<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ ‘ä¸‹çš„è€ç”·å­©</title>
  <subtitle>å·¥åŒ ä¹‹è¡Œï¼Œåœ¨è¡ŒåŠ¨ä¸­ä½“æ‚Ÿä¿®è¡Œçš„ä¹è¶£</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://freemind-lj.github.io/"/>
  <updated>2016-04-07T11:49:44.000Z</updated>
  <id>http://freemind-lj.github.io/</id>
  
  <author>
    <name>æ ‘ä¸‹çš„è€ç”·å­©</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æµ…æReactä¹‹é€šä¿¡æœºåˆ¶ï¼ˆä¸€ï¼‰</title>
    <link href="http://freemind-lj.github.io/2016/03/14/%E6%B5%85%E6%9E%90React%E4%B9%8B%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://freemind-lj.github.io/2016/03/14/æµ…æReactä¹‹é€šä¿¡æœºåˆ¶ï¼ˆä¸€ï¼‰/</id>
    <published>2016-03-14T11:38:44.000Z</published>
    <updated>2016-04-07T11:49:44.000Z</updated>
    
    <content type="html">&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-15c5ec5d168c8861.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;è‡ªä»Facebookæå‡ºäº†reactä¹‹åï¼Œè¿™ä¸ªæ¡†æ¶çš„å…³æ³¨åº¦ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œå®ƒæ‰€å¼•å…¥çš„ä¸€äº›ä¸œè¥¿è¿˜æ˜¯å€¼å¾—å­¦ä¹ ï¼Œæ¯”å¦‚ç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼ï¼Œvirtual domçš„æ€§èƒ½æå‡æ–¹å¼ç­‰ï¼Œæœ€è¿‘ä¸ºäº†æ”¹è¿›ç°æœ‰çš„è·¨å¹³å°æ–¹æ¡ˆä¹Ÿåœ¨ç ”ç©¶reactï¼Œåœ¨è¿™è¾¹ä¹Ÿåšä¸‹ç›¸å…³çš„è®°å½•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;pre&quot;&gt;&lt;a href=&quot;#pre&quot; class=&quot;headerlink&quot; title=&quot;pre&quot;&gt;&lt;/a&gt;pre&lt;/h3&gt;&lt;p&gt;åœ¨å¼€å§‹ä½¿ç”¨reactä¹‹å‰æˆ‘ä»¬éœ€è¦æ­å»ºç›¸åº”çš„ç¯å¢ƒï¼Œè¿™ä¸ªå°±ä¸åœ¨æ¢è®¨äº†ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://reactnative.cn/docs/0.20/getting-started.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œç”±äºreactéœ€è¦ä½¿ç”¨javascriptè¯­è¨€ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å»ç®€å•äº†è§£ä¸€ä¸‹ç›¸å…³çš„è¯­æ³•(æ¯”å¦‚ï¼š&lt;a href=&quot;http://es6.ruanyifeng.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ES6 æ ‡å‡†å…¥é—¨&lt;/a&gt;)ï¼Œå¦å¤–iOSåœ¨7.0ä¹‹åå¼•å…¥äº†javascriptcoreæ¡†æ¶ï¼Œæå¤§çš„æ–¹ä¾¿äº†jsè·Ÿocä¹‹é—´deé€šä¿¡ï¼Œä¹‹å‰æœ‰ä¸€ç¯‡&lt;a href=&quot;http://www.jianshu.com/p/1328e15416f3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åšå®¢&lt;/a&gt;ç®€å•çš„ä»‹ç»äº†javascriptcoreï¼Œæœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•´ä½“æ¡†æ¶&quot;&gt;&lt;a href=&quot;#æ•´ä½“æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;æ•´ä½“æ¡†æ¶&quot;&gt;&lt;/a&gt;æ•´ä½“æ¡†æ¶&lt;/h3&gt;&lt;p&gt;reactçš„æ•´ä½“ç¤ºæ„å›¾å¯ä»¥ç”¨ä¸‹é¢å›¾è¡¨ç¤ºï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„jsä»£ç å¯ä»¥åœ¨å„ä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œè¿™è®©æˆ‘ä»¬æœ‰webçš„å¼€å‘æ•ˆç‡çš„åŒæ—¶åˆæœ‰äº†åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-b6a9b19b0a599340.png&quot; alt=&quot;Learn once, write anywhere&quot;&gt;&lt;br&gt;ä¸è¿‡è¿™é‡Œé¢åŒ…å«çš„ä¸œè¥¿å¯¹äºæœ‰ç‚¹å¤šï¼Œå°¤å…¶å¾ˆå¤šwebç›¸å…³çš„ä¸œè¥¿å¯¹äºæ²¡æ¥è§¦è¿‡çš„äººè¿˜æ˜¯æœ‰äº›éš¾åº¦çš„ï¼Œè¦æƒ³å¿«é€Ÿçš„ç ”ç©¶é€å½»å¯èƒ½ä¸å¤ªç°å®ï¼Œè‡³å°‘å¯¹äºæˆ‘æ˜¯è¿™æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆç ”ç©¶ä¸€ä¸‹reactä¸­jsè·Ÿnativeä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œå…¶å®ƒçš„æœ‰å¾…åé¢åœ¨åˆ†æã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å‡è®¾ä½ å·²ç»æ­å»ºå¥½ç›¸å…³ç¯å¢ƒï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°å·¥ç¨‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;react-native init TestDemo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œxcodeprojå·¥ç¨‹ï¼ŒXcodeåœ¨ç¼–è¯‘å®Œåä¼šæ‰§è¡Œæ‰“åŒ…è„šæœ¬ï¼Œå°†jsæ–‡ä»¶éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ªmain.jsbundleæ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†è¯¥æ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šæˆ–è€…åº”ç”¨å†…éƒ¨ï¼Œå¦‚æœæ”¾åˆ°æœåŠ¡å™¨ä¸Šéœ€è¦å…ˆä¸‹è½½è¯¥æ–‡ä»¶ï¼Œæ¥ç€åŠ è½½æ‰§è¡Œè¯¥æ–‡ä»¶å¯ä»¥çœ‹åˆ°demoé¡µé¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-f4d94de13f071752.png&quot; alt=&quot;packager&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/aaaaa.png&quot; alt=&quot;demo&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;é€šä¿¡è¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#é€šä¿¡è¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;é€šä¿¡è¿‡ç¨‹&quot;&gt;&lt;/a&gt;é€šä¿¡è¿‡ç¨‹&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒæ‰€è°“çš„é€šä¿¡å…¶å®å°±æ˜¯jså’Œocä¸¤è€…å¦‚ä½•ç›¸äº’è°ƒç”¨ä¼ å‚ç­‰ï¼Œä¸ºäº†æ›´æ–¹ä¾¿çš„æ­ç¤ºä¸¤è€…çš„é€šä¿¡è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®messagequeue.jsæ–‡ä»¶ä¸­çš„SPY_MODEæ ‡å¿—ä¸ºtrueï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//MessageQueue.jsï¼Œéœ€è¦å¤„äºdevæ¨¡å¼&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//http://localhost:8081/index.ios.bundle?platform=ios&amp;amp;dev=trueä¸ºtrue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let SPY_MODE = true; //&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒç°åœ¨é‡æ–°reload jsä½ å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ—¥å¿—è¾“å‡ºï¼Œä¸‹é¢çš„æ—¥å¿—å¯ä»¥æ¯”è¾ƒç›´è§‚çš„æ­ç¤ºä¸¤è€…çš„è°ƒç”¨æ–¹å¼ï¼Œâ€™JS-&amp;gt;Nâ€™å³JSè°ƒç”¨nativeä»£ç ï¼Œåä¹‹äº¦ç„¶ã€‚å¯ä»¥çœ‹åˆ°ç¨‹åºä¸€å¼€å§‹nativeä¼šè°ƒç”¨jsçš„RCTDeviceEventEmitter.emitæ–¹æ³•ï¼Œåˆ†åˆ«å‘é€â€™appStateDidChangeâ€™ å’Œâ€™networkStatusDidChangeâ€™ä¸¤ä¸ªäº‹ä»¶ï¼Œæ¥ç€è°ƒç”¨jsçš„AppRegistry.runApplicationæ–¹æ³•å¯åŠ¨jsåº”ç”¨ï¼Œç„¶åjså±‚å°±å¯ä»¥é€šè¿‡nativeæä¾›çš„æ–¹æ³•æ¥ RCTUIManager.createViewæ¥åˆ›å»ºè§†å›¾äº†ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;N-&amp;gt;JS : RCTDeviceEventEmitter.emit([&amp;quot;appStateDidChange&amp;quot;,&amp;#123;&amp;quot;app_state&amp;quot;:&amp;quot;active&amp;quot;&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;N-&amp;gt;JS : RCTDeviceEventEmitter.emit([&amp;quot;networkStatusDidChange&amp;quot;,&amp;#123;&amp;quot;network_info&amp;quot;:&amp;quot;wifi&amp;quot;&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;N-&amp;gt;JS : AppRegistry.runApplication([&amp;quot;TestDemo&amp;quot;,&amp;#123;&amp;quot;rootTag&amp;quot;:1,&amp;quot;initialProps&amp;quot;:&amp;#123;&amp;#125;&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Running application &amp;quot;TestDemo&amp;quot; with appParams: &amp;#123;&amp;quot;rootTag&amp;quot;:1,&amp;quot;initialProps&amp;quot;:&amp;#123;&amp;#125;&amp;#125;. __DEV__ === true, development-level warning are ON, performance optimizations are OFF&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JS-&amp;gt;N : RCTUIManager.createView([2,&amp;quot;RCTView&amp;quot;,1,&amp;#123;&amp;quot;flex&amp;quot;:1&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JS-&amp;gt;N : RCTUIManager.createView([3,&amp;quot;RCTView&amp;quot;,1,&amp;#123;&amp;quot;flex&amp;quot;:1&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JS-&amp;gt;N : RCTUIManager.createView([4,&amp;quot;RCTView&amp;quot;,1,&amp;#123;&amp;quot;flex&amp;quot;:1,&amp;quot;justifyContent&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;alignItems&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;backgroundColor&amp;quot;:4294311167&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;S-&amp;gt;N : RCTUIManager.createView([5,&amp;quot;RCTText&amp;quot;,1,&amp;#123;&amp;quot;fontSize&amp;quot;:20,&amp;quot;textAlign&amp;quot;:&amp;quot;center&amp;quot;,&amp;quot;margin&amp;quot;:10,&amp;quot;accessible&amp;quot;:true,&amp;quot;allowFontScaling&amp;quot;:true&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JS-&amp;gt;N : RCTUIManager.createView([6,&amp;quot;RCTRawText&amp;quot;,1,&amp;#123;&amp;quot;text&amp;quot;:&amp;quot;Welcome to React Native!&amp;quot;&amp;#125;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JS-&amp;gt;N : RCTUIManager.setChildren([5,[6]])&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;JS-gt-Nativeï¼ŒJSè°ƒç”¨Native&quot;&gt;&lt;a href=&quot;#JS-gt-Nativeï¼ŒJSè°ƒç”¨Native&quot; class=&quot;headerlink&quot; title=&quot;JS-&amp;gt;Nativeï¼ŒJSè°ƒç”¨Native&quot;&gt;&lt;/a&gt;JS-&amp;gt;Nativeï¼ŒJSè°ƒç”¨Native&lt;/h4&gt;&lt;p&gt;è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹nativeå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¨¡å—ç„¶åæš´éœ²ç»™jså±‚è°ƒç”¨çš„ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒ&lt;a href=&quot;http://reactnative.cn/docs/0.21/native-modules-ios.html#content&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œæˆ‘ä»¬è¿™é‡Œä¸¾ä¸ªç®€å•çš„ğŸŒ°ï¼Œåˆ›å»ºä¸€ä¸ªMyModuleæ¨¡å—ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@interface MyModule : NSObject &amp;lt;RCTBridgeModule&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation MyModule&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_MODULE();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_METHOD(addEvent:(NSString *)name location:(NSString *)location)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RCTLogInfo(@&amp;quot;add an event %@ at %@&amp;quot;, name, location);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸Šé¢çš„ä¸¤ä¸ªå®å®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RCT_EXPORT_MODULE()&lt;br&gt;åœ¨nativeå±‚åˆ›å»ºçš„æ¨¡å—éœ€è¦é€šè¿‡è¿™ä¸ªå®å®šä¹‰å°†è¯¥æ¨¡å—æš´éœ²ç»™jsï¼Œè¯¥å®å®šä¹‰çš„å…·ä½“å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#define RCT_EXPORT_MODULE(js_name) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXTERN void RCTRegisterModule(Class); \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (NSString *)moduleName &amp;#123; return @#js_name; &amp;#125; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ (void)load &amp;#123; RCTRegisterModule(self); &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é¦–å…ˆå®ƒå°†RCTRegisterModuleè¿™ä¸ªå‡½æ•°å®šä¹‰ä¸ºexternï¼Œè¿™æ ·è¯¥å‡½æ•°çš„å®ç°å¯¹ç¼–è¯‘å™¨ä¸å¯è§ï¼Œä½†ä¼šåœ¨é“¾æ¥çš„æ—¶å€™å¯ä»¥è·å–åˆ°ï¼›åŒæ—¶å£°æ˜ä¸€ä¸ªmoduleNameå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›è¯¥æ¨¡å—çš„jsåç§°ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ç±»åï¼›æœ€åå£°æ˜ä¸€ä¸ªloadå‡½æ•°ï¼ˆå½“åº”ç”¨è½½å…¥åä¼šåŠ è½½æ‰€æœ‰çš„ç±»ï¼Œloadå‡½æ•°åœ¨ç±»åˆå§‹åŒ–åŠ è½½çš„æ—¶å€™å°±è°ƒç”¨ï¼‰ï¼Œç„¶åè°ƒç”¨RCTRegisterModuleå‡½æ•°æ³¨å†Œè¯¥æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¼šè¢«æ³¨å†Œæ·»åŠ åˆ°ä¸€ä¸ªå…¨å±€çš„æ•°ç»„RCTModuleClassesä¸­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RCT_EXPORT_METHOD()&lt;br&gt;è¦æš´éœ²ç»™jsè°ƒç”¨çš„APIæ¥å£éœ€è¦é€šè¿‡è¯¥å®å®šä¹‰å£°æ˜ï¼Œè¯¥å®å®šä¹‰ä¼šé¢å¤–åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå½¢å¼å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (NSArray *)__rct_export__230&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return @[ @&amp;quot;&amp;quot;, @&amp;quot;addEvent:(NSString *)name location:(NSString *)location&amp;quot; ];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¯¥å‡½æ•°åç§°ä»¥   &lt;strong&gt;rct_export&lt;/strong&gt; å¼€å¤´ï¼ŒåŒæ—¶åŠ ä¸Šè¯¥å‡½æ•°æ‰€åœ¨çš„ä»£ç è¡Œæ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«å¯é€‰çš„jsåç§°ä»¥åŠä¸€ä¸ªå‡½æ•°ç­¾åçš„æ•°ç»„ï¼Œä»–ä»¬çš„ä½œç”¨åé¢ä¼šè¯´åˆ°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RCTBatchedBridge&lt;br&gt;ä¸ºäº†æ¡¥æ¥jsè·Ÿnativeï¼Œnativeå±‚å¼•å…¥äº†RCTBridgeè¿™ä¸ªç±»è´Ÿè´£åŒæ–¹çš„é€šä¿¡ï¼Œä¸è¿‡çœŸæ­£èµ·ä½œç”¨çš„æ˜¯RCTBatchedBridgeè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»åº”è¯¥ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªç±»äº†ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ä¸»è¦åšå•¥äº‹æƒ…ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//RCTBatchedBridge.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  dispatch_queue_t bridgeQueue = dispatch_queue_create(&amp;quot;com.facebook.react.RCTBridgeQueue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // å¼‚æ­¥çš„åŠ è½½æ‰“åŒ…å®Œæˆçš„jsæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯main.jsbundleï¼Œå¦‚æœåŒ…æ–‡ä»¶åœ¨æœ¬åœ°åˆ™ç›´æ¥åŠ è½½ï¼Œå¦åˆ™æ ¹æ®URLé€šè¿‡NSURLSessionæ–¹å¼å»ä¸‹è½½&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self loadSource:^(NSError *error, NSData *source) &amp;#123;&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // åŒæ­¥åˆå§‹åŒ–éœ€è¦æš´éœ²ç»™ç»™jså±‚çš„nativeæ¨¡å—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self initModules];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å¼‚æ­¥åˆå§‹åŒ–JS Executorï¼Œä¹Ÿå°±æ˜¯jså¼•æ“&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  dispatch_group_async(setupJSExecutorAndModuleConfig, bridgeQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [weakSelf setUpExecutor];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å¼‚æ­¥è·å–å„ä¸ªæ¨¡å—çš„é…ç½®ä¿¡æ¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  dispatch_group_async(setupJSExecutorAndModuleConfig, bridgeQueue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    config = [weakSelf moduleConfig];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //è·å–å„æ¨¡å—çš„é…ç½®ä¿¡æ¯åï¼Œå°†è¿™äº›ä¿¡æ¯æ³¨å…¥åˆ°JSç¯å¢ƒä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self injectJSONConfiguration:config onComplete:^(NSError *error) &amp;#123;&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å¼€å§‹æ‰§è¡Œmain.jsbundle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self executeSourceCode:sourceCode];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç®€å•è§£é‡Šä¸€ä¸‹å…¶ä¸­å‡ ä¸ªæ­¥éª¤çš„å…·ä½“å†…å®¹ï¼š&lt;/p&gt;
&lt;h4 id=&quot;initModules&quot;&gt;&lt;a href=&quot;#initModules&quot; class=&quot;headerlink&quot; title=&quot;initModules&quot;&gt;&lt;/a&gt;initModules&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)initModules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMutableArray&amp;lt;RCTModuleData *&amp;gt; *moduleDataByID = [NSMutableArray new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMutableDictionary&amp;lt;NSString *, RCTModuleData *&amp;gt; *moduleDataByName = [NSMutableDictionary new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  SEL setBridgeSelector = NSSelectorFromString(@&amp;quot;setBridge:&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IMP objectInitMethod = [NSObject instanceMethodForSelector:@selector(init)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //RCTGetModuleClasses()è¿”å›ä¹‹å‰æåˆ°çš„å…¨å±€RCTModuleClassesæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—ç±»loadæ—¶å€™ä¼šæ³¨å†Œæ·»åŠ çš„æ•°ç»„&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  for (Class moduleClass in RCTGetModuleClasses()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *moduleName = RCTBridgeModuleNameForClass(moduleClass);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å¦‚æœè¯¥ç±»æˆ–è€…çˆ¶ç±»æ²¡æœ‰é‡å†™äº†initæ–¹æ³•æˆ–å®ç°äº†setBridgeæ–¹æ³•ï¼Œåˆ™ï¼Œåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //Reactè®¤ä¸ºå¼€å‘è€…æœŸæœ›è¿™ä¸ªæ¨¡å—åœ¨bridgeç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ä¼šå®ä¾‹åŒ–ï¼Œç¡®ä¿è¯¥æ¨¡å—åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ([moduleClass instanceMethodForSelector:@selector(init)] != objectInitMethod ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [moduleClass instancesRespondToSelector:setBridgeSelector]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      module = [moduleClass new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //åˆ›å»ºRCTModuleDataæ¨¡å—ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åˆ°æ•°ç»„ä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RCTModuleData *moduleData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (module) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (module != (id)kCFNull) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        moduleData = [[RCTModuleData alloc] initWithModuleInstance:module&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                            bridge:self];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    moduleDataByName[moduleName] = moduleData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [moduleDataByID addObject:moduleData];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“åˆ›å»ºå®Œæ¨¡å—çš„å®ä¾‹å¯¹è±¡ä¹‹åï¼Œä¼šå°†è¯¥å®ä¾‹ä¿å­˜åˆ°ä¸€ä¸ªRCTModuleDataå¯¹è±¡ä¸­ï¼ŒRCTModuleDataé‡ŒåŒ…å«æ¨¡å—çš„ç±»åï¼Œåç§°ï¼Œæ–¹æ³•åˆ—è¡¨ï¼Œå®ä¾‹å¯¹è±¡ã€è¯¥æ¨¡å—ä»£ç æ‰§è¡Œçš„é˜Ÿåˆ—ä»¥åŠé…ç½®ä¿¡æ¯ç­‰ï¼Œjså±‚å°±æ˜¯æ ¹æ®è¿™ä¸ªå¯¹è±¡æ¥æŸ¥è¯¢è¯¥æ¨¡å—çš„ç›¸å…³ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&quot;setUpExecutor&quot;&gt;&lt;a href=&quot;#setUpExecutor&quot; class=&quot;headerlink&quot; title=&quot;setUpExecutor&quot;&gt;&lt;/a&gt;setUpExecutor&lt;/h4&gt;&lt;p&gt;reactnativeçš„jså¼•æ“åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹çš„ä¼˜å…ˆçº§è·Ÿä¸»çº¿å±‚çš„ä¼˜å…ˆçº§ä¸€æ ·ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªrunloopï¼Œè¿™æ ·çº¿ç¨‹æ‰èƒ½å¾ªç¯æ‰§è¡Œä¸ä¼šé€€å‡ºã€‚æ‰€ä»¥æ‰§è¡Œjsä»£ç ä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹ï¼Œè€Œä¸”RCTJSCExecutorä½¿ç”¨çš„æ˜¯JavaScriptCoreæ¡†æ¶ï¼Œæ‰€ä»¥reactåªæ”¯æŒiOS7åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//RCTJSCExecutor.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSThread *javaScriptThread = [[NSThread alloc] initWithTarget:[self class]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                       selector:@selector(runRunLoopThread)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                         object:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  javaScriptThread.name = @&amp;quot;com.facebook.React.JavaScript&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //è®¾ç½®è¯¥çº¿ç¨‹çš„ä¼˜å…ˆçº§å¤„äºé«˜ä¼˜å…ˆçº§&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if ([javaScriptThread respondsToSelector:@selector(setQualityOfService:)]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [javaScriptThread setQualityOfService:NSOperationQualityOfServiceUserInteractive];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    javaScriptThread.threadPriority = [NSThread mainThread].threadPriority;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [javaScriptThread start];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return [self initWithJavaScriptThread:javaScriptThread context:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)addSynchronousHookWithName:(NSString *)name usingBlock:(id)block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  __weak RCTJSCExecutor *weakSelf = self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self executeBlockOnJavaScriptQueue:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å°†è¯¥blockå‡½æ•°æ·»åŠ åˆ°jsçš„contextä¸­ï¼Œjavascriptcoreä¼šå°†blockå‡½æ•°è½¬æˆjs function&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    weakSelf.context.context[name] = block;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)setUp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self addSynchronousHookWithName:@&amp;quot;noop&amp;quot; usingBlock:^&amp;#123;&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self addSynchronousHookWithName:@&amp;quot;nativeRequireModuleConfig&amp;quot; usingBlock:^NSString *(NSString *moduleName) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //è·å–è¯¥æ¨¡å—çš„å…·ä½“é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«æ–¹æ³•ä»¥åŠå¯¼å‡ºçš„å¸¸é‡ç­‰ä¿¡æ¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSArray *config = [strongSelf-&amp;gt;_bridge configForModuleName:moduleName];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *result = config ? RCTJSONStringify(config, NULL) : nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self addSynchronousHookWithName:@&amp;quot;nativeFlushQueueImmediate&amp;quot; usingBlock:^(NSArray&amp;lt;NSArray *&amp;gt; *calls)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [strongSelf-&amp;gt;_bridge handleBuffer:calls batchEnded:NO];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°setupçš„æ—¶å€™ä¼šæ³¨å†Œå‡ ä¸ªæ–¹æ³•åˆ°jsçš„ä¸Šä¸‹æ–‡ä¸­ä¾›åé¢jsè°ƒç”¨ï¼Œæ¯”å¦‚â€™nativeFlushQueueImmediateâ€™ å’Œ â€˜nativeRequireModuleConfigâ€™æ–¹æ³•ç­‰ï¼Œå½“jsè°ƒç”¨ç›¸åº”æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå¯¹åº”çš„blockï¼Œjavascriptcoreæ¡†æ¶ä¼šè´Ÿè´£js functionå’Œblockçš„è½¬æ¢ã€‚&lt;/p&gt;
&lt;h4 id=&quot;moduleConfig&quot;&gt;&lt;a href=&quot;#moduleConfig&quot; class=&quot;headerlink&quot; title=&quot;moduleConfig&quot;&gt;&lt;/a&gt;moduleConfig&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (NSString *)moduleConfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMutableArray&amp;lt;NSArray *&amp;gt; *config = [NSMutableArray new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  for (RCTModuleData *moduleData in _moduleDataByID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [config addObject:@[moduleData.name]]; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return RCTJSONStringify(@&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @&amp;quot;remoteModuleConfig&amp;quot;: config,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;, NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»å®ç°å¯ä»¥çœ‹å‡ºä»…ä»…è¯¥è¿‡ç¨‹æ˜¯å°†æ¨¡å—çš„åç§°ä¿å­˜åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªjsonå­—ç¬¦ä¸²çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å«æ‰€æœ‰çš„æ¨¡å—åç§°ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&amp;quot;remoteModuleConfig&amp;quot;:[[&amp;quot;MyModule&amp;quot;],[&amp;quot;RCTStatusBarManager&amp;quot;],[&amp;quot;RCTSourceCode&amp;quot;],[&amp;quot;RCTAlertManager&amp;quot;],[&amp;quot;RCTExceptionsManager&amp;quot;],...]&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;injectJSONConfiguration&quot;&gt;&lt;a href=&quot;#injectJSONConfiguration&quot; class=&quot;headerlink&quot; title=&quot;injectJSONConfiguration&quot;&gt;&lt;/a&gt;injectJSONConfiguration&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)injectJSONConfiguration:(NSString *)configJSON&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                     onComplete:(void (^)(NSError *))onComplete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [_javaScriptExecutor injectJSONText:configJSON&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  asGlobalObjectNamed:@&amp;quot;__fbBatchedBridgeConfig&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                             callback:onComplete];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“æˆ‘ä»¬ç”Ÿæˆé…ç½®ä¿¡æ¯ä¹‹åï¼Œé€šè¿‡ä¸Šé¢çš„å‡½æ•°å°†è¯¥jsonä¿¡æ¯ä¿å­˜åˆ°jsçš„å…¨å±€å¯¹è±¡__fbBatchedBridgeConfigä¸­ï¼Œè¿™æ ·jså±‚å°±å¯ä»¥çŸ¥é“æˆ‘ä»¬æä¾›äº†å“ªäº›æ¨¡å—ï¼Œä¸è¿‡ç»†å¿ƒçš„è¯ä½ å¯èƒ½ä¼šå‘ç°ç»™jsçš„ä¿¡æ¯åªæœ‰è¿™äº›æ¨¡å—çš„åç§°ï¼Œé‚£jsæ€ä¹ˆè°ƒç”¨nativeçš„æ–¹æ³•çš„ï¼Œå…¶å®è¿™æ˜¯reactä¸ºäº†æ‡’åŠ è½½è€Œé‡‡ç”¨çš„æ–¹å¼ï¼Œå…·ä½“æˆ‘ä»¬ä¸‹é¢è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬é…ç½®å¥½nativeæ¨¡å—åï¼Œjså±‚è¦æƒ³è°ƒç”¨è¯¥nativeæ¨¡å—çš„æ–¹æ³•å¦‚ä¸‹ç¤ºä¾‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;var myModule = require(&amp;apos;react-native&amp;apos;).NativeModules.MyModule;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;myModule.addEvent(&amp;apos;Birthday Party&amp;apos;, &amp;apos;4 Privet Drive, Surrey&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºnativeæ¨¡å—æ˜¯ä¿å­˜åœ¨NativeModulesä¸­ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ°NativeModules.jsæ–‡ä»¶ä¸­çœ‹çœ‹:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;const BatchedBridge = require(&amp;apos;BatchedBridge&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;const RemoteModules = BatchedBridge.RemoteModules;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;const NativeModules = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Object.keys(RemoteModules).forEach((moduleName) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Object.defineProperty(NativeModules, moduleName, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    enumerable: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ‡’åŠ è½½æ–¹å¼&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    get: () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      let module = RemoteModules[moduleName];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (module &amp;amp;&amp;amp; typeof module.moduleID === &amp;apos;number&amp;apos; &amp;amp;&amp;amp; global.nativeRequireModuleConfig) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //ä»nativeå±‚è·å–è¯¥æ¨¡å—çš„å…·ä½“é…ç½®ä¿¡æ¯ï¼ŒnativeRequireModuleConfigæ˜¯ä¹‹å‰æ³¨å†Œåˆ°js globalå¯¹è±¡çš„æ–¹æ³•ï¼Œç„¶åæŠŠconfigä¿¡æ¯äº¤ç»™BatchedBridgeå¤„ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        const json = global.nativeRequireModuleConfig(moduleName);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        const config = json &amp;amp;&amp;amp; JSON.parse(json);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        module = config &amp;amp;&amp;amp; BatchedBridge.processModuleConfig(config, module.moduleID);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RemoteModules[moduleName] = module;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return module;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå‡å¦‚ä½ åœ¨jså±‚æ²¡æœ‰ä½¿ç”¨åˆ°nativeæ¨¡å—ï¼Œé‚£ä¹ˆè¿™äº›æ¨¡å—æ˜¯ä¸ä¼šåŠ è½½åˆ°jså±‚çš„ï¼Œåªæœ‰ä½¿ç”¨åˆ°äº†è¯¥æ¨¡å—ï¼Œreactæ‰ä¼šå»è·å–è¯¥æ¨¡å—çš„å…·ä½“é…ç½®ä¿¡æ¯ç„¶ååŠ è½½åˆ°js,è¿™æ˜¯reactæ‡’åŠ è½½çš„ä¸€ä¸ªæ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½å¤ŸèŠ‚çº¦å†…å­˜,è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è·å–æ¨¡å—çš„é…ç½®ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//åªä¼šå¯¼å‡ºæœ‰__rct_export__å‰ç¼€çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰RCT_EXPORT_METHODè¿™ä¸ªå®å®šä¹‰æåˆ°çš„&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (NSArray&amp;lt;id&amp;lt;RCTBridgeMethod&amp;gt;&amp;gt; *)methods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //æ‹·è´è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œç„¶åè¿‡æ»¤ä»¥__rct_export__å¼€å¤´çš„æ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Method *methods = class_copyMethodList(object_getClass(_moduleClass), &amp;amp;methodCount);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  for (unsigned int i = 0; i &amp;lt; methodCount; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method method = methods[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SEL selector = method_getName(method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ([NSStringFromSelector(selector) hasPrefix:@&amp;quot;__rct_export__&amp;quot;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      IMP imp = method_getImplementation(method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      NSArray&amp;lt;NSString *&amp;gt; *entries =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((NSArray&amp;lt;NSString *&amp;gt; *(*)(id, SEL))imp)(_moduleClass, selector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [moduleMethods addObject:/*ä»£è¡¨è¯¥æ–¹æ³•çš„å¯¹è±¡*/];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è·å–æ¨¡å—çš„å…·ä½“é…ç½®ä¿¡æ¯ï¼Œä»¥æ•°ç»„å½¢å¼è¿”å›ï¼Œç¬¬ä¸€ä¸ªä¸ºæ¨¡å—åç§°ï¼Œç¬¬äºŒä¸ªä¸ºéœ€è¦å¯¼å‡ºçš„å¸¸é‡ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç¬¬ä¸‰ä¸ªä¸ºå¯¼å‡ºçš„æ–¹æ³•ï¼ˆå¦‚æœæœ‰ï¼‰&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä»¥MyModuleä¸ºä¾‹ï¼Œå¯¼å‡ºçš„configä¸ºï¼š[&amp;quot;MyModule&amp;quot;,&amp;#123;&amp;quot;FirstDay&amp;quot;:&amp;quot;Monday&amp;quot;&amp;#125;,[&amp;quot;addEvent&amp;quot;,&amp;quot;findEvents&amp;quot;]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (NSArray *)config&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //è¿‡æ»¤è·å–ä»¥__rct_export__å¼€å¤´çš„æ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  for (id&amp;lt;RCTBridgeMethod&amp;gt; method in self.methods) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [methods addObject:method.JSMethodName];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMutableArray *config = [NSMutableArray new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [config addObject:self.name];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (constants.count) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [config addObject:constants];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (methods) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [config addObject:methods];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return config;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¼å‡ºçš„é…ç½®ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°configé‡ŒåŒ…å«çš„æ¨¡å—åç§°ï¼Œå¯¼å‡ºçš„å¸¸é‡ä»¥åŠå¯¼å‡ºçš„å‡½æ•°ç­‰ï¼Œæ¨èé€šè¿‡è°ƒè¯•å·¥å…·&lt;a href=&quot;https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;React Developer Tools&lt;/a&gt;æ‰“æ–­ç‚¹æ¥æŸ¥çœ‹ï¼š&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-55517b729679058d.png&quot; alt=&quot;__fbBatchedBridgeConfig&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BatchedBridge&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬è¯´è¿‡è·å–åˆ°æ¨¡å—çš„å…·ä½“é…ç½®ä¿¡æ¯ä¹‹åä¼šäº¤ç»™BatchedBridgeå¤„ç†ï¼Œä¹‹å‰æˆ‘ä»¬è¯´çš„æ˜¯nativeçš„bridgeï¼Œä¸è¿‡jsä¸ºäº†æ¡¥æ¥nativeå±‚ä¹Ÿå¼•å…¥äº†BatchedBridgeï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//BatchedBridge.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;const MessageQueue = require(&amp;apos;MessageQueue&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;const BatchedBridge = new MessageQueue(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  __fbBatchedBridgeConfig.remoteModuleConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  __fbBatchedBridgeConfig.localModulesConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å°†BatchedBridgeæ·»åŠ åˆ°jsçš„å…¨å±€globalå¯¹è±¡ä¸­ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Object.defineProperty(global, &amp;apos;__fbBatchedBridge&amp;apos;, &amp;#123; value: BatchedBridge &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;module.exports = BatchedBridge;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°BatchedBridgeæ˜¯MessageQueueçš„ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”æ˜¯å…¨å±€å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½œä¸ºæ¡¥æ¥nativeçš„ä¸€ä¸ªå…³é”®ç‚¹ï¼Œæˆ‘ä»¬æ¥å…·ä½“æ·±å…¥çœ‹ä¸€ä¸‹å®ƒçš„å†…éƒ¨å®ç°â€œã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹ä¼ é€’ç»™messageQueueçš„ä¸¤ä¸ªå‚æ•°&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__fbBatchedBridgeConfig.remoteModuleConfig,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__fbBatchedBridgeConfig.localModulesConfig,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;fbBatchedBridgeConfigæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„jså˜é‡ï¼Œ&lt;/strong&gt;fbBatchedBridgeConfig.remoteModuleConfigå°±æ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨nativeå±‚å¯¼å‡ºçš„æ¨¡å—é…ç½®è¡¨.&lt;/p&gt;
&lt;h3 id=&quot;messageQueue&quot;&gt;&lt;a href=&quot;#messageQueue&quot; class=&quot;headerlink&quot; title=&quot;messageQueue&quot;&gt;&lt;/a&gt;messageQueue&lt;/h3&gt;&lt;p&gt;é¦–å…ˆçœ‹ä¸€ä¸‹messageQueueé‡Œçš„ä¸€äº›å®ä¾‹å˜é‡ä»¥åŠAPI&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//å­˜å‚¨nativeæä¾›çš„å„ä¸ªæ¨¡å—ä¿¡æ¯ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this.RemoteModules = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å­˜å‚¨jsæä¾›çš„å„ä¸ªæ¨¡å—ä¿¡æ¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._callableModules = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç”¨äºå­˜æ”¾è°ƒç”¨ä¿¡æ¯é˜Ÿåˆ—ï¼Œæœ‰ä¸‰ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å¯¹åº”è°ƒç”¨çš„æ¨¡å—ï¼Œè°ƒç”¨çš„å‡½æ•°å’Œå‚æ•°ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç”±è¿™ä¸‰ä¸ªæ•°ç»„æ‹¼æ¥è€Œæˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._queue = [[], [], [], 0];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä»¥moduleIDä¸ºkeyï¼Œvalueä¸ºmoduleNameï¼Œé’ˆå¯¹jsæä¾›çš„module&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._moduleTable = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä»¥moduleIdä¸ºkeyï¼Œvalueä¸ºæ¨¡å—å¯¼å‡ºçš„æ–¹æ³•ï¼Œé’ˆå¯¹jsæä¾›çš„module&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._methodTable = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å›è°ƒå‡½æ•°æ•°ç»„&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._callbacks = [];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å›è°ƒå‡½æ•°å¯¹åº”çš„ç´¢å¼•id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._callbackID = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let modulesConfig = this._genModulesConfig(remoteModules);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._genModules(modulesConfig);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;localModules &amp;amp;&amp;amp; this._genLookupTables(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this._genModulesConfig(localModules),this._moduleTable, this._methodTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä»¥moduleIdä¸ºkeyï¼Œvalueä¸ºmoduleNameï¼Œé’ˆå¯¹nativeæä¾›çš„module&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._remoteModuleTable = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä»¥moduleIdä¸ºkeyï¼Œvalueä¸ºæ¨¡å—å¯¼å‡ºçš„æ–¹æ³•ï¼Œé’ˆå¯¹nativeæä¾›module&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;this._remoteMethodTable = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¿™ä¸ªé˜Ÿåˆ—é‡Œä¿å­˜ç€jsè·Ÿnativeçš„æ¨¡å—äº¤äº’çš„æ‰€æœ‰ä¿¡æ¯ã€‚å…ˆçœ‹ä¸€ä¸‹_genModulesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ ¹æ®configè§£ææ¯ä¸ªæ¨¡å—çš„ä¿¡æ¯å¹¶ä¿å­˜åˆ°this.RemoteModulesä¸­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;_genModules(remoteModules) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  remoteModules.forEach((config, moduleID) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    this._genModule(config, moduleID);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;_genModulesä¼šå†éæ‰€æœ‰çš„remoteModules,æ ¹æ®æ¯ä¸ªæ¨¡å—çš„é…ç½®ä¿¡æ¯(å¦‚ä½•ç”Ÿæˆé…ç½®ä¿¡æ¯ä¸‹é¢ä¼šæåˆ°)å’Œmoduleç´¢å¼•IDæ¥åˆ›å»ºæ¯ä¸ªæ¨¡å—&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;_genModule(config, moduleID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let moduleName, constants, methods, asyncMethods;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //é€šè¿‡è§£æ„èµ‹å€¼çš„æ–¹å¼æå–é…ç½®ä¿¡æ¯ä¸­çš„æ¨¡å—åç§°ï¼Œå¸¸é‡(å¦‚æœæœ‰)ï¼Œæ–¹æ³•åç­‰&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [moduleName, constants, methods, asyncMethods] = config;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let module = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  methods &amp;amp;&amp;amp; methods.forEach((methodName, methodID) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å†éè¯¥configä¸­çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ ¹æ®é…ç½®ä¿¡æ¯ä¸ºæ¯ä¸ªæ¨¡å—ç”Ÿæˆjs functionæ–¹æ³•å¹¶æ·»åŠ åˆ°moduleå¯¹è±¡ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    module[methodName] = this._genMethod(moduleID, methodID, methodType);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å¸¸é‡ä¿¡æ¯assignåˆ°è¯¥moduleå¯¹è±¡,å¹¶å°†moduleä¿å­˜åˆ°this.RemoteModulesä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Object.assign(module, constants);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.RemoteModules[moduleName] = module;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return module;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;_genMethodæ–¹æ³•å¦‚ä¸‹ï¼Œå‡å¦‚æ–¹æ³•çš„typeä¸ºremoteAsyncï¼Œä¹Ÿå°±æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯ç”¨ä¸€ä¸ªpromiseå¯¹è±¡(promiseæ˜¯jsä¸­çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹å¼)æ¥åŒ…è£…æ™®é€šçš„æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åªçœ‹ä¸‹æ™®é€šæ–¹æ³•çš„å¤„ç†è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;_genMethod(module, method, type) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let fn = null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let self = this;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fn = function(...args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let lastArg = args.length &amp;gt; 0 ? args[args.length - 1] : null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let secondLastArg = args.length &amp;gt; 1 ? args[args.length - 2] : null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let hasSuccCB = typeof lastArg === &amp;apos;function&amp;apos;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let hasErrorCB = typeof secondLastArg === &amp;apos;function&amp;apos;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  hasErrorCB &amp;amp;&amp;amp; invariant(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hasSuccCB,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;apos;Cannot have a non-function arg after a function arg.&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let numCBs = hasSuccCB + hasErrorCB;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let onSucc = hasSuccCB ? lastArg : null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  let onFail = hasErrorCB ? secondLastArg : null;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  args = args.slice(0, args.length - numCBs);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return self.__nativeCall(module, method, args, onFail, onSucc);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fn.type = type;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return fn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯åœ¨å‚æ•°åˆ—è¡¨ä¸­æå–onFailå’ŒonSuccå›è°ƒå‡½æ•°ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨__nativeCallæ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;  __nativeCall(module, method, params, onFail, onSucc) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (onFail || onSucc) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      onFail &amp;amp;&amp;amp; params.push(this._callbackID);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      this._callbacks[this._callbackID++] = onFail;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      onSucc &amp;amp;&amp;amp; params.push(this._callbackID);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      this._callbacks[this._callbackID++] = onSucc;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    this._queue[MODULE_IDS].push(module);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    this._queue[METHOD_IDS].push(method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    this._queue[PARAMS].push(params);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var now = new Date().getTime();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å½“ä¸¤æ¬¡è°ƒç”¨é—´éš”è¿‡å°çš„æ—¶å€™åªæ˜¯å…ˆç¼“å­˜è°ƒç”¨ä¿¡æ¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (global.nativeFlushQueueImmediate &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        now - this._lastFlush &amp;gt;= MIN_TIME_BETWEEN_FLUSHES_MS) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      global.nativeFlushQueueImmediate(this._queue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      this._queue = [[], [], [], this._callID];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      this._lastFlush = now;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//RCTJSCExecutor.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self addSynchronousHookWithName:@&amp;quot;nativeFlushQueueImmediate&amp;quot; usingBlock:^(NSArray&amp;lt;NSArray *&amp;gt; *calls)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [strongSelf-&amp;gt;_bridge handleBuffer:calls batchEnded:NO];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;__nativeCallæ–¹æ³•ä¸­ï¼Œå‡å¦‚æœ‰å›è°ƒå‚æ•°onFailæˆ–onSuccï¼Œä¼šå°†å¯¹åº”çš„callbackIDä¿å­˜åˆ°å‚æ•°ä¸­ï¼Œå¹¶å°†å®ƒä»¬å‹å…¥åˆ°_callbacksæ ˆä¸­ï¼›æ¥ç€å°†æ¨¡å—ï¼Œåç§°ä»¥åŠå‚æ•°åˆ†åˆ«ä¿å­˜åˆ°_queueçš„ä¸‰ä¸ªæ•°ç»„ä¸­ï¼›æ¥ä¸‹æ¥çš„å…³é”®å°±æ˜¯è°ƒç”¨nativeFlushQueueImmediateæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ä¹‹å‰RCTJSCExecutor setupçš„æ—¶å€™æ³¨å†Œåˆ°js globalçš„æ–¹æ³•ï¼Œå› æ­¤å®ƒä¼šæ‰§è¡Œç›¸åº”çš„native blockæ–¹æ³•(javascriptcoreæ¡†æ¶ä¼šè´Ÿè´£js functionå’Œblockçš„è½¬æ¢)ï¼Œå¯ä»¥çœ‹å‡º_queueä¸­çš„æ¨¡å—ã€æ–¹æ³•ä»¥åŠå‚æ•°ä¿¡æ¯æœ€ç»ˆä¼šä¼ é€’ç»™nativeå±‚ï¼Œç”±nativeè§£æå¹¶æ‰§è¡Œç›¸åº”çš„nativeæ–¹æ³•ã€‚&lt;br&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥æ³¨æ„åˆ°è¿™é‡Œreactä¸ºäº†æ€§èƒ½çš„ä¼˜åŒ–ï¼Œå½“jsä¸¤æ¬¡è°ƒç”¨æ–¹æ³•çš„é—´éš”å°äºMIN_TIME_BETWEEN_FLUSHES_MS(5ms)æ—¶é—´ï¼Œä¼šå°†è°ƒç”¨ä¿¡æ¯å…ˆç¼“å­˜åˆ°_queueä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡åœ¨ä¸€å¹¶æäº¤ç»™nativeå±‚æ‰§è¡Œï¼Œå¯èƒ½è¿™ä¹Ÿå°±æ˜¯è¿™äº›å‚æ•°è®¾ç½®æˆæ•°ç»„å½¢å¼ä¿å­˜çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬åœ¨æ¥ä¸‹å»çœ‹çœ‹handleBufferï¼ŒhandleBufferä¼šå°†è°ƒç”¨ä¿¡æ¯å…ˆæŒ‰æ¨¡å—çš„é˜Ÿåˆ—åˆ†å¥½ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//RCTBatchedBridge.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)handleBuffer:(id)buffer batchEnded:(BOOL)batchEnded&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray *requestsArray = [RCTConvert NSArray:buffer];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å…ˆå°†messageueueä¼ é€’çš„å‚æ•°æå–å‡ºæ¥åˆ†åˆ«æ”¾åˆ°moduleIDsã€methodIDså’ŒparamsArraysæ•°ç»„ä¸­ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray&amp;lt;NSNumber *&amp;gt; *moduleIDs = [RCTConvert NSNumberArray:requestsArray[RCTBridgeFieldRequestModuleIDs]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray&amp;lt;NSNumber *&amp;gt; *methodIDs = [RCTConvert NSNumberArray:requestsArray[RCTBridgeFieldMethodIDs]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray&amp;lt;NSArray *&amp;gt; *paramsArrays = [RCTConvert NSArrayArray:requestsArray[RCTBridgeFieldParamss]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //å°†è°ƒç”¨çš„ä¿¡æ¯å…ˆå®‰æ¨¡å—å„è‡ªæŒ‡å®šçš„é˜Ÿåˆ—åˆ†å¥½&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMapTable *buckets = [[NSMapTable alloc] initWithKeyOptions:NSPointerFunctionsStrongMemory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                  valueOptions:NSPointerFunctionsStrongMemory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      capacity:_moduleDataByName.count];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [moduleIDs enumerateObjectsUsingBlock:^(NSNumber *moduleID, NSUInteger i, __unused BOOL *stop) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RCTModuleData *moduleData = _moduleDataByID[moduleID.integerValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_queue_t queue = moduleData.methodQueue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (!set) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      set = [NSMutableOrderedSet new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [buckets setObject:set forKey:moduleData.methodQueue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [set addObject:@(i)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //æŒ‰é˜Ÿåˆ—æ¥æ‰¹é‡æ‰§è¡Œç›¸åº”çš„è°ƒç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  for (dispatch_queue_t queue in buckets) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_block_t block = ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      RCTProfileEndFlowEvent();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      NSOrderedSet *calls = [buckets objectForKey:queue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      @autoreleasepool &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for (NSNumber *indexObj in calls) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          NSUInteger index = indexObj.unsignedIntegerValue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          //åœ¨å„è‡ªæ¨¡å—ä¸Šæ ¹æ®å‚æ•°æ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          [self _handleRequestNumber:index&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            moduleID:[moduleIDs[index] integerValue]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            methodID:[methodIDs[index] integerValue]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                              params:paramsArrays[index]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (queue == RCTJSThread) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [_javaScriptExecutor executeBlockOnJavaScriptQueue:block];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else if (queue) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      dispatch_async(queue, block);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;_handleRequestNumberæ ¹æ®æ¨¡å—çš„IDã€æ–¹æ³•IDä»¥åŠå‚æ•°æ¥è°ƒç”¨å…·ä½“çš„å‡½æ•°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)_handleRequestNumber:(NSUInteger)i&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    moduleID:(NSUInteger)moduleID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    methodID:(NSUInteger)methodID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                      params:(NSArray *)params&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RCTModuleData *moduleData = _moduleDataByID[moduleID];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id&amp;lt;RCTBridgeMethod&amp;gt; method = moduleData.methods[methodID];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [method invokeWithBridge:self module:moduleData.instance arguments:params];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­å¦‚ä½•æ ¹æ®å‡½æ•°ç­¾åæ¥è°ƒç”¨å‡½æ•°å¯ä»¥å…·ä½“æŸ¥é˜…-(void)processMethodSignatureå‡½æ•°ï¼Œè¿™é‡Œå°±ä¸å»ç»†è°ˆäº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å›è°ƒå‡½æ•°&lt;br&gt;å½“æœ‰å›è°ƒå‡½æ•°çš„æ—¶å€™ï¼Œä¹‹å‰çœ‹åˆ°__nativeCallä¼šå°†callbackIDæ”¾ç½®åœ¨å‚æ•°ä¸­ï¼Œå¯¹åº”çš„å›è°ƒå‡½æ•°æ’å…¥åˆ°_callbacksä¸­ä¿å­˜ï¼Œjså°†è¯¥IDä¼ é€’ç»™nativeï¼Œnativeå°±æ˜¯é€šè¿‡è¯¥IDæ¥æ‰¾åˆ°å¯¹åº”çš„å›è°ƒå‡½æ•°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//MyModule.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_METHOD(findEvents:(RCTResponseSenderBlock)callback)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray *events = @[@&amp;quot;test1&amp;quot;,@&amp;quot;test2&amp;quot;,@&amp;quot;test3&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  callback(@[[NSNull null], events]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç”Ÿæˆçš„å‡½æ•°ç­¾å&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;findEvents:(RCTResponseSenderBlock)callback&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¯”å¦‚MyModuleå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œå½“é€šè¿‡å‡½æ•°ç­¾åå¦‚æœå‘ç°å‚æ•°çš„ç±»å‹æ˜¯RCTResponseSenderBlockï¼Œåˆ™jsä¼ é€’è¿‡æ¥çš„å‚æ•°å°±æ˜¯å›è°ƒå‡½æ•°çš„IDï¼Œnativeå±‚å°±ä¼šæ ¹æ®è¯¥IDä»¥åŠRCTResponseSenderBlockæä¾›çš„å‚æ•°æ¥å›è°ƒç›¸åº”çš„jså›è°ƒå‡½æ•°ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¯ä»¥ç®€å•çš„ç”¨ä¸‹å›¾è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-55bd1d087f5b19af.png&quot; alt=&quot;è°ƒç”¨è¿‡ç¨‹&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;Native-gt-JSï¼ŒNativeè°ƒç”¨JS&quot;&gt;&lt;a href=&quot;#Native-gt-JSï¼ŒNativeè°ƒç”¨JS&quot; class=&quot;headerlink&quot; title=&quot;Native-&amp;gt;JSï¼ŒNativeè°ƒç”¨JS&quot;&gt;&lt;/a&gt;Native-&amp;gt;JSï¼ŒNativeè°ƒç”¨JS&lt;/h4&gt;&lt;p&gt;å‡å¦‚ä½ æœ‰è‡ªå·±åˆ›å»ºçš„jsæ¨¡å—æƒ³è¦è¢«nativeå±‚è°ƒç”¨ï¼Œä¹Ÿéœ€è¦å°†è¯¥jsæ¨¡å—æ³¨å†Œæ·»åŠ åˆ°messagequeueçš„_callableModulesä¸­ï¼Œæ¯”å¦‚reactjsçš„äº‹ä»¶å‘é€æ¨¡å—ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//RCTEventEmitter.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BatchedBridge.registerCallableModule(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;apos;RCTEventEmitter&amp;apos;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ReactNativeEventEmitter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/bbbbb.png&quot; alt=&quot;æ³¨å†Œjsæ¨¡å—&quot;&gt;&lt;br&gt;nativeå±‚è°ƒç”¨çš„jsæ–¹æ³•ç±»ä¼¼å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Â  [_bridge enqueueJSCall:@&amp;quot;RCTEventEmitter.receiveEvent&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  args:body ? @[body[@&amp;quot;target&amp;quot;], name, body] : @[body[@&amp;quot;target&amp;quot;], name]];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡è®©æˆ‘ä»¬æ¥çœ‹çœ‹çœŸæ­£æ‰§è¡Œjsä»£ç çš„åœ°æ–¹ï¼Œé‡Œé¢å…¶å®å°±æ˜¯ç”¨åˆ°javascriptcoreæ¡†æ¶ï¼Œä¸ºäº†æ–¹ä¾¿æ–­ç‚¹è°ƒè¯•æˆ‘æŠŠå®å»æ‰äº†ï¼Œä¸è¿‡ä¸å½±å“ï¼Œç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)_executeJSCall:(NSString *)method&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â  Â  Â  arguments:(NSArray *)arguments&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  Â  Â  Â  callback:(RCTJavaScriptCallback)onComplete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  dispatch_block_t myBlock = ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  JSGlobalContextRef contextJSRef = JSContextGetGlobalContext(strongSelf-&amp;gt;_context.ctx);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  JSObjectRef globalObjectJSRef = JSContextGetGlobalObject(strongSelf-&amp;gt;_context.ctx);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  //ä»jsçš„å…¨å±€å¯¹è±¡ä¸­è·å–BatchedBridgeå¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  JSStringRef moduleNameJSStringRef = JSStringCreateWithUTF8CString(&amp;quot;__fbBatchedBridge&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  JSValueRef moduleJSRef = JSObjectGetProperty(contextJSRef, globalObjectJSRef, moduleNameJSStringRef, &amp;amp;errorJSRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  JSStringRelease(moduleNameJSStringRef)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  if (moduleJSRef != NULL &amp;amp;&amp;amp; errorJSRef == NULL &amp;amp;&amp;amp; !JSValueIsUndefined(contextJSRef, moduleJSRef)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  //è·å–jså¯¹è±¡ç›¸åº”çš„æ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  JSStringRef methodNameJSStringRef = JSStringCreateWithCFString((__bridge CFStringRef)method);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  JSValueRef methodJSRef = JSObjectGetProperty(contextJSRef, (JSObjectRef)moduleJSRef, methodNameJSStringRef, &amp;amp;errorJSRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  JSStringRelease(methodNameJSStringRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  if (methodJSRef != NULL &amp;amp;&amp;amp; errorJSRef == NULL &amp;amp;&amp;amp; !JSValueIsUndefined(contextJSRef, methodJSRef)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  // è°ƒç”¨ç›¸åº”çš„jså‡½æ•°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  if (arguments.count == 0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  Â  resultJSRef = JSObjectCallAsFunction(contextJSRef, (JSObjectRef)methodJSRef, (JSObjectRef)moduleJSRef, 0, NULL, &amp;amp;errorJSRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  [self executeBlockOnJavaScriptQueue:myBlock];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºnativeè°ƒç”¨jsçš„ä»£ç å€ŸåŠ©JavaScriptCoreæ¡†æ¶å˜çš„éå¸¸ç®€å•ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h4&gt;&lt;p&gt;ä¸Šé¢ç®€å•çš„è¯´æ˜äº†reactä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ï¼Œè‡³äºè·Ÿviewç›¸å…³çš„å†…å®¹ä¸‹æ¬¡åœ¨è®¨è®ºï¼Œè¿™ä¸ªå…¶å®æ‰æ˜¯reactæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œå¦‚æœæœ‰å…´è¶£æ¬¢è¿ä¸€èµ·äº¤æµï½&lt;/p&gt;
&lt;h3 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://facebook.github.io/react-native/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://facebook.github.io/react-native/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tadeuzagallo.com/blog/react-native-bridge/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://tadeuzagallo.com/blog/react-native-bridge/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-15c5ec5d168c8861.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;è‡ªä»Facebookæå‡ºäº†reactä¹‹åï¼Œè¿™ä¸ªæ¡†æ¶çš„å…³æ³¨åº¦ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œå®ƒæ‰€å¼•å…¥çš„ä¸€äº›ä¸œè¥¿è¿˜æ˜¯å€¼å¾—å­¦ä¹ ï¼Œæ¯”å¦‚ç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼ï¼Œvirtual domçš„æ€§èƒ½æå‡æ–¹å¼ç­‰ï¼Œæœ€è¿‘ä¸ºäº†æ”¹è¿›ç°æœ‰çš„è·¨å¹³å°æ–¹æ¡ˆä¹Ÿåœ¨ç ”ç©¶reactï¼Œåœ¨è¿™è¾¹ä¹Ÿåšä¸‹ç›¸å…³çš„è®°å½•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;pre&quot;&gt;&lt;a href=&quot;#pre&quot; class=&quot;headerlink&quot; title=&quot;pre&quot;&gt;&lt;/a&gt;pre&lt;/h3&gt;&lt;p&gt;åœ¨å¼€å§‹ä½¿ç”¨reactä¹‹å‰æˆ‘ä»¬éœ€è¦æ­å»ºç›¸åº”çš„ç¯å¢ƒï¼Œè¿™ä¸ªå°±ä¸åœ¨æ¢è®¨äº†ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://reactnative.cn/docs/0.20/getting-started.html&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œç”±äºreactéœ€è¦ä½¿ç”¨javascriptè¯­è¨€ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å»ç®€å•äº†è§£ä¸€ä¸‹ç›¸å…³çš„è¯­æ³•(æ¯”å¦‚ï¼š&lt;a href=&quot;http://es6.ruanyifeng.com/&quot;&gt;ES6 æ ‡å‡†å…¥é—¨&lt;/a&gt;)ï¼Œå¦å¤–iOSåœ¨7.0ä¹‹åå¼•å…¥äº†javascriptcoreæ¡†æ¶ï¼Œæå¤§çš„æ–¹ä¾¿äº†jsè·Ÿocä¹‹é—´deé€šä¿¡ï¼Œä¹‹å‰æœ‰ä¸€ç¯‡&lt;a href=&quot;http://www.jianshu.com/p/1328e15416f3&quot;&gt;åšå®¢&lt;/a&gt;ç®€å•çš„ä»‹ç»äº†javascriptcoreï¼Œæœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•´ä½“æ¡†æ¶&quot;&gt;&lt;a href=&quot;#æ•´ä½“æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;æ•´ä½“æ¡†æ¶&quot;&gt;&lt;/a&gt;æ•´ä½“æ¡†æ¶&lt;/h3&gt;&lt;p&gt;reactçš„æ•´ä½“ç¤ºæ„å›¾å¯ä»¥ç”¨ä¸‹é¢å›¾è¡¨ç¤ºï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„jsä»£ç å¯ä»¥åœ¨å„ä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œè¿™è®©æˆ‘ä»¬æœ‰webçš„å¼€å‘æ•ˆç‡çš„åŒæ—¶åˆæœ‰äº†åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-b6a9b19b0a599340.png&quot; alt=&quot;Learn once, write anywhere&quot;&gt;&lt;br&gt;ä¸è¿‡è¿™é‡Œé¢åŒ…å«çš„ä¸œè¥¿å¯¹äºæœ‰ç‚¹å¤šï¼Œå°¤å…¶å¾ˆå¤šwebç›¸å…³çš„ä¸œè¥¿å¯¹äºæ²¡æ¥è§¦è¿‡çš„äººè¿˜æ˜¯æœ‰äº›éš¾åº¦çš„ï¼Œè¦æƒ³å¿«é€Ÿçš„ç ”ç©¶é€å½»å¯èƒ½ä¸å¤ªç°å®ï¼Œè‡³å°‘å¯¹äºæˆ‘æ˜¯è¿™æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆç ”ç©¶ä¸€ä¸‹reactä¸­jsè·Ÿnativeä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œå…¶å®ƒçš„æœ‰å¾…åé¢åœ¨åˆ†æã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="æºç è§£æ" scheme="http://freemind-lj.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
      <category term="ReactNative" scheme="http://freemind-lj.github.io/tags/ReactNative/"/>
    
  </entry>
  
  <entry>
    <title>è¯´è¯´JavaScriptCore</title>
    <link href="http://freemind-lj.github.io/2016/03/01/%E8%AF%B4%E8%AF%B4JavaScriptCore/"/>
    <id>http://freemind-lj.github.io/2016/03/01/è¯´è¯´JavaScriptCore/</id>
    <published>2016-03-01T09:43:12.000Z</published>
    <updated>2016-04-07T11:36:30.000Z</updated>
    
    <content type="html">&lt;p&gt;javascriptç›®å‰çœ‹æ¥ä»æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ï¼Œä¸ç®¡åœ¨webã€æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå¾ˆå¤šè·¨å¹³å°æ–¹æ¡ˆä¹Ÿé‡‡ç”¨jsæ¥å®ç°ï¼Œæ¯”å¦‚è‘—åçš„reactjsï¼Œè‹¹æœåœ¨iOS7å¼•å…¥äº†javascriptcoreåº“ï¼Œæä¾›æ›´ç®€å•æ–¹ä¾¿çš„æ–¹å¼å°†jsæ¥å…¥ï¼ŒiOS7ä¹‹å‰è¦æ‰§è¡Œjsæ“ä½œåªèƒ½é€šè¿‡UIWebviewä¸­çš„&lt;br&gt;stringByEvaluatingJavaScriptFromStringæ–¹æ³•ï¼Œè€Œä¸”JavaScriptCoreè¿™å—çš„ä»£ç å¼€æºï¼Œå¯ä»¥åˆ°&lt;a href=&quot;https://github.com/phoboslab/JavaScriptCore-iOS&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹ï¼Œæœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸€ä¸‹JavaScriptCoreï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Objective-Cè°ƒç”¨JavaScript&lt;/li&gt;
&lt;li&gt;JavaScriptè°ƒç”¨Objective-C&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†&lt;/li&gt;
&lt;li&gt;å¤šçº¿ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸è¿‡åœ¨é‚£ä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JSContext&lt;br&gt;ä¸€ä¸ªJSContextå®ä¾‹ä»£è¡¨ç€ä¸€ä¸ªjsè¿è¡Œæ—¶ç¯å¢ƒï¼Œjsä»£ç éƒ½éœ€è¦åœ¨ä¸€ä¸ªcontextä¸Šä¸‹æ–‡å†…æ‰§è¡Œï¼Œè€Œä¸”JSContextè¿˜è´Ÿè´£ç®¡ç†jsè™šæ‹Ÿæœºä¸­æ‰€æœ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;JSValue&lt;br&gt;è¡¨ç¤ºä¸€ä¸ªJavaScriptçš„å®ä½“ï¼Œä¸€ä¸ªJSValueå¯ä»¥è¡¨ç¤ºå¾ˆå¤šJavaScriptåŸå§‹ç±»å‹ä¾‹å¦‚boolean, integers, doublesï¼Œç”šè‡³åŒ…æ‹¬å¯¹è±¡å’Œå‡½æ•°ã€‚æˆ‘ä»¬å¯¹JSçš„æ“ä½œéƒ½æ˜¯é€šè¿‡å®ƒï¼Œå¹¶ä¸”æ¯ä¸ªJSValueéƒ½å¼ºå¼•ç”¨ä¸€ä¸ªcontextã€‚åŒæ—¶ï¼ŒOCå’ŒJSå¯¹è±¡ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ˜¯é€šè¿‡å®ƒï¼Œç›¸åº”çš„ç±»å‹è½¬æ¢å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-c67085793e9f170e.png&quot; alt=&quot;JSValueç±»å‹è½¬æ¢&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JSVirtualMachine&lt;br&gt;jsä»£ç è¿è¡Œçš„è™šæ‹Ÿæœºï¼Œæä¾›JavaScriptCoreæ‰§è¡Œéœ€è¦çš„èµ„æºï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„å †æ ˆä»¥åŠåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè€Œä¸”é€šè¿‡é”æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœéœ€è¦å¹¶å‘æ‰§è¡Œjsä»£ç ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„JSVirtualMachineè™šæ‹Ÿæœºå¯¹è±¡æ¥å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;Objective-Cè°ƒç”¨JavaScript&quot;&gt;&lt;a href=&quot;#Objective-Cè°ƒç”¨JavaScript&quot; class=&quot;headerlink&quot; title=&quot;Objective-Cè°ƒç”¨JavaScript&quot;&gt;&lt;/a&gt;Objective-Cè°ƒç”¨JavaScript&lt;/h3&gt;&lt;p&gt;ocæƒ³è¦è°ƒç”¨jsä»£ç çš„è¯ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªJSContextå¯¹è±¡å®ä¾‹ï¼Œæ¥ç€é€šè¿‡evaluateScriptåŠ è½½jsä»£ç åˆ°contextå¯¹è±¡ä¸­ï¼Œç„¶åè·å–jså¯¹è±¡ï¼Œå¦‚æœä¸ºjså‡½æ•°å¯¹è±¡ï¼Œé€šè¿‡callWithArgumentsè°ƒç”¨è¯¥jså‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥ä»¥æ•°ç»„çš„æ–¹å¼ä¼ é€’å‚æ•°ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;var appendString = function(name) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return &amp;apos;string:&amp;apos; + name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;var arr = [1, 2 , &amp;apos;hello world&amp;apos;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//test.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *jsPath = [[NSBundle mainBundle] pathForResource:@&amp;quot;test&amp;quot;ofType:@&amp;quot;js&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *jsContent = [NSString stringWithContentsOfFile:jsPath encoding:NSUTF8StringEncoding error:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *context = [[JSContext alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[context evaluateScript:jsContent];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSValue *value = [context[@&amp;quot;appendString&amp;quot;] callWithArguments:@[@&amp;quot;hello&amp;quot;]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSValue *value1 = context[@&amp;quot;arr&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;appendString:%@&amp;quot;,[value toString] );//appendString:string:hello&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;arr:%@&amp;quot;,[value1 toArray] );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// arr:(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 2,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// &amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;JavaScriptè°ƒç”¨Objective-C&quot;&gt;&lt;a href=&quot;#JavaScriptè°ƒç”¨Objective-C&quot; class=&quot;headerlink&quot; title=&quot;JavaScriptè°ƒç”¨Objective-C&quot;&gt;&lt;/a&gt;JavaScriptè°ƒç”¨Objective-C&lt;/h3&gt;&lt;p&gt;jsè°ƒç”¨ocæœ‰ä¸¤ç§å®ç°æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Blocksæ–¹å¼&lt;br&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡blockçš„æ–¹å¼å°†ocä»£ç æš´éœ²ç»™jsï¼ŒJavaScriptCoreä¼šè‡ªåŠ¨å°†oc blockåŒ…è£…åœ¨jså‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨jsä¸­è°ƒç”¨è¯¥blockå‡½æ•°ï¼Œæœ‰ç‚¹æ–¹ä¾¿ï½&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;JSContext *context = [[JSContext alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context[@&amp;quot;sayhi&amp;quot;] = ^(NSString *name) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;say hi to %@&amp;quot;,name);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[context evaluateScript:@&amp;quot;sayhi(&amp;apos;Greg&amp;apos;)&amp;quot;]; //&amp;quot;say hi to Greg&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/block____.png&quot; alt=&quot;block.png&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JSExportåè®®&lt;br&gt;å¦‚æœä½ åˆ°å¤´æ–‡ä»¶ä¸­å»æŸ¥çœ‹JSExportåè®®ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªåè®®å…¶å®æ²¡æœ‰å®šä¹‰ä»»ä½•ä¸œè¥¿ã€‚JavaScriptCoreæä¾›è¿™ä¸ªåè®®ç”¨æ¥å°†ocçš„æ–¹æ³•è·Ÿå±æ€§æš´éœ²ç»™jsè°ƒç”¨ï¼Œå…¶ä¸­@propertyä¼šè½¬æ¢æˆjsçš„getterå’Œsetteræ–¹æ³•ï¼Œå®ä¾‹æ–¹æ³•ä¼šè½¬æ¢æˆjså‡½æ•°ï¼Œè€Œç±»æ–¹æ³•åˆ™è½¬æ¢æˆjsä¸­global objectçš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-d0f65ad7e6e8a3cc.png&quot; alt=&quot;JSExport&quot;&gt;&lt;br&gt;ä¸¾ä¸ªä¾‹å­ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„PersonProtocolåè®®å®šä¹‰å¥½è¦æš´éœ²ç»™jsçš„å†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//å®šä¹‰éœ€è¦æš´éœ²ç»™jsçš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘ä»¬åªæš´éœ²personNameå’ŒqueryPersonNameæ¥å£&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@protocol PersonProtocol &amp;lt;JSExport&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property(nonatomic,copy)NSString *personName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(NSString *)queryPersonName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//Personå®ç°PersonProtocolåè®®ï¼Œè€Œè‡ªå·±å®šä¹‰çš„ageå’ŒqueryPersonAgeæ¥å£ä¸æš´éœ²ç»™js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface Person : NSObject &amp;lt;PersonProtocol&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property(nonatomic,assign)NSInteger age;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(NSInteger)queryPersonAge;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation Person&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@synthesize personName = _personName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(NSString *)queryPersonName&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.personName;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(NSInteger)queryPersonAge&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.age;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *context = [[JSContext alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºPersonç±»çš„å¯¹è±¡ï¼Œå°†ä»–èµ‹å€¼ç»™jså¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Person *person=[Person new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;person.personName = @&amp;quot;Greg&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;person.age = 27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context[@&amp;quot;person&amp;quot;]=person;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å¯ä»¥è°ƒç”¨è·å–PersonProtocolæš´éœ²çš„å†…å®¹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *personName = [[context evaluateScript:@&amp;quot;person.personName&amp;quot;] toString]; //&amp;quot;Greg&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *personName1 = [[context evaluateScript:@&amp;quot;person.queryPersonName()&amp;quot;] toString]; //&amp;quot;Greg&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//jsæ— æ³•è°ƒç”¨è·Ÿageç›¸å…³çš„å†…å®¹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSInteger age = [[context evaluateScript:@&amp;quot;person.age&amp;quot;] toInt32]; // 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSInteger age1 = [[context evaluateScript:@&amp;quot;person.queryPersonAge()&amp;quot;] toInt32]; //0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;å†…å­˜ç®¡ç†&quot;&gt;&lt;a href=&quot;#å†…å­˜ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;å†…å­˜ç®¡ç†&quot;&gt;&lt;/a&gt;å†…å­˜ç®¡ç†&lt;/h3&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´å†…å­˜ç®¡ç†æ–¹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ocä¸­ä½¿ç”¨ARCæ–¹å¼ç®¡ç†å†…å­˜ï¼ˆåŸºäºå¼•ç”¨è®¡æ•°ï¼‰ï¼Œä½†JavaScriptCoreä¸­ä½¿ç”¨çš„æ˜¯åƒåœ¾å›æ”¶æ–¹å¼ï¼Œå…¶ä¸­æ‰€æœ‰çš„å¼•ç”¨éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒå…¶å¾ªç¯å¼•ç”¨ï¼Œjsçš„åƒåœ¾å›æ”¶èƒ½å¤Ÿæ‰“ç ´è¿™äº›å¼ºå¼•ç”¨ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ä½¿ç”¨JavaScriptCoreä¸­çš„APIæ—¶ä¸å¤ªéœ€è¦å»å…³æ³¨å†…å­˜é—®é¢˜ï¼Œå› ä¸ºè¿™äº›éƒ½ä¼šè¢«è‡ªåŠ¨å¤„ç†å¥½ï¼Œä¸è¿‡æœ‰äº›æƒ…å†µéœ€è¦æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ocå¯¹è±¡ä¸­å­˜å‚¨jsçš„å€¼&lt;br&gt;å¦‚æœåœ¨ocå¯¹è±¡ä¸­å­˜å‚¨jsçš„å€¼ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ä¸è¦å¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œçœ‹ä¸ªä¾‹å­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;function ClickHandler(button, callback) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.button = button;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.handler = callback;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//test.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implement MyButton&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)setClickHandler:(JSValue*)handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _onClickHandler = handler; //å¯¼è‡´retain cycle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œmybuttonçš„onclickHandlerå¼ºå¼•ç”¨äº†jsçš„handlerï¼Œè€Œjsçš„buttonåˆå¼ºå¼•ç”¨äº†mybuttonï¼Œè¿™å°±ä¼šå¯¼è‡´retain cycleçš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-c3d1ed99df32e859.png&quot; alt=&quot;retain cycle&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ocä¸­ä¸ºäº†æ‰“ç ´å¾ªç¯å¼•ç”¨æˆ‘ä»¬é‡‡ç”¨weakçš„æ–¹å¼ï¼Œä¸è¿‡åœ¨JavaScriptCoreä¸­æˆ‘ä»¬é‡‡ç”¨å†…å­˜ç®¡ç†è¾…åŠ©å¯¹è±¡JSManagedValueçš„æ–¹å¼ï¼Œå®ƒèƒ½å¸®åŠ©å¼•ç”¨æŠ€æœ¯å’Œåƒåœ¾å›æ”¶è¿™ä¸¤ç§å†…å­˜ç®¡ç†æœºåˆ¶ä¹‹é—´è¿›è¡Œæ­£ç¡®çš„è½¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@implement MyButton&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)setClickHandler:(JSValue*)handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _onClickHandler = [JSManagedValue managedValueWithValue:handler];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [_context.virtualMachine addManagedReference:_onClickHandler];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;JSManagedValueæœ¬èº«åªå¼±å¼•ç”¨jså€¼ï¼Œéœ€è¦è°ƒç”¨JSVirtualMachineçš„addManagedReference:withOwner:æŠŠå®ƒæ·»åŠ åˆ°JSVirtualMachineä¸­ï¼Œè¿™æ ·å¦‚æœJavaScriptèƒ½å¤Ÿæ‰¾åˆ°è¯¥JSValueçš„Objective-C ownerï¼Œè¯¥JSValueçš„å¼•ç”¨å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;blockä¸­æ•è·JSContexts&lt;br&gt;æˆ‘ä»¬çŸ¥é“blockä¼šé»˜è®¤å¼ºå¼•ç”¨å®ƒæ‰€æ•è·çš„å¯¹è±¡ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå¦‚æœblockä¸­ç›´æ¥ä½¿ç”¨contextä¹Ÿä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œè¿™ä½¿ç”¨æˆ‘ä»¬æœ€å¥½é‡‡ç”¨[JSContext currentContext]æ¥è·å–å½“å‰çš„JSContext:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//bad&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *context = [[JSContext alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context[@&amp;quot;callback&amp;quot;] = ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     JSValue *object = [JSValue valueWithNewObjectInContext:context];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     return object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//good&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *context = [[JSContext alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;context[@&amp;quot;callback&amp;quot;] = ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     JSValue *object = [JSValue valueWithNewObjectInContext:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [JSContext currentContext]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     return object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;å¤šçº¿ç¨‹&quot;&gt;&lt;a href=&quot;#å¤šçº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;å¤šçº¿ç¨‹&quot;&gt;&lt;/a&gt;å¤šçº¿ç¨‹&lt;/h3&gt;&lt;p&gt;JavaScriptCoreä¸­æä¾›çš„APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸€ä¸ªJSVirtualMachineåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ªJSContextï¼Œè€Œä¸”ç›¸äº’ä¹‹é—´å¯ä»¥ä¼ å€¼ï¼Œä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œè¿™äº›contextåœ¨è¿è¡Œçš„æ—¶å€™ä¼šé‡‡ç”¨é”ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸²è¡Œæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-b68482b273b0a65c.png&quot; alt=&quot;åŒä¸€ä¸ªè™šæ‹Ÿæœºå¯ä»¥ç›¸äº’è®¿é—®&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚æˆ‘ä»¬éœ€è¦å¹¶å‘çš„æ‰§è¡Œjsä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºJSContextçš„æ—¶å€™ä¹ŸæŒ‡å®šå…¶æ‰€åœ¨çš„è™šæ‹Ÿæœºï¼Œä¸åŒçš„è™šæ‹Ÿæœºå¤„äºä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯å¦‚æœåœ¨ä¸åŒçš„ JSVirtualMachineï¼Œä¸Šä¸‹æ–‡å¹¶ä¸èƒ½ç›´æ¥äº’ç›¸ä¼ å€¼ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;JSVirtualMachine *vm1 = [JSVirtualMachine new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *ctxA1 = [[JSContext alloc] initWithVirtualMachine:vm1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *ctxA2 = [[JSContext alloc] initWithVirtualMachine:vm1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSVirtualMachine *vm2 = [JSVirtualMachine new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JSContext *ctxB = [[JSContext alloc] initWithVirtualMachine:vm2];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-999d49d8b0280c1e.png&quot; alt=&quot;ä¸åŒä¸€ä¸ªè™šæ‹Ÿæœºä¸å¯ä»¥ç›¸äº’è®¿é—®&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2013/615/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://developer.apple.com/videos/play/wwdc2013/615/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/prerelease/ios/documentation/Carbon/Reference/WebKit_JavaScriptCore_Ref/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://developer.apple.com/library/prerelease/ios/documentation/Carbon/Reference/WebKit_JavaScriptCore_Ref/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;javascriptç›®å‰çœ‹æ¥ä»æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„è¯­è¨€ï¼Œä¸ç®¡åœ¨webã€æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå¾ˆå¤šè·¨å¹³å°æ–¹æ¡ˆä¹Ÿé‡‡ç”¨jsæ¥å®ç°ï¼Œæ¯”å¦‚è‘—åçš„reactjsï¼Œè‹¹æœåœ¨iOS7å¼•å…¥äº†javascriptcoreåº“ï¼Œæä¾›æ›´ç®€å•æ–¹ä¾¿çš„æ–¹å¼å°†jsæ¥å…¥ï¼ŒiOS7ä¹‹å‰è¦æ‰§è¡Œjsæ“ä½œåªèƒ½é€šè¿‡UIWebviewä¸­çš„&lt;br&gt;stringByEvaluatingJavaScriptFromStringæ–¹æ³•ï¼Œè€Œä¸”JavaScriptCoreè¿™å—çš„ä»£ç å¼€æºï¼Œå¯ä»¥åˆ°&lt;a href=&quot;https://github.com/phoboslab/JavaScriptCore-iOS&quot;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹ï¼Œæœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸€ä¸‹JavaScriptCoreï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Objective-Cè°ƒç”¨JavaScript&lt;/li&gt;
&lt;li&gt;JavaScriptè°ƒç”¨Objective-C&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†&lt;/li&gt;
&lt;li&gt;å¤šçº¿ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸è¿‡åœ¨é‚£ä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JSContext&lt;br&gt;ä¸€ä¸ªJSContextå®ä¾‹ä»£è¡¨ç€ä¸€ä¸ªjsè¿è¡Œæ—¶ç¯å¢ƒï¼Œjsä»£ç éƒ½éœ€è¦åœ¨ä¸€ä¸ªcontextä¸Šä¸‹æ–‡å†…æ‰§è¡Œï¼Œè€Œä¸”JSContextè¿˜è´Ÿè´£ç®¡ç†jsè™šæ‹Ÿæœºä¸­æ‰€æœ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;JSValue&lt;br&gt;è¡¨ç¤ºä¸€ä¸ªJavaScriptçš„å®ä½“ï¼Œä¸€ä¸ªJSValueå¯ä»¥è¡¨ç¤ºå¾ˆå¤šJavaScriptåŸå§‹ç±»å‹ä¾‹å¦‚boolean, integers, doublesï¼Œç”šè‡³åŒ…æ‹¬å¯¹è±¡å’Œå‡½æ•°ã€‚æˆ‘ä»¬å¯¹JSçš„æ“ä½œéƒ½æ˜¯é€šè¿‡å®ƒï¼Œå¹¶ä¸”æ¯ä¸ªJSValueéƒ½å¼ºå¼•ç”¨ä¸€ä¸ªcontextã€‚åŒæ—¶ï¼ŒOCå’ŒJSå¯¹è±¡ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ˜¯é€šè¿‡å®ƒï¼Œç›¸åº”çš„ç±»å‹è½¬æ¢å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-c67085793e9f170e.png&quot; alt=&quot;JSValueç±»å‹è½¬æ¢&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JSVirtualMachine&lt;br&gt;jsä»£ç è¿è¡Œçš„è™šæ‹Ÿæœºï¼Œæä¾›JavaScriptCoreæ‰§è¡Œéœ€è¦çš„èµ„æºï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„å †æ ˆä»¥åŠåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè€Œä¸”é€šè¿‡é”æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœéœ€è¦å¹¶å‘æ‰§è¡Œjsä»£ç ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„JSVirtualMachineè™šæ‹Ÿæœºå¯¹è±¡æ¥å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>iOSåº”ç”¨ç¨‹åºé—´å…±äº«æ•°æ®</title>
    <link href="http://freemind-lj.github.io/2016/02/02/iOS%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/"/>
    <id>http://freemind-lj.github.io/2016/02/02/iOSåº”ç”¨ç¨‹åºé—´å…±äº«æ•°æ®/</id>
    <published>2016-02-02T09:39:59.000Z</published>
    <updated>2016-02-15T02:52:13.000Z</updated>
    
    <content type="html">&lt;p&gt;æˆ‘ä»¬çŸ¥é“iOSç”±äºæ²™ç›’çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½è¶Šè¿‡è‡ªå·±çš„åŒºåŸŸå»è®¿é—®åˆ«çš„å­˜å‚¨ç©ºé—´çš„å†…å®¹ï¼Œä¸è¿‡å¯èƒ½æœ‰è®¸å¤šåœºæ™¯æˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®ï¼Œæ¯”å¦‚å¤šä¸ªåº”ç”¨å…±ç”¨ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ç­‰ã€‚è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥åˆ†äº«æ•°æ®ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰äº›æ–¹æ³•å¯ä»¥å®ç°ï¼Œä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œè¿™é‡ŒåŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªå·¥ç¨‹Example1å’ŒExample2ï¼Œå®ç°è¿™ä¸¤ä¸ªappä¹‹é—´çš„ä¿¡æ¯å…±äº«ï¼ŒExample1è´Ÿè´£å†™æ•°æ®ï¼ŒExample2è´Ÿè´£è¯»æ•°æ®ï¼Œå…·ä½“çš„demoä»£ç å¯ä»¥åˆ°&lt;a href=&quot;https://github.com/FreeMind-LJ/SharedDataDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;è·å–&lt;/p&gt;
&lt;h4 id=&quot;UIPasteboard&quot;&gt;&lt;a href=&quot;#UIPasteboard&quot; class=&quot;headerlink&quot; title=&quot;UIPasteboard&quot;&gt;&lt;/a&gt;UIPasteboard&lt;/h4&gt;&lt;p&gt;å‰ªè´´æ¿æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨å…¨å±€çš„ç²˜è´´æ¿ï¼Œè€Œæ˜¯è‡ªå·±æ ¹æ®åå­—åˆ›å»ºä¸€ä¸ªæ–°çš„ç²˜è´´æ¿ï¼Œé˜²æ­¢å…¶å®ƒåœ°æ–¹å…¨å±€æ‹·è´çš„å½±å“ã€‚ç„¶åæŠŠéœ€è¦å…±äº«çš„å†…å®¹å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼Œç²˜è´´æ¿çš„å†…å®¹å¯ä»¥æ˜¯æ–‡æœ¬ã€URLã€å›¾ç‰‡å’ŒUIColorç­‰ï¼Œå¦ä¸€ä¸ªappå°±å¯ä»¥æ ¹æ®ç²˜è´´æ¿çš„åå­—å»è¯»å–ç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;Example1è®¾ç½®ç²˜è´´æ¿çš„å†…å®¹:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;UIPasteboard *pasteboard = [UIPasteboard pasteboardWithName:@&amp;quot;myPasteboard&amp;quot; create:YES];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pasteboard.string = @&amp;quot;myShareData&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Example2è¯»å–ç²˜è´´æ¿çš„å†…å®¹:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;UIPasteboard *pasteboard = [UIPasteboard pasteboardWithName:@&amp;quot;myPasteboard&amp;quot; create:NO];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *content = pasteboard.string;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Custom-URL-Scheme&quot;&gt;&lt;a href=&quot;#Custom-URL-Scheme&quot; class=&quot;headerlink&quot; title=&quot;Custom URL Scheme&quot;&gt;&lt;/a&gt;Custom URL Scheme&lt;/h4&gt;&lt;p&gt;URL Schemeèƒ½å¤Ÿè®©æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„åè®®åœ¨åº”ç”¨ç¨‹åºé—´ä¼ é€’ä¿¡æ¯ï¼Œå½“ä½ æƒ³è¦å‘é€æ•°æ®ç»™ä¸€ä¸ªå®ç°äº†è‡ªå®šä¹‰URL Schemeçš„åº”ç”¨æ—¶ï¼Œåªéœ€è¦åˆ›å»ºå¥½åˆé€‚æ ¼å¼çš„URLï¼Œç„¶åè°ƒç”¨openURL:æ–¹æ³•ï¼Œç³»ç»Ÿå°±ä¼šè½½å…¥æ³¨å†Œäº†è¯¥schemeçš„åº”ç”¨ç„¶åå°†ä½ çš„URLä¼ é€’ç»™ä»–ï¼Œæ¯”å¦‚å¦‚ä¸‹çš„ä»£ç ,todolistæ˜¯ä¸€ä¸ªå…¶å®ƒåº”ç”¨æ³¨å†Œçš„schemeï¼Œé€šè¿‡openURLä¾¿å¯ä»¥å°†æœåŠ¡è¯·æ±‚å‘é€åˆ°è¯¥åº”ç”¨ï¼ˆè‡ªå®šä¹‰çš„URL Schemeè¦èƒ½å¤Ÿå”¯ä¸€æ ‡ç¤ºè¯¥APPï¼Œå¦‚æœä½ çš„URL Schemeè·Ÿåˆ«äººå†²çªäº†ï¼Œé‚£ä¹ˆä½ çš„appå°±ä¸ä¸€å®šä¼šè¢«è°ƒèµ·ï¼ŒiOSå¹¶ä¸ä¿è¯è°ƒç”¨å“ªä¸ªåº”ç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSURL *myURL = [NSURL URLWithString:@&amp;quot;todolist://newid=20&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[UIApplication sharedApplication] openURL:myURL];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨å†ŒURL Scheme&lt;br&gt;ä¸ºäº†èƒ½å¤Ÿå¤„ç†URLè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ³¨å†Œè‡ªå®šä¹‰çš„URL Schemeï¼Œåªéœ€è¦åœ¨Info tabä¸‹çš„URL Typesæ·»åŠ å³å¯ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œæ³¨å†ŒExample2çš„URL Schemeã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/16-2-15%2F13214719.jpg&quot; alt=&quot;æ³¨å†ŒURL scheme&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;Identifierç”¨äºæ ‡ç¤ºåç§°ï¼Œä¸ºäº†å”¯ä¸€æ€§å¯ä»¥é‡‡ç”¨åè½¬åŸŸåçš„å½¢å¼ï¼Œå¦å¤–æˆ‘ä»¬è®¾ç½®URL Schemeä¸ºExample2ï¼Œä»¥åŠroleä¸ºViewer(Viewerè¡¨ç¤ºåªèƒ½è¯»å–æ”¹URLä½†ä¸èƒ½ä¿®æ”¹ï¼ŒEditorå¯ä»¥å¯¹URLè¿›è¡Œè¯»å†™)ï¼Œè¿™æ ·Example2å°±èƒ½å¤Ÿæ¥å—ç±»ä¼¼â€Example2:\â€œçš„URLè¯·æ±‚äº†ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥â€Example2:\â€œé“¾æ¥æ‰“å¼€appã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤„ç†URLè¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“æœ‰URLè¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ‰€æœ‰çš„URLéƒ½ä¼šä¼ é€’ç»™ä½ çš„app delegateï¼Œæˆ‘ä»¬éœ€è¦å®ç°application:openURL:sourceApplication:annotation:æ–¹æ³•æ¥æ¥æ”¶å¤„ç†å¯¹åº”çš„URLï¼Œæ‰€ä»¥å‡å¦‚ä½ æƒ³é€šè¿‡URLæ–¹å¼æ¥ä¼ é€’æ•°æ®ï¼Œåªéœ€è¦å°†æ•°æ®æ·»åŠ åˆ°URLä¸­å³å¯ï¼Œå¦å¤–çš„é€šè¿‡è§£æè¯¥URLæ¥è·å–å¯¹åº”çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;Eaxmple1å‘é€æºå¸¦å‚æ•°çš„URLåˆ°Example2:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSString *string = @&amp;quot;Example2://name=jiangbin#age=1&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSURL *url = [NSURL URLWithString:string];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[UIApplication sharedApplication] openURL:url];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Example2å¤„ç†URLè¯·æ±‚å¹¶è§£æ:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  if ([[url scheme] isEqualToString:@&amp;quot;Example2&amp;quot;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  NSString *content = [url resourceSpecifier];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //è§£æcontentè·å–æ•°æ®&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  return YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  return NO;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Shared-Keychain-Access&quot;&gt;&lt;a href=&quot;#Shared-Keychain-Access&quot; class=&quot;headerlink&quot; title=&quot;Shared Keychain Access&quot;&gt;&lt;/a&gt;Shared Keychain Access&lt;/h4&gt;&lt;p&gt;iOSçš„keychainæä¾›ä¸€ç§å®‰å…¨ä¿å­˜ä¿¡æ¯çš„æ–¹å¼ï¼Œå¯ä»¥ä¿å­˜å¯†ç ç­‰æ•°æ®ï¼Œè€Œä¸”keychainä¸­çš„æ•°æ®ä¸ä¼šå› ä¸ºä½ åˆ é™¤appè€Œä¸¢å¤±ï¼Œä½ å¯ä»¥åœ¨é‡æ–°å®‰è£…åç»§ç»­è¯»å–keychainä¸­çš„æ•°æ®ã€‚é€šå¸¸æ¯ä¸ªåº”ç”¨ç¨‹åºåªå…è®¸è®¿é—®è‡ªå·±åœ¨keychainä¸­ä¿å­˜çš„æ•°æ®ï¼Œä¸è¿‡å‡å¦‚ä½ ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦çš„è¯ï¼Œä¸åŒçš„appä¹Ÿå¯ä»¥é€šè¿‡keychainæ¥å®ç°åº”ç”¨é—´çš„æ•°æ®å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°keychainå…±äº«æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯Keychain Sharingï¼Œå¼€å¯æ–¹æ³•å¦‚ä¸‹ï¼Œç„¶åæ·»åŠ è®¾ç½®ç›¸åŒçš„Keychain Groupï¼Œä¸è¿‡åˆ«å¿˜è®°äº†æ·»åŠ Security.frameworkã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/458529-00ce1a0c8ccf752c.png&quot; alt=&quot;Example1&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/2.png&quot; alt=&quot;Example2&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;Example1ä¿å­˜æ•°æ®åˆ°keychain(ä¸ºäº†ç®€å•ä½¿ç”¨&lt;a href=&quot;https://github.com/soffes/sskeychain&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SSKeychian&lt;/a&gt;)&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)setKeyChain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [SSKeychain setPassword:@&amp;quot;shareData&amp;quot; forService:@&amp;quot;myservice&amp;quot; account:@&amp;quot;jiangbin&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Example2è¯»å–æ•°æ®&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (IBAction)getByKeychain:(id)sender&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *myData = [SSKeychain passwordForService:@&amp;quot;myservice&amp;quot; account:@&amp;quot;jiangbin&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;App-Groups&quot;&gt;&lt;a href=&quot;#App-Groups&quot; class=&quot;headerlink&quot; title=&quot;App Groups&quot;&gt;&lt;/a&gt;App Groups&lt;/h4&gt;&lt;p&gt;iOS8ä¹‹åè‹¹æœåŠ å…¥äº†App GroupsåŠŸèƒ½ï¼Œåº”ç”¨ç¨‹åºä¹‹é—´å¯ä»¥é€šè¿‡åŒä¸€ä¸ªgroupæ¥å…±äº«èµ„æºï¼Œapp groupå¯ä»¥é€šè¿‡NSUserDefaultsè¿›è¡Œå°é‡æ•°æ®çš„å…±äº«ï¼Œå¦‚æœéœ€è¦å…±äº«è¾ƒå¤§çš„æ–‡ä»¶å¯ä»¥é€šè¿‡NSFileCoordinatorã€NSFilePresenterç­‰æ–¹å¼ã€‚&lt;br&gt;å¼€å¯app groupsï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªgroup nameï¼Œappä¹‹é—´é€šè¿‡è¿™ä¸ªgroupå…±äº«æ•°æ®ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/16-2-15%2F66665066.jpg&quot; alt=&quot;App Groups&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;Example1æ ¹æ®group nameè®¾ç½®å†…å®¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)setAppGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSUserDefaults *myDefaults = [[NSUserDefaults alloc]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  initWithSuiteName:@&amp;quot;group.com.jiangbin.SharedData&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [myDefaults setObject:@&amp;quot;shared data&amp;quot; forKey:@&amp;quot;mykey&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Example2æ ¹æ®group nameè¯»å–æ•°æ®&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)getByAppGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSUserDefaults *myDefaults = [[NSUserDefaults alloc]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                  initWithSuiteName:@&amp;quot;group.com.jiangbin.SharedData&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *content = [myDefaults objectForKey:@&amp;quot;mykey&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘ä»¬çŸ¥é“iOSç”±äºæ²™ç›’çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½è¶Šè¿‡è‡ªå·±çš„åŒºåŸŸå»è®¿é—®åˆ«çš„å­˜å‚¨ç©ºé—´çš„å†…å®¹ï¼Œä¸è¿‡å¯èƒ½æœ‰è®¸å¤šåœºæ™¯æˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®ï¼Œæ¯”å¦‚å¤šä¸ªåº”ç”¨å…±ç”¨ç”¨æˆ·åå¯†ç è¿›è¡Œç™»å½•ç­‰ã€‚è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥åˆ†äº«æ•°æ®ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰äº›æ–¹æ³•å¯ä»¥å®ç°ï¼Œä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œè¿™é‡ŒåŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªå·¥ç¨‹Example1å’ŒExample2ï¼Œå®ç°è¿™ä¸¤ä¸ªappä¹‹é—´çš„ä¿¡æ¯å…±äº«ï¼ŒExample1è´Ÿè´£å†™æ•°æ®ï¼ŒExample2è´Ÿè´£è¯»æ•°æ®ï¼Œå…·ä½“çš„demoä»£ç å¯ä»¥åˆ°&lt;a href=&quot;https://github.com/FreeMind-LJ/SharedDataDemo&quot;&gt;è¿™é‡Œ&lt;/a&gt;è·å–&lt;/p&gt;
&lt;h4 id=&quot;UIPasteboard&quot;&gt;&lt;a href=&quot;#UIPasteboard&quot; class=&quot;headerlink&quot; title=&quot;UIPasteboard&quot;&gt;&lt;/a&gt;UIPasteboard&lt;/h4&gt;&lt;p&gt;å‰ªè´´æ¿æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨å…¨å±€çš„ç²˜è´´æ¿ï¼Œè€Œæ˜¯è‡ªå·±æ ¹æ®åå­—åˆ›å»ºä¸€ä¸ªæ–°çš„ç²˜è´´æ¿ï¼Œé˜²æ­¢å…¶å®ƒåœ°æ–¹å…¨å±€æ‹·è´çš„å½±å“ã€‚ç„¶åæŠŠéœ€è¦å…±äº«çš„å†…å®¹å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼Œç²˜è´´æ¿çš„å†…å®¹å¯ä»¥æ˜¯æ–‡æœ¬ã€URLã€å›¾ç‰‡å’ŒUIColorç­‰ï¼Œå¦ä¸€ä¸ªappå°±å¯ä»¥æ ¹æ®ç²˜è´´æ¿çš„åå­—å»è¯»å–ç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>ç»†è¯´@synchronizedå’Œdispatch_once</title>
    <link href="http://freemind-lj.github.io/2016/01/07/%E7%BB%86%E8%AF%B4-synchronized%E5%92%8Cdispatch-once/"/>
    <id>http://freemind-lj.github.io/2016/01/07/ç»†è¯´-synchronizedå’Œdispatch-once/</id>
    <published>2016-01-07T09:43:12.000Z</published>
    <updated>2016-02-15T02:54:57.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;å·¥æ¬²å–„å…¶äº‹&lt;/em&gt;,&lt;em&gt;å¿…å…ˆåˆ©å…¶å™¨&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒé€šå¸¸æˆ‘ä»¬åœ¨å®ç°å•ä¾‹æ—¶å€™éƒ½ä¼šä½¿ç”¨synchronizedæˆ–è€…dispatch_onceæ–¹æ³•ï¼Œåˆå§‹åŒ–å¾€å¾€æ˜¯ä¸‹é¢çš„æ ·å­ï¼š&lt;br&gt;ä½¿ç”¨synchronizedæ–¹æ³•å®ç°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static id obj = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(instancetype)shareInstance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @synchronized(self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (!obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            obj = [[SingletonObj alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨dispatch_onceæ–¹æ³•å®ç°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static id obj = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(instancetype)shareInstance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static dispatch_once_t onceToken;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_once(&amp;amp;onceToken, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        obj = [[SingletonObj alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h5 id=&quot;æ€§èƒ½å·®å¼‚&quot;&gt;&lt;a href=&quot;#æ€§èƒ½å·®å¼‚&quot; class=&quot;headerlink&quot; title=&quot;æ€§èƒ½å·®å¼‚&quot;&gt;&lt;/a&gt;æ€§èƒ½å·®å¼‚&lt;/h5&gt;&lt;p&gt;â€ƒâ€ƒä¸Šé¢çš„è¿™äº›å†™æ³•å¤§å®¶åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼Œæ—¢ç„¶ä¸¤ç§æ–¹å¼éƒ½èƒ½å®ç°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤è€…çš„æ€§èƒ½å·®å¼‚ï¼Œè¿™é‡Œç®€å•å†™äº†ä¸ªæµ‹è¯•çš„&lt;a href=&quot;https://github.com/FreeMind-LJ/SingletonTest&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;ï¼Œä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•åˆ†å•çº¿ç¨‹è·Ÿå¤šçº¿ç¨‹(é‡‡ç”¨dispatch_applyæ–¹å¼ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒé«˜)å»è®¿é—®ä¸€ä¸ªå•ä¾‹å¯¹è±¡ä¸€ç™¾ä¸‡æ¬¡ï¼Œå¯¹æ¯”è¿™æœŸé—´çš„è€—æ—¶ï¼Œä»iPodè·Ÿ5sæµ‹è¯•å¾—åˆ°å¦‚ä¸‹çš„ç»“æœ&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//ipodï¼Œä¸»çº¿ç¨‹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[4285:446820] synchronized time cost:2.202945s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[4285:446820] dispatch_once time cost:0.761034s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   //5sï¼Œä¸»çº¿ç¨‹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[5372:2394430] synchronized time cost:0.466293s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[5372:2394430] dispatch_once time cost:0.070822s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   //ipodï¼Œå¤šçº¿ç¨‹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[4315:448499] synchronized time cost:3.385109s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[4315:448499] dispatch_once time cost:0.908009s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   //5sï¼Œå¤šçº¿ç¨‹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[5391:2399069] synchronized time cost:0.507504s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   SingletonTest[5391:2399069] dispatch_once time cost:0.169934s&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒå¯ä»¥å‘ç°dispatch_onceæ–¹æ³•çš„æ€§èƒ½è¦æ˜æ˜¾ä¼˜äºsynchronizedæ–¹æ³•(å¤šçº¿ç¨‹ä¸é‡‡ç”¨dispathc_applyæ–¹å¼å·®è·æ›´æ˜æ˜¾)ï¼Œæ‰€ä»¥åœ¨å®é™…çš„åº”ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å¤šé‡‡ç”¨dispatch_onceæ–¹å¼æ¥å®ç°å•ä¾‹ã€‚é€šå¸¸ä½¿ç”¨çš„æ—¶å€™äº†è§£è¿™äº›å°±å¤Ÿäº†ï¼Œä¸è¿‡æƒ³çŸ¥é“ä¸¤è€…çš„å…·ä½“å·®å¼‚å°±éœ€è¦æˆ‘ä»¬å†è¿ˆè¿›ä¸€æ­¥ã€‚&lt;/p&gt;
&lt;h5 id=&quot;æ·±å…¥-synchronized-object&quot;&gt;&lt;a href=&quot;#æ·±å…¥-synchronized-object&quot; class=&quot;headerlink&quot; title=&quot;æ·±å…¥@synchronized(object)&quot;&gt;&lt;/a&gt;æ·±å…¥@synchronized(object)&lt;/h5&gt;&lt;p&gt;â€ƒâ€ƒç¿»çœ‹è‹¹æœçš„&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ–‡æ¡£&lt;/a&gt;å¯ä»¥å‘ç° @synchronizedæŒ‡ä»¤å†…éƒ¨ä½¿ç”¨é”æ¥å®ç°å¤šçº¿ç¨‹çš„å®‰å…¨è®¿é—®ï¼Œå¹¶ä¸”éšå¼æ·»åŠ äº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†çš„handlerï¼Œå½“å¼‚å¸¸å‘ç”Ÿæ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚åœ¨&lt;a href=&quot;http://stackoverflow.com/questions/1215330/how-does-synchronized-lock-unlock-in-objective-c/6047218#6047218&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;stackoverflow&lt;/a&gt;ä¸Šçœ‹åˆ°@synchronizedæŒ‡ä»¤å…¶å®å¯ä»¥è½¬æ¢æˆobjc_sync_enterè·Ÿobjc_sync_exitï¼Œå¯ä»¥åœ¨&lt;objc objc-sync.h=&quot;&quot;&gt;å¤´æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™ä¸¤ä¸ªå‡½æ•°:&lt;/objc&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//Allocates recursive pthread_mutex associated with &amp;apos;obj&amp;apos; if needed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int objc_sync_enter(id obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//End synchronizing on &amp;apos;obj&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int objc_sync_exit(id obj)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒæ ¹æ®æ³¨é‡Šæ–‡æ¡£ï¼Œobjc_sync_enterä¼šæ ¹æ®éœ€è¦ç»™æ¯ä¸ªä¼ è¿›æ¥çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªäº’æ–¥é”å¹¶lockï¼Œç„¶åobjc_sync_exitçš„æ—¶å€™unlockï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªé”æ¥å®ç°å¤šçº¿ç¨‹çš„å®‰å…¨è®¿é—®ï¼Œæ‰€ä»¥ç»“åˆè‹¹æœæ–‡æ¡£å¯ä»¥è®¤ä¸º&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@synchronized(self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	//thread safe code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç­‰ä»·äº&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_enter(self);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // thread safe code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; @finally &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    objc_sync_exit(self);    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒåº†å¹¸çš„æ˜¯è‹¹æœå·²ç»å°†objc-runtimeè¿™éƒ¨åˆ†å¼€æºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥äº†è§£å†…éƒ¨çš„å®ç°ï¼Œæºç åœ¨&lt;a href=&quot;http://www.opensource.apple.com/source/objc4/objc4-680/runtime/objc-sync.mm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œæœ‰å…´è¶£ä¹Ÿå¯ä»¥è‡ªå·±å»æŸ¥é˜…ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚&lt;br&gt;è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å‡ ä¸ªæ•°æ®ç»“æ„ï¼Œå…¶ä¸­æœ‰äº›æ¶‰åŠåˆ°ç¼“å­˜ï¼Œæˆ‘ä»¬å°±ä¸å»è€ƒè™‘äº†ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef struct SyncData &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct SyncData* nextData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DisguisedPtr&amp;lt;objc_object&amp;gt; object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int32_t threadCount;  // number of THREADS using this block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recursive_mutex_t mutex;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; SyncData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct SyncList &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SyncData *data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spinlock_t lock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define LOCK_FOR_OBJ(obj) sDataLists[obj].lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define LIST_FOR_OBJ(obj) sDataLists[obj].data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static StripedMap&amp;lt;SyncList&amp;gt; sDataLists;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒé¦–å…ˆçœ‹çœ‹SyncDataè¿™ä¸ªæ•°æ®ç»“æ„ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘objectçš„æŒ‡é’ˆï¼Œè¿™ä¸ªobjectå¯¹è±¡å°±æ˜¯æˆ‘ä»¬@synchronizedæ—¶ä¼ è¿›æ¥çš„å¯¹è±¡ï¼Œä¹ŸåŒ…å«ä¸€ä¸ªè·Ÿobjectå…³è”çš„é€’å½’äº’æ–¥é”recursive_mutex_tï¼Œè¯¥é”ç”¨æ¥äº’æ–¥è®¿é—®objectå¯¹è±¡ï¼›åŒæ—¶è¿˜åŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªSyncDataçš„æŒ‡é’ˆnextDataï¼Œå¯ä»¥çœ‹å‡ºSyncDataæ˜¯ä¸€ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼›è‡³äºthreadCountï¼Œè¿™ä¸ªå€¼æ ‡ç¤ºæœ‰å‡ ä¸ªçº¿ç¨‹æ­£åœ¨è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼Œå½“threadCount==0çš„æ—¶å€™ï¼Œä¼šé‡ç”¨è¯¥SyncDataå¯¹è±¡ï¼Œè¿™æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ã€‚&lt;br&gt;â€ƒâ€ƒæ¥ä¸‹æ¥çœ‹çœ‹SyncListï¼ŒSyncListå…¶å®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ŒdataæŒ‡å‘ç¬¬ä¸€ä¸ªSyncDataèŠ‚ç‚¹ï¼Œlockåˆ™æ˜¯ä¸ºäº†å¤šçº¿ç¨‹å®‰å…¨è®¿é—®è¯¥é“¾è¡¨ã€‚&lt;br&gt;â€ƒâ€ƒæœ€åçœ‹ä¸‹sDataListsé™æ€å“ˆå¸Œè¡¨å¯¹è±¡ï¼Œå®ƒä»¥objçš„æŒ‡é’ˆä¸ºkey,å¯¹åº”çš„valueä¸ºSyncListé“¾è¡¨ã€‚&lt;br&gt;â€ƒâ€ƒäº†è§£ä¸Šé¢ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹çœ‹objc_sync_enterè·Ÿobjc_sync_exitçš„å…·ä½“å®ç°ï¼ˆæ‘˜å–éƒ¨åˆ†ä»£ç ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//æ ¹æ®objectå¯¹è±¡å»æŸ¥è¯¢ç›¸åº”çš„SyncDataå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static SyncData* id2data(id object, enum usage why)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spinlock_t *lockp = &amp;amp;LOCK_FOR_OBJ(object);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SyncData **listp = &amp;amp;LIST_FOR_OBJ(object);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SyncData* result = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //lockï¼Œå¤šçº¿ç¨‹å®‰å…¨è®¿é—®SyncList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lockp-&amp;gt;lock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SyncData* p;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SyncData* firstUnused = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for (p = *listp; p != NULL; p = p-&amp;gt;nextData) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //æ‰¾åˆ°objectå¯¹è±¡å¯¹åº”çš„SyncDataå¯¹è±¡ï¼Œå¢åŠ å…¶threadCountè®¡æ•°ï¼Œç„¶åè¿”å›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if ( p-&amp;gt;object == object ) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                result = p;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                OSAtomicIncrement32Barrier(&amp;amp;result-&amp;gt;threadCount);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                goto done;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //å½“threadCount == 0æ—¶ï¼Œè®¾ç½®å½“å‰SyncDataä¸ºå¯é‡ç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if ( (firstUnused == NULL) &amp;amp;&amp;amp; (p-&amp;gt;threadCount == 0) )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                firstUnused = p;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // å¦‚æœæœ‰å¯é‡ç”¨çš„èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨å½“å‰SyncDataèŠ‚ç‚¹ï¼ŒSyncDataçš„objectæŒ‡é’ˆæŒ‡å‘æ–°çš„objectå¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if ( firstUnused != NULL ) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result = firstUnused;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result-&amp;gt;object = (objc_object *)object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result-&amp;gt;threadCount = 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            goto done;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å¦‚æœæ²¡æœ‰å¯é‡ç”¨çš„èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„SyncDataèŠ‚ç‚¹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = (SyncData*)calloc(sizeof(SyncData), 1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å°†æ–°çš„SyncDataèŠ‚ç‚¹çš„objectæŒ‡é’ˆæŒ‡å‘ä¼ è¿›æ¥çš„objectå¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result-&amp;gt;object = (objc_object *)object;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result-&amp;gt;threadCount = 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸è¯¥objectå…³è”çš„é€’å½’äº’æ–¥é”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    new (&amp;amp;result-&amp;gt;mutex) recursive_mutex_t();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result-&amp;gt;nextData = *listp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    *listp = result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; done:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lockp-&amp;gt;unlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int objc_sync_enter(id obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int result = OBJC_SYNC_SUCCESS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //æ ¹æ®objæŒ‡é’ˆçš„å“ˆå¸Œå€¼æŸ¥æ‰¾å¯¹åº”çš„SyncData,threadcountè®¡æ•°åŠ ä¸€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SyncData* data = id2data(obj, ACQUIRE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //ä½¿ç”¨SyncDataçš„äº’æ–¥é”ä¸Šé”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        data-&amp;gt;mutex.lock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // @synchronized(nil) ä¼ å…¥nilæ—¶ä»€ä¹ˆä¹Ÿä¸å¤„ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int objc_sync_exit(id obj)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int result = OBJC_SYNC_SUCCESS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //æ ¹æ®objæŒ‡é’ˆçš„å“ˆå¸Œå€¼æŸ¥æ‰¾å¯¹åº”çš„SyncDataï¼Œthreadcountè®¡æ•°å‡ä¸€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SyncData* data = id2data(obj, RELEASE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //ä½¿ç”¨SyncDataçš„äº’æ–¥é”è§£é” &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        bool okay = data-&amp;gt;mutex.tryUnlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (!okay) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           result = OBJC_SYNC_NOT_OWNING_THREAD_ERROR;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // @synchronized(nil) ä¼ å…¥nilæ—¶ä»€ä¹ˆä¹Ÿä¸å¤„ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒç®€å•æ¥è¯´ï¼Œè°ƒç”¨objc_sync_enter(obj)æ—¶ï¼Œä¼šæ ¹æ®objæŒ‡é’ˆåœ¨å“ˆå¸Œè¡¨sDataListså¯¹åº”çš„é“¾è¡¨SyncListï¼Œç„¶ååœ¨é“¾è¡¨ä¸­æŸ¥è¯¢å¯¹åº”objçš„SyncDataå¯¹è±¡ï¼Œå¦‚æœæŸ¥è¯¢ä¸åˆ°åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„SyncDataå¯¹è±¡ï¼ˆåŒ…å«åˆ›å»ºè·Ÿobjç›¸å…³çš„é€’å½’äº’æ–¥é”ï¼‰å¹¶æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œç„¶åä½¿ç”¨SyncDataå¯¹è±¡ä¸Šé”ï¼›è°ƒç”¨objc_sync_exit(obj)æ—¶ï¼Œä½¿ç”¨SyncDataå¯¹è±¡è§£é”ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªé”ä¾¿å¯ç¡®ä¿@synchronizedä¹‹é—´çš„ä»£ç çº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/sDataLists.png&quot; alt=&quot;sDataLists&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;h5 id=&quot;æ·±å…¥dispatch-once&quot;&gt;&lt;a href=&quot;#æ·±å…¥dispatch-once&quot; class=&quot;headerlink&quot; title=&quot;æ·±å…¥dispatch_once&quot;&gt;&lt;/a&gt;æ·±å…¥dispatch_once&lt;/h5&gt;&lt;p&gt;æ¢è®¨äº†synchronizedä¹‹åï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´dispatch_onceã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_once(dispatch_once_t *predicate, dispatch_block_t block);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒæ ¹æ®&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Performance/Reference/GCD_libdispatch_Ref/#//apple_ref/c/func/dispatch_once&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;,dispatch_onceå¯ä»¥ç”¨æ¥åˆå§‹åŒ–ä¸€äº›å…¨å±€çš„æ•°æ®ï¼Œå®ƒèƒ½å¤Ÿç¡®ä¿blockä»£ç åœ¨appçš„ç”Ÿå‘½å‘¨æœŸå†…ä»…è¢«è¿è¡Œä¸€æ¬¡ï¼Œè€Œä¸”è¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸éœ€è¦é¢å¤–åŠ é”ï¼›predicateå¿…é¡»æŒ‡å‘ä¸€ä¸ªå…¨å±€æˆ–è€…é™æ€çš„å˜é‡ï¼Œä¸è¿‡ä½¿ç”¨predicateçš„è¯ç»“æœæ˜¯æœªå®šä¹‰çš„ï¼Œä¸è¿‡predicateæœ‰å•¥ä½œç”¨ï¼Œå¦‚ä½•å®ç°blockåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæ‰§è¡Œä¸€æ¬¡ï¼Ÿé‚£æˆ‘ä»¬åªèƒ½ä»æºç æŸ¥æ‰¾(æºç åœ°å€ï¼š&lt;a href=&quot;http://opensource.apple.com/source/libdispatch/libdispatch-84.5/src/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;once&lt;/a&gt;)ã€‚&lt;br&gt;ä¸è¿‡åœ¨è¿™ä¹‹å‰å…ˆç®€è¦ä»‹ç»ä¸€ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;bool __sync_bool_compare_and_swap (type &lt;em&gt;ptr, type oldval type newval, â€¦)&lt;br&gt;æä¾›åŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼Œå¦‚æœå½“å‰å€¼&lt;/em&gt;ptr == oldvalï¼Œå°±å°†newvalå†™å…¥*ptrï¼Œå½“æ¯”è¾ƒèµ‹å€¼æ“ä½œæˆåŠŸåè¿”å›true&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;*__sync_synchronize (â€¦)&lt;br&gt;è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šäº§ç”Ÿä¸€ä¸ªfull &lt;a href=&quot;https://en.wikipedia.org/wiki/Memory_barrier&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;memory barrier&lt;/a&gt; ï¼Œç”¨äºä¿è¯CPUæŒ‰ç…§æˆ‘ä»¬ä»£ç ç¼–å†™çš„é¡ºåºæ¥æ‰§è¡Œä»£ç ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;doJob1();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; doJob2();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; __sync_synchronize();  //Job3ä¼šåœ¨Job1è·ŸJob2å®Œæˆåæ‰æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;doJob3();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;type __sync_swap(type *ptr, type value, â€¦)&lt;br&gt;æä¾›åŸå­äº¤æ¢æ“ä½œçš„å‡½æ•°ï¼Œäº¤æ¢ç¬¬ä¸€ä¸ªè·Ÿç¬¬äºŒä¸ªå‚æ•°çš„å€¼ï¼Œç„¶åè¿”å›äº¤æ¢å‰ç¬¬ä¸€ä¸ªå‚æ•°çš„æ—§å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;_dispatch_hardware_pause()&lt;br&gt;è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯æš—ç¤ºå¤„ç†å™¨ä¸è¦åšé¢å¤–çš„ä¼˜åŒ–å¤„ç†ç­‰ï¼Œæé«˜æ€§èƒ½ï¼ŒèŠ‚çœCPUæ—¶é—´ï¼Œå¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://www.searchtb.com/2011/06/spinlock%E5%89%96%E6%9E%90%E4%B8%8E%E6%94%B9%E8%BF%9B.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;äº†è§£æ›´å¤š&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;ä¿¡å·é‡&lt;br&gt;ä¿¡å·é‡æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå®šä¹‰äº†ä¸¤ç§åŸå­æ“ä½œï¼šwaitè·Ÿsignalæ¥è¿›è¡Œè®¿ï¼Œä¿¡å·é‡ä¸»è¦ç”¨äºçº¿ç¨‹åŒæ­¥ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨waitæ“ä½œæ—¶ï¼Œå¦‚æœä¿¡å·é‡çš„å€¼å¤§äº0ï¼Œåˆ™è·å¾—èµ„æºå¹¶å°†ä¿¡å·é‡å€¼å‡ä¸€ï¼Œå¦‚æœç­‰äº0çº¿ç¨‹ç¡çœ ç›´åˆ°ä¿¡å·é‡å€¼å¤§äº0æˆ–è€…è¶…æ—¶ï¼›singalå°†ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œå¦‚æœè¿™æ—¶å€™æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹ï¼Œå”¤é†’è¯¥çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// åˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œå…¶å€¼ä¸º0        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_semaphore_t sema = dispatch_semaphore_create(0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ABAddressBookRequestAccessWithCompletion(addressBook, ^(bool granted, CFErrorRef error) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	//æ“ä½œå®Œæˆåï¼Œè°ƒç”¨signalä¿¡å·é‡+1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_semaphore_signal(sema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç­‰å¾…dispatch_semaphore_signalå°†ä¿¡å·é‡å€¼åŠ 1åæ‰ç»§ç»­è¿è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒæ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“ä»£ç ï¼Œå½“æˆ‘ä»¬è°ƒç”¨dispatch_onceæ—¶å€™ï¼Œå†…éƒ¨æ˜¯è°ƒç”¨dispatch_once_få‡½æ•°ï¼Œå…¶ä¸­valå°±æ˜¯å¤–éƒ¨ä¼ å…¥çš„predicateå€¼ï¼Œctxtä¸ºBlockçš„æŒ‡é’ˆï¼Œfuncåˆ™æ˜¯Blockå†…éƒ¨å…·ä½“å®ç°çš„å‡½æ•°æŒ‡é’ˆï¼Œç”±äºæºç æ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æŠŠæºç è´´å‡ºæ¥(ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæœ‰äº›ä¸ä½¿ç”¨å®å®šä¹‰)ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;struct _dispatch_once_waiter_s &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    volatile struct _dispatch_once_waiter_s *volatile dow_next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _dispatch_thread_semaphore_t dow_sema;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define DISPATCH_ONCE_DONE ((struct _dispatch_once_waiter_s *)~0l)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_once(dispatch_once_t *val, dispatch_block_t block)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct Block_basic *bb = (void *)block;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_once_f(val, block, (void *)bb-&amp;gt;Block_invoke);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_once_f(dispatch_once_t *val, void *ctxt, dispatch_function_t func)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //volatileï¼Œæ ‡ç¤ºè¯¥å˜é‡éšæ—¶å¯èƒ½æ”¹å˜ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹è®¿é—®è¯¥å˜é‡çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ¯æ¬¡éƒ½ä»å†…å­˜å»è¯»å–ï¼Œè€Œä¸ä½¿ç”¨å¯„å­˜å™¨é‡Œçš„å€¼&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct _dispatch_once_waiter_s * volatile *vval =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            (struct _dispatch_once_waiter_s**)val;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct _dispatch_once_waiter_s dow = &amp;#123; NULL, 0 &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct _dispatch_once_waiter_s *tail, *tmp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _dispatch_thread_semaphore_t sema;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œpredicateçš„å€¼ä¸º0ï¼Œæ‰€ä»¥vvalï¼NULLï¼ŒåŸå­æ¯”è¾ƒäº¤æ¢å‡½æ•°è¿”å›true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //ç„¶åvvalæŒ‡å‘dow(dispatch_once_waiter_sï¼Œä¿¡å·é‡çš„å€¼ä¸º0ï¼Œå³ç­‰å¾…ä¸­)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (__sync_bool_compare_and_swap(vval, NULL, &amp;amp;dow)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //ç©ºçš„å®å®šä¹‰ï¼Œå•¥ä¹Ÿä¸åš&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dispatch_atomic_acquire_barrier();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //æ‰§è¡Œdispatch_onceä¼ è¿›æ¥çš„block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _dispatch_client_callout(ctxt, func);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //åé¢è§£é‡Š&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dispatch_atomic_maximally_synchronizing_barrier();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //æ‰§è¡Œå®Œblockä¹‹åï¼Œå°†vvalçš„å€¼è®¾ä¸ºDISPATCH_ONCE_DONE(å³predicateè®¾ä¸º~0lï¼‰&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        tmp = __sync_swap(vval, DISPATCH_ONCE_DONE);  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        tail = &amp;amp;dow;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //1.å¦‚æœåœ¨blockçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å…¶çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ç­‰å¾…ï¼Œtmpçš„å€¼ä¹Ÿä¸º&amp;amp;dow,tail==tmpï¼Œå¾ªç¯çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //2.å¦‚æœåœ¨blockçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å…¶çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ç­‰å¾…ï¼Œå†éä¿¡å·é‡é“¾è¡¨ï¼Œé€ä¸ªå”¤é†’çº¿ç¨‹ç»§ç»­è¿è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        while (tail != tmp) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //å¦‚æœä¸­é€”æœ‰å…¶å®ƒçº¿ç¨‹å°†vvalèµ‹å€¼&amp;amp;dowï¼Œè¿™æœŸé—´dow_nextå€¼ä¸ºNULLï¼Œéœ€è¦ç­‰å¾…ï¼Œå‚è§elseåˆ†æ”¯çš„__sync_bool_compare_and_swapè°ƒç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            while (!tmp-&amp;gt;dow_next) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _dispatch_hardware_pause();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sema = tmp-&amp;gt;dow_sema;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            tmp = (struct _dispatch_once_waiter_s*)tmp-&amp;gt;dow_next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            _dispatch_thread_semaphore_signal(sema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //å¦‚æœvvalä¸ç­‰NULLï¼Œèµ°è¿™ä¸ªåˆ†æ”¯ï¼Œéç¬¬ä¸€æ¬¡è°ƒç”¨dispatch_onceï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //è·å–ä¿¡å·é‡ï¼Œå¦‚æœæœ‰ä¿¡å·é‡åˆ™è¿”å›è¯¥ä¿¡å·é‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœ¨å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡å·é‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dow.dow_sema = _dispatch_get_thread_semaphore();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for (;;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            tmp = *vval;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //vvalå·²ç»è¢«èµ‹å€¼ä¸º~0lï¼Œè¯æ˜blockå·²ç»è¢«æ‰§è¡Œäº†ï¼Œé€€å‡ºç„¶åè°ƒç”¨_dispatch_put_thread_semaphoreé”€æ¯ä¿¡å·é‡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if (tmp == DISPATCH_ONCE_DONE) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                break;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //ç©ºçš„å®å®šä¹‰ï¼Œå•¥ä¹Ÿä¸åš&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dispatch_atomic_store_barrier();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //å°†å½“å‰ä¿¡å·é‡åŠ å…¥åˆ°ä¿¡å·é“¾è¡¨ä¸­ï¼Œç„¶åçº¿ç¨‹ç­‰å¾…ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if (__sync_bool_compare_and_swap(vval, tmp, &amp;amp;dow)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dow.dow_next = tmp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _dispatch_thread_semaphore_wait(dow.dow_sema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //å¦‚æœvvalçš„æŒ‡å‘å€¼ä¸å†æ˜¯tmpï¼Œå¯èƒ½å…¶å®ƒçº¿ç¨‹åŒæ—¶è¿›å…¥è¯¥åˆ†æ”¯ï¼Œç„¶åè°ƒç”¨__sync_bool_compare_and_swapåŸå­æ“ä½œå°†vvalæŒ‡å‘äº†æ–°çš„èŠ‚ç‚¹ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //åˆ™é‡æ–°å¼€å§‹forå¾ªç¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        _dispatch_put_thread_semaphore(dow.dow_sema);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹dispatch_onceæ˜¯å¦‚ä½•ç¡®ä¿blockåªæ‰§è¡Œä¸€æ¬¡ã€‚ç®€å•æ¥è¯´ï¼Œå½“çº¿ç¨‹Aåœ¨è°ƒç”¨æ‰§è¡Œblockå¹¶è®¾ç½®predicateä¸ºDISPATCH_ONCE_DONE(~0l)æœŸé—´ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿåœ¨è°ƒç”¨disptach_onceï¼Œåˆ™è¿™äº›çº¿ç¨‹ä¼šç­‰å¾…ï¼Œå„çº¿ç¨‹å¯¹åº”çš„ä¿¡å·é‡ä¼šåŠ å…¥åˆ°ä¿¡å·é‡é“¾è¡¨ä¸­ï¼Œç­‰predicateè®¾ç½®ä¸ºDISPATCH_ONCE_DONEåï¼Œä¹Ÿå°±æ˜¯blockæ‰§è¡Œå®Œäº†ï¼Œä¼šæ ¹æ®ä¿¡å·é‡é“¾è¡¨å”¤é†’å„ä¸ªçº¿ç¨‹ä½¿å…¶ç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%BF%A1%E5%8F%B7%E9%87%8F%E9%93%BE%E8%A1%A8.png&quot; alt=&quot;ä¿¡å·é‡é“¾è¡¨.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒä¸è¿‡æœ‰ä¸€ç§ä¸´ç•Œæƒ…å†µï¼Œå‡å¦‚çº¿ç¨‹Aåœ¨æ‰§è¡Œblockï¼Œä½†æ˜¯åˆ›å»ºå•ä¾‹å¯¹è±¡objè¿˜æœªå®Œæˆï¼Œè¿™æ—¶å€™çº¿ç¨‹Bè·å–è¯¥objå¯¹è±¡ï¼Œæ­¤æ—¶objï¼nilï¼Œè€Œçº¿ç¨‹Båœ¨çº¿ç¨‹Aå°†predicateè®¾ä¸ºDISPATCH_ONCE_DONEä¹‹åè¯»å–predicateï¼Œè¿™æ˜¯çº¿ç¨‹Bä¼šè®¤ä¸ºå•ä¾‹å¯¹è±¡å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œç„¶åä½¿ç”¨ç©ºçš„objå¯¹è±¡ï¼Œè¿™å°±ä¼šå¯¼è‡´é”™è¯¯å‘ç”Ÿã€‚å› æ­¤dispatch_onceä¼šåœ¨æ‰§è¡Œå®Œblockä¹‹åä¼šæ‰§è¡Œdispatch_atomic_maximally_synchronizing_barrier()è°ƒç”¨ï¼Œè¿™ä¸ªè°ƒç”¨ä¼šæ‰§è¡Œä¸€äº›cpuidæŒ‡ä»¤ï¼Œç¡®ä¿çº¿ç¨‹Aåˆ›å»ºå•ä¾‹å¯¹è±¡objä»¥åŠç½®predicateä¸ºDISPATCH_ONCE_DONEçš„æ—¶é—´TimeAå¤§äºçº¿ç¨‹Bè¿›å…¥blockå¹¶è¯»å–predicateå€¼çš„æ—¶é—´TimeBã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#define dispatch_atomic_maximally_synchronizing_barrier() \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    do &amp;#123; unsigned long _clbr; __asm__ __volatile__( \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;cpuid&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    : &amp;quot;=a&amp;quot; (_clbr) : &amp;quot;0&amp;quot; (0) : &amp;quot;ebx&amp;quot;, &amp;quot;ecx&amp;quot;, &amp;quot;edx&amp;quot;, &amp;quot;cc&amp;quot;, &amp;quot;memory&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ); &amp;#125; while(0)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒé™¤æ­¤ä¹‹å¤–ï¼Œæ¯æ¬¡è°ƒç”¨dispatch_onceçš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆåˆ¤æ–­predicateçš„å€¼æ˜¯å¦æ˜¯~0l(ä¹Ÿå°±æ˜¯DISPATCH_ONCE_DONE)ï¼Œå¦‚æœæ˜¯åˆ™æ„å‘³ç€blockå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œä¾¿ä¸å†æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_once(dispatch_once_t *predicate, dispatch_block_t block);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifdef __GNUC__&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define dispatch_once(x, ...) do &amp;#123; if (__builtin_expect(*(x), ~0l) != ~0l) dispatch_once((x), (__VA_ARGS__)); &amp;#125; while (0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹è¿™é‡Œé¢çš„__builtin_expect((x), (v))ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªä¼˜åŒ–çš„åœ°æ–¹ã€‚ã€‚ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__builtin_expect()ç›®çš„æ˜¯å°†â€œåˆ†æ”¯è½¬ç§»â€çš„ä¿¡æ¯æä¾›ç»™ç¼–è¯‘å™¨ï¼Œè¿™æ ·ç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ä»¥å‡å°‘æŒ‡ä»¤è·³è½¬å¸¦æ¥çš„æ€§èƒ½ä¸‹é™ã€‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__builtin_expect((x),1) è¡¨ç¤º x çš„å€¼ä¸ºçœŸçš„å¯èƒ½æ€§æ›´å¤§ï¼› &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;__builtin_expect((x),0) è¡¨ç¤º x çš„å€¼ä¸ºå‡çš„å¯èƒ½æ€§æ›´å¤§ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒç”±äºdispatch_onceçš„åªæ‰§è¡Œblockä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æœŸæœ›çš„æ˜¯å·²ç»blockå·²ç»æ‰§è¡Œå®Œäº†ï¼Œä¹Ÿå°±æ˜¯predictçš„å€¼ä¸º~0lçš„å¯èƒ½æ€§æ›´å¤§ã€‚&lt;br&gt;â€ƒâ€ƒç°åœ¨æˆ‘ä»¬æ¸…æ¥šdispatch_onceæ˜¯å¦‚ä½•ç¡®ä¿blockåªæ‰§è¡Œä¸€æ¬¡äº†ï¼Œå…³é”®å°±åœ¨predictè¿™ä¸ªå€¼ï¼Œé€šè¿‡æ¯”è¾ƒè¿™ä¸ªå€¼ç­‰äº0æˆ–è€…~0læ¥åˆ¤æ–­blockæ˜¯å¦æ‰§è¡Œè¿‡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªå€¼è®¾ä¸ºstaticæˆ–è€…å…¨å±€çš„ç¼˜æ•…ï¼Œå› ä¸ºå„ä¸ªçº¿ç¨‹éƒ½è¦å»è®¿é—®è¿™ä¸ªpredictï¼Œæœ‰å…´è¶£çš„å¯ä»¥è¯•è¯•æŠŠpredicateçš„åˆå§‹å€¼è®¾ä¸ºé0æˆ–è€…éé™æ€å…¨å±€å˜é‡ä¼šå‘ç”Ÿä»€ä¹ˆï½ï½&lt;/p&gt;
&lt;h4 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“&lt;/h4&gt;&lt;p&gt;â€ƒâ€ƒé€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“@synchronizedé‡‡ç”¨çš„æ˜¯é€’å½’äº’æ–¥é”æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè€Œdispatch_onceçš„å†…éƒ¨åˆ™ä½¿ç”¨äº†å¾ˆå¤šåŸå­æ“ä½œæ¥æ›¿ä»£é”ï¼Œä»¥åŠé€šè¿‡ä¿¡å·é‡æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œè€Œä¸”æœ‰å¾ˆå¤šé’ˆå¯¹å¤„ç†å™¨ä¼˜åŒ–çš„åœ°æ–¹ï¼Œç”šè‡³åœ¨ifåˆ¤æ–­è¯­å¥ä¸Šä¹Ÿåšäº†ä¼˜åŒ–(é€¼æ ¼æœ‰ç‚¹é«˜)ï¼Œä½¿å¾—å…¶æ•ˆç‡æœ‰å¾ˆå¤§çš„æå‡ï¼Œè™½ç„¶å…¶æºç å¾ˆçŸ­ï¼Œä½†é‡Œé¢åŒ…å«çš„ä¸œè¥¿å´å¾ˆå¤šï¼Œæ‰€ä»¥è‹¹æœä¹Ÿæ¨èä½¿ç”¨dispatch_onceæ¥åˆ›å»ºå•ä¾‹ã€‚é€šè¿‡è¿™ä¸ªç®€çŸ­çš„dispatch_onceï¼Œä½ ä¹Ÿå¯ä»¥æ¸…æ¥šä¸ºä»€ä¹ˆGCDçš„æ€§èƒ½ä¼šè¿™ä¹ˆé«˜äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥å†å»çœ‹çœ‹libdispatchçš„å…¶å®ƒæºç ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://www.opensource.apple.com/source/objc4/objc4-680/runtime/objc-sync.mm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;objc-sync&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://rykap.com/objective-c/2015/05/09/synchronized.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;synchronized&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Performance/Reference/GCD_libdispatch_Ref/#//apple_ref/c/func/dispatch_once&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;dispatch_once&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html#Atomic-Builtins&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Built-in functions for atomic memory access&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://kernelnewbies.org/FAQ/LikelyUnlikely&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;__builtin_expect&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;å·¥æ¬²å–„å…¶äº‹&lt;/em&gt;,&lt;em&gt;å¿…å…ˆåˆ©å…¶å™¨&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒé€šå¸¸æˆ‘ä»¬åœ¨å®ç°å•ä¾‹æ—¶å€™éƒ½ä¼šä½¿ç”¨synchronizedæˆ–è€…dispatch_onceæ–¹æ³•ï¼Œåˆå§‹åŒ–å¾€å¾€æ˜¯ä¸‹é¢çš„æ ·å­ï¼š&lt;br&gt;ä½¿ç”¨synchronizedæ–¹æ³•å®ç°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static id obj = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(instancetype)shareInstance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @synchronized(self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (!obj) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            obj = [[SingletonObj alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨dispatch_onceæ–¹æ³•å®ç°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static id obj = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(instancetype)shareInstance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static dispatch_once_t onceToken;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_once(&amp;amp;onceToken, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        obj = [[SingletonObj alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return obj;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h5 id=&quot;æ€§èƒ½å·®å¼‚&quot;&gt;&lt;a href=&quot;#æ€§èƒ½å·®å¼‚&quot; class=&quot;headerlink&quot; title=&quot;æ€§èƒ½å·®å¼‚&quot;&gt;&lt;/a&gt;æ€§èƒ½å·®å¼‚&lt;/h5&gt;&lt;p&gt;â€ƒâ€ƒä¸Šé¢çš„è¿™äº›å†™æ³•å¤§å®¶åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼Œæ—¢ç„¶ä¸¤ç§æ–¹å¼éƒ½èƒ½å®ç°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤è€…çš„æ€§èƒ½å·®å¼‚ï¼Œè¿™é‡Œç®€å•å†™äº†ä¸ªæµ‹è¯•çš„&lt;a href=&quot;https://github.com/FreeMind-LJ/SingletonTest&quot;&gt;demo&lt;/a&gt;ï¼Œä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•åˆ†å•çº¿ç¨‹è·Ÿå¤šçº¿ç¨‹(é‡‡ç”¨dispatch_applyæ–¹å¼ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒé«˜)å»è®¿é—®ä¸€ä¸ªå•ä¾‹å¯¹è±¡ä¸€ç™¾ä¸‡æ¬¡ï¼Œå¯¹æ¯”è¿™æœŸé—´çš„è€—æ—¶ï¼Œä»iPodè·Ÿ5sæµ‹è¯•å¾—åˆ°å¦‚ä¸‹çš„ç»“æœ&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="æºç å‰–æ" scheme="http://freemind-lj.github.io/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>è°ˆè°ˆé¢å‘å¯¹è±¡è®¾è®¡(OOD)åŸåˆ™</title>
    <link href="http://freemind-lj.github.io/2015/12/23/%E8%B0%88%E8%B0%88%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1-OOD-%E5%8E%9F%E5%88%99/"/>
    <id>http://freemind-lj.github.io/2015/12/23/è°ˆè°ˆé¢å‘å¯¹è±¡è®¾è®¡-OOD-åŸåˆ™/</id>
    <published>2015-12-23T09:46:39.000Z</published>
    <updated>2016-02-15T02:59:52.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æ‹¥æœ‰ä¸€æŠŠé”¤å­æœªå¿…èƒ½æˆä¸ºå»ºç­‘å¸ˆ&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå‘ç°åœ¨æ¯æ³¢è¿­ä»£å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦å»ä¿®æ”¹ä¹‹å‰çš„ä»£ç ï¼Œè™½ç„¶å‡ºç°è¿™æ ·çš„æƒ…å½¢å¾ˆæ­£å¸¸ï¼Œæ–°çš„éœ€æ±‚å¿…ç„¶ä¼šå¸¦æ¥æ–°çš„åŠŸèƒ½æ–°çš„è®¾è®¡ï¼Œå¯¼è‡´ä¹‹å‰çš„ä»£ç å—åˆ°å½±å“ã€‚è®°å¾—çœ‹è¿‡ä¸€ä¸ªç¬‘è¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæ€ä¸€ä¸ªç¨‹åºå‘˜ä¸éœ€è¦ç”¨æªï¼Œæ”¹ä¸‰æ¬¡éœ€æ±‚å°±å¯ä»¥äº†â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒå…¶å®éœ€æ±‚è®¾è®¡æ˜¯ä¸€ä¸ªæ–¹é¢ï¼Œå¦å¤–æˆ‘ä»¬ä½œä¸ºè®¾è®¡å¼€å‘äººå‘˜æœ‰æ—¶å€™ä¹Ÿéœ€è¦å»åçœï¼Œåçœä¸€ä¸‹ä»£ç çš„è®¾è®¡æ˜¯å¦åˆç†ï¼Œä¸ºä»€ä¹ˆæ–°åŠŸèƒ½çš„åœ¨åŸæœ‰ä»£ç ä¸Šæ‰©å±•ä¼šé‚£ä¹ˆéš¾ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä»£ç è¿™ä¹ˆä¸ç¨³å®šï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Ÿ&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘è§‰å¾—èƒ½æˆä¸ºä¸€åç¨‹åºå‘˜ï¼Œè‡³å°‘ä¸ä¼šæ˜¯ä¸€ä¸ªç¬¨çš„äººï¼Œè¦å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œæ€»èƒ½æƒ³åŠæ³•å®ç°ï¼ˆä¸ç„¶æ—©è¢«å¼€é™¤å•¦ï½ï¼‰ï¼Œä½†å®ç°çš„æ–¹æ³•æ€è·¯å´æœ‰å¥½æœ‰åï¼Œä¸è¿‡è®¤ä¸ºæ€è·¯å¯ä»¥è¢«å¼•å¯¼ï¼Œè½¯ä»¶å¼€å‘ä¸æ˜¯æ‰åˆšå¼€å§‹ï¼Œå®ƒå·²ç»å­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å¸æ”¶å‰äººçš„ä¸€äº›ç»éªŒæ•™è®­æ¥æé«˜è‡ªå·±ï¼Œæ¯”å¦‚GOFçš„ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ï¼Œå¸®æˆ‘ä»¬æ€»ç»“äº†å¾ˆå¤šé—®é¢˜çš„è§£å†³æ€è·¯ã€‚è¿™æ®µæ—¶é—´ä¹ŸèŠ±äº†ç‚¹æ—¶é—´å­¦ä¹ é¢å‘å¯¹è±¡è®¾è®¡çš„ä¸€äº›æ€æƒ³ï¼Œä¹Ÿè°ˆè°ˆè‡ªå·±çš„ä¸€äº›ç†è§£ã€‚&lt;br&gt;â€ƒâ€ƒæåˆ°è®¾è®¡æ¨¡å¼ï¼Œæˆ‘æƒ³å¾ˆå¤šäººéƒ½çœ‹è¿‡è¿™å—çš„ä¸€äº›ä¹¦ç±ï¼Œä¸è¿‡ä¸çŸ¥é“ä¼šä¸ä¼šæœ‰è·Ÿæˆ‘ä¸€æ ·çš„å›°æƒ‘ï¼šçœ‹çš„æ—¶å€™éƒ½ç†è§£ï¼Œä½†æ˜¯å®é™…å¼€å‘çš„æ—¶å€™å´æ— æ³•èå…¥ï¼Œåé¢æ…¢æ…¢å°±å¿˜è®°äº†ã€‚å°´å°¬ï¼Œå¯èƒ½æˆ‘ä»¬åªæ˜¯çœ‹åˆ°äº†æŸä¸ªæ¨¡å¼çš„è¡¨é¢ï¼Œè€Œéšè—åœ¨æ¨¡å¼åé¢çš„ä¸€äº›â€œçœŸç†â€å´æ²¡æœ‰å»æŒ–æ˜ï¼Œè¿™ä¸ªæ¨¡å¼æ˜¯è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå…¶å®æ¨¡å¼è®¾è®¡çš„èƒŒåéƒ½æ˜¯ä¸ºäº†éµå¾ªæŸç§è®¾è®¡åŸåˆ™ã€‚&lt;/p&gt;
&lt;h4 id=&quot;â€œæ¯”è®¾è®¡æ¨¡å¼æ›´é‡è¦çš„æ˜¯è®¾è®¡åŸåˆ™â€&quot;&gt;&lt;a href=&quot;#â€œæ¯”è®¾è®¡æ¨¡å¼æ›´é‡è¦çš„æ˜¯è®¾è®¡åŸåˆ™â€&quot; class=&quot;headerlink&quot; title=&quot;â€œæ¯”è®¾è®¡æ¨¡å¼æ›´é‡è¦çš„æ˜¯è®¾è®¡åŸåˆ™â€&quot;&gt;&lt;/a&gt;â€œæ¯”è®¾è®¡æ¨¡å¼æ›´é‡è¦çš„æ˜¯è®¾è®¡åŸåˆ™â€&lt;/h4&gt;&lt;p&gt;â€ƒâ€ƒé¢ç›¸å¯¹è±¡è®¾è®¡çš„æ¦‚å¿µå¤§å®¶ä¹Ÿéƒ½çŸ¥é“ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡å°±æ˜¯å¸Œæœ›è½¯ä»¶ç³»ç»Ÿèƒ½åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯æ‰©å±•ï¼šæ–°ç‰¹æ€§èƒ½å¤Ÿå¾ˆå®¹æ˜“çš„æ·»åŠ åˆ°ç°æœ‰ç³»ç»Ÿä¸­ï¼Œä¸ä¼šå½±å“åŸæœ¬çš„ä¸œè¥¿&lt;/li&gt;
&lt;li&gt;å¯ä¿®æ”¹ï¼šå½“ä¿®æ”¹æŸä¸€éƒ¨åˆ†çš„ä»£ç æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒä¸ç›¸å…³çš„éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;å¯æ›¿ä»£ï¼šå°†ç³»ç»Ÿä¸­æŸéƒ¨åˆ†çš„ä»£ç ç”¨å…¶å®ƒæœ‰ç›¸åŒæ¥å£çš„ç±»æ›¿æ¢æ—¶ï¼Œä¸ä¼šå½±å“åˆ°ç°æœ‰ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™å‡ ä¸ªå¯ä»¥ç”¨æ¥æ£€æµ‹æˆ‘ä»¬çš„è½¯ä»¶ç³»ç»Ÿæ˜¯ä¸æ˜¯è®¾è®¡å¾—åˆç†ï¼Œè€Œå¦‚ä½•è®¾è®¡å‡ºæ˜“äºç»´æŠ¤å’Œæ‰©å±•çš„è½¯ä»¶ç³»ç»Ÿæ˜¯æœ‰è®¾è®¡åŸåˆ™å¯ä»¥éµå¾ªæŒ‡å¯¼çš„ï¼Œ&lt;a href=&quot;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Robert C. Martin&lt;/a&gt;æå‡ºäº†é¢ç›¸å¯¹è±¡è®¾è®¡çš„äº”ä¸ªåŸºæœ¬åŸåˆ™ï¼ˆSOLIDï¼‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sï¼å•ä¸€èŒè´£åŸåˆ™&lt;/li&gt;
&lt;li&gt;Oï¼å¼€æ”¾å…³é—­åŸåˆ™&lt;/li&gt;
&lt;li&gt;Lï¼é‡Œæ°æ›¿æ¢åŸåˆ™&lt;/li&gt;
&lt;li&gt;Iï¼æ¥å£éš”ç¦»åŸåˆ™&lt;/li&gt;
&lt;li&gt;Dï¼ä¾èµ–å€’ç½®åŸåˆ™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬åœ¨è¿›è¡Œé¢ç›¸å¯¹è±¡è®¾è®¡çš„æ—¶å€™åº”è¯¥ç‰¢è®°è¿™å‡ ä¸ªåŸåˆ™ï¼Œè¿™èƒ½è®©ä½ æˆä¸ºæ›´ä¼˜ç§€çš„è®¾è®¡å¼€å‘äººå‘˜ï¼ï¼ï¼è‡³å°‘ä½ çš„ä»£ç ä¸ä¼šé‚£ä¹ˆçƒ‚ï¼Œä¸‹é¢æ¥ç®€å•äº†è§£ä¸€ä¸‹è¿™å‡ ä¸ªåŸåˆ™ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å•ä¸€èŒè´£åŸåˆ™ï¼šSingle-Responsibility-Principle&quot;&gt;&lt;a href=&quot;#å•ä¸€èŒè´£åŸåˆ™ï¼šSingle-Responsibility-Principle&quot; class=&quot;headerlink&quot; title=&quot;å•ä¸€èŒè´£åŸåˆ™ï¼šSingle Responsibility Principle&quot;&gt;&lt;/a&gt;å•ä¸€èŒè´£åŸåˆ™ï¼šSingle Responsibility Principle&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèŒè´£ï¼Œåªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒç®€å•æ¥è¯´ä¸€ä¸ªç±»åªåšå¥½ä¸€ä»¶äº‹å°±è¡Œï¼Œä¸å»ç®¡è·Ÿè‡ªå·±ä¸ç›¸å¹²çš„ï¼Œç‹—æ‹¿è€—å­å¤šç®¡é—²äº‹ï¼Œå…¶æ ¸å¿ƒå°±æ˜¯è§£è€¦ä»¥åŠé«˜å†…èšã€‚è¿™ä¸ªåŸåˆ™çœ‹ç€å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™å³ä¾¿ä¸çŸ¥é“è¿™ä¸ªåŸåˆ™ä¹Ÿä¼šå¾€è¿™ä¸ªæ–¹å‘é æ‹¢ï¼Œå†™å‡ºåŠŸèƒ½ç›¸å¯¹å•ä¸€çš„ç±»ï¼Œä¸è¿‡è¿™ä¸ªåŸåˆ™å¾ˆå®¹æ˜“è¿èƒŒï¼Œå› ä¸ºå¯èƒ½ç”±äºæŸç§åŸå› ï¼ŒåŸæ¥åŠŸèƒ½å•ä¸€çš„ç±»éœ€è¦è¢«ç»†åŒ–æˆé¢—ç²’æ›´å°çš„èŒè´£1è·ŸèŒè´£2ï¼Œæ‰€ä»¥åœ¨æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦é‡æ–°æ¢³ç†é‡æ„ä¹‹å‰ç¼–å†™çš„ä»£ç ï¼Œå°†ä¸åŒçš„èŒè´£å°è£…åˆ°ä¸åŒçš„ç±»æˆ–è€…æ¨¡å—ä¸­ã€‚&lt;br&gt;ä¸¾ä¸ªæ —å­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@interface DataTransfer : NSObject&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)upload:(NSData *)data; //ä¸Šä¼ æ•°æ®&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)download(NSString*)url;  //æ ¹æ®URLä¸‹è½½ä¸œè¥¿&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒDataTransferåŒ…å«ä¸Šä¼ è·Ÿä¸‹è½½åŠŸèƒ½ï¼Œä»”ç»†è€ƒè™‘å¯ä»¥å‘ç°è¿™ç›¸å½“äºå®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªè´Ÿè´£ä¸Šä¼ çš„ç›¸å…³é€»è¾‘ï¼Œå¦ä¸€ä¸ªè´Ÿè´£ä¸‹è½½çš„é€»è¾‘ï¼Œè€Œè¿™ä¸ªä¸¤ä¸ªåŠŸèƒ½ç›¸å¯¹å¯¹ç«‹ï¼Œå½“æœ‰ä¸€ä¸ªåŠŸèƒ½æ”¹å˜çš„æ—¶å€™ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æ˜¯ä½¿ç”¨AFNetworkingï¼Œç°åœ¨æƒ³æ¢æˆå…¶å®ƒç¬¬ä¸‰æ–¹æˆ–è€…nsurlconnectionæ¥å®ç°ä¸Šä¼ è·Ÿä¸‹è½½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸Šä¼ æ–¹å¼å˜æ›´ï¼Œå¯¼è‡´DataTransferå˜æ›´&lt;/li&gt;
&lt;li&gt;ä¸‹è½½æ–¹å¼å˜æ›´ï¼Œå¯¼è‡´ DataTransferå˜æ›´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒè¿™å°±è¿åäº†å•ä¸€èŒè´£çš„åŸåˆ™ï¼Œæ‰€ä»¥éœ€è¦å°†ä¸åŒçš„åŠŸèƒ½æ‹†è§£æˆä¸¤ä¸ªä¸åŒçš„ç±»ï¼Œæ¥è´Ÿè´£å„è‡ªçš„èŒè´£ï¼Œä¸è¿‡è¿™ä¸ªæ‹†çš„ç²’åº¦å¯èƒ½å› äººè€Œå·²ï¼Œæœ‰æ—¶å€™å¹¶ä¸éœ€è¦æ‹†çš„è¿‡ç»†ï¼Œä¸è¦æˆäº†ä¸ºè®¾è®¡è€Œè®¾è®¡ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3.png&quot; alt=&quot;å•ä¸€èŒè´£&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒåœ¨æˆ‘ä»¬é¡¹ç›®ä¸­ç»å¸¸çœ‹åˆ°å¾ˆå¤šè¿åè¿™æ¡åŸåˆ™çš„ä»£ç ï¼Œè€Œä¸”è¿åçš„æ¯”è¾ƒæ˜æ˜¾ï¼Œè®¸å¤šç±»éƒ½æ˜¯ä¸°å¯ŒåŠŸèƒ½çš„è¶…çº§é›†åˆï¼Œæ•´ä¸ªç±»å˜å¾—è‡ƒè‚¿éš¾ä»¥ç†è§£ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬æœ‰æ„è¯†åœ°å»é‡æ„äº†ã€‚&lt;/p&gt;
&lt;p&gt;###å¼€æ”¾å…³é—­åŸåˆ™ï¼šOpen Closed Principle&lt;br&gt;â€ƒâ€ƒå¼€é—­åŸåˆ™çš„å®šä¹‰æ˜¯è¯´ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œè€Œå¯¹ä¿®æ”¹å…³é—­ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ä½ åº”è¯¥é€šè¿‡æ‰©å±•æ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹åŸæœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ï¼Œè¯¥åŸåˆ™æ˜¯é¢ç›¸å¯¹è±¡è®¾è®¡æœ€åŸºæœ¬çš„åŸåˆ™ã€‚&lt;br&gt;â€ƒâ€ƒä¹‹å‰è¯´è¿‡åœ¨é¡¹ç›®ä¸­æ¯å½“éœ€æ±‚éœ€æ”¹çš„æ—¶å€™ç»å¸¸éœ€è¦å¯¹ä»£ç æœ‰å¾ˆå¤§çš„æ”¹åŠ¨ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯å› ä¸ºæˆ‘ä»¬å¯¹è¿™ä¸ªåŸåˆ™ç†è§£çš„ä¸å¤Ÿé€å½»ã€‚&lt;br&gt;â€ƒâ€ƒå¼€é—­åŸåˆ™çš„å…³é”®åœ¨äºæŠ½è±¡ï¼Œæˆ‘ä»¬éœ€è¦æŠ½è±¡å‡ºé‚£äº›ä¸ä¼šå˜åŒ–æˆ–è€…åŸºæœ¬ä¸å˜çš„ä¸œè¥¿ï¼Œè¿™éƒ¨åˆ†ä¸œè¥¿ç›¸å¯¹ç¨³å®šï¼Œè¿™ä¹Ÿå°±æ˜¯å¯¹ä¿®æ”¹å…³é—­çš„åœ°æ–¹ï¼ˆè¿™å¹¶ä¸æ„å‘³ç€ä¸å¯ä»¥å†ä¿®æ”¹ï¼‰ï¼Œè€Œå¯¹äºé‚£äº›å®¹æ˜“å˜åŒ–çš„éƒ¨åˆ†æˆ‘ä»¬ä¹Ÿå¯¹å…¶å°è£…ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æ˜¯å¯ä»¥åŠ¨æ€ä¿®æ”¹çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯å¯¹æ‰©å±•å¼€å‘çš„åœ°æ–¹ï¼Œæ¯”å¦‚è®¾è®¡æ¨¡å¼ä¸­çš„ç­–ç•¥æ¨¡å¼å’Œæ¨¡æ¿æ¨¡å¼å°±æ˜¯åœ¨å®ç°è¿™ä¸ªåŸåˆ™ï¼ˆç°åœ¨åº”è¯¥å¯¹æ¨¡å¼æœ‰æ›´æ„Ÿæ€§çš„è®¤è¯†äº†å§ï½ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬éœ€è¦ä¿å­˜å¯¹è±¡åˆ°æ•°æ®åº“å½“ä¸­ï¼Œå…¶ä¸­æœ‰ä¸ªç±»ä¼¼save()çš„ä¿å­˜æ–¹æ³•ï¼Œè¿™éƒ¨åˆ†åº”è¯¥æ˜¯ä¸å˜çš„ï¼Œæ¥å£ç›¸å¯¹ç¨³å®šï¼Œè€Œå…·ä½“ä¿å­˜çš„å®ç°å´æœ‰å¯èƒ½ä¸åŒï¼Œæˆ‘ä»¬ç°åœ¨å¯èƒ½æ˜¯ä¿å­˜åœ¨Sqliteæ•°æ®åº“ä¸­ï¼Œå‡å¦‚ä»¥åå¦‚æœæƒ³ä¿å­˜åˆ°ä¸€ä¸ªè‡ªå·±å®ç°çš„æ•°æ®åº“ä¸­æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ªæ‹¥æœ‰åŒæ ·æ¥å£çš„æ‰©å±•ç±»æ·»åŠ è¿›å»å³å¯ï¼Œè¿™å°±æ˜¯å¯¹æ‰©å±•å¼€æ”¾ï¼Œä¸ä¼šå¯¹ä¹‹å‰çš„ä»£ç é€ æˆä»»ä½•å½±å“ï¼Œå°±å¯ä»¥å®ç°ä¿å­˜åˆ°æ–°æ•°æ®åº“çš„åŠŸèƒ½ï¼Œä¿è¯äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99.png&quot; alt=&quot;å¼€é—­åŸåˆ™&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å®ç°å¼€é—­åŸåˆ™çš„æŒ‡å¯¼æ€æƒ³å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ½è±¡å‡ºç›¸å¯¹ç¨³å®šçš„æ¥å£ï¼Œè¿™éƒ¨åˆ†åº”è¯¥ä¸æ”¹åŠ¨æˆ–è€…å¾ˆå°‘æ”¹åŠ¨&lt;/li&gt;
&lt;li&gt;å°è£…å˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒä¸è¿‡åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦ä¸€å¼€å§‹å°±å®Œå…¨æŒ‰ç…§å¼€é—­åŸåˆ™æ¥å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œæ›´å¤šçš„æƒ…å†µæ˜¯åœ¨ä¸æ–­çš„è¿­ä»£é‡æ„è¿‡ç¨‹ä¸­å»æ”¹è¿›ï¼Œåœ¨å¯é¢„è§çš„å˜åŒ–èŒƒå›´å†…å»åšè®¾è®¡ã€‚&lt;/p&gt;
&lt;h3 id=&quot;é‡Œæ°æ›¿ä»£åŸåˆ™ï¼šLiskov-Substitution-Principle&quot;&gt;&lt;a href=&quot;#é‡Œæ°æ›¿ä»£åŸåˆ™ï¼šLiskov-Substitution-Principle&quot; class=&quot;headerlink&quot; title=&quot;é‡Œæ°æ›¿ä»£åŸåˆ™ï¼šLiskov Substitution Principle&quot;&gt;&lt;/a&gt;é‡Œæ°æ›¿ä»£åŸåˆ™ï¼šLiskov Substitution Principle&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒè¯¥åŸåˆ™çš„å®šä¹‰ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚ç®€å•æ¥è¯´ï¼Œæ‰€æœ‰ä½¿ç”¨åŸºç±»ä»£ç çš„åœ°æ–¹ï¼Œå¦‚æœæ¢æˆå­ç±»å¯¹è±¡çš„æ—¶å€™è¿˜èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œåˆ™æ»¡è¶³è¿™ä¸ªåŸåˆ™ï¼Œå¦åˆ™å°±æ˜¯ç»§æ‰¿å…³ç³»æœ‰é—®é¢˜ï¼Œåº”è¯¥åºŸé™¤ä¸¤è€…çš„ç»§æ‰¿å…³ç³»ï¼Œè¿™ä¸ªåŸåˆ™å¯ä»¥ç”¨æ¥åˆ¤æ–­æˆ‘ä»¬çš„å¯¹è±¡ç»§æ‰¿å…³ç³»æ˜¯å¦åˆç†ã€‚&lt;br&gt;æ¯”å¦‚æœ‰ä¸€ä¸ªé²¸é±¼çš„ç±»ï¼Œæˆ‘ä»¬è®©é²¸é±¼ç»§æ‰¿äºé±¼ç±»ï¼Œç„¶åé±¼ç±»æœ‰ä¸ªå‘¼å¸çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E9%B2%B8%E9%B1%BC%E7%BB%A7%E6%89%BF%E8%87%AA%E9%B1%BC%E7%B1%BB.png&quot; alt=&quot;é²¸é±¼ç»§æ‰¿è‡ªé±¼ç±»&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;ç„¶ååœ¨æ°´é‡Œçš„æ—¶å€™ï¼Œé±¼èƒ½å¤Ÿè¿›è¡Œå‘¼å¸ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if(isInwater)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //åœ¨æ°´ä¸­äº†ï¼Œå¼€å§‹å‘¼å¸&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fish.breath();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå½“æˆ‘ä»¬æŠŠé²¸é±¼è¿™ä¸ªå­å¯¹è±¡æ›¿æ¢åŸæ¥çš„åŸºç±»é±¼å¯¹è±¡ï¼Œé²¸é±¼åœ¨æ°´é‡Œå¼€å§‹å‘¼å¸ï¼Œè¿™æ—¶é—®é¢˜å°±å‡ºç°äº†ï¼Œé²¸é±¼æ˜¯å“ºä¹³åŠ¨ç‰©ï¼Œåœ¨æ°´é‡Œå‘¼å¸æ˜¯æ²¡æ³•å‘¼å¸çš„ï¼Œä¸€ç›´åœ¨æ°´é‡Œå°±GGæ€å¯†è¾¾äº†ï¼Œæ‰€ä»¥è¿™è¿åäº†è¯¥åŸåˆ™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­é²¸é±¼ç»§æ‰¿äºé±¼ç±»ä¸åˆç†ï¼Œéœ€è¦å»é‡æ–°è®¾è®¡ã€‚&lt;br&gt;â€ƒâ€ƒé€šå¸¸åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šä¼˜å…ˆé‡‡ç”¨ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ï¼Œå› ä¸ºç»§æ‰¿è™½ç„¶å‡å°‘äº†ä»£ç ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ï¼Œä½†æ˜¯çˆ¶ç±»è·Ÿå­ç±»ä¼šæœ‰å¾ˆå¼ºçš„è€¦åˆæ€§ï¼Œç ´åäº†å°è£…ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ¥å£éš”ç¦»åŸåˆ™ï¼šInterface-Segregation-Principle&quot;&gt;&lt;a href=&quot;#æ¥å£éš”ç¦»åŸåˆ™ï¼šInterface-Segregation-Principle&quot; class=&quot;headerlink&quot; title=&quot;æ¥å£éš”ç¦»åŸåˆ™ï¼šInterface Segregation Principle&quot;&gt;&lt;/a&gt;æ¥å£éš”ç¦»åŸåˆ™ï¼šInterface Segregation Principle&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒè¯¥åŸåˆ™çš„å®šä¹‰ï¼šä¸èƒ½å¼ºè¿«ç”¨æˆ·å»ä¾èµ–é‚£äº›ä»–ä»¬ä¸ä½¿ç”¨çš„æ¥å£ã€‚ç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦ä»€ä¹ˆæ¥å£ï¼Œå°±æä¾›ç»™å®ƒä»€ä¹ˆæ ·çš„æ¥å£ï¼Œå…¶å®ƒå¤šä½™çš„æ¥å£å°±ä¸è¦æä¾›ï¼Œä¸è¦è®©æ¥å£å˜å¾—è‡ƒè‚¿ï¼Œå¦åˆ™å½“å¯¹è±¡ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨çš„æ–¹æ³•è¢«æ”¹å˜äº†ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿå°†ä¼šå—åˆ°å½±å“ã€‚æ¥å£çš„è®¾è®¡åº”è¯¥éµå¾ªæœ€å°æ¥å£åŸåˆ™ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯é«˜å†…èšçš„ä¸€ç§è¡¨ç°ï¼Œæ¢å¥è¯è¯´ï¼Œä½¿ç”¨å¤šä¸ªåŠŸèƒ½å•ä¸€ã€é«˜å†…èšçš„æ¥å£æ€»æ¯”ä½¿ç”¨ä¸€ä¸ªåºå¤§çš„æ¥å£è¦å¥½ã€‚&lt;br&gt;â€ƒâ€ƒä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ªè‡ªè¡Œè½¦æ¥å£ï¼Œè¿™ä¸ªæ¥å£åŒ…å«äº†å¾ˆå¤šæ–¹æ³•ï¼ŒåŒ…æ‹¬GPSå®šä½ï¼Œä»¥åŠæ¢æŒ¡çš„æ–¹æ³•&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%B8%8D%E6%BB%A1%E8%B6%B3ISP%E5%8E%9F%E5%88%99.png&quot; alt=&quot;ä¸æ»¡è¶³ISPåŸåˆ™&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;â€ƒç„¶åæˆ‘ä»¬å‘ç°å³ä¾¿æ™®é€šçš„è‡ªè¡Œè½¦ä¹Ÿéœ€è¦å®ç°GPSå®šä½ä»¥åŠæ¢æŒ¡çš„åŠŸèƒ½ï¼Œæ˜¾ç„¶è¿™è¿èƒŒäº†æ¥å£éš”ç¦»çš„åŸåˆ™ã€‚éµå¾ªæ¥å£æœ€å°åŒ–çš„åŸåˆ™ï¼Œæˆ‘ä»¬é‡æ–°è®¾è®¡ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%BB%A1%E8%B6%B3ISP%E5%8E%9F%E5%88%99.png&quot; alt=&quot;æ»¡è¶³ISPåŸåˆ™&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒè¿™æ ·ä¸€æ¥æ¯ä¸ªæ¥å£çš„åŠŸèƒ½ç›¸å¯¹å•ä¸€ï¼Œä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨ä¸€ä¸ªæ€»çš„æ¥å£è¦å¥½ï¼Œå‡å¦‚æˆ‘ä»¬çš„å±±åœ°è½¦æ²¡æœ‰æ²¡æœ‰GPSå®šä½çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸å»ç»§æ‰¿å®ç°å¯¹åº”çš„æ¥å£å³å¯ï¼Œåœ¨iOSå¼€å‘ä¸­æœ‰å¾ˆå¤šè¿™æ ·çš„ä¾‹å­ï¼Œæ¯”å¦‚UITalbleViewçš„ä»£ç†æœ‰ä¸¤ä¸ªä¸åŒçš„æ¥å£ï¼ŒUITableViewDataSourceä¸“é—¨è´Ÿè´£éœ€è¦æ˜¾ç¤ºçš„å†…å®¹ï¼ŒUITableViewDelegateä¸“é—¨è´Ÿè´£ä¸€äº›viewçš„è‡ªå®šä¹‰æ˜¾ç¤ºï¼Œç„¶åæˆ‘ä»¬ä¼šç»§æ‰¿å¤šä¸ªæ¥å£ï¼Œè¿™å°±æ»¡è¶³äº†ISPåŸåˆ™ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@interface ViewController () &amp;lt;UITableViewDataSource,UITableViewDelegate,OtherProtocol&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ä¾èµ–å€’ç½®åŸåˆ™ï¼šDependence-Inversion-Principle&quot;&gt;&lt;a href=&quot;#ä¾èµ–å€’ç½®åŸåˆ™ï¼šDependence-Inversion-Principle&quot; class=&quot;headerlink&quot; title=&quot;ä¾èµ–å€’ç½®åŸåˆ™ï¼šDependence Inversion Principle&quot;&gt;&lt;/a&gt;ä¾èµ–å€’ç½®åŸåˆ™ï¼šDependence Inversion Principle&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒè¯¥åŸåˆ™çš„å®šä¹‰ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼›ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚å…¶å®è¿™å°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„â€œé’ˆå¯¹æ¥å£ç¼–ç¨‹â€ï¼Œè¿™é‡Œçš„æ¥å£å°±æ˜¯æŠ½è±¡ï¼Œæˆ‘ä»¬åº”è¯¥ä¾èµ–æ¥å£ï¼Œè€Œä¸æ˜¯ä¾èµ–å…·ä½“çš„å®ç°æ¥ç¼–ç¨‹ã€‚&lt;br&gt;â€ƒâ€ƒå¦‚ä½ åœ¨Sqliteæ•°æ®åº“çš„åŸºç¡€ä¸Šå¼€å‘ä¸€å¥—æ–°çš„æ•°æ®åº“ç³»ç»ŸAWEDatabaseï¼Œè¿™æ—¶å€™Sqliteç›¸å½“äºåº•å±‚æ¨¡å—ï¼Œè€Œä½ çš„AWEDatabaseå°±å±äºé«˜å±‚æ¨¡å—ï¼›è€Œä»AWEDatabaseå¼€å‘ä½¿ç”¨è€…æ¥çœ‹ï¼Œä»–çš„ä¸šåŠ¡å±‚å°±ç›¸å½“äºé«˜å±‚æ¨¡å—ï¼Œè€ŒAWEDatabaseå°±å˜æˆåº•å±‚æ¨¡å—äº†ï¼Œæ‰€ä»¥æ¨¡å—çš„é«˜ä½åº”è¯¥æ˜¯ä»å¼€å‘è€…å½“å‰çš„è§’åº¦æ¥çœ‹çš„ï¼Œä¸è¿‡DIPåŸåˆ™ä»ä¸åŒè§’åº¦æ¥çœ‹å®ƒéƒ½é€‚åˆä¸”éœ€è¦è¢«éµå®ˆã€‚å‡å¦‚æˆ‘ä»¬é«˜å±‚æ¨¡å—ç›´æ¥ä¾èµ–äºåº•å±‚æ¨¡å—ï¼Œå¸¦æ¥çš„åæœæ˜¯æ¯æ¬¡åº•å±‚æ¨¡å—æ”¹åŠ¨ï¼Œé«˜å±‚æ¨¡å—å°±ä¼šå—åˆ°å½±å“ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å˜å¾—ä¸ç¨³å®šï¼Œè¿™ä¹Ÿè¿åäº†å¼€æ”¾å…³é—­åŸåˆ™ã€‚&lt;br&gt;â€ƒâ€ƒé€šå¸¸æˆ‘ä»¬ä¼šé€šè¿‡å¼•å…¥ä¸­é—´å±‚çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªä¸­é—´å±‚ç›¸å½“äºä¸€ä¸ªæŠ½è±¡æ¥å£å±‚ï¼Œé«˜å±‚æ¨¡å—å’Œåº•å±‚æ¨¡å—éƒ½ä¾èµ–äºè¿™ä¸ªä¸­é—´å±‚æ¥äº¤äº’ï¼Œè¿™æ ·åªè¦ä¸­é—´æŠ½è±¡å±‚ä¿æŒä¸å˜ï¼Œåº•å±‚æ¨¡å—æ”¹å˜ä¸ä¼šå½±å“åˆ°é«˜å±‚æ¨¡å—ï¼Œè¿™å°±æ»¡è¶³äº†å¼€æ”¾å…³é—­åŸåˆ™ï¼›è€Œä¸”å‡å¦‚é«˜å±‚æ¨¡å—è·Ÿåº•å±‚æ¨¡å—åŒæ—¶å¤„äºå¼€å‘é˜¶æ®µï¼Œè¿™æ ·æœ‰äº†ä¸­é—´æŠ½è±¡å±‚ä¹‹åï¼Œæ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥é’ˆå¯¹è¿™ä¸ªæŠ½è±¡å±‚çš„æ¥å£åŒæ—¶å¼€å‘ï¼Œé«˜å±‚æ¨¡å—å°±ä¸éœ€è¦ç­‰åˆ°åº•å±‚æ¨¡å—å¼€å‘å®Œæ¯•æ‰èƒ½ç»§ç»­äº†ã€‚&lt;br&gt;â€ƒâ€ƒæ¯”å¦‚åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­æœ‰æ¶‰åŠIMçš„åŠŸèƒ½ï¼Œç°åœ¨è¿™ä¸ªIMæ¨¡å—é‡‡ç”¨çš„æ˜¯XMPPåè®®æ¥å®ç°ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªæ¨¡å—æ¥å®ç°æ¶ˆæ¯çš„æ”¶å‘ï¼Œä½†æ˜¯å‡å¦‚åé¢æˆ‘ä»¬æƒ³è¦æ¢æˆå…¶å®ƒåè®®ï¼Œæ¯”å¦‚MQTTç­‰ï¼Œé’ˆå¯¹æ¥å£ç¼–ç¨‹çš„è¯å°±å¯ä»¥è®©æˆ‘ä»¬å¾ˆè½»æ¾çš„å®ç°æ¨¡å—æ›¿æ¢ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E9%92%88%E5%AF%B9%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B.png&quot; alt=&quot;é’ˆå¯¹æ¥å£ç¼–ç¨‹&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@protocol MessageDelegate &amp;lt;NSObject&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@required&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)goOnline;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)sendMessage:(NSString*)content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//xmppå®ç°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface XMPPMessageCenter &amp;lt;MessageDelegate&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//MQTTå®ç°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface MQTTMessageCenter &amp;lt;MessageDelegate&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä¸šåŠ¡å±‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface BussinessLayer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä½¿ç”¨éµå¾ªMessageDelegateåè®®çš„å¯¹è±¡ï¼Œé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä»¥åæ›¿æ¢ä¹Ÿå¾ˆæ–¹ä¾¿&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property(nonatomic,strong)id&amp;lt;MessageDelegate&amp;gt; messageCenter;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒå½“æˆ‘ä»¬åœ¨è¿›è¡Œé¢å‘å¯¹è±¡è®¾è®¡çš„æ—¶å€™åº”è¯¥å……åˆ†è€ƒè™‘ä¸Šé¢è¿™å‡ ä¸ªåŸåˆ™ï¼Œä¸€å¼€å§‹å¯èƒ½è®¾è®¡å¹¶ä¸å®Œç¾ï¼Œä¸è¿‡å¯ä»¥åœ¨é‡æ„çš„è¿‡ç¨‹ä¸­ä¸æ–­å®Œå–„ã€‚ä½†å…¶å®å¾ˆå¤šäººéƒ½è·³è¿‡äº†è®¾è®¡è¿™ä¸ªç¯èŠ‚ï¼Œæ‹¿åˆ°ä¸€ä¸ªæ¨¡å—ç›´æ¥åŠ¨æ‰‹ç¼–å†™ä»£ç ï¼Œæ›´ä¸ç”¨è¯´å»æ€è€ƒè®¾è®¡äº†ï¼Œé¡¹ç›®ä¸­ä¹Ÿæœ‰å¾ˆå¤šè¿™æ ·çš„ä¾‹å­ã€‚å½“ç„¶å¯¹äºç®€å•çš„æ¨¡å—æˆ–è®¸ä¸ç”¨ä»€ä¹ˆè®¾è®¡ï¼Œä¸è¿‡å‡å¦‚æ¨¡å—ç›¸å¯¹å¤æ‚çš„è¯ï¼Œèƒ½å¤Ÿåœ¨åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰å¥½å¥½è®¾è®¡æ€è€ƒä¸€ä¸‹ï¼Œå…»æˆè¿™ä¸ªä¹ æƒ¯ï¼Œè‚¯å®šä¼šå¯¹ç¼–å†™å‡ºå¯è¯»æ€§ã€ç¨³å®šæ€§ä»¥åŠå¯æ‰©å±•æ€§è¾ƒé«˜çš„ä»£ç æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ€å…³é”®çš„è½¯ä»¶å¼€å‘å·¥å…·æ˜¯å—è¿‡è‰¯å¥½è®¾è®¡åŸåˆ™è®­ç»ƒçš„æ€ç»´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;æ‹¥æœ‰ä¸€æŠŠé”¤å­æœªå¿…èƒ½æˆä¸ºå»ºç­‘å¸ˆ&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå‘ç°åœ¨æ¯æ³¢è¿­ä»£å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦å»ä¿®æ”¹ä¹‹å‰çš„ä»£ç ï¼Œè™½ç„¶å‡ºç°è¿™æ ·çš„æƒ…å½¢å¾ˆæ­£å¸¸ï¼Œæ–°çš„éœ€æ±‚å¿…ç„¶ä¼šå¸¦æ¥æ–°çš„åŠŸèƒ½æ–°çš„è®¾è®¡ï¼Œå¯¼è‡´ä¹‹å‰çš„ä»£ç å—åˆ°å½±å“ã€‚è®°å¾—çœ‹è¿‡ä¸€ä¸ªç¬‘è¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæ€ä¸€ä¸ªç¨‹åºå‘˜ä¸éœ€è¦ç”¨æªï¼Œæ”¹ä¸‰æ¬¡éœ€æ±‚å°±å¯ä»¥äº†â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€ƒâ€ƒå…¶å®éœ€æ±‚è®¾è®¡æ˜¯ä¸€ä¸ªæ–¹é¢ï¼Œå¦å¤–æˆ‘ä»¬ä½œä¸ºè®¾è®¡å¼€å‘äººå‘˜æœ‰æ—¶å€™ä¹Ÿéœ€è¦å»åçœï¼Œåçœä¸€ä¸‹ä»£ç çš„è®¾è®¡æ˜¯å¦åˆç†ï¼Œä¸ºä»€ä¹ˆæ–°åŠŸèƒ½çš„åœ¨åŸæœ‰ä»£ç ä¸Šæ‰©å±•ä¼šé‚£ä¹ˆéš¾ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä»£ç è¿™ä¹ˆä¸ç¨³å®šï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="é¢å‘å¯¹è±¡è®¾è®¡" scheme="http://freemind-lj.github.io/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>æœ‰æ„ä¹‰çš„å‘½å</title>
    <link href="http://freemind-lj.github.io/2015/12/16/%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E5%91%BD%E5%90%8D/"/>
    <id>http://freemind-lj.github.io/2015/12/16/æœ‰æ„ä¹‰çš„å‘½å/</id>
    <published>2015-12-16T01:37:01.000Z</published>
    <updated>2016-02-15T06:51:00.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;åå‰¯å…¶å®ï¼š&quot;&gt;&lt;a href=&quot;#åå‰¯å…¶å®ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åå‰¯å…¶å®ï¼š&quot;&gt;&lt;/a&gt;åå‰¯å…¶å®ï¼š&lt;/h3&gt;&lt;p&gt;å˜é‡ã€å‡½æ•°æˆ–ç±»çš„åç§°å°±èƒ½å¤Ÿè¯´æ˜ä¸ºä»€ä¹ˆå®ƒå­˜åœ¨ï¼Œåšä»€ä¹ˆäº‹ï¼Œæ€ä¹ˆç”¨ï¼Œå¦‚æœéœ€è¦æ³¨é‡Šæ¥è¡¥å……ï¼Œå°±ä¸ç®—åå‰¯å…¶å®:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//æ¶ˆé€çš„æ—¶é—´ï¼Œä»¥æ—¥è®¡, bad!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int d;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//good&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int daysSinceCreation;Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int daysSinceModification;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;é¿å…è¯¯å¯¼&quot;&gt;&lt;a href=&quot;#é¿å…è¯¯å¯¼&quot; class=&quot;headerlink&quot; title=&quot;é¿å…è¯¯å¯¼&quot;&gt;&lt;/a&gt;é¿å…è¯¯å¯¼&lt;/h3&gt;&lt;p&gt;é¿å…ç•™ä¸‹éšè—ä»£ç æœ¬æ„çš„é”™è¯¯çº¿ç´¢ã€‚&lt;br&gt;accountList  ä¸€ç»„è´¦å·ï¼Œå¦‚æœç±»å‹ä¸æ˜¯Listä¼šå¼•èµ·è¯¯åˆ¤ï¼ŒaccountGroupæˆ–bunchOfAccoutns,ç”šè‡³accountsï¼Œæ›´å¯æ€•çš„ä¾‹å­ï¼šä½¿ç”¨å°äº›å­—æ¯lè·Ÿå­—æ¯Oä½œä¸ºå˜é‡å&lt;/p&gt;
&lt;h3 id=&quot;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot;&gt;&lt;a href=&quot;#åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot; class=&quot;headerlink&quot; title=&quot;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot;&gt;&lt;/a&gt;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&lt;/h3&gt;&lt;p&gt;ä»£ç æ˜¯å†™ç»™äººçœ‹çš„,ä»…ä»…æ˜¯æ»¡è¶³ç¼–è¯‘å™¨çš„è¦æ±‚,å°±ä¼šå¼•èµ·æ··ä¹±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥æ•°å­—ç³»åˆ—å‘½åï¼švoid copyChars(char a1[],char a2[]) ==&amp;gt; void copyChars(char source[],char destination[])&lt;/li&gt;
&lt;li&gt;è¯´åºŸè¯ï¼š a, an, the, Info, Data&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯è¯»çš„åå­—ï¼šé¿å…è¿‡åº¦ä½¿ç”¨ç¼©å†™ï¼Œgenymdhms (ç”Ÿæˆæ—¥æœŸï¼Œå¹´æœˆæ—¥æ—¶åˆ†ç§’)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¾¿äºæœç´¢çš„åç§°ï¼šé¿å…ä½¿ç”¨Magic Numberï¼Œé¿å…ä½¿ç”¨å•å­—æ¯,æˆ–å‡ºç°é¢‘ç‡æé«˜çš„çŸ­å­—æ¯ç»„åˆ(æ³¨æ„åº¦çš„æŠŠæ¡)ï¼›MAX_CLASSER_PER_STUDENT  è·Ÿ  â€œ7â€ â€œeâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;ç±»å&quot;&gt;&lt;a href=&quot;#ç±»å&quot; class=&quot;headerlink&quot; title=&quot;ç±»å&quot;&gt;&lt;/a&gt;ç±»å&lt;/h3&gt;&lt;p&gt;ç±»åå’Œå¯¹è±¡ååº”è¯¥æ˜¯åè¯æˆ–åè¯çŸ­è¯­ï¼ŒCustomerã€Account&lt;/p&gt;
&lt;h3 id=&quot;æ–¹æ³•å&quot;&gt;&lt;a href=&quot;#æ–¹æ³•å&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ³•å&quot;&gt;&lt;/a&gt;æ–¹æ³•å&lt;/h3&gt;&lt;p&gt;åŠ¨è¯æˆ–åŠ¨è¯çŸ­è¯­ï¼šdeletePageã€save,å±æ€§è®¿é—®ã€ä¿®æ”¹å’Œæ–­è¨€ï¼šåŠ ä¸Šgetã€setå’Œis&lt;/p&gt;
&lt;h3 id=&quot;åˆ«è£…å¯çˆ±&quot;&gt;&lt;a href=&quot;#åˆ«è£…å¯çˆ±&quot; class=&quot;headerlink&quot; title=&quot;åˆ«è£…å¯çˆ±&quot;&gt;&lt;/a&gt;åˆ«è£…å¯çˆ±&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ä¿—è¯­æˆ–ä¿šè¯­, eatMyShorts()è¡¨ç¤ºabort()  eatMyShortsï¼šå»æ­»å§&lt;/p&gt;
&lt;h3 id=&quot;æ¯ä¸ªæ¦‚å¿µå¯¹åº”ä¸€ä¸ªè¯&quot;&gt;&lt;a href=&quot;#æ¯ä¸ªæ¦‚å¿µå¯¹åº”ä¸€ä¸ªè¯&quot; class=&quot;headerlink&quot; title=&quot;æ¯ä¸ªæ¦‚å¿µå¯¹åº”ä¸€ä¸ªè¯&quot;&gt;&lt;/a&gt;æ¯ä¸ªæ¦‚å¿µå¯¹åº”ä¸€ä¸ªè¯&lt;/h3&gt;&lt;p&gt;ç»™æ¯ä¸ªæŠ½è±¡æ¦‚å¿µé€‰ä¸€ä¸ªè¯ï¼Œå¹¶ä¸€ä»¥è´¯ä¹‹ã€‚æ¯”å¦‚è·å–æ•°æ®å¯ä»¥ä½¿ç”¨fetchã€retriveã€getè¿™äº›è¯è¯­ï¼Œä½†æœ€å¥½èƒ½å¤Ÿç»Ÿä¸€ä½¿ç”¨ä¸€ç§(controllerã€managerç±»ä¼¼)&lt;/p&gt;
&lt;h3 id=&quot;åå­—å°½é‡æ¥è‡ªè§£å†³æ–¹æ¡ˆé¢†åŸŸæˆ–é—®é¢˜é¢†åŸŸï¼š&quot;&gt;&lt;a href=&quot;#åå­—å°½é‡æ¥è‡ªè§£å†³æ–¹æ¡ˆé¢†åŸŸæˆ–é—®é¢˜é¢†åŸŸï¼š&quot; class=&quot;headerlink&quot; title=&quot;åå­—å°½é‡æ¥è‡ªè§£å†³æ–¹æ¡ˆé¢†åŸŸæˆ–é—®é¢˜é¢†åŸŸï¼š&quot;&gt;&lt;/a&gt;åå­—å°½é‡æ¥è‡ªè§£å†³æ–¹æ¡ˆé¢†åŸŸæˆ–é—®é¢˜é¢†åŸŸï¼š&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è§£å†³æ–¹æ¡ˆé¢†åŸŸåç§°ï¼šä½¿ç”¨è®¡ç®—æœºé¢†åŸŸçš„ç§‘å­¦æœ¯è¯­ã€ç®—æ³•åã€æ¨¡å¼åç­‰ã€‚å¦‚AccountVisitorï¼šVisitoræ¨¡å¼å®ç°çš„Accountç±»ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é—®é¢˜é¢†åŸŸçš„åç§°ï¼šå¦‚æœä¸èƒ½ç”¨ç¨‹åºå‘˜ç†Ÿæ‚‰çš„æœ¯è¯­æ¥å‘½åï¼Œå°±é‡‡ç”¨æ‰€æ¶‰é—®é¢˜é¢†åŸŸçš„åç§°ã€‚æ’åº==&amp;gt; sort&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;é€‚å½“ä½¿ç”¨æœ‰æ„ä¹‰çš„è¯­å¢ƒï¼š&quot;&gt;&lt;a href=&quot;#é€‚å½“ä½¿ç”¨æœ‰æ„ä¹‰çš„è¯­å¢ƒï¼š&quot; class=&quot;headerlink&quot; title=&quot;é€‚å½“ä½¿ç”¨æœ‰æ„ä¹‰çš„è¯­å¢ƒï¼š&quot;&gt;&lt;/a&gt;é€‚å½“ä½¿ç”¨æœ‰æ„ä¹‰çš„è¯­å¢ƒï¼š&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è‰¯å¥½å‘½åçš„ç±»ã€å‡½æ•°ã€åç§°ç©ºé—´æ¥æ”¾ç½®åç§°ï¼Œç»™è¯»è€…æä¾›è¯­å¢ƒ&lt;/li&gt;
&lt;li&gt;ç»™åç§°å‰åŠ å‰ç¼€ï¼šfirstNameã€lastNameã€streetã€houseNumberã€cityã€stateå’Œzipcodeï¼Œå’Œåœ¨ä¸€èµ·çŸ¥é“æ˜¯åœ°å€ï¼Œå­¤é›¶é›¶æ—¶æ— æ³•æ¨æ–­ï¼Œ stateï¼ã€‹addrState&lt;/li&gt;
&lt;li&gt;äº‹ä¸è¿‡ä¸‰ï¼Œå¦‚æœä¼ é€’ç»™å‡½æ•°çš„å˜é‡è¶…è¿‡ä¸‰ä¸ªï¼Œè€ƒè™‘å°è£…æˆæ¦‚å¿µ,æ·»åŠ structæˆ–class&lt;/li&gt;
&lt;li&gt;ä¸è¦æ·»åŠ æ²¡ç”¨çš„è¯­å¢ƒ&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åå‰¯å…¶å®ï¼š&quot;&gt;&lt;a href=&quot;#åå‰¯å…¶å®ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åå‰¯å…¶å®ï¼š&quot;&gt;&lt;/a&gt;åå‰¯å…¶å®ï¼š&lt;/h3&gt;&lt;p&gt;å˜é‡ã€å‡½æ•°æˆ–ç±»çš„åç§°å°±èƒ½å¤Ÿè¯´æ˜ä¸ºä»€ä¹ˆå®ƒå­˜åœ¨ï¼Œåšä»€ä¹ˆäº‹ï¼Œæ€ä¹ˆç”¨ï¼Œå¦‚æœéœ€è¦æ³¨é‡Šæ¥è¡¥å……ï¼Œå°±ä¸ç®—åå‰¯å…¶å®:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//æ¶ˆé€çš„æ—¶é—´ï¼Œä»¥æ—¥è®¡, bad!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int d;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//good&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int daysSinceCreation;Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int daysSinceModification;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;é¿å…è¯¯å¯¼&quot;&gt;&lt;a href=&quot;#é¿å…è¯¯å¯¼&quot; class=&quot;headerlink&quot; title=&quot;é¿å…è¯¯å¯¼&quot;&gt;&lt;/a&gt;é¿å…è¯¯å¯¼&lt;/h3&gt;&lt;p&gt;é¿å…ç•™ä¸‹éšè—ä»£ç æœ¬æ„çš„é”™è¯¯çº¿ç´¢ã€‚&lt;br&gt;accountList  ä¸€ç»„è´¦å·ï¼Œå¦‚æœç±»å‹ä¸æ˜¯Listä¼šå¼•èµ·è¯¯åˆ¤ï¼ŒaccountGroupæˆ–bunchOfAccoutns,ç”šè‡³accountsï¼Œæ›´å¯æ€•çš„ä¾‹å­ï¼šä½¿ç”¨å°äº›å­—æ¯lè·Ÿå­—æ¯Oä½œä¸ºå˜é‡å&lt;/p&gt;
&lt;h3 id=&quot;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot;&gt;&lt;a href=&quot;#åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot; class=&quot;headerlink&quot; title=&quot;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&quot;&gt;&lt;/a&gt;åšæœ‰æ„ä¹‰çš„åŒºåˆ†&lt;/h3&gt;&lt;p&gt;ä»£ç æ˜¯å†™ç»™äººçœ‹çš„,ä»…ä»…æ˜¯æ»¡è¶³ç¼–è¯‘å™¨çš„è¦æ±‚,å°±ä¼šå¼•èµ·æ··ä¹±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥æ•°å­—ç³»åˆ—å‘½åï¼švoid copyChars(char a1[],char a2[]) ==&amp;gt; void copyChars(char source[],char destination[])&lt;/li&gt;
&lt;li&gt;è¯´åºŸè¯ï¼š a, an, the, Info, Data&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯è¯»çš„åå­—ï¼šé¿å…è¿‡åº¦ä½¿ç”¨ç¼©å†™ï¼Œgenymdhms (ç”Ÿæˆæ—¥æœŸï¼Œå¹´æœˆæ—¥æ—¶åˆ†ç§’)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¾¿äºæœç´¢çš„åç§°ï¼šé¿å…ä½¿ç”¨Magic Numberï¼Œé¿å…ä½¿ç”¨å•å­—æ¯,æˆ–å‡ºç°é¢‘ç‡æé«˜çš„çŸ­å­—æ¯ç»„åˆ(æ³¨æ„åº¦çš„æŠŠæ¡)ï¼›MAX_CLASSER_PER_STUDENT  è·Ÿ  â€œ7â€ â€œeâ€&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
      <category term="ä»£ç æ•´æ´ä¹‹é“" scheme="http://freemind-lj.github.io/tags/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/"/>
    
  </entry>
  
  <entry>
    <title>æ•´æ´ä»£ç </title>
    <link href="http://freemind-lj.github.io/2015/12/14/%E6%95%B4%E6%B4%81%E4%BB%A3%E7%A0%81/"/>
    <id>http://freemind-lj.github.io/2015/12/14/æ•´æ´ä»£ç /</id>
    <published>2015-12-14T07:16:01.000Z</published>
    <updated>2016-02-15T06:50:48.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;èµ¶æ—¶é—´å®Œæˆä»»åŠ¡ ï¼ŒæœŸæœ›åé¢å†æ¸…ç†.&lt;/li&gt;
&lt;li&gt;å‹’å¸ƒæœ—æ³•åˆ™ï¼šç¨åç­‰äºæ°¸ä¸ï¼ˆLater equals neverï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ··ä¹±çš„ä»£ä»·ï¼š&quot;&gt;&lt;a href=&quot;#æ··ä¹±çš„ä»£ä»·ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æ··ä¹±çš„ä»£ä»·ï¼š&quot;&gt;&lt;/a&gt;æ··ä¹±çš„ä»£ä»·ï¼š&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä»£ç å˜çš„æ— æ³•ç®¡ç†ï¼Œå›¢é˜Ÿç”Ÿäº§åŠ›ä¸‹é™ï¼Œ&lt;/li&gt;
&lt;li&gt;å¢åŠ äººåŠ›ï¼ŸBrookså®šå¾‹(äººæœˆç¥è¯)ï¼šå‘è¿›åº¦è½åçš„é¡¹ç›®ä¸­å¢åŠ äººæ‰‹ï¼Œåªä¼šä½¿è¿›åº¦æ›´åŠ è½åã€‚&lt;/li&gt;
&lt;li&gt;ç ´çª—ç†è®ºï¼šå‡å¦‚åŸæ¥çš„ä»£ç å¾ˆä¼˜ç§€ï¼Œæ–°åŠ å…¥çš„ä»£ç ä¼šå®³æ€•ç ´åè¿™ç¾å¦™çš„æ•´ä½“è€Œå˜çš„æ›´å¥½ï¼Œåä¹‹åˆ™ä¸ä¼šå»åœ¨æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å¼€å§‹æ–°è®¾è®¡&quot;&gt;&lt;a href=&quot;#å¼€å§‹æ–°è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹æ–°è®¾è®¡:&quot;&gt;&lt;/a&gt;å¼€å§‹æ–°è®¾è®¡:&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ–°ç³»ç»Ÿè®¾è®¡ä¸æ—§ç³»ç»Ÿç»´æŠ¤ç«èµ›ï¼Œæ—¶é—´å¯æŒç»­åå¹´ä¹‹ä¹…ï¼Œå®Œæˆæ—¶æˆå‘˜æ—©ä¸çŸ¥å»å‘&lt;/li&gt;
&lt;li&gt;èŠ±æ—¶é—´ä¿æŒä»£ç æ•´æ´ä¸ä½†å…³ä¹æ•ˆç‡ï¼Œè¿˜å…³ä¹ç”Ÿå­˜&lt;/li&gt;
&lt;li&gt;åˆ¶é€ æ··ä¹±æ— åŠ©äºèµ¶ä¸Šå·¥æœŸï¼Œåªä¼šæ‹–ç´¯ï¼Œå”¯ä¸€æ–¹æ³•å°±æ˜¯å§‹ç»ˆå°½å¯èƒ½ä¿æŒä»£ç æ•´æ´&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æ•´æ´ä»£ç ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æ•´æ´ä»£ç ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æ•´æ´ä»£ç ï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æ•´æ´ä»£ç ï¼Ÿ&lt;/h2&gt;&lt;h4 id=&quot;Bjarne-stroustrupï¼š&quot;&gt;&lt;a href=&quot;#Bjarne-stroustrupï¼š&quot; class=&quot;headerlink&quot; title=&quot;Bjarne stroustrupï¼š&quot;&gt;&lt;/a&gt;Bjarne stroustrupï¼š&lt;/h4&gt;&lt;p&gt;æˆ‘å–œæ¬¢ä¼˜é›…å’Œé«˜æ•ˆçš„ä»£ç ï¼Œä»£ç é€»è¾‘åº”ç›´æˆªäº†å½“ï¼Œå«ç¼ºé™·éš¾ä»¥éšè—ï¼›å°½é‡å‡å°‘ä¾èµ–ï¼Œä½¿ä¹‹ä¾¿äºç»´æŠ¤ï¼›ä¾æ®æŸç§åˆ†æˆæˆ˜ç•¥å®Œå–„é”™è¯¯ä»£ç å¤„ç†ï¼›æ€§èƒ½è°ƒè‡³æœ€ä¼˜ï¼Œçœçš„å¼•è¯±åˆ«äººåšæ²¡è§„çŸ©çš„ä¼˜åŒ–ï¼Œæå‡ºä¸€å †æ··ä¹±æ¥ã€‚æ•´æ´çš„ä»£ç åªåšå¥½ä¸€ä»¶äº‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Michael-Feathers-ä¿®æ”¹ä»£ç çš„è‰ºæœ¯ä½œè€…-ï¼š&quot;&gt;&lt;a href=&quot;#Michael-Feathers-ä¿®æ”¹ä»£ç çš„è‰ºæœ¯ä½œè€…-ï¼š&quot; class=&quot;headerlink&quot; title=&quot;Michael Feathers(ä¿®æ”¹ä»£ç çš„è‰ºæœ¯ä½œè€…)ï¼š&quot;&gt;&lt;/a&gt;Michael Feathers(ä¿®æ”¹ä»£ç çš„è‰ºæœ¯ä½œè€…)ï¼š&lt;/h4&gt;&lt;p&gt;æˆ‘å¯ä»¥åˆ—å‡ºæˆ‘ç•™æ„åˆ°çš„æ•´æ´ä»£ç çš„æ‰€æœ‰ç‰¹ç‚¹ï¼Œä½†å…¶ä¸­æœ‰ä¸€æ¡æ˜¯æ ¹æœ¬æ€§çš„ã€‚æ•´æ´çš„ä»£ç æ€»æ˜¯çœ‹èµ·æ¥åƒæ˜¯æŸä½ç‰¹åˆ«åœ¨æ„å®ƒçš„äººå†™çš„ï¼Œå‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ”¹è¿›çš„ä½™åœ°ï¼Œä»£ç ä½œè€…ä»€ä¹ˆéƒ½æƒ³åˆ°äº†ï¼Œå¦‚æœä½ ä¼å›¾æ”¹è¿›å®ƒï¼Œæ€»ä¼šå›åˆ°åŸç‚¹ï¼Œèµå¹æŸäººç•™ç»™ä½ çš„ä»£ç â€”â€”â€”å…¨å¿ƒå¤´äººçš„æŸäººç•™ä¸‹çš„ä»£ç ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Ronï¼ˆc-æé™ç¼–ç¨‹æ¢é™©ä½œè€…ï¼‰&quot;&gt;&lt;a href=&quot;#Ronï¼ˆc-æé™ç¼–ç¨‹æ¢é™©ä½œè€…ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;Ronï¼ˆc#æé™ç¼–ç¨‹æ¢é™©ä½œè€…ï¼‰:&quot;&gt;&lt;/a&gt;Ronï¼ˆc#æé™ç¼–ç¨‹æ¢é™©ä½œè€…ï¼‰:&lt;/h4&gt;&lt;p&gt;ä¸è¦é‡å¤çš„ä»£ç ï¼ˆè¡¨ç¤ºæŸç§æƒ³æ³•æœªåœ¨ä»£ç ä¸­å¾—åˆ°è‰¯å¥½çš„ä½“ç°ï¼‰ï¼Œåªåšä¸€ä»¶äº‹ï¼Œææ—©æ„å»ºç®€å•æŠ½è±¡ï¼ˆåœ¨é›†åˆä¸­æŸ¥æ‰¾æŸç‰©ï¼‰&lt;/p&gt;
&lt;h4 id=&quot;ç¾å›½ç«¥å­å†›å†›è§„ï¼šè®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€ã€‚&quot;&gt;&lt;a href=&quot;#ç¾å›½ç«¥å­å†›å†›è§„ï¼šè®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€ã€‚&quot; class=&quot;headerlink&quot; title=&quot;ç¾å›½ç«¥å­å†›å†›è§„ï¼šè®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€ã€‚&quot;&gt;&lt;/a&gt;ç¾å›½ç«¥å­å†›å†›è§„ï¼šè®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€ã€‚&lt;/h4&gt;&lt;p&gt;æ”¹å¥½ä¸€ä¸ªå˜é‡åï¼Œæ‹†åˆ†ä¸€ä¸ªè¿‡é•¿çš„å‡½æ•°ï¼Œæ¶ˆé™¤ä¸€ç‚¹ç‚¹é‡å¤ä»£ç &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆè¦å†™ç³Ÿç³•çš„ä»£ç ï¼Ÿ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;èµ¶æ—¶é—´å®Œæˆä»»åŠ¡ ï¼ŒæœŸæœ›åé¢å†æ¸…ç†.&lt;/li&gt;
&lt;li&gt;å‹’å¸ƒæœ—æ³•åˆ™ï¼šç¨åç­‰äºæ°¸ä¸ï¼ˆLater equals neverï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ··ä¹±çš„ä»£ä»·ï¼š&quot;&gt;&lt;a href=&quot;#æ··ä¹±çš„ä»£ä»·ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æ··ä¹±çš„ä»£ä»·ï¼š&quot;&gt;&lt;/a&gt;æ··ä¹±çš„ä»£ä»·ï¼š&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä»£ç å˜çš„æ— æ³•ç®¡ç†ï¼Œå›¢é˜Ÿç”Ÿäº§åŠ›ä¸‹é™ï¼Œ&lt;/li&gt;
&lt;li&gt;å¢åŠ äººåŠ›ï¼ŸBrookså®šå¾‹(äººæœˆç¥è¯)ï¼šå‘è¿›åº¦è½åçš„é¡¹ç›®ä¸­å¢åŠ äººæ‰‹ï¼Œåªä¼šä½¿è¿›åº¦æ›´åŠ è½åã€‚&lt;/li&gt;
&lt;li&gt;ç ´çª—ç†è®ºï¼šå‡å¦‚åŸæ¥çš„ä»£ç å¾ˆä¼˜ç§€ï¼Œæ–°åŠ å…¥çš„ä»£ç ä¼šå®³æ€•ç ´åè¿™ç¾å¦™çš„æ•´ä½“è€Œå˜çš„æ›´å¥½ï¼Œåä¹‹åˆ™ä¸ä¼šå»åœ¨æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å¼€å§‹æ–°è®¾è®¡&quot;&gt;&lt;a href=&quot;#å¼€å§‹æ–°è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹æ–°è®¾è®¡:&quot;&gt;&lt;/a&gt;å¼€å§‹æ–°è®¾è®¡:&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ–°ç³»ç»Ÿè®¾è®¡ä¸æ—§ç³»ç»Ÿç»´æŠ¤ç«èµ›ï¼Œæ—¶é—´å¯æŒç»­åå¹´ä¹‹ä¹…ï¼Œå®Œæˆæ—¶æˆå‘˜æ—©ä¸çŸ¥å»å‘&lt;/li&gt;
&lt;li&gt;èŠ±æ—¶é—´ä¿æŒä»£ç æ•´æ´ä¸ä½†å…³ä¹æ•ˆç‡ï¼Œè¿˜å…³ä¹ç”Ÿå­˜&lt;/li&gt;
&lt;li&gt;åˆ¶é€ æ··ä¹±æ— åŠ©äºèµ¶ä¸Šå·¥æœŸï¼Œåªä¼šæ‹–ç´¯ï¼Œå”¯ä¸€æ–¹æ³•å°±æ˜¯å§‹ç»ˆå°½å¯èƒ½ä¿æŒä»£ç æ•´æ´&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
      <category term="ä»£ç æ•´æ´ä¹‹é“" scheme="http://freemind-lj.github.io/tags/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºè®¸å¯è¯çš„ä¸€äº›åŒºåˆ«</title>
    <link href="http://freemind-lj.github.io/2015/11/24/%E5%BC%80%E6%BA%90%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8C%BA%E5%88%AB/"/>
    <id>http://freemind-lj.github.io/2015/11/24/å¼€æºè®¸å¯è¯çš„ä¸€äº›åŒºåˆ«/</id>
    <published>2015-11-24T01:49:32.000Z</published>
    <updated>2016-02-15T03:01:52.000Z</updated>
    
    <content type="html">&lt;p&gt;æˆ‘ä»¬åœ¨çœ‹ä¸€äº›å¼€æºé¡¹ç›®çš„æ—¶å€™ï¼Œä¸€èˆ¬å¾ˆå°‘å»å…³æ³¨å¼€æºçš„è®¸å¯è¯ï¼Œä¸è¿‡æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›è¯ä¹¦æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%BC%80%E6%BA%90%E8%AE%B8%E5%8F%AF%E8%AF%81.jpg&quot; alt=&quot;å¼€æºè®¸å¯è¯&quot;&gt;&lt;br&gt;&lt;/center&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘ä»¬åœ¨çœ‹ä¸€äº›å¼€æºé¡¹ç›®çš„æ—¶å€™ï¼Œä¸€èˆ¬å¾ˆå°‘å»å…³æ³¨å¼€æºçš„è®¸å¯è¯ï¼Œä¸è¿‡æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›è¯ä¹¦æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%BC%80%E6
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
  </entry>
  
  <entry>
    <title>å…³äºGCDå¼€å‘çš„ä¸€äº›äº‹å„¿</title>
    <link href="http://freemind-lj.github.io/2015/11/20/%E5%85%B3%E4%BA%8EGCD%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    <id>http://freemind-lj.github.io/2015/11/20/å…³äºGCDå¼€å‘çš„ä¸€äº›äº‹å„¿/</id>
    <published>2015-11-20T09:58:10.000Z</published>
    <updated>2016-02-15T03:03:58.000Z</updated>
    
    <content type="html">&lt;p&gt;åœ¨ä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡NSOperationçš„ä¸€äº›ä¸œè¥¿ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥èŠä¸€èŠå¦ä¸€ä¸ªiOSå¼€å‘æœ€ç»å¸¸ä½¿ç”¨çš„æŠ€æœ¯ä¹‹ä¸€ â€” GCDï¼ŒGCDå°†çº¿ç¨‹çš„ç®¡ç†ç§»åˆ°ç³»ç»Ÿçº§åˆ«ï¼Œä½ åªéœ€è¦å®šä¹‰å¥½è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åä¸¢åˆ°åˆé€‚çš„Dispatch queueï¼ŒGCDä¼šè´Ÿè´£åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä½ çš„ä»£ç ï¼Œç”±äºè¿™éƒ¨åˆ†æ˜¯å¤„äºç³»ç»Ÿçº§åˆ«ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ€§èƒ½é€šå¸¸éå¸¸é«˜ã€‚GCDè¿™éƒ¨åˆ†ä»£ç è‹¹æœå·²å¼€æºï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»ä¸‹è½½äº†è§£ä¸€ä¸‹:&lt;a href=&quot;http://libdispatch.macosforge.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åœ°å€&lt;/a&gt;&lt;br&gt;åœ¨ä»‹ç»GCDä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹Quality of Serviceï¼š&lt;/p&gt;
&lt;h3 id=&quot;Quality-of-Service-QoS&quot;&gt;&lt;a href=&quot;#Quality-of-Service-QoS&quot; class=&quot;headerlink&quot; title=&quot;Quality of Service(QoS)&quot;&gt;&lt;/a&gt;Quality of Service(QoS)&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯åœ¨iOS8ä¹‹åæä¾›çš„æ–°åŠŸèƒ½ï¼Œè‹¹æœæä¾›äº†å‡ ä¸ªQuality of Serviceæšä¸¾æ¥ä½¿ç”¨:user interactive, user initiated, utility å’Œ backgroundï¼Œé€šè¿‡è¿™å‘Šè¯‰ç³»ç»Ÿæˆ‘ä»¬åœ¨è¿›è¡Œä»€ä¹ˆæ ·çš„å·¥ä½œï¼Œç„¶åç³»ç»Ÿä¼šé€šè¿‡åˆç†çš„èµ„æºæ§åˆ¶æ¥æœ€é«˜æ•ˆçš„æ‰§è¡Œä»»åŠ¡ä»£ç ï¼Œå…¶ä¸­ä¸»è¦æ¶‰åŠåˆ°CPUè°ƒåº¦çš„ä¼˜å…ˆçº§ã€IOä¼˜å…ˆçº§ã€ä»»åŠ¡è¿è¡Œåœ¨å“ªä¸ªçº¿ç¨‹ä»¥åŠè¿è¡Œçš„é¡ºåºç­‰ç­‰ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæŠ½è±¡çš„Quality of Serviceå‚æ•°æ¥è¡¨æ˜ä»»åŠ¡çš„æ„å›¾ä»¥åŠç±»åˆ«ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSQualityOfServiceUserInteractive&lt;br&gt;ä¸ç”¨æˆ·äº¤äº’çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸è·ŸUIçº§åˆ«çš„åˆ·æ–°ç›¸å…³ï¼Œæ¯”å¦‚åŠ¨ç”»ï¼Œè¿™äº›ä»»åŠ¡éœ€è¦åœ¨ä¸€ç¬é—´å®Œæˆ&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceUserInitiated&lt;br&gt;ç”±ç”¨æˆ·å‘èµ·çš„å¹¶ä¸”éœ€è¦ç«‹å³å¾—åˆ°ç»“æœçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ»‘åŠ¨scroll viewæ—¶å»åŠ è½½æ•°æ®ç”¨äºåç»­cellçš„æ˜¾ç¤ºï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸è·Ÿåç»­çš„ç”¨æˆ·äº¤äº’ç›¸å…³ï¼Œåœ¨å‡ ç§’æˆ–è€…æ›´çŸ­çš„æ—¶é—´å†…å®Œæˆ&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceUtility&lt;br&gt;ä¸€äº›å¯èƒ½éœ€è¦èŠ±ç‚¹æ—¶é—´çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ä¸éœ€è¦é©¬ä¸Šè¿”å›ç»“æœï¼Œæ¯”å¦‚ä¸‹è½½çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½èŠ±è´¹å‡ ç§’æˆ–è€…å‡ åˆ†é’Ÿçš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceBackground&lt;br&gt;è¿™äº›ä»»åŠ¡å¯¹ç”¨æˆ·ä¸å¯è§ï¼Œæ¯”å¦‚åå°è¿›è¡Œå¤‡ä»½çš„æ“ä½œï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½éœ€è¦è¾ƒé•¿çš„æ—¶é—´ï¼Œå‡ åˆ†é’Ÿç”šè‡³å‡ ä¸ªå°æ—¶&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceDefault&lt;br&gt;ä¼˜å…ˆçº§ä»‹äºuser-initiated å’Œ utilityï¼Œå½“æ²¡æœ‰ QoSä¿¡æ¯æ—¶é»˜è®¤ä½¿ç”¨ï¼Œå¼€å‘è€…ä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªå€¼æ¥è®¾ç½®è‡ªå·±çš„ä»»åŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;Qoså¯ä»¥è·ŸGCD queueåšä¸ªå¯¹ç…§ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%AF%B9%E7%85%A7%E8%A1%A8.png&quot; alt=&quot;å¯¹ç…§è¡¨&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;ä¸‹é¢æˆ‘ä»¬äº†è§£ä¸€ä¸‹GCDçš„ä¸€äº›ç”¨æ³•ï¼š&lt;/p&gt;
&lt;h3 id=&quot;Dispatch-Queue&quot;&gt;&lt;a href=&quot;#Dispatch-Queue&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Queue&quot;&gt;&lt;/a&gt;Dispatch Queue&lt;/h3&gt;&lt;p&gt;å¼€å‘è€…å°†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°åˆé€‚çš„Dispatch Queueä¸­å³å¯ï¼ŒDispatch Queueä¼šæ ¹æ®ä»»åŠ¡æ·»åŠ çš„é¡ºåºå…ˆåˆ°å…ˆæ‰§è¡Œï¼Œå…¶ä¸­æœ‰ä»¥ä¸‹å‡ ç§é˜Ÿåˆ—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;main dispatch queue&lt;br&gt;åŠŸèƒ½è·Ÿä¸»çº¿ç¨‹ä¸€æ ·ï¼Œé€šè¿‡dispatch_get_main_queue()æ¥è·å–ï¼Œæäº¤åˆ°main queueçš„ä»»åŠ¡å®é™…ä¸Šéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;&lt;p&gt;global dispatch queues&lt;br&gt;ç³»ç»Ÿç»™æ¯ä¸ªåº”ç”¨æä¾›å››ä¸ªå…¨å±€çš„å¹¶å‘é˜Ÿåˆ—ï¼Œè¿™å››ä¸ªé˜Ÿåˆ—åˆ†åˆ«æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼šé«˜ã€é»˜è®¤ã€ä½ä»¥åŠåå°ï¼Œç”¨æˆ·ä¸èƒ½å»åˆ›å»ºå…¨å±€é˜Ÿåˆ—ï¼Œåªèƒ½æ ¹æ®ä¼˜å…ˆçº§å»è·å–: &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue ; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;user create queue&lt;br&gt;ç”¨æˆ·å¯ä»¥é€šè¿‡dispatch_queue_createè‡ªå·±åˆ›å»ºé˜Ÿåˆ—ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é˜Ÿåˆ—çš„åç§°ï¼Œåœ¨debugçš„æ—¶å€™æ–¹ä¾¿åŒºåˆ†ï¼›ç¬¬äºŒä¸ªæ˜¯é˜Ÿåˆ—çš„ä¸€äº›å±æ€§ï¼ŒNULLæˆ–è€…DISPATCH_QUEUE_SERIALåˆ›å»ºå‡ºæ¥çš„é˜Ÿåˆ—æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¦‚æœä¼ é€’DISPATCH_QUEUE_CONCURRENTåˆ™ä¸ºå¹¶è¡Œé˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºå¹¶è¡Œé˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;queue = dispatch_queue_create(&amp;quot;com.example.MyQueue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é˜Ÿåˆ—ä¼˜å…ˆçº§&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;dispatch_queue_createåˆ›å»ºé˜Ÿåˆ—çš„ä¼˜å…ˆçº§è·Ÿglobal dispatch queueçš„é»˜è®¤ä¼˜å…ˆçº§ä¸€æ ·ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦è®¾ç½®é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥é€šè¿‡dispatch_queue_attr_make_with_qos_classæˆ–è€…dispatch_set_target_queueæ–¹æ³•ï¼›&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//æŒ‡å®šé˜Ÿåˆ—çš„QoSç±»åˆ«ä¸ºQOS_CLASS_UTILITY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_attr_t queue_attr = dispatch_queue_attr_make_with_qos_class (DISPATCH_QUEUE_SERIAL, QOS_CLASS_UTILITY,-1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, queue_attr);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;dispatch_set_target_queueçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦è®¾ç½®ä¼˜å…ˆçº§çš„queue,ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹åº”çš„ä¼˜å…ˆçº§å‚ç…§ç‰©&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_tÂ serialQueueÂ =Â dispatch_queue_create(&amp;quot;com.example.MyQueue&amp;quot;,NULL);Â Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_tÂ globalQueueÂ =Â dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND,0);Â Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//serialQueueç°åœ¨çš„ä¼˜å…ˆçº§è·ŸglobalQueueçš„ä¼˜å…ˆçº§ä¸€æ ·&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_set_target_queue(serialQueue,Â globalQueue);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_set_target_queue&lt;br&gt;dispatch_set_target_queueé™¤äº†èƒ½ç”¨æ¥è®¾ç½®é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿåˆ›å»ºé˜Ÿåˆ—çš„å±‚æ¬¡ä½“ç³»ï¼Œå½“æˆ‘ä»¬æƒ³è®©ä¸åŒé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åŒæ­¥çš„æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œç„¶åå°†è¿™äº›é˜Ÿåˆ—çš„targetæŒ‡å‘æ–°åˆ›å»ºçš„é˜Ÿåˆ—å³å¯ï¼Œæ¯”å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E9%98%9F%E5%88%97%E4%BD%93%E7%B3%BB.p.png&quot; alt=&quot;é˜Ÿåˆ—ä½“ç³».png&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/center&gt;

&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t targetQueue = dispatch_queue_create(&amp;quot;target_queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue1 = dispatch_queue_create(&amp;quot;queue1&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue2 = dispatch_queue_create(&amp;quot;queue2&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_set_target_queue(queue1, targetQueue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_set_target_queue(queue2, targetQueue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  dispatch_async(queue1, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  NSLog(@&amp;quot;do job1&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [NSThread sleepForTimeInterval:3.f];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  dispatch_async(queue2, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  NSLog(@&amp;quot;do job2&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [NSThread sleepForTimeInterval:2.f];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  dispatch_async(queue2, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  NSLog(@&amp;quot;do job3&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [NSThread sleepForTimeInterval:1.f];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼Œè¿™äº›é˜Ÿåˆ—ä¼šåŒæ­¥çš„æ‰§è¡Œä»»åŠ¡ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13323:569147] do job1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13323:569147] do job2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13323:569147] do job3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_barrier_async&lt;br&gt;dispatch_barrier_asyncç”¨äºç­‰å¾…å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åè‡ªå·±æ‰æ‰§è¡Œï¼Œè€Œå®ƒåé¢çš„ä»»åŠ¡éœ€ç­‰å¾…å®ƒå®Œæˆä¹‹åæ‰æ‰§è¡Œã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯æ•°æ®çš„è¯»å†™ï¼Œé€šå¸¸ä¸ºäº†é˜²æ­¢æ–‡ä»¶è¯»å†™å¯¼è‡´å†²çªï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªä¸²è¡Œçš„é˜Ÿåˆ—ï¼Œæ‰€æœ‰çš„æ–‡ä»¶æ“ä½œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªé˜Ÿåˆ—æ¥æ‰§è¡Œï¼Œæ¯”å¦‚FMDBï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è¯»å†™å†²çªã€‚ä¸è¿‡å…¶å®è¿™æ ·æ•ˆç‡æ˜¯æœ‰æå‡çš„ç©ºé—´çš„ï¼Œå½“æ²¡æœ‰æ›´æ–°æ•°æ®æ—¶ï¼Œè¯»æ“ä½œå…¶å®æ˜¯å¯ä»¥å¹¶è¡Œè¿›è¡Œçš„ï¼Œè€Œå†™æ“ä½œéœ€è¦ä¸²è¡Œçš„æ‰§è¡Œï¼Œå¦‚ä½•å®ç°å‘¢ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;Database_Queue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_async(queue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;reading data1&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_async(queue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;reading data2&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_barrier_async(queue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;writing data1&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [NSThread sleepForTimeInterval:1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_async(queue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [NSThread sleepForTimeInterval:1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;reading data3&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13360:584316] reading data2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13360:584317] reading data1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13360:584317] writing data1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[13360:584317] reading data3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†å†™æ•°æ®çš„æ“ä½œæ”¾åœ¨dispatch_barrier_asyncä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿åœ¨å†™æ•°æ®çš„æ—¶å€™ä¼šç­‰å¾…å‰é¢çš„è¯»æ“ä½œå®Œæˆï¼Œè€Œåç»­çš„è¯»æ“ä½œä¹Ÿä¼šç­‰åˆ°å†™æ“ä½œå®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæé«˜æ–‡ä»¶è¯»å†™çš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_queue_set_specific ã€dispatch_get_specific&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªAPIç±»ä¼¼äºobjc_setAssociatedObjectè·Ÿobjc_getAssociatedObjectï¼ŒFMDBé‡Œå°±ç”¨åˆ°è¿™ä¸ªæ¥é˜²æ­¢æ­»é”ï¼Œæ¥çœ‹çœ‹FMDBçš„éƒ¨åˆ†æºç &lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static const void * const kDispatchQueueSpecificKey = &amp;amp;kDispatchQueueSpecificKey;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—æ¥æ‰§è¡Œæ•°æ®åº“çš„æ‰€æœ‰æ“ä½œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; _queue = dispatch_queue_create([[NSString stringWithFormat:@&amp;quot;fmdb.%@&amp;quot;, self] UTF8String], NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; //é€šè¿‡keyæ ‡ç¤ºé˜Ÿåˆ—ï¼Œè®¾ç½®contextä¸ºself&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; dispatch_queue_set_specific(_queue, kDispatchQueueSpecificKey, (__bridge void *)self, NULL);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å½“è¦æ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¦‚æœåœ¨queueé‡Œé¢çš„blockæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåˆè°ƒç”¨äº† indatabaseæ–¹æ³•ï¼Œéœ€è¦æ£€æŸ¥æ˜¯ä¸æ˜¯åŒä¸€ä¸ªqueueï¼Œå› ä¸ºåŒä¸€ä¸ªqueueçš„è¯ä¼šäº§ç”Ÿæ­»é”æƒ…å†µ&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)inDatabase:(void (^)(FMDatabase *db))block &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FMDatabaseQueue *currentSyncQueue = (__bridge id)dispatch_get_specific(kDispatchQueueSpecificKey);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    assert(currentSyncQueue != self &amp;amp;&amp;amp; &amp;quot;inDatabase: was called reentrantly on the same queue, which would lead to a deadlock&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_apply&lt;br&gt;dispatch_applyç±»ä¼¼ä¸€ä¸ªforå¾ªç¯ï¼Œä¼šåœ¨æŒ‡å®šçš„dispatch queueä¸­è¿è¡Œblockä»»åŠ¡næ¬¡ï¼Œå¦‚æœé˜Ÿåˆ—æ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œåˆ™ä¼šå¹¶å‘æ‰§è¡Œblockä»»åŠ¡ï¼Œdispatch_applyæ˜¯ä¸€ä¸ªåŒæ­¥è°ƒç”¨ï¼Œblockä»»åŠ¡æ‰§è¡Œnæ¬¡åæ‰è¿”å›ã€‚&lt;br&gt;ç®€å•çš„ä½¿ç”¨æ–¹æ³•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;myqueue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å¹¶å‘çš„è¿è¡Œä¸€ä¸ªblockä»»åŠ¡5æ¬¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_apply(5, queue, ^(size_t i) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;do a job %zu times&amp;quot;,i+1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;go on&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºç»“æœï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] do a job 2 times&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] do a job 1 times&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] do a job 3 times&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] do a job 5 times&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] do a job 4 times&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[10029:760640] go on&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨dispatch_applyä¼šå¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ï¼Œæ¯”å¦‚ä½ çš„ä»£ç éœ€è¦ä»¥æ¯ä¸ªåƒç´ ä¸ºåŸºå‡†æ¥å¤„ç†è®¡ç®—imageå›¾ç‰‡ã€‚åŒæ—¶dispatch applyèƒ½å¤Ÿé¿å…ä¸€äº›çº¿ç¨‹çˆ†ç‚¸çš„æƒ…å†µå‘ç”Ÿï¼ˆåˆ›å»ºå¾ˆå¤šçº¿ç¨‹ï¼‰&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//å±é™©ï¼Œå¯èƒ½å¯¼è‡´çº¿ç¨‹çˆ†ç‚¸ä»¥åŠæ­»é”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for (int i = 0; i &amp;lt; 999; i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   dispatch_async(q, ^&amp;#123;...&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_barrier_sync(q, ^&amp;#123;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// è¾ƒä¼˜é€‰æ‹©ï¼Œ GCD ä¼šç®¡ç†å¹¶å‘&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_apply(999, q, ^(size_t i)&amp;#123;...&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Dispatch-Block&quot;&gt;&lt;a href=&quot;#Dispatch-Block&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Block&quot;&gt;&lt;/a&gt;Dispatch Block&lt;/h4&gt;&lt;p&gt;æ·»åŠ åˆ°gcdé˜Ÿåˆ—ä¸­æ‰§è¡Œçš„ä»»åŠ¡æ˜¯ä»¥blockçš„å½¢å¼æ·»åŠ çš„ï¼Œblockå°è£…äº†éœ€è¦æ‰§è¡ŒåŠŸèƒ½ï¼Œblockå¸¦æ¥çš„å¼€å‘æ•ˆç‡æå‡å°±ä¸è¯´äº†ï¼Œgcdè·Ÿblockå¯ä»¥è¯´æ˜¯ä¸€å¯¹å¥½åŸºå‹ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„é…åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºblock&lt;br&gt;æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºblockå¹¶æ·»åŠ åˆ°queueä¸­å»æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºblock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t block = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  NSLog(@&amp;quot;do something&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, block);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨åˆ›å»ºblockçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®QoSï¼ŒæŒ‡å®šblockå¯¹åº”çš„ä¼˜å…ˆçº§ï¼Œåœ¨dispatch_block_create_with_qos_classä¸­æŒ‡å®šQoSç±»åˆ«å³å¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t block = dispatch_block_create_with_qos_class(0, QOS_CLASS_USER_INITIATED, -1, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;do something with QoS&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, block);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_block_wait&lt;br&gt;å½“éœ€è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨dispatch_block_waitè¿™ä¸ªæ¥å£ï¼Œè®¾ç½®ç­‰å¾…æ—¶é—´DISPATCH_TIME_FOREVERä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°å‰é¢çš„ä»»åŠ¡å®Œæˆï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t block = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;before sleep&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [NSThread sleepForTimeInterval:1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;after sleep&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, block);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç­‰å¾…å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_wait(block, DISPATCH_TIME_FOREVER);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;coutinue&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¨‹åºè¿è¡Œç»“æœ:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[16679:863641] before sleep&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[16679:863641] after sleep&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[16679:863529] coutinue&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_block_notify&lt;br&gt;dispatch_block_notifyå½“è§‚å¯Ÿçš„æŸä¸ªblockæ‰§è¡Œç»“æŸä¹‹åç«‹åˆ»é€šçŸ¥æäº¤å¦ä¸€ç‰¹å®šçš„blockåˆ°æŒ‡å®šçš„queueä¸­æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€å‚æ•°æ˜¯éœ€è¦è§‚å¯Ÿçš„blockï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«é€šçŸ¥blockæäº¤æ‰§è¡Œçš„queueï¼Œç¬¬ä¸‰å‚æ•°æ˜¯å½“éœ€è¦è¢«é€šçŸ¥æ‰§è¡Œçš„blockï¼Œå‡½æ•°çš„åŸå‹:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_block_notify(dispatch_block_t block, dispatch_queue_t queue,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		dispatch_block_t notification_block);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨çš„æ–¹æ³•:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t previousBlock = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;previousBlock begin&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [NSThread sleepForTimeInterval:1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;previousBlock done&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, previousBlock);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t notifyBlock = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;notifyBlock&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å½“previousBlockæ‰§è¡Œå®Œæ¯•åï¼Œæäº¤notifyBlockåˆ°global queueä¸­æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_notify(previousBlock, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), notifyBlock);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[17129:895673] previousBlock begin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[17129:895673] previousBlock done&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[17129:895673] notifyBlock&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_block_cancel&lt;br&gt;ä¹‹å‰åœ¨ä»‹ç»nsoprerationçš„æ—¶å€™æåˆ°å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥å–æ¶ˆæŸä¸ªoperationï¼Œç°åœ¨åœ¨iOS8ä¹‹åï¼Œæäº¤åˆ°gcdé˜Ÿåˆ—ä¸­çš„dispatch blockä¹Ÿå¯å–æ¶ˆäº†ï¼Œåªéœ€è¦ç®€å•çš„è°ƒç”¨dispatch_block_cancelä¼ å…¥æƒ³è¦å–æ¶ˆçš„blockå³å¯:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_SERIAL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t block1 = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;block1 begin&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [NSThread sleepForTimeInterval:1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;block1 done&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_t block2 = dispatch_block_create(0, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;block2 &amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, block1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, block2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_block_cancel(block2);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ‰§è¡Œç»“æœï¼Œblock2ä¸å†æ‰§è¡Œäº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[17271:902981] block1 begin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[17271:902981] block1 done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;Dispatch-Group&quot;&gt;&lt;a href=&quot;#Dispatch-Group&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Group&quot;&gt;&lt;/a&gt;Dispatch Group&lt;/h4&gt;&lt;p&gt;å½“æˆ‘ä»¬æƒ³åœ¨gcd queueä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹ååšäº›ç‰¹å®šäº‹æƒ…çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—çš„åŒæ­¥é—®é¢˜ï¼Œå¦‚æœé˜Ÿåˆ—æ˜¯ä¸²è¡Œçš„è¯ï¼Œé‚£å°†è¯¥æ“ä½œæœ€åæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å³å¯ï¼Œä½†å¦‚æœé˜Ÿåˆ—æ˜¯å¹¶è¡Œé˜Ÿåˆ—çš„è¯ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨dispatch_groupæ¥å®ç°äº†ï¼Œdispatch_groupèƒ½å¾ˆæ–¹ä¾¿çš„è§£å†³åŒæ­¥çš„é—®é¢˜ã€‚dispatch_group_createå¯ä»¥åˆ›å»ºä¸€ä¸ªgroupå¯¹è±¡ï¼Œç„¶åå¯ä»¥æ·»åŠ blockåˆ°è¯¥ç»„é‡Œé¢ï¼Œä¸‹é¢çœ‹ä¸‹å®ƒçš„ä¸€äº›ç”¨æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_group_wait&lt;br&gt;dispatch_group_waitä¼šåŒæ­¥åœ°ç­‰å¾…groupä¸­æ‰€æœ‰çš„blockæ‰§è¡Œå®Œæ¯•åæ‰ç»§ç»­æ‰§è¡Œ,ç±»ä¼¼äºdispatch barrier&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_t group = dispatch_group_create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å°†ä»»åŠ¡å¼‚æ­¥åœ°æ·»åŠ åˆ°groupä¸­å»æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_async(group,queue,^&amp;#123; NSLog(@&amp;quot;block1&amp;quot;); &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_async(group,queue,^&amp;#123; NSLog(@&amp;quot;block2&amp;quot;); &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_wait(group,DISPATCH_TIME_FOREVER);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;go on&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œåªæœ‰block1è·Ÿblock2æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œdispatch_group_waitåé¢çš„å†…å®¹ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[954:41031] block2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[954:41032] block1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[954:40847] go on&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_group_notify&lt;br&gt;åŠŸèƒ½ä¸dispatch_group_waitç±»ä¼¼ï¼Œä¸è¿‡è¯¥è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œdispatch_group_notifyæœ‰ä¸‰ä¸ªå‚æ•°&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void dispatch_group_notify(dispatch_group_t group, //è¦è§‚å¯Ÿçš„group&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           dispatch_queue_t queue,   //blockæ‰§è¡Œçš„é˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                           dispatch_block_t block);   //å½“groupä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åè¦æ‰§è¡Œçš„block&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•çš„ç¤ºæ„ç”¨æ³•:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;queue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_t group = dispatch_group_create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_async(group,queue,^&amp;#123; NSLog(@&amp;quot;block1&amp;quot;); &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_async(group,queue,^&amp;#123; NSLog(@&amp;quot;block2&amp;quot;); &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_notify(group, dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;done&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;go on&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ‰§è¡Œç»“æœ&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1046:45104] go on&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1046:45153] block1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1046:45152] block2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1046:45104] done&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_group_enter dispatch_group_leave&lt;br&gt;å‡å¦‚æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨dispatch_group_asyncå¼‚æ­¥çš„å°†ä»»åŠ¡ä¸¢åˆ°groupä¸­å»æ‰§è¡Œï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°dispatch_group_enterè·Ÿdispatch_group_leaveæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¦é…å¯¹å‡ºç°ï¼Œä»¥ä¸‹è¿™ä¸¤ç§æ–¹æ³•æ˜¯ç­‰ä»·çš„ï¼š&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_async(group, queue, ^&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç­‰ä»·äº&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_enter(group);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ã€€ã€€dispatch_group_leave(group);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç®€å•çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥è‡ªå·±è¯•è¯•æ²¡æœ‰å†™dispatch_group_leaveä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_t group = dispatch_group_create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for (int i =0 ; i&amp;lt;3; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_group_enter(group);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;do block:%d&amp;quot;,i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_group_leave(group);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç­‰å¾…ä¸Šé¢çš„ä»»åŠ¡å®Œæˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_group_wait(group, DISPATCH_TIME_FOREVER);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;go on&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Dispatch-Semaphore&quot;&gt;&lt;a href=&quot;#Dispatch-Semaphore&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Semaphore&quot;&gt;&lt;/a&gt;Dispatch Semaphore&lt;/h4&gt;&lt;p&gt;dispatch semaphoreä¹Ÿæ˜¯ç”¨æ¥åšè§£å†³ä¸€äº›åŒæ­¥çš„é—®é¢˜ï¼Œdispatch_semaphore_createä¼šåˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œè¯¥å‡½æ•°éœ€è¦ä¼ é€’ä¸€ä¸ªä¿¡å·å€¼ï¼Œdispatch_semaphore_signalä¼šä½¿ä¿¡å·å€¼åŠ 1ï¼Œå¦‚æœä¿¡å·å€¼çš„å¤§å°ç­‰äº1ï¼Œdispatch_semaphore_waitä¼šä½¿ä¿¡å·å€¼å‡1ï¼Œå¹¶ç»§ç»­å¾€ä¸‹èµ°ï¼Œå¦‚æœä¿¡å·å€¼ä¸º0ï¼Œåˆ™ç­‰å¾…ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œåˆå§‹å€¼ä¸º0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_semaphore_t sema = dispatch_semaphore_create(0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;do some job&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sleep(1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;increase the semaphore&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_semaphore_signal(sema); //ä¿¡å·å€¼åŠ 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);//ç­‰å¾…ç›´åˆ°ä¿¡å·å€¼å¤§äºç­‰1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;go on&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œç»“æœå¦‚ä¸‹:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1394:92383] do some job&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1394:92383] increase the semaphore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GCDTests[1394:92326] go on&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Dispatch-Timer&quot;&gt;&lt;a href=&quot;#Dispatch-Timer&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Timer&quot;&gt;&lt;/a&gt;Dispatch Timer&lt;/h4&gt;&lt;p&gt;dispatch timeré€šå¸¸é…åˆdispatch_afterä½¿ç”¨ï¼Œå®Œæˆä¸€äº›å»¶æ—¶çš„ä»»åŠ¡ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//å»¶è¿Ÿ5ç§’åæ‰§è¡Œä»»åŠ¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5 * NSEC_PER_SEC));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_after(time, dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;do job afer 5 seconds&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;Dispatch-IO&quot;&gt;&lt;a href=&quot;#Dispatch-IO&quot; class=&quot;headerlink&quot; title=&quot;Dispatch IO&quot;&gt;&lt;/a&gt;Dispatch IO&lt;/h4&gt;&lt;p&gt;å½“æˆ‘ä»¬è¦è¯»å–ä¸€ä»½è¾ƒå¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å»è¯»è‚¯å®šæ¯”ä¸€ä¸ªçº¿ç¨‹å»è¯»çš„é€Ÿåº¦è¦å¿«ï¼Œè¦å®ç°è¿™æ ·çš„åŠŸèƒ½å¯ä»¥é€šè¿‡dispatch ioè·Ÿdispatch dataæ¥å®ç°ï¼Œé€šè¿‡dispatch ioå»è¯»æ–‡ä»¶æ—¶ï¼Œä¼šä½¿ç”¨global dispatch queueå°†ä¸€ä¸ªæ–‡ä»¶æŒ‰ç…§ä¸€ä¸ªæŒ‡å®šçš„åˆ†å—å¤§å°åŒæ—¶å»è¯»å–æ•°æ®ï¼Œç±»ä¼¼äºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, ^&amp;#123;/* è¯»å–0-99å­—èŠ‚ */&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, ^&amp;#123;/* è¯»å–100-199å­—èŠ‚ */&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_async(queue, ^&amp;#123;/* è¯»å–200-299å­—èŠ‚ */&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å°†æ–‡ä»¶åˆ†æˆä¸€å—ä¸€å—å¹¶è¡Œçš„å»è¯»å–ï¼Œè¯»å–çš„æ•°æ®é€šè¿‡Dispatch Dataå¯ä»¥æ›´ä¸ºç®€å•åœ°è¿›è¡Œç»“åˆå’Œåˆ†å‰² ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_io_create&lt;br&gt;ç”ŸæˆDispatch IO,æŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶ç”¨æ¥æ‰§è¡Œå¤„ç†çš„Block,ä»¥åŠæ‰§è¡Œè¯¥Blockçš„Dispatch Queue&lt;/li&gt;
&lt;li&gt;dispatch_io_set_low_water&lt;br&gt;è®¾å®šä¸€æ¬¡è¯»å–çš„å¤§å°ï¼ˆåˆ†å‰²çš„å¤§å°ï¼‰&lt;/li&gt;
&lt;li&gt;dispatch_io_read&lt;br&gt;ä½¿ç”¨Global Dispatch Queueå¼€å§‹å¹¶åˆ—è¯»å–ï¼Œå½“æ¯ä¸ªåˆ†å‰²çš„æ–‡ä»¶å—è¯»å–å®Œæ¯•æ—¶ï¼Œä¼šå°†å«æœ‰æ–‡ä»¶æ•°æ®çš„dispatch dataè¿”å›åˆ°dispatch_io_readè®¾å®šçš„blockï¼Œåœ¨blockä¸­éœ€è¦åˆ†æä¼ é€’è¿‡æ¥çš„dispatch dataè¿›è¡Œåˆå¹¶å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹ä¸‹è‹¹æœçš„ç³»ç»Ÿæ—¥å¿—API(Libc-763.11 gen/asl.c)çš„æºä»£ç ä½¿ç”¨åˆ°äº†dispatch IOï¼š&lt;a href=&quot;https://github.com/Apple-FOSS-Mirror/Libc/blob/2ca2ae74647714acfc18674c3114b1a5d3325d7d/gen/asl.c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æºç åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//dispatch_io_createå‡ºé”™æ—¶handleræ‰§è¡Œçš„é˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pipe_q = dispatch_queue_create(&amp;quot;PipeQ&amp;quot;, NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pipe_channel = dispatch_io_create(DISPATCH_IO_STREAM, fd, pipe_q, ^(int err)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	//å‡ºé”™æ—¶æ‰§è¡Œçš„handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	close(fd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*out_fd = fdpair[1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è®¾å®šä¸€æ¬¡è¯»å–çš„å¤§å°(åˆ†å‰²å¤§å°)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_io_set_low_water(pipe_channel, SIZE_MAX);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_io_read(pipe_channel, 0, SIZE_MAX, pipe_q, ^(bool done, dispatch_data_t pipedata, int err)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (error)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (err == 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		//æ¯æ¬¡è¯»å–åˆ°æ•°æ®è¿›è¡Œæ•°æ®çš„å¤„ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		size_t len = dispatch_data_get_size(pipedata);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		if (len &amp;gt; 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			const char *bytes = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			char *encoded;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			uint32_t eval;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			dispatch_data_t md = dispatch_data_create_map(pipedata, (const void **)&amp;amp;bytes, &amp;amp;len);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			encoded = asl_core_encode_buffer(bytes, len);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			asl_msg_set_key_val(aux, ASL_KEY_AUX_DATA, encoded);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			free(encoded);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			eval = _asl_evaluate_send(NULL, (aslmsg)aux, -1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			_asl_send_message(NULL, eval, aux, NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			asl_msg_release(aux);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			dispatch_release(md);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (done)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		//å¹¶å‘è¯»å–å®Œæ¯•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		dispatch_semaphore_signal(sem);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		dispatch_release(pipe_channel);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		dispatch_release(pipe_q);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å‡å¦‚ä½ çš„æ•°æ®æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨dispatch IOçš„æ–¹å¼æ¥æé«˜è¯»å–çš„é€Ÿç‡ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Dispatch-Source&quot;&gt;&lt;a href=&quot;#Dispatch-Source&quot; class=&quot;headerlink&quot; title=&quot;Dispatch Source&quot;&gt;&lt;/a&gt;Dispatch Source&lt;/h4&gt;&lt;p&gt;dispatchæ¡†æ¶æä¾›ä¸€å¥—æ¥å£ç”¨äºç›‘å¬ç³»ç»Ÿåº•å±‚å¯¹è±¡(å¦‚æ–‡ä»¶æè¿°ç¬¦ã€Machç«¯å£ã€ä¿¡å·é‡ç­‰)ï¼Œå½“è¿™äº›å¯¹è±¡æœ‰äº‹ä»¶äº§ç”Ÿæ—¶ä¼šè‡ªåŠ¨æŠŠäº‹ä»¶çš„å¤„ç†blockå‡½æ•°æäº¤åˆ°dispatché˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œè¿™å¥—æ¥å£å°±æ˜¯Dispatch Source APIï¼ŒDispatch Sourceå…¶å®å°±æ˜¯å¯¹kqueueåŠŸèƒ½çš„å°è£…ï¼Œå¯ä»¥å»æŸ¥çœ‹dispatch_sourceçš„cæºç å®ç°(ä»€ä¹ˆæ˜¯kqueueï¼ŸGoogleï¼Œä»€ä¹ˆæ˜¯Machç«¯å£? Google Again)ï¼ŒDispatch Sourceä¸»è¦å¤„ç†ä»¥ä¸‹å‡ ç§äº‹ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_DATA_ADD   å˜é‡å¢åŠ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_DATA_OR    å˜é‡OR&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_MACH_SEND  Machç«¯å£å‘é€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_MACH_RECV  Machç«¯å£æ¥æ”¶&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_MEMORYPRESSURE å†…å­˜å‹åŠ›æƒ…å†µå˜åŒ–&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_PROC       ä¸è¿›ç¨‹ç›¸å…³çš„äº‹ä»¶&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_READ       å¯è¯»å–æ–‡ä»¶æ˜ åƒ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_SIGNAL     æ¥æ”¶ä¿¡å·&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_TIMER      å®šæ—¶å™¨äº‹ä»¶&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_VNODE      æ–‡ä»¶ç³»ç»Ÿå˜æ›´&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DISPATCH_SOURCE_TYPE_WRITE      å¯å†™å…¥æ–‡ä»¶æ˜ åƒ&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œdispatch sourceè‡ªåŠ¨å°†ä¸€ä¸ªblockæ”¾å…¥ä¸€ä¸ªdispatch queueæ‰§è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;dispatch_source_create&lt;br&gt;åˆ›å»ºä¸€ä¸ªdispatch sourceï¼Œéœ€è¦æŒ‡å®šäº‹ä»¶æºçš„ç±»å‹,handlerçš„æ‰§è¡Œé˜Ÿåˆ—ï¼Œdispatch sourceåˆ›å»ºå®Œä¹‹åå°†å¤„äºæŒ‚èµ·çŠ¶æ€ã€‚æ­¤æ—¶dispatch sourceä¼šæ¥æ”¶äº‹ä»¶ï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œå¤„ç†ï¼Œä½ éœ€è¦è®¾ç½®äº‹ä»¶å¤„ç†çš„handlerï¼Œå¹¶æ‰§è¡Œé¢å¤–çš„é…ç½®ï¼›åŒæ—¶ä¸ºäº†é˜²æ­¢äº‹ä»¶å †ç§¯åˆ°dispatch queueä¸­ï¼Œdispatch sourceè¿˜ä¼šå¯¹äº‹ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¦‚æœæ–°äº‹ä»¶åœ¨ä¸Šä¸€ä¸ªäº‹ä»¶å¤„ç†handleræ‰§è¡Œä¹‹å‰åˆ°è¾¾ï¼Œdispatch sourceä¼šæ ¹æ®äº‹ä»¶çš„ç±»å‹æ›¿æ¢æˆ–è€…åˆå¹¶æ–°æ—§äº‹ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;dispatch_source_set_event_handler&lt;br&gt;ç»™æŒ‡å®šçš„dispatch sourceè®¾ç½®äº‹ä»¶å‘ç”Ÿçš„å¤„ç†handler&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;dispatch_source_set_cancel_handler&lt;br&gt;ç»™æŒ‡å®šçš„dispatch sourceè®¾ç½®ä¸€ä¸ªå–æ¶ˆå¤„ç†handlerï¼Œå–æ¶ˆå¤„ç†handlerä¼šåœ¨dispatch soruceé‡Šæ”¾ä¹‹å‰åšäº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dispatch_source_set_cancel_handler(mySource, ^&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   close(fd); //å…³é—­æ–‡ä»¶ç§’é€Ÿç¬¦ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;dispatch_source_cancel&lt;br&gt;å¼‚æ­¥åœ°å…³é—­dispatch sourceï¼Œè¿™æ ·åç»­çš„äº‹ä»¶å‘ç”Ÿæ—¶ä¸å»è°ƒç”¨å¯¹åº”çš„äº‹ä»¶å¤„ç†handlerï¼Œä½†å·²ç»åœ¨æ‰§è¡Œçš„handlerä¸ä¼šè¢«å–æ¶ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ä¼šç”¨åˆ°dispatch sourceçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‘—åçš„IMæ¡†æ¶XMPPFrameworkåœ¨æ¶‰åŠåˆ°å®šæ—¶å™¨çš„æ—¶å€™éƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¯”å¦‚å‘é€å¿ƒè·³åŒ…çš„æ—¶å€™(&lt;a href=&quot;https://github.com/robbiehanson/XMPPFramework/blob/master/Core/XMPPStream.m&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;setupKeepAliveTimer&lt;/a&gt;)ã€‚&lt;br&gt;ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//å¦‚æœdispatch sourceæ˜¯æœ¬åœ°å˜é‡ï¼Œä¼šè¢«é‡Šæ”¾æ‰ï¼Œéœ€è¦è¿™ä¹ˆå£°æ˜&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (nonatomic)dispatch_source_t timerSource;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//äº‹ä»¶handlerçš„å¤„ç†é˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_queue_t queue = dispatch_queue_create(&amp;quot;myqueue&amp;quot;, NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;_timerSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å®šæ—¶å™¨é—´éš”æ—¶é—´&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;uint64_t interval = 2 * NSEC_PER_SEC;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è®¾ç½®å®šæ—¶å™¨ä¿¡æ¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_source_set_timer(_timerSource,DISPATCH_TIME_NOW, interval , 0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è®¾ç½®äº‹ä»¶çš„å¤„ç†handler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_source_set_event_handler(_timerSource, ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;receive time event&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //if (done) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //   dispatch_source_cancel(_timerSource); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å¼€å§‹å¤„ç†å®šæ—¶å™¨äº‹ä»¶ï¼Œdispatch_suspendæš‚åœå¤„ç†äº‹ä»¶&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dispatch_resume(_timerSource);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®šæ—¶å™¨è¿˜å¯ä»¥é€šè¿‡NSTimerå®ç°ï¼Œä¸è¿‡NSTimerä¼šè·Ÿrunloopå…³è”åœ¨ä¸€èµ·ï¼Œä¸»çº¿å±‚é»˜è®¤æœ‰ä¸€ä¸ªrunloopï¼Œå‡å¦‚ä½ nstimeræ˜¯è¿è¡Œåœ¨å­çº¿ç¨‹ï¼Œå°±éœ€è¦è‡ªå·±æ‰‹åŠ¨å¼€å¯ä¸€ä¸ªrunloopï¼Œè€Œä¸”nstimeré»˜è®¤æ˜¯åœ¨NSDefaultRunLoopModeæ¨¡å¼ä¸‹çš„ï¼Œæ‰€ä»¥å½“runloopåˆ‡æ¢åˆ°å…¶å®ƒæ¨¡å¼nstimerå°±ä¸ä¼šè¿è¡Œï¼Œéœ€è¦æ‰‹åŠ¨å°†nstimeræ·»åŠ åˆ°NSRunLoopCommonModesæ¨¡å¼ä¸‹ï¼›è€Œdispatch source timerä¸è·Ÿrunloopå…³è”ï¼Œæ‰€ä»¥æœ‰äº›åœºæ™¯å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ€»ç»“äº†GCDçš„ä¸€äº›ç”¨æ³•ï¼Œä¸è¿‡æœ‰äº›APIå¯èƒ½iOS8ä¹‹åæ‰å¯ä»¥ç”¨ï¼Œå¦‚æœ‰è¿˜æœ‰ä»€ä¹ˆå¯ä»¥è¡¥å……çš„ï¼Œæ¬¢è¿æå‡ºï½&lt;/p&gt;
&lt;h4 id=&quot;éƒ¨åˆ†å‚è€ƒ&quot;&gt;&lt;a href=&quot;#éƒ¨åˆ†å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;éƒ¨åˆ†å‚è€ƒ&quot;&gt;&lt;/a&gt;éƒ¨åˆ†å‚è€ƒ&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;dispatchæºç åœ°å€ï¼š&lt;a href=&quot;http://libdispatch.macosforge.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://libdispatch.macosforge.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2015-718/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Building Responsive and Efficient Apps with GCD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/library/prerelease/ios/documentation/Performance/Reference/GCD_libdispatch_Ref/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Grand Central Dispatch (GCD) Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.amazon.cn/Objective-C%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B-iOS%E4%B8%8EOS-X%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-%E5%9D%82%E6%9C%AC%E4%B8%80%E6%A0%91/dp/B00DE60G3S/ref=sr_1_8?ie=UTF8&amp;amp;qid=1447952737&amp;amp;sr=8-8&amp;amp;keywords=iOS&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-Cé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ä¹‹å‰æˆ‘ä»¬ä»‹ç»è¿‡NSOperationçš„ä¸€äº›ä¸œè¥¿ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥èŠä¸€èŠå¦ä¸€ä¸ªiOSå¼€å‘æœ€ç»å¸¸ä½¿ç”¨çš„æŠ€æœ¯ä¹‹ä¸€ â€” GCDï¼ŒGCDå°†çº¿ç¨‹çš„ç®¡ç†ç§»åˆ°ç³»ç»Ÿçº§åˆ«ï¼Œä½ åªéœ€è¦å®šä¹‰å¥½è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åä¸¢åˆ°åˆé€‚çš„Dispatch queueï¼ŒGCDä¼šè´Ÿè´£åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä½ çš„ä»£ç ï¼Œç”±äºè¿™éƒ¨åˆ†æ˜¯å¤„äºç³»ç»Ÿçº§åˆ«ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ€§èƒ½é€šå¸¸éå¸¸é«˜ã€‚GCDè¿™éƒ¨åˆ†ä»£ç è‹¹æœå·²å¼€æºï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»ä¸‹è½½äº†è§£ä¸€ä¸‹:&lt;a href=&quot;http://libdispatch.macosforge.org/&quot;&gt;åœ°å€&lt;/a&gt;&lt;br&gt;åœ¨ä»‹ç»GCDä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹Quality of Serviceï¼š&lt;/p&gt;
&lt;h3 id=&quot;Quality-of-Service-QoS&quot;&gt;&lt;a href=&quot;#Quality-of-Service-QoS&quot; class=&quot;headerlink&quot; title=&quot;Quality of Service(QoS)&quot;&gt;&lt;/a&gt;Quality of Service(QoS)&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯åœ¨iOS8ä¹‹åæä¾›çš„æ–°åŠŸèƒ½ï¼Œè‹¹æœæä¾›äº†å‡ ä¸ªQuality of Serviceæšä¸¾æ¥ä½¿ç”¨:user interactive, user initiated, utility å’Œ backgroundï¼Œé€šè¿‡è¿™å‘Šè¯‰ç³»ç»Ÿæˆ‘ä»¬åœ¨è¿›è¡Œä»€ä¹ˆæ ·çš„å·¥ä½œï¼Œç„¶åç³»ç»Ÿä¼šé€šè¿‡åˆç†çš„èµ„æºæ§åˆ¶æ¥æœ€é«˜æ•ˆçš„æ‰§è¡Œä»»åŠ¡ä»£ç ï¼Œå…¶ä¸­ä¸»è¦æ¶‰åŠåˆ°CPUè°ƒåº¦çš„ä¼˜å…ˆçº§ã€IOä¼˜å…ˆçº§ã€ä»»åŠ¡è¿è¡Œåœ¨å“ªä¸ªçº¿ç¨‹ä»¥åŠè¿è¡Œçš„é¡ºåºç­‰ç­‰ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæŠ½è±¡çš„Quality of Serviceå‚æ•°æ¥è¡¨æ˜ä»»åŠ¡çš„æ„å›¾ä»¥åŠç±»åˆ«ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSQualityOfServiceUserInteractive&lt;br&gt;ä¸ç”¨æˆ·äº¤äº’çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸è·ŸUIçº§åˆ«çš„åˆ·æ–°ç›¸å…³ï¼Œæ¯”å¦‚åŠ¨ç”»ï¼Œè¿™äº›ä»»åŠ¡éœ€è¦åœ¨ä¸€ç¬é—´å®Œæˆ&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceUserInitiated&lt;br&gt;ç”±ç”¨æˆ·å‘èµ·çš„å¹¶ä¸”éœ€è¦ç«‹å³å¾—åˆ°ç»“æœçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ»‘åŠ¨scroll viewæ—¶å»åŠ è½½æ•°æ®ç”¨äºåç»­cellçš„æ˜¾ç¤ºï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸è·Ÿåç»­çš„ç”¨æˆ·äº¤äº’ç›¸å…³ï¼Œåœ¨å‡ ç§’æˆ–è€…æ›´çŸ­çš„æ—¶é—´å†…å®Œæˆ&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceUtility&lt;br&gt;ä¸€äº›å¯èƒ½éœ€è¦èŠ±ç‚¹æ—¶é—´çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ä¸éœ€è¦é©¬ä¸Šè¿”å›ç»“æœï¼Œæ¯”å¦‚ä¸‹è½½çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½èŠ±è´¹å‡ ç§’æˆ–è€…å‡ åˆ†é’Ÿçš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceBackground&lt;br&gt;è¿™äº›ä»»åŠ¡å¯¹ç”¨æˆ·ä¸å¯è§ï¼Œæ¯”å¦‚åå°è¿›è¡Œå¤‡ä»½çš„æ“ä½œï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½éœ€è¦è¾ƒé•¿çš„æ—¶é—´ï¼Œå‡ åˆ†é’Ÿç”šè‡³å‡ ä¸ªå°æ—¶&lt;/li&gt;
&lt;li&gt;NSQualityOfServiceDefault&lt;br&gt;ä¼˜å…ˆçº§ä»‹äºuser-initiated å’Œ utilityï¼Œå½“æ²¡æœ‰ QoSä¿¡æ¯æ—¶é»˜è®¤ä½¿ç”¨ï¼Œå¼€å‘è€…ä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªå€¼æ¥è®¾ç½®è‡ªå·±çš„ä»»åŠ¡&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="GCD" scheme="http://freemind-lj.github.io/tags/GCD/"/>
    
  </entry>
  
  <entry>
    <title>NSOperationå’ŒNSOperationQueueçš„ä¸€äº›äº‹å„¿</title>
    <link href="http://freemind-lj.github.io/2015/11/02/NSOperation%E5%92%8CNSOperationQueue%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    <id>http://freemind-lj.github.io/2015/11/02/NSOperationå’ŒNSOperationQueueçš„ä¸€äº›äº‹å„¿/</id>
    <published>2015-11-02T08:06:56.000Z</published>
    <updated>2016-02-15T03:06:08.000Z</updated>
    
    <content type="html">&lt;p&gt;åœ¨é¢å¯¹å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œå¤§å¤šæ•°ä¼šé€‰æ‹©NSOperationæˆ–è€…GCDæ¥å®ç°ï¼ŒGCDç”±äºä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œåº”è¯¥æ˜¯å¾ˆå¤šå¼€å‘è€…çš„é¦–é€‰ï¼Œä¸è¿‡ä½ ä¼šå‘ç°å…¶å®å¾ˆå¤šå¼€æºä»£ç éƒ½æ˜¯ä½¿ç”¨NSOpertaionæ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡,æ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬æ¥è¯´è¯´NSOperationè·ŸNSOperationQueueï¼Œä»¥åŠå®ƒçš„å¼ºå¤§ä¹‹å¤„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;NSOPerationQueue&quot;&gt;&lt;a href=&quot;#NSOPerationQueue&quot; class=&quot;headerlink&quot; title=&quot;NSOPerationQueue&quot;&gt;&lt;/a&gt;NSOPerationQueue&lt;/h3&gt;&lt;p&gt;NSOperationå¯ä»¥é€šè¿‡è°ƒç”¨startæ–¹æ³•åŒæ­¥åœ°æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ï¼Œä¸è¿‡é€šå¸¸NSOprtaionéƒ½æ˜¯é…åˆNSOPerationQueueæ¥ä½¿ç”¨çš„ï¼ŒNSOperationQueueå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§é«˜çº§çš„dispatch queueï¼Œå°†NSOperationåŠ å…¥åˆ°queueä¸­ï¼Œqueueä¼šè‡ªåŠ¨å¼‚æ­¥çš„æ‰§è¡Œè¯¥NSOperation&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºé˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperationQueue *queue = [[NSOperationQueue alloc] init];  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å°†NSOperationåŠ å…¥é˜Ÿåˆ—ä¹‹åï¼Œqueueä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥operation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue addOperation:operation];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨gcdç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•å–æ¶ˆblockå¯¹åº”çš„ä»»åŠ¡ï¼Œä¸è¿‡NSOPerationQueueä¹‹æ‰€ä»¥ç§°ä¸ºé«˜çº§çš„dispatch queueé™¤äº†èƒ½å¼‚æ­¥çš„æ‰§è¡Œä»»åŠ¡ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å–æ¶ˆæ“ä½œ&lt;br&gt;å½“NSOperationåŠ å…¥åˆ°NSOperationQueueä¹‹åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆå•ä¸ªä»»åŠ¡ï¼Œå¦‚æœæƒ³å–æ¶ˆæ‰€æœ‰çš„ä»»åŠ¡å¯ä»¥è°ƒç”¨cancelAllOperationsæ–¹æ³•;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// å–æ¶ˆä¸€ä¸ªä»»åŠ¡ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[operation cancel];  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// å–æ¶ˆqueueä¸­æ‰€æœ‰çš„ä»»åŠ¡  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue cancelAllOperations];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®æœ€å¤§å¹¶å‘æ•°&lt;br&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®maxConcurrentOperationCountæ¥è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ•°ï¼Œæ¯”å¦‚å½“ç½‘ç»œä¸ºWi-Fiæ—¶è®¾ç½®ä¸º6ï¼Œ3Gæ—¶è®¾ç½®ä¸º2ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//è®¾ç½®å¹¶å‘æ•°ç›®ä¸º2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;queue.maxConcurrentOperationCount = 2;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å‡å¦‚maxConcurrentOperationCountçš„å€¼è®¾ä¸º1ï¼Œå¯ä»¥çœ‹ä½œè¯¥é˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ï¼Œæ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä¸è¿‡NSOPerationQueueä¸æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—ï¼Œè¿™ç‚¹è·Ÿdispatch queueæœ‰ç‚¹åŒºåˆ«ï¼Œdispatch queueä¸­çš„blockä¼šæŒ‰ç…§FIFOçš„é¡ºåºå»æ‰§è¡Œï¼ŒNSOPerationQueueä¼šæ ¹æ®Operationçš„çŠ¶æ€(æ˜¯å¦Ready)ä»¥åŠä¼˜å…ˆçº§æ¥ç¡®å®šæ‰§è¡Œçš„NSOperationçš„é¡ºåºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æš‚åœè·Ÿç»§ç»­&lt;br&gt;å‡å¦‚æƒ³è¦æš‚åœNSOperationçš„æ‰§è¡Œï¼Œå¯ä»¥è°ƒç”¨queueçš„setSuspended:æ–¹æ³•æš‚åœqueueç»§ç»­è°ƒåº¦è¿è¡Œæ–°çš„ä»»åŠ¡ï¼Œä¸è¿‡æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ— æ³•æš‚åœ&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// æš‚åœé˜Ÿåˆ—è¿è¡Œä»»åŠ¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue setSuspended:YES];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// ç»§ç»­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue setSuspended:NO];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;é˜Ÿåˆ—ä¼˜å…ˆçº§&lt;br&gt;iOS8ä¹‹åå¼•å…¥äº†QualityOfServiceçš„æ¦‚å¿µï¼Œç±»ä¼¼äºçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œè®¾ç½®ä¸åŒçš„QualityOfServiceå€¼åç³»ç»Ÿä¼šåˆ†é…ä¸åŒçš„CPUæ—¶é—´ã€ç½‘ç»œèµ„æºå’Œç¡¬ç›˜èµ„æºç­‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè®¾ç½®é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ï¼ŒNSQualityOfServiceå®šä¹‰äº†å‡ ä¸ªæšä¸¾å€¼ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;UserInteractive&lt;/strong&gt;: ä»»åŠ¡è·Ÿç•Œé¢çš„ä¸€äº›UIç›¸å…³ï¼Œæ¯”å¦‚ç»˜åˆ¶å±å¹•å†…å®¹è·Ÿå¤„ç†ç‚¹å‡»äº‹ä»¶ç­‰ï¼Œå¤„äºæœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UserInitiated&lt;/strong&gt; : ç”¨æˆ·ä¸€äº›è¯·æ±‚çš„ä»»åŠ¡ï¼Œå…³ç³»åˆ°åé¢çš„äº¤äº’ï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æ¶ˆæ¯æŒ‰é’®åè·å–é‚®ä»¶åˆ—è¡¨çš„ä»»åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; Utility:&lt;/strong&gt; å¤„ç†ä¸€äº›ç”¨æˆ·å¹¶ä¸ç«‹å³éœ€è¦ç»“æœçš„ä»»åŠ¡ï¼Œæ¯”å¦‚å®šæœŸçš„å†…å®¹æ›´æ–°ä¹‹ç±»çš„ä»»åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; Background&lt;/strong&gt;:åå°ä»»åŠ¡ï¼Œç”¨æˆ·ä¸ä¼šå¯Ÿè§‰åˆ°è¿™äº›ä»»åŠ¡ï¼Œæ¯”å¦‚åå°å¯¹æ–‡ä»¶è¿›è¡Œç´¢å¼•æ–¹ä¾¿åç»­æœç´¢ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; Default:&lt;/strong&gt; é»˜è®¤å€¼ï¼Œä»‹äºUserInitiatedè·ŸUtilityä¹‹é—´&lt;/p&gt;
&lt;h3 id=&quot;NSOperaion&quot;&gt;&lt;a href=&quot;#NSOperaion&quot; class=&quot;headerlink&quot; title=&quot;NSOperaion&quot;&gt;&lt;/a&gt;NSOperaion&lt;/h3&gt;&lt;p&gt;NSOperationå¯ä»¥çœ‹ä½œæ˜¯é«˜çº§çš„dispatch block(dispatch_block_t),æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªä»»åŠ¡å°è£…æˆä¸€ä¸ªNSOperationå¯¹è±¡ï¼Œç„¶åæ”¾åˆ°NSOperationQueueä¸­å»å¼‚æ­¥æ‰§è¡Œã€‚NSOperationåˆ†ä¸ºconcurrent(å¹¶å‘ä»»åŠ¡)è·Ÿnon-concurrent(éå¹¶å‘ä»»åŠ¡)ä¸¤ç§ï¼Œä¸¤è€…ä¸»è¦æ˜¯ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†æœ‰äº›åŒºåˆ«ï¼ŒNSOperationæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿äºå®ƒå¹¶å®ç°ä¸€äº›æ–¹æ³•ã€‚(å½“ä»»åŠ¡ç›¸å¯¹ç®€å•çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨NSInvocationOperationæˆ–æ˜¯NSBlockOperationï¼Œè¿™ä¸¤è€…ä¹Ÿéƒ½ç»§æ‰¿è‡ªNSOperation)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;non-concurrent operation&lt;br&gt;å®ç°ä¸€ä¸ªnon-concurrent operationåªéœ€è¦ç®€å•çš„ç»§æ‰¿NSOperationå¹¶å®ç°mainæ–¹æ³•å³å¯,NSOperationQueueä¼šè°ƒç”¨NSOperationçš„startæ–¹æ³•ï¼Œç„¶ååœ¨startæ–¹æ³•ä¸­è°ƒç”¨mainæ–¹æ³•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@interface NonConcurrentOperation : NSOperation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation NonConcurrentOperation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;main called&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_time_t time=dispatch_time(DISPATCH_TIME_NOW, 3*NSEC_PER_SEC);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __weak typeof(self) weakSelf = self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_after(time, dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;weakSelf:%@&amp;quot;,weakSelf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)dealloc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;dealloc called&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;non-concurrent operationä¼šåŒæ­¥çš„è¿è¡Œmainæ–¹æ³•ï¼Œä¸ç®¡æœŸé—´çš„ä»»åŠ¡éœ€è¦è¿è¡Œå¤šé•¿æ—¶é—´ï¼Œå½“åœ¨æ‰§è¡Œå®Œmainæ–¹æ³•åè¯¥operationå¯¹è±¡ä¼šè¢«é‡Šæ”¾ã€‚å‡å¦‚ä½ åœ¨mainæ–¹æ³•ä¸­æ‰§è¡Œäº†å¼‚æ­¥çš„æ“ä½œæ—¶ä¼šå‡ºç°é”™è¯¯ï¼Œæ¯”å¦‚ä¸Šè¿°çš„ä»£ç å¯ä»¥å‘ç°mainæ–¹æ³•è¿è¡Œå®Œåå°±è°ƒç”¨deallocæ–¹æ³•é‡Šæ”¾äº†ï¼Œå¯¼è‡´weakSelfçš„å€¼ä¸ºç©ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1467:91483] main called&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1467:91483] dealloc called&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1467:91218] weakSelf:(null)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;concurrent operation&lt;br&gt;å½“ä½ çš„ä»»åŠ¡æ˜¯å¹¶å‘çš„ä»»åŠ¡æ˜¯å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œä½ éœ€è¦çš„æ˜¯ç»§æ‰¿NSOperationå¹¶è‡³å°‘å®ç°startã€isExecutingå’ŒisFinishedæ–¹æ³•ï¼Œå…¶ä¸­isExecutingè·ŸisFinishedä¸¤ä¸ªå±æ€§å€¼çš„æ”¹å˜éœ€è¦åšKVOé€šçŸ¥ã€‚&lt;br&gt;concurrent operationçš„ç”Ÿå‘½å‘¨æœŸè·Ÿnon-concurrent operationä¸ä¸€æ ·ï¼Œå¯ä»¥åœ¨startæ–¹æ³•ä¸­æ‰§è¡Œå¼‚æ­¥çš„æ–¹æ³•ï¼Œå½“startæ–¹æ³•æ‰§è¡Œå®Œä¹‹åè¯¥operationå¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ï¼Œç›´åˆ°è¯¥operationæ‰§è¡Œç»“æŸï¼Œæ”¶åˆ°isFinishedçš„kvoé€šçŸ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//çŠ¶æ€æšä¸¾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;typedef NS_ENUM(NSInteger, ConcurrentOperationState) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentOperationReadyState = 1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentOperationExecutingState,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentOperationFinishedState&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface ConcurrentOperation ()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (nonatomic, assign) ConcurrentOperationState state;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation ConcurrentOperation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)isReady &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.state = ConcurrentOperationReadyState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.state == ConcurrentOperationReadyState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)isExecuting&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.state == ConcurrentOperationExecutingState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)isFinished&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.state == ConcurrentOperationFinishedState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)start &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __weak typeof(self) weakSelf = self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_time_t time=dispatch_time(DISPATCH_TIME_NOW, 3*NSEC_PER_SEC);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dispatch_after(time, dispatch_get_main_queue(), ^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //kvoï¼šç»“æŸ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [weakSelf willChangeValueForKey:@&amp;quot;isFinished&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        weakSelf.state = ConcurrentOperationFinishedState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        [weakSelf didChangeValueForKey:@&amp;quot;isFinished&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NSLog(@&amp;quot;finished :%@&amp;quot;,weakSelf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;start called&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //kvoï¼šæ­£åœ¨æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [weakSelf willChangeValueForKey:@&amp;quot;isExecuting&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    weakSelf.state = ConcurrentOperationExecutingState;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [weakSelf didChangeValueForKey:@&amp;quot;isExecuting&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)dealloc&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;dealloc called&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥ä»æ‰“å°çš„æ—¥å¿—çœ‹åˆ°ï¼Œå½“startæ–¹æ³•ç»“æŸåå¯¹è±¡å¹¶æ²¡æœ‰ç«‹å³è¢«é‡Šæ”¾ï¼Œåªæœ‰å‘å‡ºisFinishedçš„kvoé€šçŸ¥åï¼Œè¯¥operationå¯¹è±¡æ‰ä¼šè¢«é‡Šæ”¾&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1556:103301] start called&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1556:103242] finished :&amp;lt;ConcurrentOperation: 0x79a47bf0&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[1556:103242] dealloc called&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSOperationçŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/NSOperation%E7%8A%B6%E6%80%81.png&quot; alt=&quot;NSOperationçŠ¶æ€&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„å›¾å¯ä»¥çœ‹åˆ°nsoperationçš„å‡ ç§çŠ¶æ€ï¼Œå½“è¿™å‡ ä¸ªçŠ¶æ€å€¼æ”¹å˜æ—¶éœ€è¦ä½¿ç”¨KVOé€šçŸ¥ï¼Œå…¶ä¸­å¤„äºPendingã€Readyè·ŸExecutingçŠ¶æ€çš„operationæ˜¯å¯ä»¥è¢«cancelçš„ï¼Œè€Œå½“operationå¤„äºfinishedçŠ¶æ€æ˜¯æ— æ³•è¢«å–æ¶ˆçš„ã€‚å½“operationæˆåŠŸç»“æŸã€å¤±è´¥æˆ–è€…è¢«å–æ¶ˆäº†ï¼ŒisFinishedçš„å€¼éƒ½ä¼šè¢«è®¾ç½®ä¸ºyes,æ‰€ä»¥ä¸èƒ½ä»…ä»…é isFinished==YESè®¤ä¸ºoperationæˆåŠŸæ‰§è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®ä¼˜å…ˆçº§&lt;br&gt;æˆ‘ä»¬å¯ä»¥è®¾ç½®operationè¿è¡Œçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„é€‰æ‹©ä¸»è¦æœ‰:&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NSOperationQueuePriorityVeryLow = -8L,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NSOperationQueuePriorityLow = -4L,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NSOperationQueuePriorityNormal = 0,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NSOperationQueuePriorityHigh = 4,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	NSOperationQueuePriorityVeryHigh = 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è®¾ç½®ä¼˜å…ˆçº§&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[operation1 setQueuePriority:NSOperationQueuePriorityVeryLow];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“operationè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¹‹åï¼ŒNSOperationQueueä¼šæµè§ˆæ‰€æœ‰çš„operationï¼Œä¼˜å…ˆè¿è¡Œé‚£äº›å¤„äºreadyçŠ¶æ€ä¸”ä¼˜å…ˆçº§è¾ƒé«˜çš„æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dependencies&lt;br&gt;NSOperationçš„å¦ä¸€ä¸ªå¼ºå¤§ä¹‹å¤„å°±æ˜¯å¯ä»¥æ·»åŠ ä¾èµ–ï¼Œå½“operation1ä¾èµ–äºoperation2çš„æ—¶å€™ï¼Œç³»ç»Ÿå¯ä»¥ä¿è¯åªæœ‰å½“operation2ç»“æŸçš„æ—¶å€™ï¼Œoperation1æ‰ä¼šè¿è¡Œï¼Œè€Œä¸”ä¾èµ–ä¸å±€é™äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½ å¯ä»¥ä¾èµ–ä¸€ä¸ªä¸åŒé˜Ÿåˆ—çš„NSOperationã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface NonConcurrentOperation ()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property(nonatomic,strong)NSNumber *number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation NonConcurrentOperation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(id)initWithNumber:(NSNumber *)number&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self = [super init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (self) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.number = number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSLog(@&amp;quot;main called, %@&amp;quot;,self.number);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//æµ‹è¯•ä»£ç &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperationQueue  *queue1 = [NSOperationQueue new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperationQueue  *queue2 = [NSOperationQueue new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NonConcurrentOperation *op1 = [[NonConcurrentOperation alloc] initWithNumber:@(1)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NonConcurrentOperation *op2 = [[NonConcurrentOperation alloc] initWithNumber:@(2)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NonConcurrentOperation *op3 = [[NonConcurrentOperation alloc] initWithNumber:@(3)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NonConcurrentOperation *op4 = [[NonConcurrentOperation alloc] initWithNumber:@(4)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//æ·»åŠ ä¾èµ–&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[op1 addDependency:op2];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[op2 addDependency:op3];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å¯ä»¥ä¾èµ–ä¸åŒé˜Ÿåˆ—çš„operation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[op3 addDependency:op4];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue1 addOperation:op1];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue1 addOperation:op2];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue1 addOperation:op3];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue2 addOperation:op4]; //æ·»åŠ åˆ°ä¸åŒé˜Ÿåˆ—ä¸­&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¾“å‡ºç»“æœ:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[2105:179596] main called, 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[2105:179596] main called, 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[2105:179596] main called, 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperations[2105:179596] main called, 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ·»åŠ ä¾èµ–çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸è¦ç›¸äº’ä¾èµ–ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[op1 addDependency:op2];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[op2 addDependency:op1];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚æœç›¸äº’ä¾èµ–ï¼ŒåŒæ–¹éƒ½ä¼šç­‰å¾…å¯¹æ–¹ç»“æŸå¯¼è‡´ç›¸äº’ä¹‹é—´éƒ½æ— æ³•æ‰§è¡Œã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%BA%92%E7%9B%B8%E4%BE%9D%E8%B5%96.png&quot; alt=&quot;äº’ç›¸ä¾èµ–.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;ul&gt;
&lt;li&gt;æŠ½è±¡åŒ–é€»è¾‘&lt;br&gt;NSOperationå¯ä»¥ç”¨æ¥æŠ½è±¡åŒ–ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œä¸šåŠ¡ä¹‹é—´æœ‰ä¾èµ–çš„æƒ…å†µå¯ä»¥é€šè¿‡dependencyæ¥ç®€åŒ–ã€‚æ¯”å¦‚æœ‰çš„ä¸šåŠ¡åœºæ™¯éœ€è¦æ”¶è—ä¸€ç¯‡æ–‡ç« ï¼Œç”±äºæ”¶è—æ–‡ç« éœ€è¦ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè€Œè·å–ç”¨æˆ·çš„ä¿¡æ¯åˆéœ€è¦å»ç™»é™†è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ç™»é™†ã€è·å–ç”¨æˆ·ä¿¡æ¯ä»¥åŠæ”¶è—æ–‡ç« æŠ½è±¡å°è£…å°è£…æˆ3ä¸ªoperationï¼Œè€Œå…¶ä¸­çš„é€»è¾‘å…³ç³»é€šè¿‡dependencyæ¥å®ç°ï¼Œé™ä½é€»è¾‘å¤æ‚åº¦ï¼Œè€Œä¸”ä¸šåŠ¡ä¹‹é—´çš„å…³ç³»å˜å¾—å¯ç»„è£…ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//è·å–ç”¨æˆ·ä¿¡æ¯éœ€è¦ç™»é™†å®Œæ‰èƒ½æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[userInfoOperation addDependency:loginOperation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//æ”¶è—éœ€è¦è·å–åˆ°ç”¨æˆ·ä¿¡æ¯åæ‰èƒ½æ‰§è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[favorOperation addDependency:userInfoOperation];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%B8%9A%E5%8A%A1%E9%97%B4%E7%9A%84%E8%81%94%E7%B3%BB.png&quot; alt=&quot;ä¸šåŠ¡é—´çš„è”ç³».png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;hr&gt;
&lt;p&gt;ä¸è¿‡NSOperationè·ŸNSOperationåº•å±‚ä¹Ÿæ˜¯åŸºäºGCDå®ç°çš„ï¼Œå®ƒæ˜¯æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œå½“ä½ æ¡†æ¶è®¾è®¡æ¶‰åŠåˆ°è¿™å—å†…å®¹çš„æ—¶å€™åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨NSOperationsï¼Œè¿™æ ·æ¡†æ¶çš„ç»“æ„ç›¸å¯¹ä¼šå¥½äº›ï¼Œç±»ä¼¼SDwebimgagè·ŸAFNetworkingç­‰å¾ˆå¤šå¼€æºæ¡†æ¶éƒ½åœ¨ä½¿ç”¨NSOperationsã€‚ä¸è¿‡ä¸å¯å¦è®¤gcdä»£ç ç¼–å†™æ›´ç®€ä¾¿ï¼Œè¿™è¾¹å°±å½“æŠ›ç –å¼•ç‰å§ï½&lt;/p&gt;
&lt;h5 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;a href=&quot;#å‚è€ƒèµ„æ–™&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒèµ„æ–™&quot;&gt;&lt;/a&gt;å‚è€ƒèµ„æ–™&lt;/h5&gt;&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Reference/NSOperation_class/index.html#//apple_ref/doc/uid/TP40004591&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSOperation&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://greenchiu.github.io/blog/2013/08/06/ren-shi-nsoperation/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;èªè­˜NSOperation&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2015-226/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Advanced NSOperations&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨é¢å¯¹å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œå¤§å¤šæ•°ä¼šé€‰æ‹©NSOperationæˆ–è€…GCDæ¥å®ç°ï¼ŒGCDç”±äºä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œåº”è¯¥æ˜¯å¾ˆå¤šå¼€å‘è€…çš„é¦–é€‰ï¼Œä¸è¿‡ä½ ä¼šå‘ç°å…¶å®å¾ˆå¤šå¼€æºä»£ç éƒ½æ˜¯ä½¿ç”¨NSOpertaionæ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡,æ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬æ¥è¯´è¯´NSOperationè·ŸNSOperationQueueï¼Œä»¥åŠå®ƒçš„å¼ºå¤§ä¹‹å¤„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;NSOPerationQueue&quot;&gt;&lt;a href=&quot;#NSOPerationQueue&quot; class=&quot;headerlink&quot; title=&quot;NSOPerationQueue&quot;&gt;&lt;/a&gt;NSOPerationQueue&lt;/h3&gt;&lt;p&gt;NSOperationå¯ä»¥é€šè¿‡è°ƒç”¨startæ–¹æ³•åŒæ­¥åœ°æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ï¼Œä¸è¿‡é€šå¸¸NSOprtaionéƒ½æ˜¯é…åˆNSOPerationQueueæ¥ä½¿ç”¨çš„ï¼ŒNSOperationQueueå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§é«˜çº§çš„dispatch queueï¼Œå°†NSOperationåŠ å…¥åˆ°queueä¸­ï¼Œqueueä¼šè‡ªåŠ¨å¼‚æ­¥çš„æ‰§è¡Œè¯¥NSOperation&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//åˆ›å»ºé˜Ÿåˆ—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSOperationQueue *queue = [[NSOperationQueue alloc] init];  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//å°†NSOperationåŠ å…¥é˜Ÿåˆ—ä¹‹åï¼Œqueueä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥operation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue addOperation:operation];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨gcdç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•å–æ¶ˆblockå¯¹åº”çš„ä»»åŠ¡ï¼Œä¸è¿‡NSOPerationQueueä¹‹æ‰€ä»¥ç§°ä¸ºé«˜çº§çš„dispatch queueé™¤äº†èƒ½å¼‚æ­¥çš„æ‰§è¡Œä»»åŠ¡ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å–æ¶ˆæ“ä½œ&lt;br&gt;å½“NSOperationåŠ å…¥åˆ°NSOperationQueueä¹‹åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆå•ä¸ªä»»åŠ¡ï¼Œå¦‚æœæƒ³å–æ¶ˆæ‰€æœ‰çš„ä»»åŠ¡å¯ä»¥è°ƒç”¨cancelAllOperationsæ–¹æ³•;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// å–æ¶ˆä¸€ä¸ªä»»åŠ¡ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[operation cancel];  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// å–æ¶ˆqueueä¸­æ‰€æœ‰çš„ä»»åŠ¡  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[queue cancelAllOperations];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="GCD" scheme="http://freemind-lj.github.io/tags/GCD/"/>
    
  </entry>
  
  <entry>
    <title>IMå¼€å‘(2)-XMPP iOSå¼€å‘</title>
    <link href="http://freemind-lj.github.io/2015/10/20/IM%E5%BC%80%E5%8F%91-2-XMPP-iOS%E5%BC%80%E5%8F%91/"/>
    <id>http://freemind-lj.github.io/2015/10/20/IMå¼€å‘-2-XMPP-iOSå¼€å‘/</id>
    <published>2015-10-20T04:30:46.000Z</published>
    <updated>2016-02-15T04:03:19.000Z</updated>
    
    <content type="html">&lt;p&gt;æ­å»ºå®Œ&lt;a href=&quot;http://www.jianshu.com/p/f801229de016&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æœ¬åœ°æœåŠ¡å™¨&lt;/a&gt;ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç€æ‰‹å®¢æˆ·ç«¯çš„å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&quot;https://github.com/robbiehanson/XMPPFramework&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;XMPPFramework&lt;/a&gt;è¿™ä¸ªå¼€æºåº“ï¼Œå®‰å“å¹³å°å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https://github.com/igniterealtime/Smack&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Smack&lt;/a&gt;(æœ€å¥½ä½¿ç”¨4.1ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œæ”¯æŒæµç®¡ç†)ï¼Œä¸ºäº†ç®€å•èµ·è§è¿™é‡Œåªå®ç°ç™»é™†ã€è·å–å¥½å‹åˆ—è¡¨ä»¥åŠèŠå¤©ç­‰åŠŸèƒ½ï¼Œé¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;center&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/user2%E7%9A%84%E5%A5%BD%E5%8F%8B%E5%88%97%E8%A1%A8.png&quot; alt=&quot;user2çš„å¥½å‹åˆ—è¡¨.png&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E8%81%8A%E5%A4%A9.png&quot; alt=&quot;èŠå¤©.png&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/center&gt;

&lt;h4 id=&quot;xmppåˆå§‹åŒ–&quot;&gt;&lt;a href=&quot;#xmppåˆå§‹åŒ–&quot; class=&quot;headerlink&quot; title=&quot;xmppåˆå§‹åŒ–&quot;&gt;&lt;/a&gt;xmppåˆå§‹åŒ–&lt;/h4&gt;&lt;p&gt;â€ƒâ€ƒåœ¨å¼€å§‹ä½¿ç”¨xmppè¿›è¡ŒIMèŠå¤©ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–xmppæµï¼Œæ¥å…¥æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#define JBXMPP_HOST @&amp;quot;lujiangbin.local&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define JBXMPP_PORT 5222&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)setupStream&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  if (!_xmppStream) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppStream = [[XMPPStream alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [self.xmppStream setHostName:JBXMPP_HOST]; //è®¾ç½®xmppæœåŠ¡å™¨åœ°å€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [self.xmppStream setHostPort:JBXMPP_PORT]; //è®¾ç½®xmppç«¯å£ï¼Œé»˜è®¤5222&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [self.xmppStream addDelegate:self delegateQueue:dispatch_get_main_queue()];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [self.xmppStream setKeepAliveInterval:30]; //å¿ƒè·³åŒ…æ—¶é—´&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //å…è®¸xmppåœ¨åå°è¿è¡Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  self.xmppStream.enableBackgroundingOnSocket=YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  //æ¥å…¥æ–­çº¿é‡è¿æ¨¡å—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppReconnect = [[XMPPReconnect alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppReconnect setAutoReconnect:YES];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppReconnect activate:self.xmppStream];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  //æ¥å…¥æµç®¡ç†æ¨¡å—ï¼Œç”¨äºæµæ¢å¤è·Ÿæ¶ˆæ¯ç¡®è®¤ï¼Œåœ¨ç§»åŠ¨ç«¯å¾ˆé‡è¦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _storage = [XMPPStreamManagementMemoryStorage new];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppStreamManagement = [[XMPPStreamManagement alloc] initWithStorage:_storage];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppStreamManagement.autoResume = YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppStreamManagement addDelegate:self delegateQueue:dispatch_get_main_queue()];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppStreamManagement activate:self.xmppStream];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  //æ¥å…¥å¥½å‹æ¨¡å—ï¼Œå¯ä»¥è·å–å¥½å‹åˆ—è¡¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppRosterMemoryStorage = [[XMPPRosterMemoryStorage alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppRoster = [[XMPPRoster alloc] initWithRosterStorage:_xmppRosterMemoryStorage];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppRoster activate:self.xmppStream];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppRoster addDelegate:self delegateQueue:dispatch_get_main_queue()];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  //æ¥å…¥æ¶ˆæ¯æ¨¡å—ï¼Œå°†æ¶ˆæ¯å­˜å‚¨åˆ°æœ¬åœ°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppMessageArchivingCoreDataStorage = [XMPPMessageArchivingCoreDataStorage sharedInstance];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  _xmppMessageArchiving = [[XMPPMessageArchiving alloc] initWithMessageArchivingStorage:_xmppMessageArchivingCoreDataStorage dispatchQueue:dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 9)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [_xmppMessageArchiving activate:self.xmppStream];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;ç™»é™†&quot;&gt;&lt;a href=&quot;#ç™»é™†&quot; class=&quot;headerlink&quot; title=&quot;ç™»é™†&quot;&gt;&lt;/a&gt;ç™»é™†&lt;/h4&gt;&lt;p&gt;xmppçš„ç™»é™†è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œç™»é™†è¿‡ç¨‹åŒ…æ‹¬åˆå§‹åŒ–æµã€TLSæ¡æ‰‹å’ŒSASLéªŒè¯ç­‰ï¼Œæƒ³è¦äº†è§£å„ä¸ªé˜¶æ®µæœåŠ¡ç«¯è·Ÿå®¢æˆ·ç«¯ä¹‹é—´äº¤äº’çš„å†…å®¹å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;https://github.com/winterSleep/XMPPBlog/blob/master/1-%E5%BB%BA%E7%AB%8Bsocket%E5%88%B0%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œå°±ä¸åœ¨è¯¦ç»†ä»‹ç»ã€‚XMPPFrameworkå°†æ•´ä¸ªå¤æ‚çš„ç™»é™†è¿‡ç¨‹éƒ½å°è£…èµ·æ¥äº†ï¼Œå®¢æˆ·ç«¯è°ƒç”¨connectWithTimeout:(NSTimeInterval)timeout error:(NSError **)errPtrè¿æ¥æœåŠ¡å™¨ï¼Œç„¶ååœ¨xmppStreamDidConnectä»£ç†æ–¹æ³•è¾“å…¥å¯†ç éªŒè¯ç™»é™†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åœ¨æ­å»ºæœåŠ¡å™¨æ—¶åˆ›å»ºçš„ä¸¤ä¸ªç”¨æˆ·ï¼Œuser1å’Œuser2ã€‚&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#define JBXMPP_DOMAIN @&amp;quot;lujiangbin.local&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)loginWithName:(NSString *)userName andPassword:(NSString *)password&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  _myJID = [XMPPJID jidWithUser:userName domain:JBXMPP_DOMAIN resource:@&amp;quot;iOS&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  self.myPassword = password;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [self.xmppStream setMyJID:_myJID];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  NSError *error = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [_xmppStream connectWithTimeout:XMPPStreamTimeoutNone error:&amp;amp;error]ï¼›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#pragma mark -- connect delegate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è¾“å…¥å¯†ç éªŒè¯ç™»é™†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)xmppStreamDidConnect:(XMPPStream *)sender&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  NSError *error = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â [[self xmppStream] authenticateWithPassword:_myPassword error:&amp;amp;error]ï¼›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç™»é™†æˆåŠŸ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)xmppStreamDidAuthenticate:(XMPPStream *)sender&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  NSLog(@&amp;quot;%s&amp;quot;,__func__);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å‘é€åœ¨çº¿é€šçŸ¥ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ‰ä¼šå°†ç¦»çº¿æ¶ˆæ¯æ¨é€è¿‡æ¥&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XMPPPresence *presence = [XMPPPresence presence]; // é»˜è®¤&amp;quot;available&amp;quot; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [[self xmppStream] sendElement:presence];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  //å¯ç”¨æµç®¡ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [_xmppStreamManagement enableStreamManagementWithResumption:YES maxTimeout:0];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ç™»é™†å¤±è´¥&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)xmppStream:(XMPPStream *)sender didNotAuthenticate:(NSXMLElement *)error&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  NSLog(@&amp;quot;%s&amp;quot;,__func__);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;è·å–å¥½å‹åˆ—è¡¨&quot;&gt;&lt;a href=&quot;#è·å–å¥½å‹åˆ—è¡¨&quot; class=&quot;headerlink&quot; title=&quot;è·å–å¥½å‹åˆ—è¡¨&quot;&gt;&lt;/a&gt;è·å–å¥½å‹åˆ—è¡¨&lt;/h4&gt;&lt;p&gt;ç™»é™†æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡XMPPRosterå»è·å–å¥½å‹åˆ—è¡¨ï¼Œåœ¨ç¤ºä¾‹ä¸­æˆ‘ä»¬ä¸ºäº†ç®€å•èµ·è§ä½¿ç”¨&lt;br&gt;XMPPRosterMemoryStorageå°†å¥½å‹å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåœ¨å®é™…åœºæ™¯ä½ å¯ä»¥å°†å¥½å‹å­˜å‚¨åœ¨&lt;br&gt;XMPPRosterCoreDataStorageï¼Œxmppframeworkä½¿ç”¨coredataå°†å¥½å‹ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–xmppæµçš„æ—¶å€™è®¾ç½®ã€‚ä¸ºäº†è·å–å¥½å‹åˆ—è¡¨ï¼Œåªéœ€è°ƒç”¨fetchRosteræ–¹æ³•:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//è·å–æœåŠ¡å™¨å¥½å‹åˆ—è¡¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [[[JBXMPPManager sharedInstance] xmppRoster] fetchRoster];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;æ¶ˆæ¯&quot;&gt;&lt;a href=&quot;#æ¶ˆæ¯&quot; class=&quot;headerlink&quot; title=&quot;æ¶ˆæ¯&quot;&gt;&lt;/a&gt;æ¶ˆæ¯&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯å‘é€&lt;br&gt;åªéœ€è¦è°ƒç”¨xmppçš„sendElement:æ–¹æ³•ï¼Œç”±äºxmppåªæ”¯æŒæ–‡æœ¬ï¼Œæ‰€ä»¥å‡å¦‚ä½ æƒ³å‘é€äºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯­éŸ³å›¾ç‰‡ç­‰ï¼Œå¯ä»¥å…ˆå‹ç¼©ç„¶åç”¨base64ç¼–ç ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å†åšè§£ç å·¥ä½œï¼Œæ¯”å¦‚è¯­éŸ³å¯ä»¥å‹ç¼©æˆamræ ¼å¼ï¼Œamræ ¼å¼å®‰å“å¯ä»¥ç›´æ¥æ’­æ”¾ï¼ŒiOSéœ€è¦åœ¨è§£å‹æˆwavæ ¼å¼ï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&quot;https://github.com/FreeMind-LJ/IMChatDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)sendMessage:(NSString *)message to:(XMPPJID *)jid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  XMPPMessage* newMessage = [[XMPPMessage alloc] initWithType:@&amp;quot;chat&amp;quot; to:jid];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [newMessage addBody:message]; //æ¶ˆæ¯å†…å®¹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [_xmppStream sendElement:newMessage];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯æ¥æ”¶&lt;br&gt;å½“æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™ï¼Œxmppframeworkä¼šè°ƒç”¨didReceiveMessageï¼šä»£ç†æ–¹æ³•ï¼Œç”±äºæˆ‘ä»¬åœ¨åˆå§‹åŒ–æµçš„æ—¶å€™å°†æ¶ˆæ¯è®¾ç½®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¯ä»¥çœ‹åˆ°XMPPMessageArchivingåœ¨didReceiveMessageæ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™å°†æ¶ˆæ¯å­˜å‚¨èµ·æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// XMPPMessageArchiving.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)xmppStream:(XMPPStream *)sender didSendMessage:(XMPPMessage *)message&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     if ([self shouldArchiveMessage:message outgoing:YES xmppStream:sender])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         [xmppMessageArchivingStorage archiveMessage:message outgoing:YES     xmppStream:sender];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯ç¡®è®¤&lt;br&gt;ä¸ºäº†é˜²æ­¢å‘å‡ºå»çš„æ¶ˆæ¯ä¸¢å¤±äº†ï¼Œå¯ä»¥æ¥å…¥æ¶ˆæ¯å›æ‰§æ¨¡å—(XEP-184)ï¼Œè¿™æ ·å¯¹æ–¹æ¯æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯çš„æ—¶å€™éƒ½ä¼šè¿”å›ä¸€æ¡ç¡®è®¤çš„æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æ”¶åˆ°è¯¥æ¡ç¡®è®¤æ¶ˆæ¯å¯ä»¥è®¤ä¸ºå‘é€å¤±è´¥ï¼Œç¡®è®¤æ¶ˆæ¯çš„æ ¼å¼å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; Â &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;message to=&amp;quot;user2@lujiangbin.local&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  &amp;lt;received xmlns=&amp;quot;urn:xmpp:receipts&amp;quot; id=&amp;quot;æ¶ˆæ¯ID&amp;quot;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/message&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸è¿‡è¿™ç§æ–¹æ³•ä¹Ÿæœ‰äº›å¼Šç«¯ï¼Œæ¯”å¦‚æ¯æ¬¡æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯éƒ½å¿…é¡»å›å¤ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¼šæµªè´¹æµé‡ä»¥åŠå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨æµç®¡ç†æ¥å®ç°æ¶ˆæ¯ç¡®è®¤ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æµå…³é—­&quot;&gt;&lt;a href=&quot;#æµå…³é—­&quot; class=&quot;headerlink&quot; title=&quot;æµå…³é—­&quot;&gt;&lt;/a&gt;æµå…³é—­&lt;/h4&gt;&lt;p&gt;å½“é€€å‡ºç¨‹åºçš„æ—¶å€™ï¼Œæœ€å¥½èƒ½ç»™æœåŠ¡å™¨å‘é€å…³é—­æµçš„é€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯å‘é€&amp;lt;/stream:stream&amp;gt;ç»“æŸæµï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åå¼€å§‹å°†åç»­å‘ç»™è¯¥å¯¹è±¡çš„æ¶ˆæ¯æ”¶é›†åˆ°ç¦»çº¿ä»“åº“ä¸­ï¼Œå½“å®¢æˆ·ç«¯é‡æ–°ä¸Šçº¿çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šä¸»åŠ¨å°†ç¦»çº¿æ¶ˆæ¯æ¨é€è¿‡æ¥ï¼Œè¿™æ ·ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚ç”±äºå®¢æˆ·ç«¯çš„æ“ä½œç»å¸¸æ˜¯åˆ‡åˆ°åå°ç„¶åç›´æ¥å…³æ‰ç¨‹åºï¼Œå› æ­¤å¯ä»¥ç›‘å¬UIApplicationWillTerminateNotificationæ¶ˆæ¯ï¼Œç„¶åæ‰‹åŠ¨å…³é—­æµã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(applicationWillTerminate) name:UIApplicationWillTerminateNotification object:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#pragma mark -- terminate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â *Â  ç”³è¯·åå°æ›´å¤šçš„æ—¶é—´æ¥å®Œæˆå…³é—­æµçš„ä»»åŠ¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)applicationWillTerminate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  UIApplication *app=[UIApplication sharedApplication];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  UIBackgroundTaskIdentifier taskId;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  taskId=[app beginBackgroundTaskWithExpirationHandler:^(void)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  [app endBackgroundTask:taskId];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  if(taskId==UIBackgroundTaskInvalid)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [_xmppStream disconnectAfterSendingEndStream];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;æµç®¡ç†&quot;&gt;&lt;a href=&quot;#æµç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;æµç®¡ç†&quot;&gt;&lt;/a&gt;æµç®¡ç†&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;http://xmpp.org/extensions/xep-0198.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Stream Management&lt;/a&gt;æ˜¯ä¸ºäº†æµæ¢å¤è·ŸèŠ‚ç¡®è®¤è€Œå¢åŠ çš„ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å‘é€å…³é—­æµçš„é€šçŸ¥ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†åç»­çš„æ¶ˆæ¯å­˜å‚¨åˆ°ç¦»çº¿ä»“åº“ï¼Œç­‰å®¢æˆ·ç«¯å†ç™»é™†ä¸Šçº¿çš„æ—¶å€™æ¨é€è¿‡æ¥ï¼Œä½†æ˜¯åœ¨ç§»åŠ¨ç«¯ç½‘ç»œå¯èƒ½éšæ—¶æ–­æ‰ï¼Œè¿™æ—¶å€™æœåŠ¡å™¨å¹¶ä¸ä¼šé©¬ä¸Šå¯Ÿè§‰(åªèƒ½ä¾é TCPè¶…æ—¶æˆ–è€…æœåŠ¡å™¨è‡ªå·±çš„å¿ƒè·³åŒ…)ï¼Œå®ƒä¼šè®¤ä¸ºå¯¹æ–¹è¿˜åœ¨çº¿ï¼Œå°†åç»­çš„æ¶ˆæ¯å‘é€è¿‡å»ï¼Œè¿™æ ·åˆ°æœåŠ¡å™¨çŸ¥é“å¯¹æ–¹æ‰çº¿çš„è¿™æ®µæ—¶é—´ï¼ŒæœŸé—´çš„æ¶ˆæ¯å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥éœ€è¦æµç®¡ç†æ¥å¤„ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç¡®è®¤(stanza acknowledgement)&lt;br&gt;ç”¨æ¥ç¡®è®¤ä¸€æ®µæ—¶é—´å†…èŠ‚(åŒ…æ‹¬&amp;lt;iq/&amp;gt;,&amp;lt;message/&amp;gt;,&amp;lt;presence/&amp;gt;,ä¸æ˜¯&amp;lt;iq/&amp;gt;&lt;br&gt;,&amp;lt;message/&amp;gt;,æˆ–&amp;lt;presence/&amp;gt;è¿™æ ·çš„stanzasä¸ä¼šåœ¨æµç®¡ç†ä¸­è¢«ç¡®è®¤è·Ÿè®¡æ•°çš„)æ˜¯å¦è¢«å¯¹æ–¹æ¥æ”¶ï¼Œå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½å„è‡ªæœ‰æœ‰ä¸¤ä¸ªhå€¼ç”¨æ¥ç»´æŠ¤è¿™äº›ä¿¡æ¯ã€‚ä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œå…¶ä¸­ä¸€ä¸ªhå€¼ç”¨äºè®°å½•æ”¶åˆ°çš„èŠ‚ï¼Œæ¯”å¦‚å½“æ”¶åˆ°æœåŠ¡æ¨é€çš„æ¶ˆæ¯æ—¶ï¼Œä¼šå°†è¯¥hå€¼åŠ 1ï¼›å¦ä¸€ä¸ªhå€¼ç”¨äºè®°å½•å‘å‡ºå»çš„èŠ‚ï¼Œå½“å‘å‡ºä¸€æ¡æ¶ˆæ¯æ—¶è¯¥hå€¼ä¹ŸåŠ 1ï¼Œæ‰€ä»¥ä¸ºäº†ç¡®è®¤æ¶ˆæ¯æ˜¯å¦è¢«æ”¶åˆ°å…¶å®éƒ½æ˜¯åœ¨æ¯”è¾ƒåŒæ–¹çš„ä¸¤ä¸ªhå€¼ã€‚&lt;br&gt;ä¸ºäº†æŸ¥è¯¢è¿™äº›hå€¼ï¼Œxmppå®šä¹‰äº† &amp;lt;a/&amp;gt; å’Œ &amp;lt;r/&amp;gt; ä¸¤ä¸ªå…ƒç´ ï¼Œ&amp;lt;r/&amp;gt;ç”¨æˆ·è¯·æ±‚èŠ‚çš„ç¡®è®¤æ¶ˆæ¯ï¼Œ&amp;lt;a/&amp;gt;ç”¨äºå›ç­”èŠ‚çš„ç¡®è®¤æ¶ˆæ¯ï¼Œå¿…é¡»æºå¸¦è‡ªå·±å·²å¤„ç†çš„hå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;æœåŠ¡ç«¯: &amp;lt;r xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;å®¢æˆ·ç«¯: &amp;lt;a xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos; h=&amp;apos;3&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¯”å¦‚æœåŠ¡ç«¯å‘é€ &amp;lt;r/&amp;gt; è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿”å›è‡ªå·±æ¥å—æ”¶åˆ°çš„hå€¼ï¼ˆ3ï¼‰ï¼Œç„¶åæœåŠ¡ç«¯ä¼šæ ¹æ®è¿™ä¸ªhå€¼è·Ÿå®ƒè‡ªå·±è®°å½•å‘å‡ºå»çš„èŠ‚çš„hå€¼åšæ¯”è¾ƒï¼Œå‡å¦‚å°çš„è¯ä¼šé‡æ–°å‘é€å‰©ä¸‹çš„èŠ‚ï¼Œæ¥é˜²æ­¢èŠ‚ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æµæ¢å¤&lt;br&gt;ç”±äºç§»åŠ¨ç½‘ç»œå¯èƒ½éšæ—¶downæ‰ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬é‡è¿ä¸Šæ¥çš„æ—¶å€™éœ€è¦çš„æ˜¯å¿«é€Ÿæ¢å¤ä¸Šä¸€æ¬¡çš„æµï¼Œè€Œä¸æ˜¯é‡æ–°æ–°å»ºä¸€ä¸ªæµï¼Œrosterçš„æ£€ç´¢ä»¥åŠçŠ¶æ€çš„å¹¿æ’­ï¼Œæµç®¡ç†å¯ä»¥é€šè¿‡ä¸Šä¸€æ¬¡çš„æµidï¼ˆå½“å¯ç”¨æµç®¡ç†çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªidæ¥è¡¨ç¤ºä¸€ä¸ªæµï¼‰ä»¥åŠåŒæ–¹çš„hå€¼æ¥å®Œæˆæµçš„å¿«é€Ÿæ¢å¤ä»¥åŠè¿™æœŸé—´çš„èŠ‚ç¡®è®¤ï¼Œå‘é€æœªè¢«ç¡®è®¤çš„èŠ‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¼€å¯æµç®¡ç†&lt;br&gt;è¦æƒ³å¯ç”¨æµç®¡ç†ï¼Œå®¢æˆ·ç«¯å‘é€ &amp;lt;enable/ &amp;gt;å…ƒç´ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¿”å›&amp;lt;enabled/&amp;gt;å…ƒç´ è¡¨ç¤ºè¯¥æµå·²ç»è¢«ç®¡ç†äº†ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªidå€¼æ¥æ ‡ç¤ºè¿™ä¸ªæµï¼Œxmppframeworkå¼€å¯æµç®¡ç†åªéœ€è¦è°ƒç”¨&lt;br&gt;enableStreamManagementWithResumption: maxTimeout:æ¥å£ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å®¢æˆ·ç«¯: &amp;lt;enable xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos; resume=&amp;apos;true&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æœåŠ¡ç«¯: &amp;lt;enabled xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos; id=&amp;apos;æµid&amp;apos; resume=&amp;apos;true&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)xmppStreamDidAuthenticate:(XMPPStream *)sender&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  //ç™»é™†å®Œæˆåï¼Œå¯ç”¨æµç®¡ç†&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [_xmppStreamManagement enableStreamManagementWithResumption:YES maxTimeout:0];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;è¯·æ±‚æµæ¢å¤&lt;br&gt;å½“å®¢æˆ·ç«¯æƒ³è¦æ¢å¤ä¸€ä¸ªæµçš„æ—¶å€™ï¼Œéœ€è¦å‘é€&amp;lt;resume/&amp;gt;å…ƒç´ ä»¥åŠä¸€ä¸ªprevidå€¼ï¼Œä¹Ÿå°±æ˜¯æƒ³è¦æ¢å¤çš„ä¸Šä¸€æ¬¡çš„æµidï¼Œå½“æµå¯ä»¥æ¢å¤çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›&amp;lt;resumed/&amp;gt;å…ƒç´ ï¼ŒåŒæ–¹éƒ½ä¼šæºå¸¦ä¸€ä¸ªhå€¼ç”¨äºèŠ‚ç¡®è®¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;å®¢æˆ·ç«¯: &amp;lt;resume xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos; h=&amp;apos;å®¢æˆ·ç«¯æ¥æ”¶çš„hå€¼&amp;apos; previd=&amp;apos;æµid&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æœåŠ¡ç«¯: &amp;lt;resumed xmlns=&amp;apos;urn:xmpp:sm:3&amp;apos; h=&amp;apos;æœåŠ¡ç«¯æ¥æ”¶çš„hå€¼&amp;apos; previd=&amp;apos;æµid&amp;apos;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;xmppframeworkå°†è¿™éƒ¨åˆ†é€»è¾‘å°è£…åœ¨å†…éƒ¨ï¼Œä¸è¿‡è¿™äº›hè·Ÿæµidçš„å€¼æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå½“ç¨‹åºé€€å‡ºçš„æ—¶å€™è¿™äº›å€¼å°±æ²¡äº†ï¼Œä¹Ÿå°±æ— æ³•æ¢å¤æµã€‚æ‰€ä»¥å®é™…åº”ç”¨çš„æ—¶å€™éœ€è¦å°†è¿™äº›å€¼ä¿å­˜åˆ°æœ¬åœ°ï¼Œæ¯”å¦‚&lt;a href=&quot;https://github.com/FreeMind-LJ/IMChatDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;é‡Œçš„XMPPStreamManagementPersistentStorageã€‚&lt;/p&gt;
&lt;h4 id=&quot;xmppæ³¨æ„ç‚¹&quot;&gt;&lt;a href=&quot;#xmppæ³¨æ„ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;xmppæ³¨æ„ç‚¹&quot;&gt;&lt;/a&gt;xmppæ³¨æ„ç‚¹&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶httpä¸Šä¼ &lt;br&gt;ç”±äºxmppåªæ”¯æŒæ–‡æœ¬ï¼Œæ‰€ä»¥ç±»ä¼¼éŸ³é¢‘è¿™ç§äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ç”¨base64è½¬æˆæ–‡æœ¬å½¢å¼ï¼Œä½†æ›´å¥½çš„æ–¹å¼æ˜¯é‡‡ç”¨httpä¸Šä¼ æ–‡ä»¶ï¼Œæ¶ˆæ¯ä½“ä¿å­˜çš„æ˜¯æ–‡ä»¶å¯¹åº”çš„URLã€‚&lt;/li&gt;
&lt;li&gt;ç™»é™†æ”¹è¿›&lt;br&gt;xmppçš„ç™»é™†æ¶‰åŠåˆ°å§‹åŒ–æµã€TLSæ¡æ‰‹å’ŒSASLéªŒè¯ç­‰ï¼Œæ­¥éª¤æ¯”è¾ƒç¹çï¼Œå¯ä»¥æ ¹æ®æƒ…å†µç®€åŒ–æµç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;TLSåŠ å¯†&lt;br&gt;å‡å¦‚æˆ‘ä»¬çš„iméœ€è¦åŠ å¯†ï¼Œå¯ä»¥å¼€å¯TLSï¼Œä¸è¿‡iOSçš„TLS&lt;a href=&quot;https://dev.ssllabs.com/ssltest/viewClient.html?name=Apple%20ATS&amp;amp;version=9&amp;amp;platform=iOS%209&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä¸æ”¯æŒå‹ç¼©&lt;/a&gt;ã€‚&lt;br&gt;GCDAsyncSocketå†…éƒ¨å·²ç»å¸®æˆ‘ä»¬å°è£…åå•†çš„è¿‡ç¨‹ï¼Œä¸è¿‡æˆ‘ä»¬å¯èƒ½ä¼šæ”¶åˆ°é”™è¯¯ï¼škCFStreamErrorDomainSSL Code=-9807ï¼Œè¿™æ˜¯ç”±äºæœåŠ¡å™¨è¯ä¹¦å¹¶ä¸æ˜¯æ­£å¼çš„è¯ä¹¦ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å»è®¤è¯ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//è®¾ç½®æ‰‹åŠ¨è®¤è¯è¯ä¹¦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSMutableDictionary *settings = [NSMutableDictionary dictionary];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[settings setObject:@YES forKey:GCDAsyncSocketManuallyEvaluateTrust];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[asyncSocket startTLS:settings];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)socketDidSecure:(GCDAsyncSocket *)sock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     // å¼€å§‹æ¥æ”¶æ•°æ®&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [sock readDataWithTimeout:TIMEOUT_XMPP_READ_STREAM tag:TAG_XMPP_READ_STREAM];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//åœ¨delegateæ–¹æ³•ä¸­ï¼Œæ‰‹åŠ¨ä¿¡ä»»&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)xmppStream:(XMPPStream *)sender didReceiveTrust:(SecTrustRef)trust completionHandler:(void (^)(BOOL))completionHandler&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  if (completionHandler)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  completionHandler(YES);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„demoå·¥ç¨‹å¯ä»¥åœ¨&lt;a href=&quot;https://github.com/FreeMind-LJ/IMChatDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æ­å»ºå®Œ&lt;a href=&quot;http://www.jianshu.com/p/f801229de016&quot;&gt;æœ¬åœ°æœåŠ¡å™¨&lt;/a&gt;ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç€æ‰‹å®¢æˆ·ç«¯çš„å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&quot;https://github.com/robbiehanson/XMPPFramework&quot;&gt;XMPPFramework&lt;/a&gt;è¿™ä¸ªå¼€æºåº“ï¼Œå®‰å“å¹³å°å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https://github.com/igniterealtime/Smack&quot;&gt;Smack&lt;/a&gt;(æœ€å¥½ä½¿ç”¨4.1ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œæ”¯æŒæµç®¡ç†)ï¼Œä¸ºäº†ç®€å•èµ·è§è¿™é‡Œåªå®ç°ç™»é™†ã€è·å–å¥½å‹åˆ—è¡¨ä»¥åŠèŠå¤©ç­‰åŠŸèƒ½ï¼Œé¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="IM" scheme="http://freemind-lj.github.io/tags/IM/"/>
    
      <category term="XMPP" scheme="http://freemind-lj.github.io/tags/XMPP/"/>
    
  </entry>
  
  <entry>
    <title>IMå¼€å‘(1)-ejabberdæœåŠ¡å™¨æ­å»º</title>
    <link href="http://freemind-lj.github.io/2015/10/08/IM%E5%BC%80%E5%8F%91-1-ejabberd%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"/>
    <id>http://freemind-lj.github.io/2015/10/08/IMå¼€å‘-1-ejabberdæœåŠ¡å™¨æ­å»º/</id>
    <published>2015-10-08T10:12:50.000Z</published>
    <updated>2016-02-15T03:17:15.000Z</updated>
    
    <content type="html">&lt;p&gt;æœ€è¿‘é¡¹ç›®ä¸­éœ€è¦é›†æˆIMåŠŸèƒ½ï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„ç¬¬ä¸‰æ–¹æä¾›imæœåŠ¡ï¼Œæ¯”å¦‚ç¯ä¿¡ã€èäº‘ç­‰ï¼Œä½†éƒ½æœ‰ä½¿ç”¨é™åˆ¶çš„åœ°æ–¹ï¼Œå¦‚æœä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹å¯ä»¥è‡ªå·±å»å®ç°ä¸€å¥—IMç³»ç»Ÿï¼Œä¸è¿‡ä¸€ä¸ªIMç³»ç»Ÿæ¶‰åŠåˆ°çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œå¼€å‘éš¾åº¦è¾ƒé«˜ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨xmppï¼Œxmppçš„ä¼˜ç‚¹æ˜¯æœ‰å¾ˆå¤šçš„å¼€æºå®ç°ï¼Œæ¯”å¦‚æœåŠ¡ç«¯çš„ejabberdã€Openfireï¼ŒiOSä»¥åŠå®‰å“ç«¯éƒ½å¾ˆä¼˜ç§€çš„å¼€æºåº“å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸”ä¼ è¾“å®‰å…¨ä»¥åŠæ‰©å±•æ€§å¼ºç­‰(ç¯ä¿¡ä¹Ÿæ˜¯åŸºäºxmpp)ï¼›åŒæ—¶ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ä¸èƒ½ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ä»¥åŠè´¹æµé‡ç­‰ï¼Œæœ‰äº›åœ°æ–¹éœ€è¦å»æ”¹è¿›ã€‚&lt;br&gt;   ä¸‹é¢è®°å½•å¦‚ä½•ä½¿ç”¨XMPPæ¥ç®€å•å®ç°IMåŠŸèƒ½ï¼Œåœ¨è¿™ä¹‹å‰éœ€è¦å…ˆæ­å»ºæœ¬åœ°æœåŠ¡å™¨ç”¨äºæµ‹è¯•ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;ejabberdæœåŠ¡å™¨æ­å»º&quot;&gt;&lt;a href=&quot;#ejabberdæœåŠ¡å™¨æ­å»º&quot; class=&quot;headerlink&quot; title=&quot;ejabberdæœåŠ¡å™¨æ­å»º&quot;&gt;&lt;/a&gt;ejabberdæœåŠ¡å™¨æ­å»º&lt;/h3&gt;&lt;p&gt;ä¸ºäº†å®ç°IMèŠå¤©ï¼Œéœ€è¦å…ˆæ­å»ºä¸€ä¸ªXMPPæœåŠ¡å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ejabberdæ¥ä½œä¸ºæœåŠ¡å™¨ï¼Œejabberedé‡‡ç”¨Erlangè¯­è¨€ç¼–å†™ï¼Œç”±äºè¯­è¨€çš„ç‰¹æ€§å¤©ç”Ÿé€‚åˆé«˜å¹¶å‘çš„æƒ…æ™¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…Erlang&lt;br&gt;åœ¨å®‰è£…ejabberedä¹‹å‰éœ€è¦å…ˆå®‰è£…Erlangï¼Œåœ¨æ§åˆ¶å°è¾“å…¥å‘½ä»¤&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brew install erlang&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç­‰å¾…å®‰è£…å®Œæˆå³å¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…ejabbered&lt;br&gt;ejabberedæœåŠ¡å™¨çš„å®‰è£…éå¸¸ç®€å•ï¼Œä¸‹è½½&lt;a href=&quot;https://www.process-one.net/en/ejabberd/downloads&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ejabberd&lt;/a&gt;å®‰è£…åŒ…ç›´æ¥å®‰è£…å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/ejabbered%E5%AE%89%E8%A3%85%E5%8C%85.png&quot; alt=&quot;ejabberedå®‰è£…åŒ….png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å®‰è£…å®Œä¹‹åå¯ä»¥åœ¨Applicationsç›®å½•å…ˆæ‰¾åˆ°ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png&quot; alt=&quot;ç›®å½•ç»“æ„.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;ç”±äºæˆ‘ä»¬çš„æœåŠ¡å™¨åªæ˜¯æµ‹è¯•ç”¨çš„ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯binç›®å½•ä¸‹çš„startå’Œstopå‘½ä»¤ï¼Œè¿™ä¸¤ä¸ªåˆ†åˆ«ç”¨äºå¼€å¯å’Œå…³é—­xmppæœåŠ¡ï¼Œè®¾ç½®è¿™ä¸¤ä¸ªå‘½ä»¤ä¸ºå¯æ‰§è¡Œï¼š&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;chmod 755 stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod 755 start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨è¾“å…¥å‘½ä»¤ ./startå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%90%AF%E5%8A%A8%E9%A1%B5%E9%9D%A2.png&quot; alt=&quot;å¯åŠ¨é¡µé¢.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;ul&gt;
&lt;li&gt;æ·»åŠ ç”¨æˆ·&lt;br&gt;ç°åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨åªæœ‰administratorsï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ å‡ ä¸ªç”¨æˆ·ï¼Œä¹Ÿæ–¹ä¾¿åé¢æµ‹è¯•ï¼Œå¯ä»¥è¾“å…¥&lt;a href=&quot;http://localhost:5280/admin/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://localhost:5280/admin/&lt;/a&gt; åˆ°ejabberdçš„åå°ç®¡ç†é¡µé¢ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2.png&quot; alt=&quot;ç®¡ç†é¡µé¢.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;ç‚¹å‡»è™šæ‹Ÿä¸»æœºï¼Œé€‰æ‹©ç”¨æˆ·èœå•å¯ä»¥çœ‹åˆ°æ·»åŠ ç”¨æˆ·çš„é¡µé¢å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ·»åŠ äº†user1@lujiangbin.localå’Œuser2@lujiangbin.localä¸¤ä¸ªç”¨æˆ·ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7.png&quot; alt=&quot;æ·»åŠ ç”¨æˆ·.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;ul&gt;
&lt;li&gt;æµ‹è¯•æœåŠ¡å™¨&lt;br&gt;ç°åœ¨å¯ä»¥æ¥æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚è¦æµ‹è¯•çš„è¯æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ”¯æŒxmppåè®®çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥ä½¿ç”¨Mac OSXè‡ªå¸¦çš„iMessage(ç™»é™†user1)å’ŒAdium(ç™»é™†user2) ï¼Œå…¶ä¸­æ”¯æŒxmppåè®®çš„å®¢æˆ·ç«¯æœ‰ï¼š&lt;br&gt;&lt;a href=&quot;http://xmpp.org/xmpp-software/clients/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://xmpp.org/xmpp-software/clients/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰“å¼€iMessageæ·»åŠ ç”¨æˆ·&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7user1.png&quot; alt=&quot;æ·»åŠ ç”¨æˆ·user1.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;iMessageå¯èƒ½ä¼šæç¤ºæœåŠ¡å™¨çš„è¯ä¹¦éœ€è¦éªŒè¯ï¼Œç‚¹å‡»ç»§ç»­å³å¯ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-10-08%20%E4%B8%8B%E5%8D%883.34.55.png&quot; alt=&quot;å±å¹•å¿«ç…§ 2015-10-08 ä¸‹åˆ3.34.55.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°user1å·²ç»ç™»é™†æˆåŠŸäº†ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E7%99%BB%E9%99%86%E6%88%90%E5%8A%9F.png&quot; alt=&quot;ç™»é™†æˆåŠŸ&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;æ¥ç€æ‰“å¼€Adiumæ·»åŠ user2@lujiangbin.localç”¨æˆ·ï¼Œæ·»åŠ è¿‡ç¨‹è·ŸiMessageç±»ä¼¼ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B71.png&quot; alt=&quot;æ·»åŠ ç”¨æˆ·1.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;è®¾ç½®è¿æ¥æœåŠ¡å™¨ä¸ºlocalhost:&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B72.png&quot; alt=&quot;æ·»åŠ ç”¨æˆ·2.png&quot;&gt;&lt;br&gt;&lt;/center&gt;


&lt;p&gt;ç”±äºç°åœ¨user1å’Œuser2è¿˜ä¸æ˜¯å¥½å‹å…³ç³»ï¼Œå› æ­¤æ²¡æ³•è¿›è¡ŒèŠå¤©ï¼Œç‚¹å‡»iMessageæ·»åŠ å¥½å‹user2@lujiangbin.localï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B.png&quot; alt=&quot;æ·»åŠ å¥½å‹&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;åœ¨Adiumä¼šæ”¶åˆ°éªŒè¯è¯·æ±‚ï¼Œç‚¹å‡»æ¥å—åŒæ–¹äº’åŠ å¥½å‹ï¼Œæ¥ç€å°±å¯ä»¥è¿›è¡ŒimèŠå¤©äº†ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%A5%BD%E5%8F%8B%E6%B7%BB%E5%8A%A0.png&quot; alt=&quot;å¥½å‹æ·»åŠ .png&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E8%81%8A%E5%A4%A9IM.png&quot; alt=&quot;èŠå¤©.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;è¿™æ ·æˆ‘ä»¬ç¡®è®¤æœ¬åœ°çš„xmppæœåŠ¡å™¨æ˜¯å¯ç”¨çš„ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç€æ‰‹å®¢æˆ·ç«¯çš„å¼€å‘äº†ï¼Œå¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://freemind-lj.github.io/2015/10/20/IM%E5%BC%80%E5%8F%91-2-XMPP-iOS%E5%BC%80%E5%8F%91/&quot;&gt;IMå¼€å‘(2)-iOSå®¢æˆ·ç«¯&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘é¡¹ç›®ä¸­éœ€è¦é›†æˆIMåŠŸèƒ½ï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„ç¬¬ä¸‰æ–¹æä¾›imæœåŠ¡ï¼Œæ¯”å¦‚ç¯ä¿¡ã€èäº‘ç­‰ï¼Œä½†éƒ½æœ‰ä½¿ç”¨é™åˆ¶çš„åœ°æ–¹ï¼Œå¦‚æœä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹å¯ä»¥è‡ªå·±å»å®ç°ä¸€å¥—IMç³»ç»Ÿï¼Œä¸è¿‡ä¸€ä¸ªIMç³»ç»Ÿæ¶‰åŠåˆ°çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œå¼€å‘éš¾åº¦è¾ƒé«˜ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨xmppï¼Œxmppçš„ä¼˜ç‚¹æ˜¯æœ‰å¾ˆå¤šçš„å¼€æºå®ç°ï¼Œæ¯”å¦‚æœåŠ¡ç«¯çš„ejabberdã€Openfireï¼ŒiOSä»¥åŠå®‰å“ç«¯éƒ½å¾ˆä¼˜ç§€çš„å¼€æºåº“å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸”ä¼ è¾“å®‰å…¨ä»¥åŠæ‰©å±•æ€§å¼ºç­‰(ç¯ä¿¡ä¹Ÿæ˜¯åŸºäºxmpp)ï¼›åŒæ—¶ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ä¸èƒ½ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ä»¥åŠè´¹æµé‡ç­‰ï¼Œæœ‰äº›åœ°æ–¹éœ€è¦å»æ”¹è¿›ã€‚&lt;br&gt;   ä¸‹é¢è®°å½•å¦‚ä½•ä½¿ç”¨XMPPæ¥ç®€å•å®ç°IMåŠŸèƒ½ï¼Œåœ¨è¿™ä¹‹å‰éœ€è¦å…ˆæ­å»ºæœ¬åœ°æœåŠ¡å™¨ç”¨äºæµ‹è¯•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="IM" scheme="http://freemind-lj.github.io/tags/IM/"/>
    
      <category term="XMPP" scheme="http://freemind-lj.github.io/tags/XMPP/"/>
    
  </entry>
  
  <entry>
    <title>iOS appæ€§èƒ½ä¼˜åŒ–çš„é‚£äº›äº‹(äºŒ)</title>
    <link href="http://freemind-lj.github.io/2015/09/09/iOS-app%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B-%E4%BA%8C/"/>
    <id>http://freemind-lj.github.io/2015/09/09/iOS-appæ€§èƒ½ä¼˜åŒ–çš„é‚£äº›äº‹-äºŒ/</id>
    <published>2015-09-09T07:16:28.000Z</published>
    <updated>2016-02-15T03:22:15.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒè¿™æ¬¡æˆ‘ä»¬æ¥è¯´è¯´iOS appä¸­æ»‘åŠ¨çš„é‚£äº›äº‹ã€‚iOSä¸ºäº†æé«˜æ»‘åŠ¨çš„æµç•…æ„Ÿï¼Œç‰¹æ„åœ¨æ»‘åŠ¨çš„æ—¶å€™å°†runloopæ¨¡å¼åˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸“å¿ƒåšè·Ÿæ»‘åŠ¨ç›¸å…³çš„å·¥ä½œï¼Œè¿™ä¹Ÿå°±æ˜¯åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆnstimeræ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºä¸¤ä¸ªæ²¡åœ¨åŒä¸€modeä¸‹é¢ã€‚ä½†æˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šé‡åˆ°æ»‘åŠ¨ä¸æ€ä¹ˆæµç•…çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨é¡¹ç›®ä¸­ç¢°åˆ°åœ¨æ»‘åŠ¨tableviewçš„æ—¶å€™ä¸æ€ä¹ˆé¡ºç•…ï¼Œæ„Ÿè§‰æœ‰ç‚¹ä¸çˆ½ï¼Œå³ä¾¿æ˜¯åœ¨æµ‹è¯•ä¸­è¡¨ç°æœ€å¥½çš„5s(touchä¹‹ç±»çš„æ„Ÿå—æ›´ç›´è§‚)ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/tableview%20%E6%BB%91%E5%8A%A8%E4%B8%8D%E6%B5%81%E7%95%85.png&quot; alt=&quot;tableview æ»‘åŠ¨ä¸æµç•…&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;â€ƒâ€ƒé‚£ç¢°åˆ°è¿™ç§æƒ…å†µè¯¥æ€ä¹ˆå¤„ç†ï¼Œåˆ†æå›¾åƒåŠ¨ç”»æ€§èƒ½ä¸»è¦ç”¨çš„æ˜¯Core Animationè¿™ä¸ªç»„ä»¶ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹é‡Œé¢ä¸€äº›ç»å¸¸ç”¨åˆ°çš„é€‰é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Color Blended layers&lt;br&gt;æ ‡ç¤ºæ··åˆçš„å›¾å±‚ä¼šä¸ºçº¢è‰²,ä¸é€æ˜çš„å›¾å±‚ä¸ºç»¿è‰²ï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›ç»¿è‰²çš„åŒºåŸŸè¶Šå¤šè¶Šå¥½ã€‚&lt;/li&gt;
&lt;li&gt;Color Hits Green and Misses Red&lt;br&gt;å‡å¦‚æˆ‘ä»¬è®¾ç½®viewlayerçš„shouldRasterizeä¸ºYESï¼Œé‚£äº›æˆåŠŸè¢«ç¼“å­˜çš„layerä¼šæ ‡æ³¨ä¸ºç»¿è‰²ï¼Œåä¹‹ä¸ºçº¢è‰²ï¼Œä¸‹é¢ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚&lt;/li&gt;
&lt;li&gt;Color copied images&lt;br&gt;æ ‡ç¤ºé‚£äº›è¢«Core Animationæ‹·è´çš„å›¾ç‰‡ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºè¯¥å›¾ç‰‡çš„è‰²å½©æ ¼å¼ä¸èƒ½è¢«GPUç›´æ¥å¤„ç†ï¼Œéœ€è¦åœ¨CPUè¿™è¾¹åšè½¬æ¢ï¼Œå‡å¦‚åœ¨ä¸»çº¿å±‚åšè¿™ä¸ªæ“ä½œå¯¹æ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;Color misaligned images&lt;br&gt;è¢«ç¼©æ”¾çš„å›¾ç‰‡ä¼šè¢«æ ‡è®°ä¸ºé»„è‰²,åƒç´ ä¸å¯¹é½åˆ™ä¼šæ ‡æ³¨ä¸ºç´«è‰²ã€‚&lt;/li&gt;
&lt;li&gt;Color offscreen-rendered yellow&lt;br&gt;æ ‡ç¤ºå“ªäº›layeréœ€è¦åšç¦»å±æ¸²æŸ“(offscreen-render)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;ç®€å•ä»‹ç»å®ŒCore Animationçš„ä¸€äº›ä¸œè¥¿ä¹‹åæˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹å“ªäº›é—®é¢˜ä¼šå½±å“åˆ°å›¾å½¢çš„æ€§èƒ½ï¼Œä¸‹é¢è¿™å¼ å›¾æ‘˜è‡ªWWDC2014(&lt;a href=&quot;https://developer.apple.com/videos/wwdc/2014/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Advanced Graphics and Animations for iOS Apps&lt;/a&gt;ï¼Œè¿™ä¸Šé¢çš„ä¸€äº›åˆ†äº«éå¸¸æœ‰æŠ€æœ¯æ€§)&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/performance%20investigation%20mindset.png&quot; alt=&quot;performance investigation mindset.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å½“ä½ ç¢°åˆ°æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦å—åˆ°CPUæˆ–è€…GPUçš„é™åˆ¶ï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦æœ‰ä¸å¿…è¦çš„CPUæ¸²æŸ“ï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦æœ‰å¤ªå¤šçš„ç¦»å±æ¸²æŸ“æ“ä½œï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦æœ‰å¤ªå¤šçš„å›¾å±‚æ··åˆæ“ä½œï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦æœ‰å¥‡æ€ªçš„å›¾ç‰‡æ ¼å¼æˆ–è€…å°ºå¯¸ï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ˜¯å¦æ¶‰åŠåˆ°æ˜‚è´µçš„viewæˆ–è€…æ•ˆæœï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;viewçš„å±‚æ¬¡ç»“æ„æ˜¯å¦åˆç†ï¼Ÿ&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå“ªäº›æ˜¯ä½ æœ€è¯¥å¼€å§‹è€ƒè™‘çš„æ–¹å‘å‘¢ï¼Ÿé€šå¸¸å‘ç”Ÿå›¾å½¢æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œæ¯”å¦‚åˆ—è¡¨æ»‘åŠ¨ä¸é¡ºç•…ã€åŠ¨ç”»å¡é¡¿ç­‰ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç”±äºOffscreen Rendering(ç¦»å±æ¸²æŸ“)æˆ–è€…blendingå¯¼è‡´çš„ï¼Œå› ä¸ºè¿™åœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§éƒ½ä¼šæ¶‰åŠåˆ°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;offscreen-render&quot;&gt;&lt;a href=&quot;#offscreen-render&quot; class=&quot;headerlink&quot; title=&quot;offscreen-render&quot;&gt;&lt;/a&gt;offscreen-render&lt;/h3&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯offscreen-renderï¼Ÿoffscreen-renderæ¶‰åŠçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæœ‰offscreen-renderé‚£å°±æœ‰onscreen renderï¼Œonscreen renderæŒ‡çš„æ˜¯GPUåœ¨å½“å‰ç”¨äºæ˜¾ç¤ºçš„å±å¹•ç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“ï¼Œç›¸åoffscreen-renderå°±æ˜¯ä¸åœ¨å½“å‰çš„å±å¹•ç¼“å­˜åŒºï¼Œè€Œåœ¨å¦å¤–çš„ç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“ï¼Œoffscreen-renderæœ‰ä¸¤ç§å½¢å¼ï¼š&lt;/p&gt;
&lt;h5 id=&quot;CPUçš„offscreen-render&quot;&gt;&lt;a href=&quot;#CPUçš„offscreen-render&quot; class=&quot;headerlink&quot; title=&quot;CPUçš„offscreen-render&quot;&gt;&lt;/a&gt;CPUçš„offscreen-render&lt;/h5&gt;&lt;p&gt;ä½¿ç”¨CPUæ¥å®Œæˆæ¸²æŸ“æ“çºµï¼Œé€šå¸¸åœ¨ä½ ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;drawRect (å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ç»˜åˆ¶çš„ä»»åŠ¡å°±ä¸è¦åœ¨å­ç±»ä¸­å†™ä¸€ä¸ªç©ºçš„drawRectæ–¹æ³•ï¼Œå› ä¸ºåªè¦å®ç°äº†è¯¥æ–¹æ³•ï¼Œå°±ä¼šä¸ºè§†å›¾åˆ†é…ä¸€ä¸ªå¯„å®¿å›¾ï¼Œè¿™ä¸ªå¯„å®¿å›¾çš„åƒç´ å°ºå¯¸ç­‰äºè§†å›¾å¤§å°ä¹˜ä»¥ contentsScaleçš„å€¼ï¼Œé€ æˆèµ„æºæµªè´¹)&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Core Graphics&lt;br&gt;ä¸Šé¢çš„ä¸¤ç§æƒ…å†µä½¿ç”¨çš„å°±æ˜¯CPUç¦»å±æ¸²æŸ“ï¼Œé¦–å…ˆåˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶åè¿›è¡Œæ¸²æŸ“æ“ä½œç”Ÿæˆä¸€ä»½bitmapä½å›¾ï¼Œæ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¼šåœ¨ä½ çš„åº”ç”¨ä¸­åŒæ­¥çš„è¿›è¡Œï¼Œæ¥ç€å†å°†ä½å›¾æ‰“åŒ…å‘é€åˆ°iOSé‡Œä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹â€“render serverï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œrender serverå°†å†…å®¹äº¤ç»™GPUç›´æ¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;GPUçš„offscreen-render&quot;&gt;&lt;a href=&quot;#GPUçš„offscreen-render&quot; class=&quot;headerlink&quot; title=&quot;GPUçš„offscreen-render&quot;&gt;&lt;/a&gt;GPUçš„offscreen-render&lt;/h5&gt;&lt;p&gt;ä½¿ç”¨GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç¼“å†²åŒºè¿›è¡Œç»˜åˆ¶ï¼Œé€šå¸¸å‘ç”Ÿçš„æƒ…å†µæœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®cornerRadius, masks, shadows,edge antialiasingç­‰&lt;/li&gt;
&lt;li&gt;è®¾ç½®layer.shouldRasterize ï¼ YES&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B.png&quot; alt=&quot;æ¸²æŸ“æµç¨‹&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;offscreen-renderå¯¹æ€§èƒ½åˆ°åº•æœ‰ä»€ä¹ˆå½±å“ï¼Ÿé€šå¸¸å¤§å®¶è¯´çš„ç¦»å±æ¸²æŸ“æŒ‡çš„æ˜¯GPUè¿™å—(å½“ç„¶CPUè¿™å—ä¹Ÿä¼šæœ‰å½±å“ï¼Œä¹Ÿéœ€è¦æ¶ˆè€—ä¸€å®šçš„èµ„æº)ï¼Œæ¯”å¦‚ä¿®æ”¹äº†layerçš„é˜´å½±æˆ–è€…åœ†è§’ï¼ŒGPUéœ€è¦åšé¢å¤–çš„æ¸²æŸ“æ“ä½œã€‚é€šå¸¸GPUåœ¨åšæ¸²æŸ“çš„æ—¶å€™æ˜¯å¾ˆå¿«çš„ï¼Œä½†æ˜¯æ¶‰åŠåˆ°offscreen-renderçš„æ—¶å€™æƒ…å†µå°±å¯èƒ½æœ‰äº›ä¸åŒï¼Œå› ä¸ºéœ€è¦é¢å¤–å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“ï¼Œç„¶åç»˜åˆ¶åˆ°å½“å‰å±å¹•çš„è¿‡ç¨‹éœ€è¦åšonscreenè·Ÿoffscreenä¸Šä¸‹æ–‡ä¹‹é—´çš„åˆ‡æ¢ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„æ¶ˆè€—ä¼šæ¯”è¾ƒæ˜‚è´µï¼Œæ¶‰åŠåˆ°OpenGLçš„pipelineè·Ÿbarrierï¼Œè€Œä¸”offscreen-renderåœ¨æ¯ä¸€å¸§éƒ½ä¼šæ¶‰åŠåˆ°ï¼Œå› æ­¤å¤„ç†ä¸å½“è‚¯å®šä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥å¯ä»¥çš„è¯å°½é‡å‡å°‘offscreen-renderçš„å›¾å±‚ï¼ŒæŸ¥çœ‹å“ªäº›å›¾å±‚éœ€è¦ç¦»å±æ¸²æŸ“å¯ä»¥ç”¨Instrumentsçš„Core Animationå·¥å…·è¿›è¡Œæ£€æµ‹ï¼ŒColor Offscreen-Rendered Yellowé€‰é¡¹ä¼šå°†å¯¹åº”çš„å›¾å±‚æ ‡è®°ä¸ºé»„è‰²ã€‚&lt;/p&gt;
&lt;h3 id=&quot;Blending&quot;&gt;&lt;a href=&quot;#Blending&quot; class=&quot;headerlink&quot; title=&quot;Blending&quot;&gt;&lt;/a&gt;Blending&lt;/h3&gt;&lt;p&gt;å‡å¦‚æœ€ä¸Šå±‚çš„viewæ˜¯ä¸é€æ˜çš„ï¼Œé‚£ç›´æ¥ä½¿ç”¨è¿™ä¸ªviewçš„å¯¹åº”é¢œè‰²ä¹‹å°±å¯ä»¥ï¼Œä½†å¦‚æœviewæ˜¯é€æ˜çš„ï¼Œåœ¨è®¡ç®—åƒç´ çš„é¢œè‰²å€¼æ—¶å°±éœ€è¦è®¡ç®—å®ƒä¸‹é¢å›¾å±‚ï¼Œé€æ˜çš„è§†å›¾è¶Šå¤šï¼Œè®¡ç®—é‡å°±è¶Šå¤§ï¼Œå› æ­¤ä¹Ÿä¼šå¯¹å›¾å½¢çš„æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥å¯ä»¥çš„è¯ä¹Ÿå°½é‡å‡å°‘é€æ˜å›¾å±‚çš„æ•°ç›®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Demo&quot;&gt;&lt;a href=&quot;#Demo&quot; class=&quot;headerlink&quot; title=&quot;Demo&quot;&gt;&lt;/a&gt;Demo&lt;/h2&gt;&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•&lt;a href=&quot;https://github.com/FreeMind-LJ/OptimiseDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œè¿™ä¸ªdemoé‡Œé¢æ¶‰åŠåˆ°çš„é—®é¢˜æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­æ‰€ç¢°åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯æœ€ä¸Šé¢é‚£å¼ å›¾é‡Œåˆ—è¡¨æ»‘åŠ¨ä¸æµç•…æƒ…å†µâ€”ç”±é˜´å½±ä»¥åŠåœ†è§’å¯¼è‡´çš„offscreen-renderã€‚&lt;br&gt;æ•´ä¸ªé¡µé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„tableviewï¼Œå…¶ä¸­å¤´åƒä¸ºåœ†è§’ï¼Œä¸€ä¸ªlabelæœ‰é˜´å½±æ•ˆæœï¼Œæ»‘åŠ¨çš„æ—¶å€™åœ¨iPodä¸Šå¸§ç‡åªæœ‰å¯æ€œçš„28FPSã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/Color%20Offscreen-Rendered%20Yellow.png&quot; alt=&quot;Color Offscreen-Rendered Yellow&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/28FPS.png&quot; alt=&quot;28FPS.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å…¶ä¸­é»„è‰²çš„åŒºåŸŸå°±æ˜¯ç¦»å±æ¸²æŸ“çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å«æœ‰åœ†è§’è·Ÿé˜´å½±çš„layerã€‚&lt;/p&gt;
&lt;h5 id=&quot;shadowPath&quot;&gt;&lt;a href=&quot;#shadowPath&quot; class=&quot;headerlink&quot; title=&quot;shadowPath&quot;&gt;&lt;/a&gt;shadowPath&lt;/h5&gt;&lt;p&gt;è®¾ç½®labelçš„é˜´å½±æ•ˆæœå¯ä»¥é€šè¿‡ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cell.sign.layer.shadowOffset = CGSizeMake(0, 2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  cell.sign.layer.shadowOpacity = 0.5;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  cell.sign.layer.shadowColor = [UIColor blackColor].CGColor;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä½ å¯ä»¥å‘ç°è¿™ä¼šå¯¼è‡´ç¦»å±æ¸²æŸ“ï¼Œä¸€ä¸ªç®€å•çš„ä¸éœ€è¦ç¦»å±æ¸²æŸ“çš„æ–¹æ³•å°±æ˜¯åˆ¶å®šé˜´å½±çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®layerçš„shadowPathå±æ€§ï¼Œé€šè¿‡instrumentså‘ç°é˜´å½±çš„åœ°æ–¹æ²¡æœ‰é»„è‰²äº†ï¼Œå¸§ç‡ä¹Ÿæé«˜åˆ°äº†40FPSï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cell.sign.layer.shadowPath = [UIBezierPathÂ  bezierPathWithRect:cell.sign.bounds].CGPath;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E8%AE%BE%E7%BD%AEshadowPath%E6%B6%88%E9%99%A4%E7%A6%BB%E5%B1%8F%E6%B8%B2%E6%9F%93.png&quot; alt=&quot;è®¾ç½®shadowPathæ¶ˆé™¤ç¦»å±æ¸²æŸ“.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;h5 id=&quot;rasterize&quot;&gt;&lt;a href=&quot;#rasterize&quot; class=&quot;headerlink&quot; title=&quot;rasterize&quot;&gt;&lt;/a&gt;rasterize&lt;/h5&gt;&lt;p&gt;å¯¹äºåœ†è§’è¿™ç§ç±»ä¼¼å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œæœ€ç®€å•çš„å°±æ˜¯åœ¨åˆ—è¡¨ä¸­ä¸è¦ä½¿ç”¨åœ†è§’ï¼Œå‡å¦‚è¦ä½¿ç”¨åœ†è§’çš„è¯ï¼Œä¸€ç§æœ€å¿«æå‡æ€§èƒ½çš„æ–¹å¼å°±æ˜¯è®¾ç½®layerçš„shouldRasterizeä¸ºYESï¼š&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  cell.layer.shouldRasterize = YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  cell.layer.rasterizationScale = [UIScreen mainScreen].scale;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¢«Rasterizeçš„å›¾å±‚ä¹Ÿä¼šå¼•èµ·ç¦»å±æ¸²æŸ“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•´ä¸ªcelléƒ½è¢«æ ‡ç¤ºä¸ºé»„è‰²ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/shouldRasterize.png&quot; alt=&quot;shouldRasterize.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;layerè®¾ç½®shouldRasterizeï¼YESä¹‹åï¼Œä¼šæŠŠè¢«å…‰æ …åŒ–çš„å›¾å±‚ä¿å­˜æˆä½å›¾å¹¶ç¼“å­˜èµ·æ¥ï¼Œå…¶ä¸­åœ†è§’æˆ–è€…é˜´å½±ä¹‹ç±»çš„æ•ˆæœä¹Ÿæ˜¯ç›´æ¥ä¿å­˜åˆ°ä½å›¾å½“ä¸­ï¼Œå½“éœ€è¦æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„æ—¶å€™åªéœ€è¦åˆ°ç¼“å­˜ä¸­å»å–å¯¹åº”çš„ä½å›¾è¿›è¡Œæ˜¾ç¤ºå°±è¡Œäº†ï¼ŒåŠ å¿«äº†æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹ã€‚å¯ä»¥é€šè¿‡å‹¾é€‰instruments core animationä¸­çš„Color Hits Green and Misses Redé€‰é¡¹æ¥æŸ¥çœ‹å›¾å±‚æ˜¯å¦è¢«ç¼“å­˜äº†ï¼Œå¦‚æœå›¾å±‚æ˜¾ç¤ºä¸ºç»¿è‰²åˆ™è¡¨ç¤ºå·²ç»è¢«ç¼“å­˜èµ·æ¥äº†ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç¼“å†²åŒºçš„å†…å®¹è¢«å¤ç”¨äº†ï¼Œä¸ç”¨åœ¨å»é‡æ–°åˆ›å»ºç¼“å†²åŒºï¼Œåä¹‹åˆ™æ˜¯ç”¨çº¢è‰²æ ‡ç¤ºã€‚å¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°è®¾ç½®shouldRasterizeä¹‹åï¼Œcelléƒ½è¢«æ ‡ç¤ºä¸ºç»¿è‰²äº†ï¼Œå¦‚æœæ»‘åŠ¨è¿‡ç¨‹ä¸­å‘ç°éƒ½æ˜¯çº¢è‰²çš„è¯æ˜å°±æœ‰é—®é¢˜äº†ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/cached.png&quot; alt=&quot;cached.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å†çœ‹çœ‹ç°åœ¨æ»‘åŠ¨çš„å¸§ç‡ï¼š&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%BC%98%E5%8C%96%E5%90%8E.png&quot; alt=&quot;ä¼˜åŒ–å.png&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;å¯ä»¥å‘ç°ç°åœ¨æ»šåŠ¨çš„æ€§èƒ½å¤§å¤§æé«˜äº†ï¼Œå…‰æ …åŒ–å¯¹äºé‚£äº›æœ‰å¾ˆå¤šå­viewåµŒå¥—åœ¨ä¸€èµ·ã€viewçš„å±‚çº§å¤æ‚æˆ–è€…æœ‰å¾ˆå¤æ‚ç‰¹æ•ˆæ•ˆæœçš„å›¾å±‚æœ‰å¾ˆæ˜æ˜¾çš„æå‡ï¼Œå› ä¸ºè¿™äº›å†…å®¹éƒ½è¢«ç¼“å­˜åˆ°ä½å›¾å½“ä¸­äº†ã€‚ä½†æ˜¯ä½¿ç”¨å…‰æ …åŒ–éœ€è¦æ³¨æ„ä¸€äº›å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€‚ç”¨äºå†…å®¹åŸºæœ¬ä¸å˜çš„å›¾å±‚&lt;br&gt;å‡å¦‚å›¾å±‚çš„å†…å®¹ç»å¸¸å˜åŒ–ï¼Œæ¯”å¦‚cellé‡Œé¢æœ‰æ¶‰åŠåˆ°åŠ¨ç”»ä¹‹ç±»çš„ï¼Œé‚£ä¹ˆç¼“å­˜çš„å†…å®¹å°±æ— æ•ˆäº†ï¼ŒGPUéœ€è¦é‡æ–°åˆ›å»ºç¼“å­˜åŒºï¼Œå¯¼è‡´ç¦»å±æ¸²æŸ“ï¼Œè¿™åˆæ¶‰åŠåˆ°OpenGLçš„ä¸Šä¸‹æ–‡ç¯å¢ƒåˆ‡æ¢ï¼Œåè€Œé™ä½æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è¦è¿‡åº¦ä½¿ç”¨&lt;br&gt;ç¼“å­˜åŒºçš„å¤§å°è¢«è®¾ç½®ä¸ºå±å¹•å¤§å°çš„2.5å€ï¼Œå‡å¦‚è¿‡åˆ†ä½¿ç”¨åŒæ ·ä¼šå¯¼è‡´å¤§é‡çš„ç¦»å±æ¸²æŸ“ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç¼“å­˜çš„å†…å®¹è¶…è¿‡100msæ²¡æœ‰è¢«ä½¿ç”¨åˆ™ä¼šè¢«å›æ”¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&quot;tips&quot;&gt;&lt;a href=&quot;#tips&quot; class=&quot;headerlink&quot; title=&quot;tips&quot;&gt;&lt;/a&gt;tips&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¯¹äºåœ†è§’å¯ä»¥ä½¿ç”¨ä¸€å¼ ä¸­é—´åœ†å½¢é€æ˜çš„å›¾è¦†ç›–åœ¨ä¸Šé¢ï¼Œè™½ç„¶è¿™ä¼šå¼•å…¥blendingæ“ä½œï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ€§èƒ½ä¼šæ¯”ç¦»å±æ¸²æŸ“å¥½ã€‚&lt;/li&gt;
&lt;li&gt;è®©ä½ çš„viewå±‚æ¬¡ç»“æ„å¹³å¦ä¸€äº›ï¼Œå› ä¸ºOpenGLåœ¨æ¸²æŸ“layerçš„æ—¶å€™ï¼Œåœ¨ç¢°åˆ°æœ‰å­å±‚çº§layerçš„æ—¶å€™å¯èƒ½éœ€è¦åœä¸‹æ¥æŠŠä¸¤è€…åˆæˆåˆ°ä¸€ä¸ªbufferé‡Œå†æ¥ç€æ¸²æŸ“ã€‚ï¼ˆWhen the OpenGL renderer goes to draw each layer, it may have to stop for some subhierarchies and composite them into a single bufferï¼‰.&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å»¶è¿ŸåŠ è½½å›¾ç‰‡&lt;br&gt;æœ‰æ—¶å€™åœ¨è¾¹æ»šåŠ¨è¾¹è®¾ç½®å›¾ç‰‡çš„æ—¶å€™å¯èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“ï¼Œå› æ­¤å¯ä»¥åœ¨æ»šåŠ¨çš„æ—¶å€™imageviewä¸æ‰§è¡Œsetimageçš„æ“ä½œï¼Œæ»šåŠ¨åœæ­¢çš„æ—¶å€™æ‰åŠ è½½å›¾ç‰‡ï¼Œç”±äºæ»šåŠ¨çš„æ—¶å€™NSRunloopæ˜¯å¤„äºUITrackingRunLoopModeæ¨¡å¼ä¸‹ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼ï¼Œå°†è®¾ç½®å›¾ç‰‡æ”¾åˆ°NSDefaultRunLoopModeæ¨¡å¼ä¸‹æ‰è¿›è¡Œï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;UIImage *downloadedImage = ...;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  [self.avatarImageView performSelector:@selector(setImage:)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  withObject:downloadedImage&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  afterDelay:0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inModes:@[NSDefaultRunLoopMode]];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å›¾ç‰‡åŠ è½½çš„æé™ä¼˜åŒ–æ–¹å¼ï¼š&lt;a href=&quot;https://github.com/path/FastImageCache&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FastImageCache&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;å›¾å½¢æ€§èƒ½è¿™å—æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•ä¹Ÿå¯æå‡ºæ¥äº¤æµä¸€ä¸‹ï½ï½&lt;/p&gt;
&lt;h5 id=&quot;å‚è€ƒï¼š&quot;&gt;&lt;a href=&quot;#å‚è€ƒï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒï¼š&quot;&gt;&lt;/a&gt;å‚è€ƒï¼š&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://lobste.rs/s/ckm4uw/a_performance-minded_take_on_ios_design/comments/itdkfh&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://lobste.rs/s/ckm4uw/a_performance-minded_take_on_ios_design/comments/itdkfh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/wwdc/2014/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Advanced Graphics and Animations for iOS Apps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://iosinjordan.tumblr.com/post/56778173518/help-my-tables-dont-scroll-smoothly&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://iosinjordan.tumblr.com/post/56778173518/help-my-tables-dont-scroll-smoothly&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒè¿™æ¬¡æˆ‘ä»¬æ¥è¯´è¯´iOS appä¸­æ»‘åŠ¨çš„é‚£äº›äº‹ã€‚iOSä¸ºäº†æé«˜æ»‘åŠ¨çš„æµç•…æ„Ÿï¼Œç‰¹æ„åœ¨æ»‘åŠ¨çš„æ—¶å€™å°†runloopæ¨¡å¼åˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸“å¿ƒåšè·Ÿæ»‘åŠ¨ç›¸å…³çš„å·¥ä½œï¼Œè¿™ä¹Ÿå°±æ˜¯åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆnstimeræ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºä¸¤ä¸ªæ²¡åœ¨åŒä¸€modeä¸‹é¢ã€‚ä½†æˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šé‡åˆ°æ»‘åŠ¨ä¸æ€ä¹ˆæµç•…çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨é¡¹ç›®ä¸­ç¢°åˆ°åœ¨æ»‘åŠ¨tableviewçš„æ—¶å€™ä¸æ€ä¹ˆé¡ºç•…ï¼Œæ„Ÿè§‰æœ‰ç‚¹ä¸çˆ½ï¼Œå³ä¾¿æ˜¯åœ¨æµ‹è¯•ä¸­è¡¨ç°æœ€å¥½çš„5s(touchä¹‹ç±»çš„æ„Ÿå—æ›´ç›´è§‚)ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/tableview%20%E6%BB%91%E5%8A%A8%E4%B8%8D%E6%B5%81%E7%95%85.png&quot; alt=&quot;tableview æ»‘åŠ¨ä¸æµç•…&quot;&gt;&lt;br&gt;&lt;/center&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="http://freemind-lj.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>iOS appæ€§èƒ½ä¼˜åŒ–çš„é‚£äº›äº‹</title>
    <link href="http://freemind-lj.github.io/2015/09/05/iOS-app%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <id>http://freemind-lj.github.io/2015/09/05/iOS-appæ€§èƒ½ä¼˜åŒ–çš„é‚£äº›äº‹/</id>
    <published>2015-09-05T09:18:33.000Z</published>
    <updated>2016-02-15T03:23:48.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒiPhoneä¸Šé¢çš„åº”ç”¨ä¸€ç›´éƒ½æ˜¯ä»¥æµç•…çš„æ“ä½œä½“éªŒè€Œè‘—ç§°ï¼Œä½†æ˜¯ç”±äºä¹‹å‰å¼€å‘äººå‘˜æŠŠæ³¨æ„åŠ›æ›´å¤šçš„æ”¾åœ¨å¼€å‘åŠŸèƒ½ä¸Šé¢ï¼Œæ¯”è¾ƒå°‘å»è€ƒè™‘æ€§èƒ½çš„é—®é¢˜ï¼Œå¯èƒ½è¿™å…¶ä¸­æ¶‰åŠåˆ°objectiveï¼c,c++è·Ÿluaï¼Œä¼˜åŒ–èµ·æ¥ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œå¯¼è‡´åº”ç”¨åœ¨æ¯”å¦‚touchç­‰è¾ƒä½ç«¯çš„äº§å“ä¸Šï¼Œå…‰ä»å¯åŠ¨åˆ°è¿›å…¥é¡µé¢å°±èŠ±äº†å°†è¿‘ä¸€åˆ†é’Ÿçš„æ—¶é—´ï¼Œé¡µé¢ä¹‹é—´çš„åˆ‡æ¢æ²¡æœ‰é‚£ç§å¾ˆæµç•…çš„æ„Ÿè§‰ï¼Œå†…å­˜ä¹Ÿå±…é«˜ä¸ä¸‹ï¼Œæ¯”è¾ƒå½±å“åº”ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹æˆ‘åœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ï¼š&lt;/p&gt;
&lt;h3 id=&quot;1-instruments&quot;&gt;&lt;a href=&quot;#1-instruments&quot; class=&quot;headerlink&quot; title=&quot;1 instruments&quot;&gt;&lt;/a&gt;1 instruments&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒåœ¨iOSä¸Šè¿›è¡Œæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œé¦–å…ˆè€ƒè™‘å€ŸåŠ©instrumentsè¿™ä¸ªåˆ©å™¨åˆ†æå‡ºé—®é¢˜å‡ºåœ¨å“ªï¼Œä¸è¦å‡­ç©ºæƒ³è±¡ï¼Œä¸ç„¶ä½ å¯èƒ½æŠŠç²¾åŠ›èŠ±åœ¨äº†1%çš„é—®é¢˜ä¸Šï¼Œæœ€åå‘ç°å…¶å®å•¥éƒ½æ²¡ä¼˜åŒ–ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹ç¨‹åºå“ªäº›éƒ¨åˆ†æœ€è€—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Time Profilerï¼Œè¦æŸ¥çœ‹å†…å­˜æ˜¯å¦æ³„æ¼äº†ï¼Œå¯ä»¥ä½¿ç”¨Leaksç­‰ã€‚å…³äºinstrumentsç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œä½œä¸ºä¸€ä¸ªåˆæ ¼iOSå¼€å‘è€…ï¼Œç†Ÿæ‚‰è¿™ä¸ªå·¥å…·è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;2-ä¸è¦é˜»å¡ä¸»çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#2-ä¸è¦é˜»å¡ä¸»çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;2 ä¸è¦é˜»å¡ä¸»çº¿ç¨‹&quot;&gt;&lt;/a&gt;2 ä¸è¦é˜»å¡ä¸»çº¿ç¨‹&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒåœ¨iOSé‡Œå…³äºUIKitçš„æ“ä½œéƒ½æ˜¯æ”¾åœ¨ä¸»çº¿ç¨‹ï¼Œå› æ­¤å¦‚æœä¸»çº¿ç¨‹è¢«é˜»å¡ä½äº†ï¼Œä½ çš„UIå¯èƒ½æ— æ³•åŠæ—¶å“åº”äº‹ä»¶ï¼Œç»™äººä¸€ç§å¡é¡¿çš„æ„Ÿè§‰ã€‚å¤§å¤šæ•°é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µæ˜¯åœ¨ä¸»çº¿ç¨‹åšIOæ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶çš„è¯»å†™ï¼ŒåŒ…å«æ•°æ®åº“ã€å›¾ç‰‡ã€jsonæ–‡æœ¬æˆ–è€…logæ—¥å¿—ç­‰ï¼Œå°½é‡å°†è¿™äº›æ“ä½œæ”¾æ”¾åˆ°å­çº¿ç¨‹(å¦‚æœæ•°æ®åº“æœ‰ä¸€æ¬¡æœ‰è¾ƒå¤šçš„æ“ä½œï¼Œè®°å¾—é‡‡ç”¨äº‹åŠ¡æ¥å¤„ç†ï¼Œæ€§èƒ½ç›¸å·®è¿˜æ˜¯æŒºå¤§çš„)ï¼Œæˆ–è€…åœ¨åå°å»ºç«‹å¯¹åº”çš„dispatch queueæ¥åšè¿™äº›æ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªä½çº§åˆ«çš„serial queueæ¥è´Ÿè´£logæ–‡ä»¶çš„è®°å½•ç­‰ç­‰ã€‚ç¨‹åºä¸­å¦‚æœä½ çš„ä»£ç é€»è¾‘æ˜¯æŒ‰ç…§åŒæ­¥çš„é€»è¾‘æ¥å†™çš„ï¼Œå°½é‡ä¿®æ”¹é€»è¾‘ä»£ç å§ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;3-ä½¿ç”¨cache&quot;&gt;&lt;a href=&quot;#3-ä½¿ç”¨cache&quot; class=&quot;headerlink&quot; title=&quot;3 ä½¿ç”¨cache&quot;&gt;&lt;/a&gt;3 ä½¿ç”¨cache&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒä¸€èˆ¬ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œéƒ½ä¼šåœ¨åº”ç”¨ä¸­ä½¿ç”¨ç¼“å­˜ï¼Œæ¯”å¦‚å¯¹äºå›¾ç‰‡èµ„æºå¯ä»¥ä½¿ç”¨SDWebImageè¿™ä¸ªå¼€æºåº“ï¼Œé‡Œé¢å°±å®ç°äº†ä¸€ä¸ªå›¾ç‰‡ç¼“å­˜çš„åŠŸèƒ½ã€‚å‚è€ƒSDWebImageçš„ä»£ç è‡ªå·±ä¹Ÿå¯ä»¥å®ç°ç¼“å­˜åŠŸèƒ½:&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/cache%E7%AE%80%E5%8D%95%E7%A4%BA%E6%84%8F%E5%9B%BE.png&quot; alt=&quot;cacheç®€å•ç¤ºæ„å›¾&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;p&gt;ä¸šåŠ¡å±‚æ ¹æ®èµ„æºçš„urlå‘resourcemanagerè·å–å¯¹åº”çš„èµ„æºï¼Œresourcemanageré¦–å…ˆä¼šåˆ°memorycacheè¿™è¾¹å»è·å–èµ„æºï¼Œmemorycacheå¯ä»¥åˆ©ç”¨NSCacheå®ç°ï¼Œå› ä¸ºNSCacheé¦–å…ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”åœ¨æ”¶åˆ°å†…å­˜è­¦å‘Šçš„æ—¶å€™ä¼šè‡ªå·±é‡Šæ”¾å¯¹åº”çš„å†…å­˜ï¼›å¦‚æœmemorycacheæ²¡æœ‰å¯¹åº”çš„èµ„æºå†å»diskæŸ¥æ‰¾ï¼Œdiskä¹Ÿæ²¡æœ‰çš„è¯å†å»internetè·å–ï¼Œè·å–åˆ°çš„è¯ä¼šæ›´æ–°åˆ°memorycacheå’Œdiskä¸­ï¼Œå…·ä½“å¯ä»¥å»å‚è€ƒä¸€ä¸‹SDWebimageçš„å®ç°ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;4-å‡å°‘ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­çš„ä»»åŠ¡&quot;&gt;&lt;a href=&quot;#4-å‡å°‘ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­çš„ä»»åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;4 å‡å°‘ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­çš„ä»»åŠ¡&quot;&gt;&lt;/a&gt;4 å‡å°‘ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­çš„ä»»åŠ¡&lt;/h3&gt;&lt;p&gt;å½“ç”¨æˆ·ç‚¹å‡»appçš„å›¾æ ‡ä¹‹åï¼Œç¨‹åºåº”è¯¥å°½å¯èƒ½å¿«çš„è¿›å…¥åˆ°ä¸»é¡µé¢ï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå»åš3dæ¨¡å‹çš„æ¸²æŸ“æ“ä½œï¼Œå®Œæˆä¹‹ååœ¨è¿›å…¥é¦–é¡µé¢å±•ç¤ºï¼Œä½†å…¶å®æˆ‘ä»¬å¯ä»¥å…ˆè¿›å…¥åˆ°ä¸»é¡µé¢ï¼Œå°†æ¸²æŸ“3dçš„ä»»åŠ¡æ”¾åˆ°å­çº¿ç¨‹å»å®Œæˆï¼Œç¼©çŸ­ç”¨æˆ·éœ€è¦ç­‰å¾…çš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/3d.png&quot; alt=&quot;3d&quot;&gt;&lt;br&gt;&lt;/center&gt;

&lt;h3 id=&quot;5-ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„&quot;&gt;&lt;a href=&quot;#5-ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;5 ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„&quot;&gt;&lt;/a&gt;5 ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„&lt;/h3&gt;&lt;p&gt;æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯æ¥é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œå¯èƒ½åœ¨æ•°æ®é‡æ¯”è¾ƒå°‘çš„æ—¶å€™çœ‹ä¸å‡ºä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯å‡å¦‚ä½ å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ä¸”æ•°æ®ç»“æ„æ¯”è¾ƒå¤æ‚çš„è¯ï¼Œè¿™æœ‰å¯èƒ½ä¼šå½±å“åˆ°ä½ çš„ç¨‹åºæ€§èƒ½ã€‚ä¸€èˆ¬ç”¨çš„æ¯”è¾ƒå¤šçš„æ•°æ®ç»“æ„å°±æ˜¯arrayï¼Œä½†æˆ‘ä»¬çŸ¥é“å®ƒçš„æŸ¥æ‰¾å¤æ‚åº¦æ˜¯O(n)ï¼Œå› æ­¤å‡å¦‚éœ€è¦å¿«é€Ÿçš„æŸ¥æ‰¾æŸä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨mapã€‚å¯ä»¥å‚è€ƒä¸‹&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Collections/Collections.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt; &lt;a href=&quot;https://developer.apple.com/library/ios/#documentation/cocoa/conceptual/collections/Collections.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Apple Collections Programming Topics&lt;/a&gt; &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;6-å†…å­˜&quot;&gt;&lt;a href=&quot;#6-å†…å­˜&quot; class=&quot;headerlink&quot; title=&quot;6 å†…å­˜&quot;&gt;&lt;/a&gt;6 å†…å­˜&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬å¼€å‘éƒ½ä½¿ç”¨çš„ARCï¼Œä¸å¤ªéœ€è¦å¼€å‘è€…å»å…³æ³¨å†…å­˜çš„åˆ›å»ºå’Œé‡Šæ”¾è¿™å—ï¼Œä½†å‡å¦‚ä½ ä½¿ç”¨çš„æ˜¯MRCï¼Œå¹¶ä¸”è·Ÿå…¶å®ƒè¯­è¨€æ··æ‚åœ¨ä¸€èµ·(æ¯”å¦‚c++å’Œlua)ç­‰çš„æ—¶å€™ï¼Œå¦‚ä½•ç¡®ä¿å†…å­˜æ­£ç¡®é‡Šæ”¾å°±æ˜¯ä½ éœ€è¦è€ƒè™‘çš„é—®é¢˜äº†ã€‚æœ‰æ—¶å€™ä¸€äº›å†…å­˜æ³„æ¼instrumentså¯èƒ½æ— æ³•å‡†ç¡®çš„åˆ†æå‡ºæ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦è‡ªå·±å»æ’æŸ¥äº†ï¼Œå¯ä»¥ä½¿ç”¨&lt;a href=&quot;http://www.jianshu.com/p/be1ddd8c699f&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;method swizzling&lt;/a&gt;æ–¹æ³•æ¥è¾…åŠ©æˆ‘ä»¬æ’æŸ¥å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œç¡®ä¿ç¨‹åºçš„æ­£ç¡®è¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&quot;7-æ‡’åŠ è½½view&quot;&gt;&lt;a href=&quot;#7-æ‡’åŠ è½½view&quot; class=&quot;headerlink&quot; title=&quot;7 æ‡’åŠ è½½view&quot;&gt;&lt;/a&gt;7 æ‡’åŠ è½½view&lt;/h3&gt;&lt;p&gt;ä¸è¦åœ¨cellé‡Œé¢åµŒå¥—å¤ªå¤šçš„viewï¼Œè¿™ä¼šå¾ˆå½±å“æ»‘åŠ¨çš„æµç•…æ„Ÿï¼Œè€Œä¸”æ›´å¤šçš„viewä¹Ÿéœ€è¦èŠ±è´¹æ›´å¤šçš„CPUè·Ÿå†…å­˜ã€‚å‡å¦‚ç”±äºviewå¤ªå¤šè€Œå¯¼è‡´äº†æ»‘åŠ¨ä¸æµç•…ï¼Œé‚£å°±ä¸è¦åœ¨ä¸€æ¬¡å°±æŠŠæ‰€æœ‰çš„viewéƒ½åˆ›å»ºå‡ºæ¥ï¼ŒæŠŠéƒ¨åˆ†viewæ”¾åˆ°éœ€è¦æ˜¾ç¤ºcellçš„æ—¶å€™å†å»åˆ›å»ºã€‚&lt;/p&gt;
&lt;h3 id=&quot;8-luaä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#8-luaä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;8 luaä¼˜åŒ–&quot;&gt;&lt;/a&gt;8 luaä¼˜åŒ–&lt;/h3&gt;&lt;p&gt;ç”±äºé¡¹ç›®çš„ä¸šåŠ¡æ˜¯ä»¥åŠéƒ¨åˆ†æ¡†æ¶æ˜¯ç”¨luaè¯­è¨€å®ç°çš„ï¼Œå› æ­¤ä¹Ÿé¡ºä¾¿è¯´ä¸€ä¸‹luaè¿™å—é‡åˆ°çš„é—®é¢˜ã€‚luaå·ç§°æ˜¯æœ€å¿«çš„è„šæœ¬è¯­è¨€ï¼Œä¸€èˆ¬æ€§èƒ½ä¸Šä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚æœluaä»£ç è¦ä¼˜åŒ–çš„è¯ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè¿™å—ä¼˜åŒ–çš„&lt;a href=&quot;http://www.cnblogs.com/gdev/archive/2012/08/22/lua-performance-tips-1.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ³¨æ„ç‚¹&lt;/a&gt;ï¼Œè¿™æ¬¡æˆ‘ä¸»è¦è¯´ä¸ªå¯èƒ½å½±å“æ€§èƒ½çš„ç‚¹â€”luaçš„åƒåœ¾å›æ”¶ã€‚åƒåœ¾å›æ”¶æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œå‡å¦‚åƒåœ¾å›æ”¶çš„æ“ä½œå¤ªè¿‡äºé¢‘ç¹åŠ¿å¿…ä¼šå½±å“åˆ°è¿™ä¸ªç¨‹åºçš„è¿è¡Œï¼Œæ¯”å¦‚åœ¨iPodåœ¨åˆ©ç”¨lua_cjsonè§£æä¸€ä»½4.7Mçš„jsonæ–‡ä»¶æ˜¯èŠ±äº†3.43sçš„æ—¶é—´ï¼Œåæ¥å‘ç°è·Ÿåƒåœ¾å›æ”¶è¿™å—æœ‰å…³ã€‚ä¸€èˆ¬å†…å­˜çš„ä½¿ç”¨é‡é€‚ä¸­çš„è¯ï¼Œå¯ä»¥ä¸ç”¨å»ç†ä»–ï¼Œè®©luaçš„incrementalæ¨¡å¼è‡ªå·±å»å¤„ç†ï¼Œæ­£å¸¸æƒ…å†µè¿™ä¸ªä¼šå·¥ä½œçš„æ¯”è¾ƒå¥½ï¼›å‡å¦‚æƒ³è¦è‡ªå·±å»æ§åˆ¶gcçš„è¿è¡Œï¼Œå¯ä»¥è®¾ç½®gcçš„å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯èƒ½ä¼šè·Ÿé¡¹ç›®æœ‰ä¸€å®šçš„å…³ç³»ï¼Œå¯ä»¥è‡ªå·±å¤šè¯•éªŒå–æœ€ä¼˜å€¼ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//gc çš„å‚æ•°è®¾ç½®ï¼Œæ ¹æ®æƒ…å†µå–æœ€ä¼˜å€¼&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;collectgarbage(&amp;quot;setpause&amp;quot;, 150)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;collectgarbage(&amp;quot;setstepmul&amp;quot;, 200)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒiPhoneä¸Šé¢çš„åº”ç”¨ä¸€ç›´éƒ½æ˜¯ä»¥æµç•…çš„æ“ä½œä½“éªŒè€Œè‘—ç§°ï¼Œä½†æ˜¯ç”±äºä¹‹å‰å¼€å‘äººå‘˜æŠŠæ³¨æ„åŠ›æ›´å¤šçš„æ”¾åœ¨å¼€å‘åŠŸèƒ½ä¸Šé¢ï¼Œæ¯”è¾ƒå°‘å»è€ƒè™‘æ€§èƒ½çš„é—®é¢˜ï¼Œå¯èƒ½è¿™å…¶ä¸­æ¶‰åŠåˆ°objectiveï¼c,c++è·Ÿluaï¼Œä¼˜åŒ–èµ·æ¥ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œå¯¼è‡´åº”ç”¨åœ¨æ¯”å¦‚touchç­‰è¾ƒä½ç«¯çš„äº§å“ä¸Šï¼Œå…‰ä»å¯åŠ¨åˆ°è¿›å…¥é¡µé¢å°±èŠ±äº†å°†è¿‘ä¸€åˆ†é’Ÿçš„æ—¶é—´ï¼Œé¡µé¢ä¹‹é—´çš„åˆ‡æ¢æ²¡æœ‰é‚£ç§å¾ˆæµç•…çš„æ„Ÿè§‰ï¼Œå†…å­˜ä¹Ÿå±…é«˜ä¸ä¸‹ï¼Œæ¯”è¾ƒå½±å“åº”ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹æˆ‘åœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ï¼š&lt;/p&gt;
&lt;h3 id=&quot;1-instruments&quot;&gt;&lt;a href=&quot;#1-instruments&quot; class=&quot;headerlink&quot; title=&quot;1 instruments&quot;&gt;&lt;/a&gt;1 instruments&lt;/h3&gt;&lt;p&gt;â€ƒâ€ƒåœ¨iOSä¸Šè¿›è¡Œæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œé¦–å…ˆè€ƒè™‘å€ŸåŠ©instrumentsè¿™ä¸ªåˆ©å™¨åˆ†æå‡ºé—®é¢˜å‡ºåœ¨å“ªï¼Œä¸è¦å‡­ç©ºæƒ³è±¡ï¼Œä¸ç„¶ä½ å¯èƒ½æŠŠç²¾åŠ›èŠ±åœ¨äº†1%çš„é—®é¢˜ä¸Šï¼Œæœ€åå‘ç°å…¶å®å•¥éƒ½æ²¡ä¼˜åŒ–ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹ç¨‹åºå“ªäº›éƒ¨åˆ†æœ€è€—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Time Profilerï¼Œè¦æŸ¥çœ‹å†…å­˜æ˜¯å¦æ³„æ¼äº†ï¼Œå¯ä»¥ä½¿ç”¨Leaksç­‰ã€‚å…³äºinstrumentsç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œä½œä¸ºä¸€ä¸ªåˆæ ¼iOSå¼€å‘è€…ï¼Œç†Ÿæ‚‰è¿™ä¸ªå·¥å…·è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="http://freemind-lj.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ogre3Dåœ¨Macå¹³å°çš„ç¼–è¯‘</title>
    <link href="http://freemind-lj.github.io/2015/08/26/ogre3D%E5%9C%A8Mac%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%BC%96%E8%AF%91/"/>
    <id>http://freemind-lj.github.io/2015/08/26/ogre3Dåœ¨Macå¹³å°çš„ç¼–è¯‘/</id>
    <published>2015-08-26T11:25:10.000Z</published>
    <updated>2016-02-15T03:43:02.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒæœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨Macå¹³å°ä¸‹ç¼–è¯‘ä¸€ä»½å¯ä»¥åœ¨iOSä¸Šè¿è¡Œçš„ogre3då¼•æ“çš„sdkï¼Œ&lt;a href=&quot;http://www.ogre3d.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;OGRE&lt;/a&gt;ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå›¾å½¢å¼•æ“ï¼Œå¹¶ä¸”ä¹Ÿåªæ˜¯ä¸€ä¸ªå›¾å½¢å¼•æ“ï¼Œä¸åƒcocos2dxä¹‹ç±»çš„æ¸¸æˆå¼•æ“ï¼ŒåŒ…æ‹¬ç½‘ç»œï¼Œå£°éŸ³å’Œç‰©ç†ç¢°æ’ç­‰ç»„ä»¶ï¼ŒOGREåªä¸“æ³¨äºå›¾å½¢æ¸²æŸ“è¿™å—ï¼Œä¸è¿‡å¯ä»¥æ–¹ä¾¿çš„ç»“åˆå…¶å®ƒç»„ä»¶æ¥ç»„æˆä¸€ä¸ªæ¸¸æˆå¼•æ“ï¼Œå…·ä½“å¯ä»¥è‡ªå·±å»äº†è§£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&quot;ç¼–è¯‘OGRE3d&quot;&gt;&lt;a href=&quot;#ç¼–è¯‘OGRE3d&quot; class=&quot;headerlink&quot; title=&quot;ç¼–è¯‘OGRE3d&quot;&gt;&lt;/a&gt;ç¼–è¯‘OGRE3d&lt;/h4&gt;&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºæ”¾ç½®OGRE3Dé¡¹ç›®ï¼Œè¿™ä¸ªå¯ä»¥éšä¾¿æŒ‡å®šï¼Œæ¯”å¦‚æ”¾ç½®åœ¨æ¡Œé¢:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mkdir /Users/LJ/Desktop/OGREBuild&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹è½½Ogre3dä¾èµ–&lt;br&gt;ç¼–è¯‘ogreéœ€è¦é¦–å…ˆä¸‹è½½ç›¸å…³çš„ä¾èµ–åº“ï¼Œç”±äºæˆ‘ä»¬æƒ³è¦ç¼–è¯‘çš„æ˜¯è¿è¡Œåœ¨iOSä¸Šé¢çš„ï¼Œæ‰€ä»¥é€‰æ‹©ç°åœ¨iOSç›¸å…³çš„ä¾èµ–åº“,ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;http://sourceforge.net/projects/ogre/files/ogre-dependencies-mac/1.9/Ogre_iOS_7.0_Dependencies_20140315.dmg/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iOSDependencies&lt;/a&gt;ï¼Œæ‰“å¼€dmgå°†é‡Œé¢çš„æ–‡ä»¶å¤¹æ‹–åˆ°OGREBuildæ–‡ä»¶å¤¹é‡Œé¢ï¼›&lt;/li&gt;
&lt;li&gt;ä¸‹è½½ogre3dæºç &lt;br&gt;è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯1.9ç‰ˆæœ¬çš„ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å…‹éš†å¯¹åº”çš„æºç (è¦å…ˆå®‰è£…Mercurial)ï¼š&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hg clone https://bitbucket.org/sinbad/ogre ogre3d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åé¢æ˜¯æŒ‡å®šä¸‹è½½çš„æ–‡ä»¶å¤¹åå­—ï¼Œæ–‡ä»¶å¤§å°500Må·¦å³ï¼Œä¸‹è½½è¿‡ç¨‹æ¯”è¾ƒç¼“æ…¢ï¼Œå¯ä»¥åˆ°ç½‘ç›˜é‡Œé¢ä¸‹è½½ï¼š&lt;a href=&quot;http://pan.baidu.com/s/1hqyE8tu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ogre3d&lt;/a&gt;ï¼ŒåŒæ ·æŠŠè¯¥æ–‡ä»¶å¤¹æ”¾åˆ°OGREBuildé‡Œé¢ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CMakeå®‰è£…&lt;br&gt;é¦–å…ˆè¦å…ˆå®‰è£…cmakeï¼Œå®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒç½‘ä¸Šçš„ä¿¡æ¯ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œåœ¨ogre3dé‡Œé¢åˆ›å»ºä¸€ä¸ªbuildæ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œcmakeå‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lujbdeAir:ogre LJ$ mkdir build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lujbdeAir:ogre LJ$ cd build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lujbdeAir:build LJ$Â cmake -DCMAKE_CXX_FLAGS=&amp;quot;$&amp;#123;CMAKE_CXX_FLAGS&amp;#125; -v -stdlib=libc++ -std=c++11&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -D BOOST_ROOT=/Users/LJ/Desktop/OGREBuild/iOSDependencies/include/boost &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -D BOOST_INCLUDEDIR=/Users/LJ/Desktop/OGREBuild/iOSDependencies/include/boost &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -D BOOST_LIBRARYDIR=/Users/LJ/Desktop/OGREBuild/iOSDependencies/lib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -D OGRE_DEPENDENCIES_DIR=/Users/LJ/Desktop/OGREBuild/iOSDependencies -D OGRE_STATIC=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -D OGRE_BUILD_SAMPLES=0 -D OGRE_BUILD_PLATFORM_APPLE_IOS=1 -G Xcode ..&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç®€å•ä»‹ç»ä¸€ä¸‹cmakeé‡Œé¢çš„å‚æ•°ï¼š&lt;br&gt;DCMAKE_CXX_FLAGSçš„å€¼è¡¨ç¤ºæ”¯æŒc++11ï¼›BOOST_ROOTï¼ŒBOOST_INCLUDEDIRï¼ŒBOOST_LIBRARYDIRï¼ŒOGRE_DEPENDENCIES_DIRåˆ†åˆ«å¯¹åº”booståº“å’Œä¾èµ–åº“çš„è·¯å¾„ï¼›OGRE_STATIC=1è¡¨ç¤ºæˆ‘ä»¬æ„å»ºçš„æ˜¯é™æ€åº“ï¼ŒOGRE_BUILD_SAMPLESè¡¨ç¤ºæ˜¯å¦éœ€è¦æ„å»ºsampleå·¥ç¨‹ï¼Œç”±äºæˆ‘ä»¬åªæƒ³è¦buildå¯¹åº”çš„sdkï¼Œæ‰€ä»¥å°†è¯¥å€¼è®¾ä¸º0è¡¨ç¤ºä¸æ„å»ºsampleï¼›åŒæ—¶æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„å»ºiOSç‰ˆæœ¬çš„sdkï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®OGRE_BUILD_PLATFORM_APPLE_IOSï¼1ã€‚&lt;br&gt;â€ƒâ€ƒè¿è¡Œå®Œä¹‹åèƒ½çœ‹åˆ°åœ¨buildæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸ªOGREå·¥ç¨‹ï¼Œç‚¹å‡»OGRE.xcodeprojå°±å¯ä»¥å¼€å§‹ç¼–è¯‘æˆ‘ä»¬çš„sdkäº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼–è¯‘sdk&lt;br&gt;â€ƒâ€ƒåœ¨è¿è¡Œogreå·¥ç¨‹ä¹‹å‰ï¼Œéœ€è¦é…ç½®ä¸€äº›é€‰é¡¹ï¼Œç‚¹å‡»Product â†’ Scheme â†’ Edit Schemeï¼Œåˆ†åˆ«è®¾ç½®ALL_BUILDå’Œinstall targetçš„Build Configurationé€‰é¡¹ä¸ºreleaseï¼Œç„¶åè®¾ç½®é€‰æ‹©çš„targetä¸ºALL_BUILDã€‚æ¥ä¸‹æ¥å°±command+Bå¼€å§‹ç¼–è¯‘ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¹Ÿéœ€è¦èŠ±ç‚¹æ—¶é—´ï¼›buildæˆåŠŸä¹‹åï¼Œåœ¨é€‰æ‹©install targetï¼ŒåŒæ ·commandï¼‹Bç¼–è¯‘ï¼Œå®Œæˆä¹‹åä½ åº”è¯¥èƒ½å‘ç°æœ‰ä¸€ä¸ªsdkç›®å½•ï¼Œåˆ«å¿˜äº†è¿˜éœ€è¦æŠŠbuildç›®ä¸‹çš„libæ–‡ä»¶å¤¹å†…å®¹æ‹·è´åˆ°sdkçš„libæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™é‡Œé¢åŒ…å«çš„æ˜¯iOSè¿è¡Œæ—¶éœ€è¦ç”¨åˆ°çš„ä¸€äº›é™æ€åº“:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/sdk%E7%9B%AE%E5%BD%95.png&quot; alt=&quot;sdkç›®å½•&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºiOS demoå·¥ç¨‹&lt;br&gt;â€ƒâ€ƒç¼–è¯‘å®Œsdkä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„iOSå·¥ç¨‹äº†ï¼Œä¸ºäº†æ–¹ä¾¿å»ºç«‹ogreå·¥ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½ä¸€ä¸ª&lt;a href=&quot;http://sourceforge.net/projects/ogre/files/ogre-dependencies-mac/1.9/Ogre_Xcode4_Templates_20140408.pkg.zip/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Ogre_Xcode4_Templates&lt;/a&gt;ï¼Œå®‰è£…å®Œä¹‹åèƒ½çœ‹åˆ°åœ¨åˆ›å»ºXcodeå·¥ç¨‹æ—¶å¤šäº†ä¸€ä¸ªé€‰é¡¹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-08-26%20%E4%B8%8B%E5%8D%887.32.51.p.png&quot; alt=&quot;å±å¹•å¿«ç…§ 2015-08-26 ä¸‹åˆ7.32.51.png&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;ç‚¹å‡»nextä¾¿å¯ä»¥åˆ›å»ºä¸€ä¸ªiOSçš„ogreå·¥ç¨‹äº†,å¯ä»¥çœ‹åˆ°æ¨¡ç‰ˆå¸®æˆ‘ä»¬åˆ›å»ºäº†å¥½äº›æ–‡ä»¶ï¼ŒåŒ…æ‹¬OgreFrameworkå’ŒdemoAPPç­‰ï¼Œæƒ³è¦è¿è¡Œè¿˜éœ€è¦äº›é…ç½®ã€‚&lt;br&gt;æ‰“å¼€Build Settingsé€‰æ‹©â€+â€ add User-Defined Settingï¼Œæ–°å»ºOGRE_SDK_ROOTä¸ºsdkçš„è·¯å¾„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/OGRE_SDK_ROOT%E8%B7%AF%E5%BE%84.png&quot; alt=&quot;OGRE_SDK_ROOTè·¯å¾„&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;è®¾ç½®Header Search Paths:&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/Header%20Search%20Paths.png&quot; alt=&quot;Header Search Paths&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;è®¾ç½®Library Search Paths:&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/Library%20Search%20Paths.png&quot; alt=&quot;Library Search Paths&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;é…ç½®å®Œè¿™äº›å†…å®¹åï¼Œç‚¹å‡»è¿è¡Œåº”è¯¥å°±èƒ½çœ‹åˆ°åœ¨iPhoneä¸Šå‡ºç°äº†ogre3dçš„ç»å…¸æ¨¡å‹ç”»é¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/ogre.png&quot; alt=&quot;ogre&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹ogreå¼•æ“çš„ç ”ç©¶ä¹‹æ—…äº†ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒæœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨Macå¹³å°ä¸‹ç¼–è¯‘ä¸€ä»½å¯ä»¥åœ¨iOSä¸Šè¿è¡Œçš„ogre3då¼•æ“çš„sdkï¼Œ&lt;a href=&quot;http://www.ogre3d.org/&quot;&gt;OGRE&lt;/a&gt;ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå›¾å½¢å¼•æ“ï¼Œå¹¶ä¸”ä¹Ÿåªæ˜¯ä¸€ä¸ªå›¾å½¢å¼•æ“ï¼Œä¸åƒcocos2dxä¹‹ç±»çš„æ¸¸æˆå¼•æ“ï¼ŒåŒ…æ‹¬ç½‘ç»œï¼Œå£°éŸ³å’Œç‰©ç†ç¢°æ’ç­‰ç»„ä»¶ï¼ŒOGREåªä¸“æ³¨äºå›¾å½¢æ¸²æŸ“è¿™å—ï¼Œä¸è¿‡å¯ä»¥æ–¹ä¾¿çš„ç»“åˆå…¶å®ƒç»„ä»¶æ¥ç»„æˆä¸€ä¸ªæ¸¸æˆå¼•æ“ï¼Œå…·ä½“å¯ä»¥è‡ªå·±å»äº†è§£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&quot;ç¼–è¯‘OGRE3d&quot;&gt;&lt;a href=&quot;#ç¼–è¯‘OGRE3d&quot; class=&quot;headerlink&quot; title=&quot;ç¼–è¯‘OGRE3d&quot;&gt;&lt;/a&gt;ç¼–è¯‘OGRE3d&lt;/h4&gt;&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºæ”¾ç½®OGRE3Dé¡¹ç›®ï¼Œè¿™ä¸ªå¯ä»¥éšä¾¿æŒ‡å®šï¼Œæ¯”å¦‚æ”¾ç½®åœ¨æ¡Œé¢:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mkdir /Users/LJ/Desktop/OGREBuild&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹è½½Ogre3dä¾èµ–&lt;br&gt;ç¼–è¯‘ogreéœ€è¦é¦–å…ˆä¸‹è½½ç›¸å…³çš„ä¾èµ–åº“ï¼Œç”±äºæˆ‘ä»¬æƒ³è¦ç¼–è¯‘çš„æ˜¯è¿è¡Œåœ¨iOSä¸Šé¢çš„ï¼Œæ‰€ä»¥é€‰æ‹©ç°åœ¨iOSç›¸å…³çš„ä¾èµ–åº“,ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;http://sourceforge.net/projects/ogre/files/ogre-dependencies-mac/1.9/Ogre_iOS_7.0_Dependencies_20140315.dmg/download&quot;&gt;iOSDependencies&lt;/a&gt;ï¼Œæ‰“å¼€dmgå°†é‡Œé¢çš„æ–‡ä»¶å¤¹æ‹–åˆ°OGREBuildæ–‡ä»¶å¤¹é‡Œé¢ï¼›&lt;/li&gt;
&lt;li&gt;ä¸‹è½½ogre3dæºç &lt;br&gt;è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯1.9ç‰ˆæœ¬çš„ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å…‹éš†å¯¹åº”çš„æºç (è¦å…ˆå®‰è£…Mercurial)ï¼š&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hg clone https://bitbucket.org/sinbad/ogre ogre3d&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åé¢æ˜¯æŒ‡å®šä¸‹è½½çš„æ–‡ä»¶å¤¹åå­—ï¼Œæ–‡ä»¶å¤§å°500Må·¦å³ï¼Œä¸‹è½½è¿‡ç¨‹æ¯”è¾ƒç¼“æ…¢ï¼Œå¯ä»¥åˆ°ç½‘ç›˜é‡Œé¢ä¸‹è½½ï¼š&lt;a href=&quot;http://pan.baidu.com/s/1hqyE8tu&quot;&gt;ogre3d&lt;/a&gt;ï¼ŒåŒæ ·æŠŠè¯¥æ–‡ä»¶å¤¹æ”¾åˆ°OGREBuildé‡Œé¢ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CMakeå®‰è£…&lt;br&gt;é¦–å…ˆè¦å…ˆå®‰è£…cmakeï¼Œå®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒç½‘ä¸Šçš„ä¿¡æ¯ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œåœ¨ogre3dé‡Œé¢åˆ›å»ºä¸€ä¸ªbuildæ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œcmakeå‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
      <category term="OGRE" scheme="http://freemind-lj.github.io/tags/OGRE/"/>
    
  </entry>
  
  <entry>
    <title>method Swizzlingå®è·µ--alloc hooker</title>
    <link href="http://freemind-lj.github.io/2015/08/06/method-Swizzling%E5%AE%9E%E8%B7%B5-alloc-hooker/"/>
    <id>http://freemind-lj.github.io/2015/08/06/method-Swizzlingå®è·µ-alloc-hooker/</id>
    <published>2015-08-06T15:06:04.000Z</published>
    <updated>2016-02-15T04:07:15.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ã€‚è¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜ä¸»è¦æ˜¯åœ¨é¡¹ç›®é‡Œæ¶‰åŠåˆ°çš„ä¸€äº›å†…å­˜é—®é¢˜ï¼Œå…ˆè¯´è¯´è¿™ä¸ªé¡¹ç›®çš„æ•´ä½“ç»“æ„ï¼Œç”±äºè¦å®ç°è·¨å¹³å°çš„ç¼˜æ•…ï¼Œæ‰€ä»¥åœ¨æœ€é¡¶å±‚æ˜¯ç”±luaæ¥ç¼–å†™ç›¸å…³çš„ä¸šåŠ¡ä»£ç çš„ï¼Œå®ç°å®‰å“å’ŒiOSç«¯ä¸šåŠ¡çš„å¿«é€Ÿå¼€å‘ï¼Œä¸­é—´æ˜¯ä¸€å±‚ç»Ÿä¸€çš„c++æ¥å£ï¼Œç„¶åiOSè·Ÿå®‰å“æ ¹æ®è¿™ä»½ç»Ÿä¸€çš„c++æ¥å£å®ç°å„è‡ªå¹³å°çš„åº•å±‚é€»è¾‘ä»£ç ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªViewï¼Œc++çš„ç»Ÿä¸€æ¥å£ä¸ºï¼š &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void *createView(const char *type)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååˆ›å»ºviewç”±iOSè·Ÿå®‰å“å„è‡ªå»å®ç°ï¼ŒiOSç«¯å¯ä»¥å®ç°c++è·Ÿocçš„æ··åˆç¼–ç ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ocçš„ä»£ç ï¼Œç„¶åluaè°ƒç”¨c++å€Ÿç”±&lt;a href=&quot;http://www.ibm.com/developerworks/cn/aix/library/au-swig/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;swig&lt;/a&gt;å®ç°äº’è°ƒï¼Œè¿™ä¸ªæœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥è‡ªå·±å»æŒ‘é€‰åˆé€‚çš„ã€‚&lt;br&gt;â€ƒâ€ƒä¸‹é¢è¯´è¯´æ¡†æ¶ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œç”±äºè¿™ä¸­é—´æ¶‰åŠåˆ°luaï¼Œcï¼‹ï¼‹è·Ÿocçš„æ··åˆç¼–ç ï¼Œè€Œä¸”ocä½¿ç”¨çš„æ˜¯mrcæ–¹å¼(é¡¹ç›®å¼€å§‹çš„æ—¶é—´æ¯”è¾ƒæ—©)ï¼Œå› æ­¤å†…å­˜ç®¡ç†çš„é—®é¢˜å˜å¾—å°¤ä¸ºé‡è¦ã€‚æ­£å¸¸çš„å¤„ç†é€»è¾‘æ˜¯ï¼šåˆ›å»ºæ—¶ï¼Œluaè°ƒç”¨c++å»newä¸€ä¸ªocå¯¹è±¡ï¼›é‡Šæ”¾æ—¶ï¼Œluaè°ƒç”¨c++çš„ææ„å‡½æ•°ï¼Œç„¶ååœ¨ææ„å‡½æ•°é‡Œå®Œæˆocå¯¹è±¡çš„é‡Šæ”¾ã€‚ç„¶åæ€ä¹ˆç¡®ä¿è¿™äº›å¯¹è±¡æŒ‰ç…§è¿™ä¸ªé€»è¾‘è¢«é‡Šæ”¾æ‰äº†å‘¢ï½&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;â€ƒâ€ƒå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‡‡å–çš„ç­–ç•¥æ˜¯åœ¨æ¯ä¸ªå¯¹è±¡åˆ›å»ºçš„æ—¶å€™åšä¸€ä¸ªè®°å½•ï¼Œç„¶ååœ¨å¯¹è±¡è¢«æ¸…ç†çš„æ—¶å€™ä»è®°å½•ä¸­åˆ é™¤ï¼Œæœ€åçœ‹çœ‹è®°å½•ä¸­è¿˜æœ‰æ²¡æœ‰å¤šä½™çš„å¯¹è±¡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦éƒ½è¢«é‡Šæ”¾å®Œæ¯•(æˆ–è€…æœ‰å•¥æ–°çš„æ€è·¯ä¹Ÿå¯ä»¥æå‡ºæ¥å“ˆï½)ï¼Œå®ç°è¿™ä¸ªéœ€è¦å€ŸåŠ©ä¸¤ä¸ªä¸œè¥¿ï¼š&lt;a href=&quot;http://www.jianshu.com/p/b87fa689055f&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;method Swizzling&lt;/a&gt; å’Œ &lt;a href=&quot;http://www.cocoachina.com/industry/20140605/8683.html]&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSHashTable&lt;/a&gt;,method Swizzlingå¯ä»¥å‚è€ƒä¹‹å‰çš„åšå®¢ï¼ŒNSHashTableä¸»è¦åˆ©ç”¨å®ƒå¯ä»¥æŒæœ‰weakç±»å‹çš„æˆå‘˜å˜é‡ï¼ŒNSHashTableWeakMemoryè¡¨ç¤ºæ·»åŠ åˆ°è¯¥hash tableæ—¶å¹¶ä¸ä¼šå¢åŠ å¯¹è±¡çš„å¼•ç”¨æŠ€æœ¯ï¼Œå½“æ·»åŠ çš„å¯¹è±¡åœ¨å¤–éƒ¨è¢«é‡Šæ”¾æ—¶ï¼Œè¯¥tableä¼šè‡ªåŠ¨åˆ é™¤ç›¸åº”çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSHashTable *hashTable = [NSHashTable hashTableWithOptions: NSHashTableWeakMemory];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å› æ­¤å¯ä»¥çœ‹å‡ºå…·ä½“çš„å®ç°æ–¹å¼äº†ï¼šåˆ©ç”¨method Swizzlingå»hook nsobjectçš„initæ–¹æ³•ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°NSHashTableWeakMemoryå‹çš„NSHashTableï¼Œæœ€åçœ‹çœ‹è¯¥tableä¸­è¿˜æœ‰å“ªäº›å¯¹è±¡ï¼Œè¯æ˜è¿™äº›å¯¹è±¡è¿˜æ²¡æœ‰è¢«é‡Šæ”¾æ‰ï¼Œå¯ä»¥é€šè¿‡è¿™æ¥æ£€æµ‹æ•´ä¸ªå¯¹è±¡çš„åˆ›å»ºè·Ÿé‡Šæ”¾é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚&lt;br&gt;â€ƒâ€ƒä¸‹é¢ç»™å‡ºç¤ºä¾‹ä»£ç ï¼Œæ¯”å¦‚è¦è®°å½•UIViewå¯¹è±¡åˆ›å»ºè·Ÿé‡Šæ”¾ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;static NSHashTable *hashTable;//å­˜å‚¨åˆ›å»ºçš„å¯¹è±¡&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation UIView (AllocHook)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//method Swizzlingçš„æ–¹æ³•ï¼Œæˆ‘ä»¬hookè¯¥æ–¹æ³•ï¼Œå¹¶é¢å¤–å°†è¯¥å¯¹è±¡æ·»åŠ åˆ°NSHashTableä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(instancetype)customInit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (!hashTable) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        hashTable = [NSHashTable hashTableWithOptions:NSHashTableWeakMemory];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [hashTable addObject:self];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return [self customInit];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//ä¸€ä¸ªhookå¯¹è±¡ï¼Œç”¨äºå¼€å¯method Swizzling&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation ViewAllocHooker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-(void)startRecord&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Class class = [UIView class];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SEL originalSelector = @selector(init);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SEL swizzledSelector = @selector(customInit);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method originalMethod = class_getInstanceMethod(class, originalSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //äº¤æ¢åŸæ¥çš„initæ–¹æ³•è·Ÿæ–°çš„customInitæ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    method_exchangeImplementations(originalMethod, swizzledMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·æ¯ä¸ªè°ƒç”¨initæ–¹æ³•åˆ›å»ºçš„UIViewæˆ–å…¶å­ç±»éƒ½å°†è¢«è®°å½•åˆ°NSHashTableä¸­ï¼ŒåŒæ—¶ç”±äºè¯¥tableåªæ˜¯æŒæœ‰æ·»åŠ å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå› æ­¤å¯ä»¥åœ¨åé¢æŸ¥çœ‹è¯¥tableè¿˜æœ‰å“ªäº›å¯¹è±¡å°±å¯ä»¥ç¡®å®šè¿™äº›å¯¹è±¡è¿˜æ²¡è¢«é‡Šæ”¾ï¼Œä»¥éªŒè¯è¯¥æ¡†æ¶æ˜¯å¦æ­£ç¡®ã€‚è¯¦ç»†çš„ä¾‹å­ä»£ç å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;https://github.com/FreeMind-LJ/AllocHooker&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;github&lt;/a&gt;ï¼Œå…¶ä¸­çš„ViewAllocHookerå¯ä»¥é‡‡ç”¨å•ä¾‹ï¼Œç”±äºæ˜¯ç¤ºä¾‹ä»£ç å°±ä¸æ›´æ”¹äº†ï¼Œæœ‰å•¥æ”¹è¿›çš„åœ°æ–¹æ¬¢è¿æå‡ºï½ï½&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ã€‚è¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜ä¸»è¦æ˜¯åœ¨é¡¹ç›®é‡Œæ¶‰åŠåˆ°çš„ä¸€äº›å†…å­˜é—®é¢˜ï¼Œå…ˆè¯´è¯´è¿™ä¸ªé¡¹ç›®çš„æ•´ä½“ç»“æ„ï¼Œç”±äºè¦å®ç°è·¨å¹³å°çš„ç¼˜æ•…ï¼Œæ‰€ä»¥åœ¨æœ€é¡¶å±‚æ˜¯ç”±luaæ¥ç¼–å†™ç›¸å…³çš„ä¸šåŠ¡ä»£ç çš„ï¼Œå®ç°å®‰å“å’ŒiOSç«¯ä¸šåŠ¡çš„å¿«é€Ÿå¼€å‘ï¼Œä¸­é—´æ˜¯ä¸€å±‚ç»Ÿä¸€çš„c++æ¥å£ï¼Œç„¶åiOSè·Ÿå®‰å“æ ¹æ®è¿™ä»½ç»Ÿä¸€çš„c++æ¥å£å®ç°å„è‡ªå¹³å°çš„åº•å±‚é€»è¾‘ä»£ç ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªViewï¼Œc++çš„ç»Ÿä¸€æ¥å£ä¸ºï¼š &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;void *createView(const char *type)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååˆ›å»ºviewç”±iOSè·Ÿå®‰å“å„è‡ªå»å®ç°ï¼ŒiOSç«¯å¯ä»¥å®ç°c++è·Ÿocçš„æ··åˆç¼–ç ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ocçš„ä»£ç ï¼Œç„¶åluaè°ƒç”¨c++å€Ÿç”±&lt;a href=&quot;http://www.ibm.com/developerworks/cn/aix/library/au-swig/&quot;&gt;swig&lt;/a&gt;å®ç°äº’è°ƒï¼Œè¿™ä¸ªæœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥è‡ªå·±å»æŒ‘é€‰åˆé€‚çš„ã€‚&lt;br&gt;â€ƒâ€ƒä¸‹é¢è¯´è¯´æ¡†æ¶ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œç”±äºè¿™ä¸­é—´æ¶‰åŠåˆ°luaï¼Œcï¼‹ï¼‹è·Ÿocçš„æ··åˆç¼–ç ï¼Œè€Œä¸”ocä½¿ç”¨çš„æ˜¯mrcæ–¹å¼(é¡¹ç›®å¼€å§‹çš„æ—¶é—´æ¯”è¾ƒæ—©)ï¼Œå› æ­¤å†…å­˜ç®¡ç†çš„é—®é¢˜å˜å¾—å°¤ä¸ºé‡è¦ã€‚æ­£å¸¸çš„å¤„ç†é€»è¾‘æ˜¯ï¼šåˆ›å»ºæ—¶ï¼Œluaè°ƒç”¨c++å»newä¸€ä¸ªocå¯¹è±¡ï¼›é‡Šæ”¾æ—¶ï¼Œluaè°ƒç”¨c++çš„ææ„å‡½æ•°ï¼Œç„¶ååœ¨ææ„å‡½æ•°é‡Œå®Œæˆocå¯¹è±¡çš„é‡Šæ”¾ã€‚ç„¶åæ€ä¹ˆç¡®ä¿è¿™äº›å¯¹è±¡æŒ‰ç…§è¿™ä¸ªé€»è¾‘è¢«é‡Šæ”¾æ‰äº†å‘¢ï½&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>gité‡åˆ°çš„ä¸€äº›é—®é¢˜è§£å†³</title>
    <link href="http://freemind-lj.github.io/2015/07/21/git%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <id>http://freemind-lj.github.io/2015/07/21/gité‡åˆ°çš„ä¸€äº›é—®é¢˜è§£å†³/</id>
    <published>2015-07-21T07:27:01.000Z</published>
    <updated>2016-02-15T03:41:27.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨ä½¿ç”¨git cloneä»£ç çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç°åœ¨è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªæ‹‰å–æœ€æ–°ç‰ˆæœ¬&lt;br&gt;å› ä¸ºè¦cloneçš„ä»£ç å¤šè¾¾4ã€5ä¸ªGï¼Œåœ¨åŠ ä¸Šé‡Œé¢çš„åˆ†æ”¯ä»¥åŠå†å²å¤ªå¤šï¼Œå› æ­¤ç›´æ¥ç”¨git clone å‘½ä»¤å»å…‹éš†çš„æ—¶å€™ç»å¸¸å¯¼è‡´æœåŠ¡ç«¯å†…å­˜çˆ†æ»¡ï¼Œcloneä¸ä¸‹æ¥ã€‚å¦‚æœä¸éœ€è¦å»å…³æ³¨ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åªcloneæœ€æ–°çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone --depth=1 git://serverRepo myRepo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·å°±åªæ‹‰å–é»˜è®¤åˆ†æ”¯çš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è·å–æŸä¸ªå…·ä½“çš„åˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨branch å‘½ä»¤ï¼Œæ‹‰å–æŸä¸ªåˆ†æ”¯çš„æœ€æ–°ç‰ˆæœ¬ä»£ç ï¼Œæ¯”å¦‚è¦è·å–release/1.6.0åˆ†æ”¯çš„ä»£ç  :&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone -b release/1.6.0 --depth=1 git://serverRepo myRepo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;fatal: The remote end hung up unexpectedly&lt;br&gt;åœ¨cloneåˆ†æ”¯çš„æ—¶å€™å¯èƒ½ä¼šå¤±è´¥ï¼Œæ¯”å¦‚early EOFï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;center&gt;&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/clone%E5%A4%B1%E8%B4%A5.png&quot; alt=&quot;cloneå¤±è´¥&quot;&gt;&lt;br&gt;&lt;/center&gt;&lt;br&gt;è§£å†³çš„åŠæ³•æ˜¯ä½¿ç”¨sshåè®®å»cloneï¼Œè€Œä¸æ˜¯httpåè®®ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨ä½¿ç”¨git cloneä»£ç çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç°åœ¨è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªæ‹‰å–æœ€æ–°ç‰ˆæœ¬&lt;br&gt;å› ä¸ºè¦cloneçš„ä»£ç å¤šè¾¾4ã€5ä¸ªGï¼Œåœ¨åŠ ä¸Šé‡Œé¢çš„åˆ†æ”¯ä»¥åŠå†å²å¤ªå¤šï¼Œå› æ­¤ç›´æ¥ç”¨git clone å‘½ä»¤å»å…‹éš†çš„æ—¶å€™ç»å¸¸å¯¼è‡´æœåŠ¡ç«¯å†…å­˜çˆ†æ»¡ï¼Œcloneä¸ä¸‹
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘ä¹‹ï¼ï¼ DNSè§£æ(ç½‘ç»œåˆ‡æ¢çš„é—®é¢˜è§£å†³)</title>
    <link href="http://freemind-lj.github.io/2015/06/18/iOS%E5%BC%80%E5%8F%91%E4%B9%8B%EF%BC%8D%EF%BC%8D-DNS%E8%A7%A3%E6%9E%90-%E7%BD%91%E7%BB%9C%E5%88%87%E6%8D%A2%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <id>http://freemind-lj.github.io/2015/06/18/iOSå¼€å‘ä¹‹ï¼ï¼-DNSè§£æ-ç½‘ç»œåˆ‡æ¢çš„é—®é¢˜è§£å†³/</id>
    <published>2015-06-18T08:28:20.000Z</published>
    <updated>2016-02-15T01:44:19.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒä¸Šæ¬¡æåˆ°è¿‡ç”±äºç”µä¿¡çš„é—®é¢˜éœ€è¦è‡ªå·±æ‰‹åŠ¨å»è§£ædnsï¼Œ&lt;a href=&quot;http://www.jianshu.com/p/7c89b8c5482a&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;ä»‹ç»çš„æ˜¯å¦‚ä½•æ‹¦æˆª&lt;br&gt;æ¯ä¸€ä¸ªè¯·æ±‚åšè§£æï¼Œä½†æ˜¯æ²¡æœ‰è¯´å…·ä½“çš„è§£ææ–¹æ³•ï¼Œä¸‹é¢ç®€å•çš„è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;res_queryæ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int res_query(char *domain_name, int class, int type, char *answer_buffer, int answer_buffer_length)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ˜¯æ¯”è¾ƒå¸¸è§çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™éœ€è¦åœ¨Xcodeä¸­æ·»åŠ libresolv.dylibï¼Œç„¶ååŒ…å«resolv.hå¤´æ–‡ä»¶å³å¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;unsigned char res[512];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int nBytesRead = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è°ƒç”¨ç³»ç»Ÿæ–¹æ³•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nBytesRead = res_query(&amp;quot;www.baidu.com&amp;quot;, ns_c_in, ns_t_a, res, sizeof(res));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ns_msg handle;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ns_initparse(res, nBytesRead, &amp;amp;handle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSMutableArray *ipList = nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int msg_count = ns_msg_count(handle, ns_s_an);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if (msg_count &amp;gt; 0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ipList = [[NSMutableArray alloc] initWithCapacity:msg_count];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    for(int rrnum = 0; rrnum &amp;lt; msg_count; rrnum++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ns_rr rr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //è§£æç»“æœ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if(ns_parserr(&amp;amp;handle, ns_s_an, rrnum, &amp;amp;rr) == 0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            char ip1[16];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            strcpy(ip1, inet_ntoa(*(struct in_addr *)ns_rr_rdata(rr)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            NSString *ipString = [[NSString alloc] initWithCString:ip1 encoding:NSASCIIStringEncoding];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if (![ipString isEqualToString:@&amp;quot;&amp;quot;]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                //å°†æå–åˆ°çš„IPåœ°å€æ”¾åˆ°æ•°ç»„ä¸­&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                [ipList addObject:ipString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶è€Œè¯¥æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç½‘ç»œä»2/3Gå’ŒWI-FIä¹‹é—´åˆ‡æ¢çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•ç»å¸¸ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ–è€…éœ€è¦ç­‰å¾…è¾ƒé•¿çš„æ—¶é—´ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gethostbyname&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;struct hostent *gethostbyname(const char *hostName);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; å…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;struct hostent *host = gethostbyname(&amp;quot;www.google.com.hk&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct in_addr **list = (struct in_addr **)host-&amp;gt;h_addr_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//è·å–IPåœ°å€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *ip= [NSString stringWithCString:inet_ntoa(*list[0]) encoding:NSUTF8StringEncoding];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&amp;quot;ip address is : %@&amp;quot;,ip);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹æ³•åœ¨ç¢°åˆ°åˆ‡æ¢ç½‘ç»œçš„æ—¶å€™ï¼Œå‡ºç°å¤±è´¥çš„æƒ…å†µæ¯”ä¸Šé¢çš„æ–¹æ³•å¥½å¤šäº†ï¼Œä½†å¶å°”ä¹Ÿè¿˜æ˜¯ä¼šå‡ºç°ï¼Œæ˜¯æ—¶å€™é‡‡ç”¨è‹¹æœè‡ªå·±çš„æ–¹æ³•äº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CFHostStartInfoResolution&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Boolean CFHostStartInfoResolution (CFHostRef theHost, CFHostInfoType info, CFStreamError *error);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Boolean result,bResolved;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFHostRef hostRef;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFArrayRef addresses = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFStringRef hostNameRef = CFStringCreateWithCString(kCFAllocatorDefault, &amp;quot;www.google.com.hk&amp;quot;, kCFStringEncodingASCII);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hostRef = CFHostCreateWithName(kCFAllocatorDefault, hostNameRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if (hostRef) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = CFHostStartInfoResolution(hostRef, kCFHostAddresses, NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (result == TRUE) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        addresses = CFHostGetAddressing(hostRef, &amp;amp;result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bResolved = result == TRUE ? true : false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if(bResolved)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    struct sockaddr_in* remoteAddr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    for(int i = 0; i &amp;lt; CFArrayGetCount(addresses); i++)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CFDataRef saData = (CFDataRef)CFArrayGetValueAtIndex(addresses, i);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        remoteAddr = (struct sockaddr_in*)CFDataGetBytePtr(saData);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if(remoteAddr != NULL)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //è·å–IPåœ°å€&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            char ip[16];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            strcpy(ip, inet_ntoa(remoteAddr-&amp;gt;sin_addr));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFRelease(hostNameRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFRelease(hostRef);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…·ä½“çš„demoå¯ä»¥åˆ°&lt;a href=&quot;https://github.com/FreeMind-LJ/DNSTest&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è¿™é‡Œ&lt;/a&gt;çœ‹çœ‹&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒä¸Šæ¬¡æåˆ°è¿‡ç”±äºç”µä¿¡çš„é—®é¢˜éœ€è¦è‡ªå·±æ‰‹åŠ¨å»è§£ædnsï¼Œ&lt;a href=&quot;http://www.jianshu.com/p/7c89b8c5482a&quot;&gt;è¿™é‡Œ&lt;/a&gt;ä»‹ç»çš„æ˜¯å¦‚ä½•æ‹¦æˆª&lt;br&gt;æ¯ä¸€ä¸ªè¯·æ±‚åšè§£æï¼Œä½†æ˜¯æ²¡æœ‰è¯´å…·ä½“çš„è§£ææ–¹æ³•ï¼Œä¸‹é¢ç®€å•çš„è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;res_queryæ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int res_query(char *domain_name, int class, int type, char *answer_buffer, int answer_buffer_length)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ˜¯æ¯”è¾ƒå¸¸è§çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™éœ€è¦åœ¨Xcodeä¸­æ·»åŠ libresolv.dylibï¼Œç„¶ååŒ…å«resolv.hå¤´æ–‡ä»¶å³å¯ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘ä¹‹--- NSURLProtocol</title>
    <link href="http://freemind-lj.github.io/2015/06/16/iOS%E5%BC%80%E5%8F%91%E4%B9%8B-NSURLProtocol/"/>
    <id>http://freemind-lj.github.io/2015/06/16/iOSå¼€å‘ä¹‹-NSURLProtocol/</id>
    <published>2015-06-16T03:29:55.000Z</published>
    <updated>2016-02-15T03:40:22.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®é‡Œç”±äºç”µä¿¡é‚£è¾¹å‘ç”Ÿdnså‘ç”ŸåŸŸååŠ«æŒï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å°†URLè¯·æ±‚çš„åŸŸåé‡å®šå‘åˆ°æŒ‡å®šçš„IPåœ°å€ï¼Œä½†æ˜¯ç”±äºè¯·æ±‚å¯èƒ½æ˜¯é€šè¿‡NSURLConnection,NSURLSessionæˆ–è€…AFNetworkingç­‰æ–¹å¼ï¼Œå› æ­¤è¦æƒ³ç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼Œä¸€å¼€å§‹æ˜¯æƒ³é€šè¿‡Method Swizzlingå»hook cfnetworkingåº•å±‚æ–¹æ³•ï¼Œåæ¥å‘ç°å…¶å®æœ‰ä¸ªæ›´å¥½çš„æ–¹æ³•â€“NSURLProtocolã€‚&lt;/p&gt;
&lt;h2 id=&quot;NSURLProtocol&quot;&gt;&lt;a href=&quot;#NSURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;NSURLProtocol&quot;&gt;&lt;/a&gt;NSURLProtocol&lt;/h2&gt;&lt;p&gt;â€ƒâ€ƒNSURLProtocolèƒ½å¤Ÿè®©ä½ å»é‡æ–°å®šä¹‰è‹¹æœçš„&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165-BCICJDHA&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;URLåŠ è½½ç³»ç»Ÿ&lt;/a&gt; (URL Loading System)çš„è¡Œä¸ºï¼ŒURL Loading Systemé‡Œæœ‰è®¸å¤šç±»ç”¨äºå¤„ç†URLè¯·æ±‚ï¼Œæ¯”å¦‚NSURLï¼ŒNSURLRequestï¼ŒNSURLConnectionå’ŒNSURLSessionç­‰ï¼Œå½“URL Loading Systemä½¿ç”¨NSURLRequestå»è·å–èµ„æºçš„æ—¶å€™ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªNSURLProtocolå­ç±»çš„å®ä¾‹ï¼Œä½ ä¸åº”è¯¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªNSURLProtocolï¼ŒNSURLProtocolçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªåè®®ï¼Œä½†å…¶å®è¿™æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”å¿…é¡»ä½¿ç”¨è¯¥ç±»çš„å­ç±»ï¼Œå¹¶ä¸”éœ€è¦è¢«æ³¨å†Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;/a&gt;ä½¿ç”¨åœºæ™¯&lt;/h2&gt;&lt;p&gt;â€ƒâ€ƒä¸ç®¡ä½ æ˜¯é€šè¿‡UIWebView, NSURLConnection æˆ–è€…ç¬¬ä¸‰æ–¹åº“ (AFNetworking, MKNetworkKitç­‰)ï¼Œä»–ä»¬éƒ½æ˜¯åŸºäºNSURLConnectionæˆ–è€… NSURLSessionå®ç°çš„ï¼Œå› æ­¤ä½ å¯ä»¥é€šè¿‡NSURLProtocolåšè‡ªå®šä¹‰çš„æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å®šå‘ç½‘ç»œè¯·æ±‚&lt;/li&gt;
&lt;li&gt;å¿½ç•¥ç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰ç½‘ç»œè¯·æ±‚çš„è¿”å›ç»“æœ&lt;/li&gt;
&lt;li&gt;ä¸€äº›å…¨å±€çš„ç½‘ç»œè¯·æ±‚è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;æ‹¦æˆªç½‘ç»œè¯·æ±‚&quot;&gt;&lt;a href=&quot;#æ‹¦æˆªç½‘ç»œè¯·æ±‚&quot; class=&quot;headerlink&quot; title=&quot;æ‹¦æˆªç½‘ç»œè¯·æ±‚&quot;&gt;&lt;/a&gt;æ‹¦æˆªç½‘ç»œè¯·æ±‚&lt;/h2&gt;&lt;h4 id=&quot;å­ç±»åŒ–NSURLProtocolå¹¶æ³¨å†Œ&quot;&gt;&lt;a href=&quot;#å­ç±»åŒ–NSURLProtocolå¹¶æ³¨å†Œ&quot; class=&quot;headerlink&quot; title=&quot;å­ç±»åŒ–NSURLProtocolå¹¶æ³¨å†Œ&quot;&gt;&lt;/a&gt;å­ç±»åŒ–NSURLProtocolå¹¶æ³¨å†Œ&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@interface CustomURLProtocol : NSURLProtocol&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨application:didFinishLaunchingWithOptions:æ–¹æ³•ä¸­æ³¨å†Œè¯¥CustomURLProtocolï¼Œä¸€æ—¦æ³¨å†Œå®Œæ¯•åï¼Œå®ƒå°±æœ‰æœºä¼šæ¥å¤„ç†æ‰€æœ‰äº¤ä»˜ç»™URL Loading systemçš„ç½‘ç»œè¯·æ±‚ã€‚&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ³¨å†Œprotocol&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [NSURLProtocol registerClass:[CustomURLProtocol class]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;å®ç°CustomURLProtocol&quot;&gt;&lt;a href=&quot;#å®ç°CustomURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;å®ç°CustomURLProtocol&quot;&gt;&lt;/a&gt;å®ç°CustomURLProtocol&lt;/h4&gt;&lt;p&gt;æ³¨å†Œå¥½äº†ä¹‹åï¼Œç°åœ¨å¯ä»¥å¼€å§‹å®ç°NSURLProtocolçš„ä¸€äº›æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;+canInitWithRequest:&lt;br&gt;è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯è¯´æ˜ä½ æ˜¯å¦æ‰“ç®—å¤„ç†å¯¹åº”çš„requestï¼Œå¦‚æœä¸æ‰“ç®—å¤„ç†ï¼Œè¿”å›NOï¼ŒURL Loading Systemä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„è¡Œä¸ºå»å¤„ç†ï¼›å¦‚æœæ‰“ç®—å¤„ç†ï¼Œè¿”å›YESï¼Œç„¶åä½ å°±éœ€è¦å¤„ç†è¯¥è¯·æ±‚çš„æ‰€æœ‰ä¸œè¥¿ï¼ŒåŒ…æ‹¬è·å–è¯·æ±‚æ•°æ®å¹¶è¿”å›ç»™ URL Loading Systemã€‚ç½‘ç»œæ•°æ®å¯ä»¥ç®€å•çš„é€šè¿‡NSURLConnectionå»è·å–ï¼Œè€Œä¸”æ¯ä¸ªNSURLProtocolå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªNSURLProtocolClientå®ä¾‹ï¼Œå¯ä»¥é€šè¿‡è¯¥clientå°†è·å–åˆ°çš„æ•°æ®è¿”å›ç»™URL Loading Systemã€‚&lt;br&gt;è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ å»åŠ è½½ä¸€ä¸ªURLèµ„æºçš„æ—¶å€™ï¼ŒURL Loading Systemä¼šè¯¢é—®CustomURLProtocolæ˜¯å¦èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œä½ è¿”å›YESï¼Œç„¶åURL Loading Systemä¼šåˆ›å»ºä¸€ä¸ªCustomURLProtocolå®ä¾‹ç„¶åè°ƒç”¨NSURLConnectionå»è·å–æ•°æ®ï¼Œç„¶è€Œè¿™ä¹Ÿä¼šè°ƒç”¨URL Loading Systemï¼Œè€Œä½ åœ¨+canInitWithRequest:ä¸­åˆæ€»æ˜¯è¿”å›YESï¼Œè¿™æ ·URL Loading Systemåˆä¼šåˆ›å»ºä¸€ä¸ªCustomURLProtocolå®ä¾‹å¯¼è‡´æ— é™å¾ªç¯ã€‚æˆ‘ä»¬åº”è¯¥ä¿è¯æ¯ä¸ªrequeståªè¢«å¤„ç†ä¸€æ¬¡ï¼Œå¯ä»¥é€šè¿‡+setProperty:forKey:inRequest:æ ‡ç¤ºé‚£äº›å·²ç»å¤„ç†è¿‡çš„requestï¼Œç„¶ååœ¨+canInitWithRequest:ä¸­æŸ¥è¯¢è¯¥requestæ˜¯å¦å·²ç»å¤„ç†è¿‡äº†ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›NOã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (BOOL)canInitWithRequest:(NSURLRequest *)request&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //åªå¤„ç†httpå’Œhttpsè¯·æ±‚&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *scheme = [[request URL] scheme];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ( ([scheme caseInsensitiveCompare:@&amp;quot;http&amp;quot;] == NSOrderedSame ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [scheme caseInsensitiveCompare:@&amp;quot;https&amp;quot;] == NSOrderedSame))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //çœ‹çœ‹æ˜¯å¦å·²ç»å¤„ç†è¿‡äº†ï¼Œé˜²æ­¢æ— é™å¾ªç¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if ([NSURLProtocol propertyForKey:URLProtocolHandledKey inRequest:request]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return NO;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return NO;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;+canonicalRequestForRequest:&lt;br&gt;é€šå¸¸è¯¥æ–¹æ³•ä½ å¯ä»¥ç®€å•çš„ç›´æ¥è¿”å›requestï¼Œä½†ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹requestï¼Œæ¯”å¦‚æ·»åŠ headerï¼Œä¿®æ”¹hostç­‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„requestï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (NSURLRequest *) canonicalRequestForRequest:(NSURLRequest *)request &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSMutableURLRequest *mutableReqeust = [request mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mutableReqeust = [self redirectHostInRequset:mutableReqeust];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return mutableReqeust;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(NSMutableURLRequest*)redirectHostInRequset:(NSMutableURLRequest*)request&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ([request.URL host].length == 0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return request;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *originUrlString = [request.URL absoluteString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *originHostString = [request.URL host];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSRange hostRange = [originUrlString rangeOfString:originHostString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (hostRange.location == NSNotFound) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return request;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å®šå‘åˆ°bingæœç´¢ä¸»é¡µ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *ip = @&amp;quot;cn.bing.com&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // æ›¿æ¢åŸŸå&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSString *urlString = [originUrlString stringByReplacingCharactersInRange:hostRange withString:ip];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSURL *url = [NSURL URLWithString:urlString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    request.URL = url;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return request;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;+requestIsCacheEquivalent:toRequest:&lt;br&gt;ä¸»è¦åˆ¤æ–­ä¸¤ä¸ªrequestæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒçš„è¯å¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œé€šå¸¸åªéœ€è¦è°ƒç”¨çˆ¶ç±»çš„å®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return [super requestIsCacheEquivalent:a toRequest:b];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;-startLoading  -stopLoading&lt;br&gt;è¿™ä¸¤ä¸ªæ–¹æ³•ä¸»è¦æ˜¯å¼€å§‹å’Œå–æ¶ˆç›¸åº”çš„requestï¼Œè€Œä¸”éœ€è¦æ ‡ç¤ºé‚£äº›å·²ç»å¤„ç†è¿‡çš„requestã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void)startLoading&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NSMutableURLRequest *mutableReqeust = [[self request] mutableCopy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ ‡ç¤ºæ”¹requestå·²ç»å¤„ç†è¿‡äº†ï¼Œé˜²æ­¢æ— é™å¾ªç¯&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [NSURLProtocol setProperty:@YES forKey:URLProtocolHandledKey inRequest:mutableReqeust];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.connection = [NSURLConnection connectionWithRequest:mutableReqeust delegate:self];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)stopLoading&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.connection cancel];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;NSURLConnectionDataDelegateæ–¹æ³•&lt;br&gt;åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ—¶å€™ä¼šè°ƒç”¨åˆ°è¯¥ä»£ç†æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å°†æ”¶åˆ°çš„æ¶ˆæ¯é€šè¿‡clientè¿”å›ç»™URL Loading Systemã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (void) connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageNotAllowed];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void) connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.client URLProtocol:self didLoadData:data];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void) connectionDidFinishLoading:(NSURLConnection *)connection &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.client URLProtocolDidFinishLoading:self];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self.client URLProtocol:self didFailWithError:error];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç°åœ¨ä½ å·²ç»å¯ä»¥æˆªå–requestå¹¶åšä½ æƒ³åšçš„äº‹äº†ï¼Œè¿™é‡Œæœ‰ä¸ª&lt;a href=&quot;https://github.com/FreeMind-LJ/NSURLProtocolExample&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;demo&lt;/a&gt;å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œæˆªå–requestå¹¶é‡æ–°å®šå‘åˆ°æ–°çš„åœ°å€ï¼Œå…·ä½“dnsè§£ææ–¹æ³•å¯ä»¥å‚çœ‹&lt;a href=&quot;http://freemind-lj.github.io/2015/06/18/iOSå¼€å‘ä¹‹ï¼ï¼-DNSè§£æ-ç½‘ç»œåˆ‡æ¢çš„é—®é¢˜è§£å†³/&quot;&gt;DNSè§£æ)&lt;/a&gt; ï¼Œå¦‚æœ‰ä¸å¯¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå“ˆï½&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®é‡Œç”±äºç”µä¿¡é‚£è¾¹å‘ç”Ÿdnså‘ç”ŸåŸŸååŠ«æŒï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å°†URLè¯·æ±‚çš„åŸŸåé‡å®šå‘åˆ°æŒ‡å®šçš„IPåœ°å€ï¼Œä½†æ˜¯ç”±äºè¯·æ±‚å¯èƒ½æ˜¯é€šè¿‡NSURLConnection,NSURLSessionæˆ–è€…AFNetworkingç­‰æ–¹å¼ï¼Œå› æ­¤è¦æƒ³ç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼Œä¸€å¼€å§‹æ˜¯æƒ³é€šè¿‡Method Swizzlingå»hook cfnetworkingåº•å±‚æ–¹æ³•ï¼Œåæ¥å‘ç°å…¶å®æœ‰ä¸ªæ›´å¥½çš„æ–¹æ³•â€“NSURLProtocolã€‚&lt;/p&gt;
&lt;h2 id=&quot;NSURLProtocol&quot;&gt;&lt;a href=&quot;#NSURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;NSURLProtocol&quot;&gt;&lt;/a&gt;NSURLProtocol&lt;/h2&gt;&lt;p&gt;â€ƒâ€ƒNSURLProtocolèƒ½å¤Ÿè®©ä½ å»é‡æ–°å®šä¹‰è‹¹æœçš„&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165-BCICJDHA&quot;&gt;URLåŠ è½½ç³»ç»Ÿ&lt;/a&gt; (URL Loading System)çš„è¡Œä¸ºï¼ŒURL Loading Systemé‡Œæœ‰è®¸å¤šç±»ç”¨äºå¤„ç†URLè¯·æ±‚ï¼Œæ¯”å¦‚NSURLï¼ŒNSURLRequestï¼ŒNSURLConnectionå’ŒNSURLSessionç­‰ï¼Œå½“URL Loading Systemä½¿ç”¨NSURLRequestå»è·å–èµ„æºçš„æ—¶å€™ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªNSURLProtocolå­ç±»çš„å®ä¾‹ï¼Œä½ ä¸åº”è¯¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªNSURLProtocolï¼ŒNSURLProtocolçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªåè®®ï¼Œä½†å…¶å®è¿™æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”å¿…é¡»ä½¿ç”¨è¯¥ç±»çš„å­ç±»ï¼Œå¹¶ä¸”éœ€è¦è¢«æ³¨å†Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;/a&gt;ä½¿ç”¨åœºæ™¯&lt;/h2&gt;&lt;p&gt;â€ƒâ€ƒä¸ç®¡ä½ æ˜¯é€šè¿‡UIWebView, NSURLConnection æˆ–è€…ç¬¬ä¸‰æ–¹åº“ (AFNetworking, MKNetworkKitç­‰)ï¼Œä»–ä»¬éƒ½æ˜¯åŸºäºNSURLConnectionæˆ–è€… NSURLSessionå®ç°çš„ï¼Œå› æ­¤ä½ å¯ä»¥é€šè¿‡NSURLProtocolåšè‡ªå®šä¹‰çš„æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å®šå‘ç½‘ç»œè¯·æ±‚&lt;/li&gt;
&lt;li&gt;å¿½ç•¥ç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰ç½‘ç»œè¯·æ±‚çš„è¿”å›ç»“æœ&lt;/li&gt;
&lt;li&gt;ä¸€äº›å…¨å±€çš„ç½‘ç»œè¯·æ±‚è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="tech" scheme="http://freemind-lj.github.io/categories/tech/"/>
    
    
      <category term="iOSå¼€å‘" scheme="http://freemind-lj.github.io/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Xcodeä¸­ç»Ÿè®¡ä»£ç è¦†ç›–ç‡</title>
    <link href="http://freemind-lj.github.io/2015/06/11/Xcode%E4%B8%AD%E7%BB%9F%E8%AE%A1%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87/"/>
    <id>http://freemind-lj.github.io/2015/06/11/Xcodeä¸­ç»Ÿè®¡ä»£ç è¦†ç›–ç‡/</id>
    <published>2015-06-11T11:31:20.000Z</published>
    <updated>2016-02-15T03:30:28.000Z</updated>
    
    <content type="html">&lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®é‡Œéœ€è¦åœ¨å•å…ƒæµ‹è¯•æ—¶ç»Ÿè®¡ä¸€ä¸‹&lt;a href=&quot;http://www.cnblogs.com/coderzh/archive/2009/03/29/1424344.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ä»£ç è¦†ç›–ç‡&lt;/a&gt;ï¼Œå…¶å®å°±æ˜¯è¢«ç”¨æ¥ä½œä¸ºæµ‹é‡å•å…ƒæµ‹è¯•çš„æŒ‡æ ‡ï¼Œçœ‹çœ‹æµ‹è¯•çš„ä»£ç è¦†ç›–åˆ°å¤šå¹¿çš„èŒƒå›´ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç»Ÿè®¡å•å…ƒæµ‹è¯•çš„ä»£ç è¦†ç›–ç‡ï¼š&lt;/p&gt;
&lt;h4 id=&quot;ä¸‹è½½å·¥å…·&quot;&gt;&lt;a href=&quot;#ä¸‹è½½å·¥å…·&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½å·¥å…·&quot;&gt;&lt;/a&gt;ä¸‹è½½å·¥å…·&lt;/h4&gt;&lt;p&gt;â€ƒâ€ƒä¸»è¦é‡‡ç”¨&lt;a href=&quot;https://github.com/jonreid/XcodeCoverage&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;XcodeCoverage&lt;/a&gt;å·¥å…·ï¼Œå®ƒå¯ä»¥å°†ä»£ç è¦†ç›–çš„ç»“æœä»¥htmlçš„å½¢å¼å±•ç°ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ï¼Œå¯ä»¥é‡‡ç”¨podçš„æ–¹å¼å®‰è£…:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;XcodeCoverage&amp;apos;, &amp;apos;~&amp;gt;1.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;å·¥ç¨‹é…ç½®&quot;&gt;&lt;a href=&quot;#å·¥ç¨‹é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;å·¥ç¨‹é…ç½®&quot;&gt;&lt;/a&gt;å·¥ç¨‹é…ç½®&lt;/h4&gt;&lt;p&gt;podå®‰è£…åéœ€è¦é…ç½®å·¥ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½® Build Settings&lt;br&gt;éœ€è¦è®¾ç½®ä¸¤ä¸ªåœ°æ–¹ï¼Œæ‰¾åˆ° â€œGenerate Test Coverage Filesâ€å’Œâ€œInstrument Program Flowâ€ä¸¤ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«è®¾ç½®Debugä¸‹ä¸ºYESï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;![&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-06-11%20.jpeg&quot; alt=&quot;å±å¹•å¿«ç…§ 2015-06-11 ä¸‹åˆ5.47.01.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;](&lt;a href=&quot;http://upload-images.jianshu.io/upload_images/458529-ad6665fef33cbe69.png&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://upload-images.jianshu.io/upload_images/458529-ad6665fef33cbe69.png&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½® Build Phases&lt;br&gt;ç‚¹å‡»New Run Script Phaseï¼Œç¼–è¾‘ä½¿å…¶è¿è¡ŒPods/XcodeCoverage/exportenv.shè„šæœ¬ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E6%B7%BB%E5%8A%A0%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC.jpeg&quot; alt=&quot;æ·»åŠ è¿è¡Œè„šæœ¬&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;RUN&quot;&gt;&lt;a href=&quot;#RUN&quot; class=&quot;headerlink&quot; title=&quot;RUN&quot;&gt;&lt;/a&gt;RUN&lt;/h4&gt;&lt;p&gt;å·¥ç¨‹é…ç½®å®Œåï¼Œå¼€å§‹è·‘å•å…ƒæµ‹è¯•ä¾‹ã€‚è·‘å®Œæµ‹è¯•ä¾‹åï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œcdè¿›å…¥åˆ°XcodeCoverageç›®å½•ï¼Œè¿è¡Œå¦‚ä¸‹è„šæœ¬ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./getcov --show&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åä½ å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ä½ çš„ä»£ç è¦†ç›–ç‡ç»“æœã€‚&lt;/p&gt;
&lt;h4 id=&quot;example&quot;&gt;&lt;a href=&quot;#example&quot; class=&quot;headerlink&quot; title=&quot;example&quot;&gt;&lt;/a&gt;example&lt;/h4&gt;&lt;p&gt;ä¸‹é¢å‡è®¾ä½ è¦æµ‹è¯•ä¸€ä¸ªgetMaxNumberåŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@implementation MaxNumber&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+(int)getMaxNumber:(int)a b:(int)b c:(int)c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if(a &amp;gt; b)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if(a &amp;gt; c)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return a;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;else&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;else&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if(b &amp;gt; c)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;else&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é¦–å…ˆæ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(void)testGetMax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XCTAssertEqual(3, [MaxNumber getMaxNumber:1 b:2 c:3]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿è¡Œå®Œè¯¥æµ‹è¯•ä¾‹åï¼Œè¿è¡Œè„šæœ¬./getcov â€“showï¼Œä¾¿å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E4%B8%8D%E5%AE%8C%E5%85%A8%E8%A6%86%E7%9B%96.jpeg&quot; alt=&quot;ä¸å®Œå…¨è¦†ç›–&quot;&gt;&lt;br&gt;å…¶ä¸­çš„çº¢è‰²è¡¨ç¤ºæµ‹è¯•ä¾‹æ²¡æœ‰è¦†ç›–åˆ°çš„åœ°æ–¹ã€‚ä¸‹é¢å¢åŠ ä¸‰ä¸ªæµ‹è¯•ä¾‹&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-(void)testGetMax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XCTAssertEqual(3, [MaxNumber getMaxNumber:1 b:2 c:3]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XCTAssertEqual(3, [MaxNumber getMaxNumber:2 b:1 c:3]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XCTAssertEqual(3, [MaxNumber getMaxNumber:3 b:2 c:1]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    XCTAssertEqual(3, [MaxNumber getMaxNumber:1 b:3 c:2]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æµ‹è¯•ä¾‹ä¿®æ”¹ä¹‹åï¼Œéœ€è¦å…ˆè¿è¡Œcleancovè„šæœ¬(å¦‚æœå·¥ç¨‹é‡Œé¢çš„ä»£ç ä¿®æ”¹äº†ï¼Œéœ€è¦clean product)ï¼Œç„¶åå†è¿è¡Œè„šæœ¬./getcov â€“showæŸ¥çœ‹ç»“æœï¼š&lt;br&gt;&lt;img src=&quot;http://7xpjm0.com1.z0.glb.clouddn.com/%E5%AE%8C%E5%85%A8%E8%A6%86%E7%9B%96.jpeg&quot; alt=&quot;å®Œå…¨è¦†ç›–&quot;&gt;&lt;br&gt;å¯ä»¥çœ‹å‡ºç°åœ¨çš„æµ‹è¯•ä»£ç å·²ç»è¦†ç›–åˆ°äº†è¯¥å‡½æ•°çš„æ‰€æœ‰ä»£ç ã€‚&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;â€ƒâ€ƒæœ€è¿‘åœ¨é¡¹ç›®é‡Œéœ€è¦åœ¨å•å…ƒæµ‹è¯•æ—¶ç»Ÿè®¡ä¸€ä¸‹&lt;a href=&quot;http://www.cnblogs.com/coderzh/archive/2009/03/29/1424344.html&quot;&gt;ä»£ç è¦†ç›–ç‡&lt;/a&gt;ï¼Œå…¶å®å°±æ˜¯è¢«ç”¨æ¥ä½œä¸ºæµ‹é‡å•å…ƒæµ‹è¯•çš„æŒ‡æ ‡ï¼Œçœ‹çœ‹æµ‹è¯•çš„ä»£ç è¦†ç›–åˆ°å¤šå¹¿çš„èŒƒå›´ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç»Ÿè®¡å•å…ƒæµ‹è¯•çš„ä»£ç è¦†ç›–ç‡ï¼š&lt;/p&gt;
&lt;h4 id=&quot;ä¸‹è½½å·¥å…·&quot;&gt;&lt;a href=&quot;#ä¸‹è½½å·¥å…·&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½å·¥å…·&quot;&gt;&lt;/a&gt;ä¸‹è½½å·¥å…·&lt;/h4&gt;&lt;p&gt;â€ƒâ€ƒä¸»è¦é‡‡ç”¨&lt;a href=&quot;https://github.com/jonreid/XcodeCoverage&quot;&gt;XcodeCoverage&lt;/a&gt;å·¥å…·ï¼Œå®ƒå¯ä»¥å°†ä»£ç è¦†ç›–çš„ç»“æœä»¥htmlçš„å½¢å¼å±•ç°ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ï¼Œå¯ä»¥é‡‡ç”¨podçš„æ–¹å¼å®‰è£…:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;XcodeCoverage&amp;apos;, &amp;apos;~&amp;gt;1.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;å·¥ç¨‹é…ç½®&quot;&gt;&lt;a href=&quot;#å·¥ç¨‹é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;å·¥ç¨‹é…ç½®&quot;&gt;&lt;/a&gt;å·¥ç¨‹é…ç½®&lt;/h4&gt;&lt;p&gt;podå®‰è£…åéœ€è¦é…ç½®å·¥ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½® Build Settings&lt;br&gt;éœ€è¦è®¾ç½®ä¸¤ä¸ªåœ°æ–¹ï¼Œæ‰¾åˆ° â€œGenerate Test Coverage Filesâ€å’Œâ€œInstrument Program Flowâ€ä¸¤ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«è®¾ç½®Debugä¸‹ä¸ºYESï¼š&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="others" scheme="http://freemind-lj.github.io/categories/others/"/>
    
    
      <category term="æµ‹è¯•" scheme="http://freemind-lj.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
